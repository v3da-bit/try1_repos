!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@remusao/smaz"),require("@cliqz/adblocker-extended-selectors"),require("@remusao/guess-url-type"),require("tldts-experimental"),require("@remusao/small")):"function"==typeof define&&define.amd?define(["exports","@remusao/smaz","@cliqz/adblocker-extended-selectors","@remusao/guess-url-type","tldts-experimental","@remusao/small"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={},e.smaz,e.adblockerExtendedSelectors,e.guessUrlType,e.tldtsExperimental,e.small)}(this,(function(e,t,s,i,r,n){"use strict";var o=["%3D%3D%2527%252Cnecessary%3Atrue%252Cpreferences%3Afalse%252Cstatistics%3Afalse%252Cmarketing%3Afalse%252Cmethod%3A%2527explicit%2527%252Cve",'div[style="position: absolute; inset: 0px; overflow: hidden; z-index: 160; background: transparent none repeat scroll 0% 0%; display: block;','div[style="position: fixed; display: block; width: 100%; height: 100%; inset: 0px; background-color: rgba(0, 0, 0, 0); z-index: 300000;"]','"]:not([style^="width: 1px; height: 1px; position: absolute; left: -10000px; top: -"])',"acs, document.createElement, %2Fl%5C.parentNode%5C.insertBefore%5C(s%2F","%2Fvisit%2F%22%5D%5Btitle%5E%3D%22https%3A%2F%2F%22%5D, %5Btitle%5D","rmnt, script, %2Fh%3DdecodeURIComponent%7CpopundersPerIP%2F",':not([style^="position: absolute; left: -5000px"])',"href-sanitizer, a%5Bhref%5E%3D%22https%3A%2F%2F","ra, oncontextmenu%7Condragstart%7Conselectstart","acs, document.querySelectorAll, popMagic","acs, addEventListener, google_ad_client","aost, String.prototype.charCodeAt, ai_","aopr, app_vars.force_disable_adblock",'paid.outbrain.com/network/redir?"]',"acs, document.addEventListener, ","acs, document.getElementById, ","no-fetch-if, googlesyndication","aopr, document.dispatchEvent","no-xhr-if, googlesyndication",", document.createElement, ","acs, String.fromCharCode, ","%2522%253Afalse%252C%2522",", document.oncontextmenu","aeld, DOMContentLoaded, ","nosiif, visibility, 1000","set-local-storage-item, ","trusted-click-element, ","set, blurred, false","acs, eval, replace","decodeURIComponent",'[target="_blank"]',"%22%3Afalse%2C%22","^script:has-text(","Object.prototype.",'[href^="https://','[href^="http://','[href="https://','[src^="https://',"modal-backdrop","rmnt, script, ","BlockDetected","console.clear","trusted-set-","contextmenu","no-fetch-if","otification",":has-text(","background",'[class*="','[class^="',"AAAAAAAAA","body,html","container","Container","decodeURI","div[class",'div[id^="',"div[style","document.","no-xhr-if","ompliance","placehold","sbygoogle",'[href*="',"#wpsafe-","Detector","disclaim","nano-sib","nextFunc","noopFunc","nostif, ","nowebrtc",'.com/"]',"300x250","article","consent","Consent","content","display","message","Message","overlay","privacy","sidebar","sponsor","wrapper","[data-","%7B%7D","728x90","accept","Accept","aopr, ","banner","bottom","cookie","Cookie","nosiif","notice","nowoif","policy","Policy","script","Script","widget",":has(",":not(","block","Block","click","deskt","disab","fixed","frame","modal","popup","video","0px;","2%3A","aeld","body","butt","down","foot","gdpr","goog","html","icky","ight","show","tion","true"," > ","%3D","%7C","age","box","div","ent","out","rap","set","__",", ",".t",'"]',"%2","%5",'="',"00","ac","ad","Ad","al","an","ar","at","e-","ed","en","er","he","id","in","is","la","le","lo","od","ol","om","on","op","or","re","s_","s-","se","st","t-","te","ti","un"," ","_","-",";",":",".","(",")","[","]","*","/","#","^","0","1","2","3","4","5","6","7","8","9","b","B","c","C","d","D","e","E","f","F","g","G","h","H","I","j","J","k","l","L","m","M","n","N","o","O","p","P","q","Q","r","R","s","S","t","T","u","U","v","V","w","W","x","y","Y","z","Z"],a=["sandbox allow-forms allow-same-origin allow-scripts allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-top-navigation","script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:","script-src 'self' 'unsafe-inline' 'unsafe-eval' "," *.google.com *.gstatic.com *.googleapis.com",".com *.google.com *.googletagmanager.com *.","script-src 'self' '*' 'unsafe-inline'","default-src 'unsafe-inline' 'self'"," *.google.com *.gstatic.com *.","t-src 'self' 'unsafe-inline' ","script-src * 'unsafe-inline'",".com *.googleapis.com *."," *.googletagmanager.com","default-src 'self' *.","frame-src 'self' *"," *.cloudflare.com","child-src 'none';","worker-src 'none'"," 'unsafe-inline'","google-analytics"," 'unsafe-eval'","bootstrapcdn","connect-src ","child-src *"," *.gstatic","googleapis","script-src","style-src ","frame-src","facebook","https://"," 'self'",".com *.",".net *.","addthis","captcha","gstatic","youtube","defaul","disqus","google","jquery","data:","scrip","-src",".com",".net","n.cc"," *.","age","dia","img","vic"," *","*.","ch","el","im","in","ra","re","tt","wi","wp","yt"," ","-",";",":",".","'","*","/","3","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y"],h=["/homad-global-configs.schneevonmorgen.com/global_config","/videojs-vast-vpaid@2.0.2/bin/videojs_5.vast.vpaid.min","/etc.clientlibs/logitech-common/clientlibs/onetrust.","[\\/]{1,}.*[a-zA-Z0-9]{3,7}\\/[a-zA-Z0-9]{6,}\\/.*/","/pagead/managed/js/adsense/*/show_ads_impl","/pagead/managed/js/gpt/*/pubads_impl","/pagead/js/adsbygoogle.js","/vans-adapter-google-ima","/js/sdkloader/ima3_dai","/js/sdkloader/ima3.js","/videojs-contrib-ads","/wp-content/plugins/","/wp-content/uploads/","/wp-content/themes/","/detroitchicago/","/appmeasurement","/413gkwmt/init","/cdn-cgi/trace","/style/03/img/","\\/[a-zA-Z0-9]{","/^https?:\\/\\/","/^https:\\/\\/","notification","fingerprint","/ljub4etb/","impression","[a-z0-9]{","/plugins/","affiliate","analytics","(.+?\\.)?","[0-9a-z]","/assets/","/images/","/pagead/","pageview","template","tracking","300x250","collect","consent","content","counter","default","metrics","privacy","[a-z]{","/embed","/video","728x90","aptcha","banner","bundle","client","cookie","detect","dn-cgi","google","iframe","module","prebid","public","script","source","widget",".aspx",".cgi?",".com/",".html","/api/","/beac","/html","/java","/stat","block","click","count","event","manag","media","pixel","popup","track","type=",".css",".gif",".jpg",".min",".php",".png","/img","/jqu","/js/","/lib","/log","/web","/wp-","468x","data","gdpr","gi-b","ight","mail","plug","show","stat","uild","view",".js","/ad","=*&","age","fig","jax","key","lay","log","sdk","tag","web","ync","*/","*^","/_","/?","/*","/1","/d","/f","/g","/h","/l","/n","/r","/u","/v","/w","\\/","^*","00","ac","ad","al","am","an","ap","ar","as","at","bo","ce","ch","ck","co","de","di","e/","ed","el","en","eo","er","et","g/","he","ic","id","im","in","is","it","js","la","le","li","lo","mp","o/","ol","om","on","op","or","ot","re","ro","s_","s-","s?","s/","sp","ss","st","t/","te","ti","tm","tr","ub","um","un","ur","us","ut","ve","_","-",",",":","?",".","}","*","/","\\","&","^","=","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],l=["securepubads.g.doubleclick",".xx.fbcdn.net.iberostar","googlesyndication","imasdk.googleapis",".cloudfront.net",".actonservice","analytics.","marketing.","tracking.","metrics.","images.",".co.uk","a8clk.","stats.","a8cv.","media","track",".com",".net",".top",".xyz","tion","www.",".io",".jp","app","cdn","new","web",".b",".c",".d",".f",".g",".h",".k",".m",".n",".p",".s",".t",".v",".w","a1","a4","a8","ab","ac","ad","af","ag","ai","ak","al","am","an","ap","ar","as","at","au","av","aw","ax","ay","az","be","bl","bo","br","bu","ca","ce","ch","ci","ck","cl","cr","ct","cu","de","di","dn","do","dr","ds","du","dy","e-","eb","ec","ed","ef","eg","el","em","en","ep","er","es","et","eu","ev","ew","ex","ey","fe","ff","fi","fl","fo","fr","ge","gh","go","gr","gu","he","ho","ia","ib","ic","id","ie","if","ig","ik","il","im","in","ip","ir","is","it","iv","ix","iz","jo","ks","la","ld","le","li","ll","lo","lu","ly","ma","me","mo","mp","my","ne","no","ob","ok","ol","om","on","oo","op","or","ot","ou","ow","pa","pe","ph","pl","po","pr","pu","qu","ra","re","ro","ru","ry","s-","sc","se","sh","si","sk","sn","so","sp","ss","st","su","sw","sy","t-","ta","te","th","ti","tn","to","tr","ts","tu","tw","ty","ub","ul","um","un","up","ur","us","ut","ve","vi","vo","we","-",".","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],c=["google-analytics.com/analytics.js","googlesyndication_adsbygoogle.js","googletagmanager.com/gtm.js","googletagservices_gpt.js","googletagmanager_gtm.js","fuckadblock.js-3.2.0","amazon_apstag.js","google-analytics","fingerprint2.js","noop-1s.mp4:10","google-ima.js","noop-0.1s.mp3","prebid-ads.js","nobab2.js:10","noopmp3-0.1s","noop-1s.mp4","hd-main.js","noopmp4-1s","32x32.png","noop.html","noopframe","noop.txt","nooptext","1x1.gif","2x2.png","noop.js","noopjs",".com/",".js:5","noop",":10",".js","ads","bea","_a",":5","am","ar","ch","ic","in","le","on","re","st","_","-",":",".","/","0","1","2","3","4","5","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","r","s","t","u","v","w","x","y","z"],d=["/js/sdkloader/ima3.j",",redirect-rule=noop",".com^$third-party","googlesyndication","imasdk.googleapis",".cloudfront.net^",",redirect-rule=","$script,domain=",",redirect=noop","xmlhttprequest",".actonservice","^$third-party","||smetrics.","third-party","marketing.","analytics",",domain=","metrics.","tracking","$script",".co.uk","$ghide","a8clk.","cookie","google","script","stats.",".com^",".top^",".xyz^","/wp-c","$doma","a8cv.","image","media","track",".au^",".com",".fr^",".gif",".jp^",".net","/js/","$doc","$xhr","www.",",1p",",3p",".jp",".js","app","cdn","ent","new","web",".b",".c",".d",".f",".k",".m",".n",".p",".s",".t","@@","/*","/p","||","ab","ac","ad","af","ag","ak","al","am","an","ap","ar","as","at","au","av","aw","ax","ay","az","be","bo","br","ca","ce","ch","ck","cl","cr","ct","de","di","do","ds","e-","e^","eb","ec","ed","el","em","en","ep","er","es","et","ev","ew","ex","fe","ff","fi","fo","fr","g^","ge","gi","go","gr","gu","he","hi","ho","hp","ht","ic","id","ig","il","im","in","io","ip","ir","is","it","ix","iz","jo","js","ke","le","li","lo","lu","ly","me","mo","mp","my","ne","no","od","ok","ol","om","on","op","or","ot","pl","po","pr","qu","re","ri","ro","ru","s-","s/","sc","se","sh","si","so","sp","ss","st","su","sw","te","th","ti","to","tr","ts","ub","ud","ul","um","un","up","ur","us","ut","ve","vi","yo","_","-",",","?",".","*","/","^","=","|","~","$","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],u=["-webkit-touch-callou","app_vars.force_disab","nosiif, visibility, ","overflow: auto !impo","rtant; position: ini","set-local-storage-it","set, blurred, false)","user-select: text !i","##^script:has-text(","##body,html:style(","decodeURIComponent",'[href^="https://',"acs, document.","rmnt, script, "," !important;","trusted-set-",", noopFunc)","contextmenu","no-fetch-if","otification",".com##+js(","%2522%253A","%252C%2522",'="https://',"background","t: default"," -webkit-",".*,xhamst","container","mportant;","AAAAAAAA","disclaim","nostif, ",",google",":style(",".co.uk,","consent","content","message","nowoif)","privacy","-wrapp",",kayak","[class","##+js(","accept","aopr, ","banner","bottom","cookie","Cookie","notice","policy","widget",":has(","##div","block","cript","true)",".co.",".com",".de,",".fr,",".net",".nl,",".pl,",".xyz","#@#.","2%3A","gdpr","goog","html","ight","news","text","wrap"," > ",".*,","##.","###","%3D","%7C","ent","lay","web","__","-s",", ",",b",",c",",f",",g",",m",",p",",s",",t",": ",".*",".b",".c",".m",".p",".s",'"]',"##","%2","%5",'="',"00","a-","ab","ac","ad","Ad","af","ag","ak","al","am","an","ap","ar","as","at","au","av","ay","az","bo","ch","ck","co","ct","de","di","do","e-","ed","el","em","en","er","es","et","ex","fi","fo","he","ic","id","if","il","im","in","is","it","le","li","lo","mo","mp","ol","om","on","op","or","ot","ov","ow","po","re","ro","s_","s-","se","sh","si","sp","st","t-","th","ti","tr","tv","ub","ul","um","un","up","ur","us","ut","ve","vi"," ","_","-",",",";",":",".","(",")","[","/","^","0","1","2","3","4","5","6","7","8","9","a","b","B","c","C","d","D","e","E","f","F","g","h","i","I","j","k","l","L","m","M","n","o","p","P","q","r","R","s","S","t","T","u","v","w","x","y","z"];class f{constructor(){this.cosmeticSelector=new t.Smaz(o),this.networkCSP=new t.Smaz(a),this.networkRedirect=new t.Smaz(c),this.networkHostname=new t.Smaz(l),this.networkFilter=new t.Smaz(h),this.networkRaw=new t.Smaz(d),this.cosmeticRaw=new t.Smaz(u)}}const p=(()=>{let e=0;const t=new Int32Array(256);for(let s=0;256!==s;s+=1)e=s,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,e=1&e?-306674912^e>>>1:e>>>1,t[s]=e;return t})();const g=2147483647,m=36,y=1,b=26,w=38,v=700,k=72,x=128,S="-",z=/[^\0-\x7E]/,F=/[\x2E\u3002\uFF0E\uFF61]/g,A={"invalid-input":"Invalid input","not-basic":"Illegal input >= 0x80 (not a basic code point)",overflow:"Overflow: input needs wider integers to process"},I=m-y;function C(e){throw new RangeError(A[e])}function U(e,t){return e+22+75*(e<26?1:0)-0}function R(e,t,s){let i=0;for(e=s?Math.floor(e/v):e>>1,e+=Math.floor(e/t);e>I*b>>1;i+=m)e=Math.floor(e/I);return Math.floor(i+(I+1)*e/(e+w))}function j(e){const t=[],s=e.length;let i=0,r=x,n=k,o=e.lastIndexOf(S);o<0&&(o=0);for(let s=0;s<o;++s)e.charCodeAt(s)>=128&&C("not-basic"),t.push(e.charCodeAt(s));for(let h=o>0?o+1:0;h<s;){const o=i;for(let t=1,r=m;;r+=m){h>=s&&C("invalid-input");const o=(a=e.charCodeAt(h++))-48<10?a-22:a-65<26?a-65:a-97<26?a-97:m;(o>=m||o>Math.floor((g-i)/t))&&C("overflow"),i+=o*t;const l=r<=n?y:r>=n+b?b:r-n;if(o<l)break;const c=m-l;t>Math.floor(g/c)&&C("overflow"),t*=c}const l=t.length+1;n=R(i-o,l,0===o),Math.floor(i/l)>g-r&&C("overflow"),r+=Math.floor(i/l),i%=l,t.splice(i++,0,r)}var a;return String.fromCodePoint.apply(null,t)}function E(e){const t=[],s=function(e){const t=[];let s=0;const i=e.length;for(;s<i;){const r=e.charCodeAt(s++);if(r>=55296&&r<=56319&&s<i){const i=e.charCodeAt(s++);56320==(64512&i)?t.push(((1023&r)<<10)+(1023&i)+65536):(t.push(r),s--)}else t.push(r)}return t}(e),i=s.length;let r=x,n=0,o=k;for(let e=0;e<s.length;e+=1){const i=s[e];i<128&&t.push(String.fromCharCode(i))}const a=t.length;let h=a;for(a&&t.push(S);h<i;){let e=g;for(let t=0;t<s.length;t+=1){const i=s[t];i>=r&&i<e&&(e=i)}const i=h+1;e-r>Math.floor((g-n)/i)&&C("overflow"),n+=(e-r)*i,r=e;for(let e=0;e<s.length;e+=1){const l=s[e];if(l<r&&++n>g&&C("overflow"),l===r){let e=n;for(let s=m;;s+=m){const i=s<=o?y:s>=o+b?b:s-o;if(e<i)break;const r=e-i,n=m-i;t.push(String.fromCharCode(U(i+r%n))),e=Math.floor(r/n)}t.push(String.fromCharCode(U(e))),o=R(n,i,h===a),n=0,++h}}++n,++r}return t.join("")}function H(e){const t=e.replace(F,".").split("."),s=[];for(let e=0;e<t.length;e+=1)s.push(z.test(t[e])?"xn--"+E(t[e]):t[e]);return s.join(".")}const L=new Uint8Array(0),T=new Uint32Array(0),O=1===new Int8Array(new Int16Array([1]).buffer)[0];let B,$=()=>{const e=new f;return $=()=>e,e};function _(e){return e<=127?1:5}function M(e,t){return P(e.length,t)}function P(e,t){return(t?3:0)+e+_(e)}function D(e){return e.length+_(e.length)}function q(e){const t=E(e).length;return t+_(t)}function N(e){return e.byteLength+_(e.length)}class W{static empty(e){return W.fromUint8Array(L,e)}static fromUint8Array(e,t){return new W(e,t)}static allocate(e,t){return new W(new Uint8Array(e),t)}constructor(e,{enableCompression:t}){if(!1===O)throw new Error("Adblocker currently does not support Big-endian systems");!0===t&&this.enableCompression(),this.buffer=e,this.pos=0}enableCompression(){this.compression=$()}checksum(){return function(e,t,s){let i=-1;const r=s-7;let n=t;for(;n<r;)i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])],i=i>>>8^p[255&(i^e[n++])];for(;n<r+7;)i=i>>>8^p[255&(i^e[n++])];return~i>>>0}(this.buffer,0,this.pos)}dataAvailable(){return this.pos<this.buffer.byteLength}setPos(e){this.pos=e}getPos(){return this.pos}seekZero(){this.pos=0}slice(){return this.checkSize(),this.buffer.slice(0,this.pos)}subarray(){return this.pos===this.buffer.byteLength?this.buffer:(this.checkSize(),this.buffer.subarray(0,this.pos))}align4(){this.pos=this.pos+3&-4}set(e){this.buffer=new Uint8Array(e),this.seekZero()}pushBool(e){this.pushByte(Number(e))}getBool(){return Boolean(this.getByte())}setByte(e,t){this.buffer[e]=t}pushByte(e){this.pushUint8(e)}getByte(){return this.getUint8()}pushBytes(e,t=!1){this.pushLength(e.length),!0===t&&this.align4(),this.buffer.set(e,this.pos),this.pos+=e.byteLength}getBytes(e=!1){const t=this.getLength();!0===e&&this.align4();const s=this.buffer.subarray(this.pos,this.pos+t);return this.pos+=t,s}getUint32ArrayView(e){if(this.align4(),0===e)return T;const t=new Uint32Array(this.buffer.buffer,this.pos+this.buffer.byteOffset,e);return this.pos+=4*e,t}pushUint8(e){this.buffer[this.pos++]=e}getUint8(){return this.buffer[this.pos++]}pushUint16(e){this.buffer[this.pos++]=e>>>8,this.buffer[this.pos++]=e}getUint16(){return(this.buffer[this.pos++]<<8|this.buffer[this.pos++])>>>0}pushUint32(e){this.buffer[this.pos++]=e>>>24,this.buffer[this.pos++]=e>>>16,this.buffer[this.pos++]=e>>>8,this.buffer[this.pos++]=e}getUint32(){return(this.buffer[this.pos++]<<24>>>0)+(this.buffer[this.pos++]<<16|this.buffer[this.pos++]<<8|this.buffer[this.pos++])>>>0}pushUint32Array(e){this.pushLength(e.length);for(const t of e)this.pushUint32(t)}getUint32Array(){const e=this.getLength(),t=new Uint32Array(e);for(let s=0;s<e;s+=1)t[s]=this.getUint32();return t}pushUTF8(e){const t=E(e);this.pushLength(t.length);for(let e=0;e<t.length;e+=1)this.buffer[this.pos++]=t.charCodeAt(e)}getUTF8(){const e=this.getLength();return this.pos+=e,j(String.fromCharCode.apply(null,this.buffer.subarray(this.pos-e,this.pos)))}pushASCII(e){this.pushLength(e.length);for(let t=0;t<e.length;t+=1)this.buffer[this.pos++]=e.charCodeAt(t)}getASCII(){const e=this.getLength();return this.pos+=e,String.fromCharCode.apply(null,this.buffer.subarray(this.pos-e,this.pos))}pushNetworkRedirect(e){void 0!==this.compression?this.pushBytes(this.compression.networkRedirect.compress(e)):this.pushASCII(e)}getNetworkRedirect(){return void 0!==this.compression?this.compression.networkRedirect.decompress(this.getBytes()):this.getASCII()}pushNetworkHostname(e){void 0!==this.compression?this.pushBytes(this.compression.networkHostname.compress(e)):this.pushASCII(e)}getNetworkHostname(){return void 0!==this.compression?this.compression.networkHostname.decompress(this.getBytes()):this.getASCII()}pushNetworkCSP(e){void 0!==this.compression?this.pushBytes(this.compression.networkCSP.compress(e)):this.pushASCII(e)}getNetworkCSP(){return void 0!==this.compression?this.compression.networkCSP.decompress(this.getBytes()):this.getASCII()}pushNetworkFilter(e){void 0!==this.compression?this.pushBytes(this.compression.networkFilter.compress(e)):this.pushASCII(e)}getNetworkFilter(){return void 0!==this.compression?this.compression.networkFilter.decompress(this.getBytes()):this.getASCII()}pushCosmeticSelector(e){void 0!==this.compression?this.pushBytes(this.compression.cosmeticSelector.compress(e)):this.pushASCII(e)}getCosmeticSelector(){return void 0!==this.compression?this.compression.cosmeticSelector.decompress(this.getBytes()):this.getASCII()}pushRawCosmetic(e){void 0!==this.compression?this.pushBytes(this.compression.cosmeticRaw.compress(E(e))):this.pushUTF8(e)}getRawCosmetic(){return void 0!==this.compression?j(this.compression.cosmeticRaw.decompress(this.getBytes())):this.getUTF8()}pushRawNetwork(e){void 0!==this.compression?this.pushBytes(this.compression.networkRaw.compress(E(e))):this.pushUTF8(e)}getRawNetwork(){return void 0!==this.compression?j(this.compression.networkRaw.decompress(this.getBytes())):this.getUTF8()}checkSize(){if(0!==this.pos&&this.pos>this.buffer.byteLength)throw new Error(`StaticDataView too small: ${this.buffer.byteLength}, but required ${this.pos} bytes`)}pushLength(e){e<=127?this.pushUint8(e):(this.pushUint8(128),this.pushUint32(e))}getLength(){const e=this.getUint8();return 128===e?this.getUint32():e}}class G{static deserialize(e){return new G({debug:e.getBool(),enableCompression:e.getBool(),enableHtmlFiltering:e.getBool(),enableInMemoryCache:e.getBool(),enableMutationObserver:e.getBool(),enableOptimizations:e.getBool(),enablePushInjectionsOnNavigationEvents:e.getBool(),guessRequestTypeFromUrl:e.getBool(),integrityCheck:e.getBool(),loadCSPFilters:e.getBool(),loadCosmeticFilters:e.getBool(),loadExceptionFilters:e.getBool(),loadExtendedSelectors:e.getBool(),loadGenericCosmeticsFilters:e.getBool(),loadNetworkFilters:e.getBool(),loadPreprocessors:e.getBool()})}constructor({debug:e=!1,enableCompression:t=!1,enableHtmlFiltering:s=!1,enableInMemoryCache:i=!0,enableMutationObserver:r=!0,enableOptimizations:n=!0,enablePushInjectionsOnNavigationEvents:o=!0,guessRequestTypeFromUrl:a=!1,integrityCheck:h=!0,loadCSPFilters:l=!0,loadCosmeticFilters:c=!0,loadExceptionFilters:d=!0,loadExtendedSelectors:u=!1,loadGenericCosmeticsFilters:f=!0,loadNetworkFilters:p=!0,loadPreprocessors:g=!1}={}){this.debug=e,this.enableCompression=t,this.enableHtmlFiltering=s,this.enableInMemoryCache=i,this.enableMutationObserver=r,this.enableOptimizations=n,this.enablePushInjectionsOnNavigationEvents=o,this.guessRequestTypeFromUrl=a,this.integrityCheck=h,this.loadCSPFilters=l,this.loadCosmeticFilters=c,this.loadExceptionFilters=d,this.loadExtendedSelectors=u,this.loadGenericCosmeticsFilters=f,this.loadNetworkFilters=p,this.loadPreprocessors=g}getSerializedSize(){return 16}serialize(e){e.pushBool(this.debug),e.pushBool(this.enableCompression),e.pushBool(this.enableHtmlFiltering),e.pushBool(this.enableInMemoryCache),e.pushBool(this.enableMutationObserver),e.pushBool(this.enableOptimizations),e.pushBool(this.enablePushInjectionsOnNavigationEvents),e.pushBool(this.guessRequestTypeFromUrl),e.pushBool(this.integrityCheck),e.pushBool(this.loadCSPFilters),e.pushBool(this.loadCosmeticFilters),e.pushBool(this.loadExceptionFilters),e.pushBool(this.loadExtendedSelectors),e.pushBool(this.loadGenericCosmeticsFilters),e.pushBool(this.loadNetworkFilters),e.pushBool(this.loadPreprocessors)}}const V="undefined"!=typeof window&&"function"==typeof window.queueMicrotask?e=>window.queueMicrotask(e):e=>(B||(B=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));function Z(e,t,s){let i=s.get(e);void 0===i&&(i=[],s.set(e,i)),i.push(t)}function K(e,t,s){const i=s.get(e);if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}function X(e,t,s){if(0===s.size)return!1;const i=s.get(e);return void 0!==i&&(V((()=>{for(const e of i)e(...t)})),!0)}class J{constructor(){this.onceListeners=new Map,this.onListeners=new Map}on(e,t){Z(e,t,this.onListeners)}once(e,t){Z(e,t,this.onceListeners)}unsubscribe(e,t){K(e,t,this.onListeners),K(e,t,this.onceListeners)}emit(e,...t){X(e,t,this.onListeners),!0===X(e,t,this.onceListeners)&&this.onceListeners.delete(e)}}function Q(e,t){let s=3;const i=()=>e(t).catch((e=>{if(s>0)return s-=1,new Promise(((e,t)=>{setTimeout((()=>{i().then(e).catch(t)}),500)}));throw e}));return i()}function Y(e,t){return Q(e,t).then((e=>e.text()))}const ee="https://raw.githubusercontent.com/ghostery/adblocker/master/packages/adblocker/assets",te=[`${ee}/easylist/easylist.txt`,`${ee}/peter-lowe/serverlist.txt`,`${ee}/ublock-origin/badware.txt`,`${ee}/ublock-origin/filters-2020.txt`,`${ee}/ublock-origin/filters-2021.txt`,`${ee}/ublock-origin/filters-2022.txt`,`${ee}/ublock-origin/filters-2023.txt`,`${ee}/ublock-origin/filters-2024.txt`,`${ee}/ublock-origin/filters.txt`,`${ee}/ublock-origin/quick-fixes.txt`,`${ee}/ublock-origin/resource-abuse.txt`,`${ee}/ublock-origin/unbreak.txt`],se=[...te,`${ee}/easylist/easyprivacy.txt`,`${ee}/ublock-origin/privacy.txt`],ie=[...se,`${ee}/easylist/easylist-cookie.txt`,`${ee}/ublock-origin/annoyances-others.txt`,`${ee}/ublock-origin/annoyances-cookies.txt`];function re(e,t){return Promise.all(t.map((t=>Y(e,t))))}function ne(e){return Y(e,`${ee}/ublock-origin/resources.txt`)}class oe{constructor(){this.options=new Set,this.prefix=void 0,this.infix=void 0,this.suffix=void 0,this.redirect=void 0}blockRequestsWithType(e){if(this.options.has(e))throw new Error(`Already blocking type ${e}`);return this.options.add(e),this}images(){return this.blockRequestsWithType("image")}scripts(){return this.blockRequestsWithType("script")}frames(){return this.blockRequestsWithType("frame")}fonts(){return this.blockRequestsWithType("font")}medias(){return this.blockRequestsWithType("media")}styles(){return this.blockRequestsWithType("css")}redirectTo(e){if(void 0!==this.redirect)throw new Error(`Already redirecting: ${this.redirect}`);return this.redirect=`redirect=${e}`,this}urlContains(e){if(void 0!==this.infix)throw new Error(`Already matching pattern: ${this.infix}`);return this.infix=e,this}urlStartsWith(e){if(void 0!==this.prefix)throw new Error(`Already matching prefix: ${this.prefix}`);return this.prefix=`|${e}`,this}urlEndsWith(e){if(void 0!==this.suffix)throw new Error(`Already matching suffix: ${this.suffix}`);return this.suffix=`${e}|`,this}withHostname(e){if(void 0!==this.prefix)throw new Error(`Cannot match hostname if filter already has prefix: ${this.prefix}`);return this.prefix=`||${e}^`,this}toString(){const e=[];void 0!==this.prefix&&e.push(this.prefix),void 0!==this.infix&&e.push(this.infix),void 0!==this.suffix&&e.push(this.suffix);const t=["important"];if(0!==this.options.size)for(const e of this.options)t.push(e);return void 0!==this.redirect&&t.push(this.redirect),`${0===e.length?"*":e.join("*")}$${t.join(",")}`}}function ae(){return new oe}const he=new class{constructor(e){this.pos=0,this.buffer=new Uint32Array(e)}reset(){this.pos=0}slice(){return this.buffer.slice(0,this.pos)}push(e){this.buffer[this.pos++]=e}empty(){return 0===this.pos}full(){return this.pos===this.buffer.length}remaining(){return this.buffer.length-this.pos}}(1024),le=37,ce=5011;function de(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24}function ue(e,t){return!!(e&t)}function fe(e,t){return e|t}function pe(e,t){return e&~t}function ge(e,t,s){let i=ce;for(let r=t;r<s;r+=1)i=i*le^e.charCodeAt(r);return i>>>0}function me(e){return"string"!=typeof e||0===e.length?ce:ge(e,0,e.length)}function ye(e){const t=new Uint32Array(e.length);let s=0;for(const i of e)t[s++]=me(i);return t}function be(e,t){if(e.length<t.length)return!1;const s=t.length;for(let i=0;i<s;i+=1)if(e[i]!==t[i])return!1;return!0}function we(e,t,s){if(e.length-s<t.length)return!1;const i=s+t.length;for(let r=s;r<i;r+=1)if(e[r]!==t[r-s])return!1;return!0}function ve(e){return e>=48&&e<=57}function ke(e){return e>=97&&e<=122||e>=65&&e<=90}function xe(e){return ke(e)||ve(e)||37===e||function(e){return e>=192&&e<=450}(e)||function(e){return e>=1024&&e<=1279}(e)}function Se(e,t,s,i){const r=Math.min(e.length,2*i.remaining());let n=!1,o=0,a=ce;for(let s=0;s<r;s+=1){const r=e.charCodeAt(s);!0===xe(r)?(!1===n&&(a=ce,n=!0,o=s),a=a*le^r):!0===n&&(n=!1,s-o>1&&(!1===t||0!==o)&&i.push(a>>>0))}!0===n&&!1===s&&e.length-o>1&&!1===i.full()&&i.push(a>>>0)}function ze(e,t){const s=Math.min(e.length,2*t.remaining());let i=!1,r=0,n=ce;for(let o=0;o<s;o+=1){const s=e.charCodeAt(o);!0===xe(s)?(!1===i&&(n=ce,i=!0,r=o),n=n*le^s):!0===i&&(i=!1,o-r>1&&t.push(n>>>0))}!0===i&&e.length-r>1&&!1===t.full()&&t.push(n>>>0)}function Fe(e){return he.reset(),ze(e,he),he.slice()}function Ae(e,t){return-1!==function(e,t){if(0===e.length)return-1;let s=0,i=e.length-1;for(;s<=i;){const r=s+i>>>1,n=e[r];if(n<t)s=r+1;else{if(!(n>t))return r;i=r-1}}return-1}(e,t)}const Ie=/[^\u0000-\u00ff]/;function Ce(e){return Ie.test(e)}const Ue={extractHostname:!0,mixedInputs:!1,validateHostname:!1},Re={beacon:me("type:beacon"),cspReport:me("type:csp"),csp_report:me("type:csp"),cspviolationreport:me("type:cspviolationreport"),document:me("type:document"),eventsource:me("type:other"),fetch:me("type:xhr"),font:me("type:font"),image:me("type:image"),imageset:me("type:image"),mainFrame:me("type:document"),main_frame:me("type:document"),manifest:me("type:other"),media:me("type:media"),object:me("type:object"),object_subrequest:me("type:object"),other:me("type:other"),ping:me("type:ping"),prefetch:me("type:other"),preflight:me("type:preflight"),script:me("type:script"),signedexchange:me("type:signedexchange"),speculative:me("type:other"),stylesheet:me("type:stylesheet"),subFrame:me("type:subdocument"),sub_frame:me("type:subdocument"),texttrack:me("type:other"),webSocket:me("type:websocket"),web_manifest:me("type:other"),websocket:me("type:websocket"),xhr:me("type:xhr"),xml_dtd:me("type:other"),xmlhttprequest:me("type:xhr"),xslt:me("type:other")};function je(e){let t=ce;for(let s=e.length-1;s>=0;s-=1)t=t*le^e.charCodeAt(s);return t>>>0}function Ee(e,t,s){he.reset();let i=ce;for(let r=t-1;r>=0;r-=1){const t=e.charCodeAt(r);46===t&&r<s&&he.push(i>>>0),i=i*le^t}return he.push(i>>>0),he.slice()}function He(e,t){const s=function(e,t){let s=null;const i=t.indexOf(".");if(-1!==i){const r=t.slice(i+1);s=e.slice(0,-r.length-1)}return s}(e,t);return null!==s?Ee(s,s.length,s.length):T}function Le(e,t){return Ee(e,e.length,e.length-t.length)}class Te{static fromRawDetails({requestId:e="0",tabId:t=0,url:s="",hostname:i,domain:n,sourceUrl:o="",sourceHostname:a,sourceDomain:h,type:l="main_frame",_originalRequestDetails:c}){if(s=s.toLowerCase(),void 0===i||void 0===n){const e=r.parse(s,Ue);i=i||e.hostname||"",n=n||e.domain||""}if(void 0===a||void 0===h){const e=r.parse(a||h||o,Ue);a=a||e.hostname||"",h=h||e.domain||a||""}return new Te({requestId:e,tabId:t,domain:n,hostname:i,url:s,sourceDomain:h,sourceHostname:a,sourceUrl:o,type:l,_originalRequestDetails:c})}constructor({requestId:e,tabId:t,type:s,domain:i,hostname:r,url:n,sourceDomain:o,sourceHostname:a,_originalRequestDetails:h}){if(this.tokens=void 0,this.hostnameHashes=void 0,this.entityHashes=void 0,this._originalRequestDetails=h,this.id=e,this.tabId=t,this.type=s,this.url=n,this.hostname=r,this.domain=i,this.sourceHostnameHashes=0===a.length?T:Le(a,o),this.sourceEntityHashes=0===a.length?T:He(a,o),this.isThirdParty=function(e,t,s,i,r){return"main_frame"!==r&&"mainFrame"!==r&&(0!==t.length&&0!==i.length?t!==i:0!==t.length&&0!==s.length?t!==s:0!==i.length&&0!==e.length&&e!==i)}(r,i,a,o,s),this.isFirstParty=!this.isThirdParty,this.isSupported=!0,"websocket"===this.type||this.url.startsWith("ws:")||this.url.startsWith("wss:"))this.isHttp=!1,this.isHttps=!1,this.type="websocket",this.isSupported=!0;else if(this.url.startsWith("http:"))this.isHttp=!0,this.isHttps=!1;else if(this.url.startsWith("https:"))this.isHttps=!0,this.isHttp=!1;else if(this.url.startsWith("data:")){this.isHttp=!1,this.isHttps=!1;const e=this.url.indexOf(",");-1!==e&&(this.url=this.url.slice(0,e))}else this.isHttp=!1,this.isHttps=!1,this.isSupported=!1}getHostnameHashes(){return void 0===this.hostnameHashes&&(this.hostnameHashes=0===this.hostname.length?T:Le(this.hostname,this.domain)),this.hostnameHashes}getEntityHashes(){return void 0===this.entityHashes&&(this.entityHashes=0===this.hostname.length?T:He(this.hostname,this.domain)),this.entityHashes}getTokens(){if(void 0===this.tokens){he.reset();for(const e of this.sourceHostnameHashes)he.push(e);he.push(Re[this.type]),ze(this.url,he),this.tokens=he.slice()}return this.tokens}isMainFrame(){return"main_frame"===this.type||"mainFrame"===this.type}isSubFrame(){return"sub_frame"===this.type||"subFrame"===this.type}guessTypeOfRequest(){const e=this.type;return this.type=i(this.url),e!==this.type&&(this.tokens=void 0),this.type}}class Oe{static parse(e,t=!1){if(0===e.length)return;const s=[],i=[],r=[],n=[];for(let t of e){Ce(t)&&(t=H(t));const e=126===t.charCodeAt(0),o=42===t.charCodeAt(t.length-1)&&46===t.charCodeAt(t.length-2),a=e?1:0,h=o?t.length-2:t.length,l=je(!0===e||!0===o?t.slice(a,h):t);e?o?i.push(l):n.push(l):o?s.push(l):r.push(l)}return new Oe({entities:0!==s.length?new Uint32Array(s).sort():void 0,hostnames:0!==r.length?new Uint32Array(r).sort():void 0,notEntities:0!==i.length?new Uint32Array(i).sort():void 0,notHostnames:0!==n.length?new Uint32Array(n).sort():void 0,parts:!0===t?e.join(","):void 0})}static deserialize(e){const t=e.getUint8();return new Oe({entities:1&~t?void 0:e.getUint32Array(),hostnames:2&~t?void 0:e.getUint32Array(),notEntities:4&~t?void 0:e.getUint32Array(),notHostnames:8&~t?void 0:e.getUint32Array(),parts:16&~t?void 0:e.getUTF8()})}constructor({entities:e,hostnames:t,notEntities:s,notHostnames:i,parts:r}){this.entities=e,this.hostnames=t,this.notEntities=s,this.notHostnames=i,this.parts=r}updateId(e){const{hostnames:t,entities:s,notHostnames:i,notEntities:r}=this;if(void 0!==t)for(const s of t)e=e*le^s;if(void 0!==s)for(const t of s)e=e*le^t;if(void 0!==i)for(const t of i)e=e*le^t;if(void 0!==r)for(const t of r)e=e*le^t;return e}serialize(e){const t=e.getPos();e.pushUint8(0);let s=0;void 0!==this.entities&&(s|=1,e.pushUint32Array(this.entities)),void 0!==this.hostnames&&(s|=2,e.pushUint32Array(this.hostnames)),void 0!==this.notEntities&&(s|=4,e.pushUint32Array(this.notEntities)),void 0!==this.notHostnames&&(s|=8,e.pushUint32Array(this.notHostnames)),void 0!==this.parts&&(s|=16,e.pushUTF8(this.parts)),e.setByte(t,s)}getSerializedSize(){let e=1;return void 0!==this.entities&&(e+=N(this.entities)),void 0!==this.hostnames&&(e+=N(this.hostnames)),void 0!==this.notHostnames&&(e+=N(this.notHostnames)),void 0!==this.notEntities&&(e+=N(this.notEntities)),void 0!==this.parts&&(e+=q(this.parts)),e}match(e,t){if(void 0!==this.notHostnames)for(const t of e)if(Ae(this.notHostnames,t))return!1;if(void 0!==this.notEntities)for(const e of t)if(Ae(this.notEntities,e))return!1;if(void 0!==this.hostnames||void 0!==this.entities){if(void 0!==this.hostnames)for(const t of e)if(Ae(this.hostnames,t))return!0;if(void 0!==this.entities)for(const e of t)if(Ae(this.entities,e))return!0;return!1}return!0}}function Be(e){if(!1===e.startsWith("^script"))return;const t=":has-text(",s=[];let i=7;for(;e.startsWith(t,i);){i+=10;let t=1;const r=i;let n=-1;for(;i<e.length&&0!==t;i+=1){const s=e.charCodeAt(i);92!==n&&(40===s&&(t+=1),41===s&&(t-=1)),n=s}s.push(e.slice(r,i-1))}return i===e.length?["script",s]:void 0}function $e(e,t,s){for(const s of t)if(-1===e.indexOf(s))return!1;for(const t of s)if(!1===t.test(e))return!1;return!0}const _e=[T],Me="display: none !important;",Pe=new RegExp(/\\u002C/,"g"),De=new RegExp(/\\u005C/,"g"),qe=new RegExp(/\\,/,"g");function Ne(e){for(let t=1;t<e.length;t+=1){const s=e.charCodeAt(t);if(!(45===s||95===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122)){if(t<e.length-1){const i=e.charCodeAt(t+1);if(91===s||46===s||58===s||32===s&&(62===i||43===i||126===i||46===i||35===i))return!0}return!1}}return!0}function We(e,t){return e.startsWith('href^="',t)||e.startsWith('href*="',t)||e.startsWith('href="',t)}const Ge=(()=>{const e="undefined"!=typeof document?document.createElement("div"):{matches:()=>{}},t=/^[#.]?[\w-.]+$/;return function(s){if(t.test(s))return!0;try{(t=>{e.matches(t)})(s)}catch(e){return!1}return!0}})();class Ve{static parse(e,t=!1){const i=e;let r,n,o,a=0;const h=e.indexOf("#"),l=h+1;let c=l+1;if(e.length>l&&("@"===e[l]?(a=fe(a,1),c+=1):"?"===e[l]&&(c+=1)),c>=e.length)return null;if(h>0&&(n=Oe.parse(e.slice(0,h).split(","),t)),e.endsWith(":remove()"))a=fe(a,64),a=fe(a,128),e=e.slice(0,-9);else if(e.length-c>=8&&e.endsWith(")")&&-1!==e.indexOf(":style(",c)){const t=e.indexOf(":style(",c);o=e.slice(t+7,-1),e=e.slice(0,t)}if(94===e.charCodeAt(c)){if(!1===we(e,"script:has-text(",c+1)||41!==e.charCodeAt(e.length-1))return null;if(r=e.slice(c,e.length),void 0===Be(r))return null}else if(e.length-c>4&&43===e.charCodeAt(c)&&we(e,"+js(",c)){if((void 0===n||void 0===n.hostnames&&void 0===n.entities)&&!1===ue(a,1))return null;if(a=fe(a,2),r=e.slice(c+4,e.length-1),!1===ue(a,1)&&0===r.length)return null}else{r=e.slice(c);const t=s.classifySelector(r);if(t===s.SelectorType.Extended)a=fe(a,128);else if(t===s.SelectorType.Invalid||!Ge(r))return null}if(void 0===n&&!0===ue(a,128))return null;if(void 0!==r&&(Ce(r)&&(a=fe(a,4)),!1===ue(a,2)&&!1===ue(a,64)&&!1===ue(a,128)&&!1===r.startsWith("^"))){const e=r.charCodeAt(0),t=r.charCodeAt(1),s=r.charCodeAt(2);!1===ue(a,2)&&(46===e&&Ne(r)?a=fe(a,8):35===e&&Ne(r)?a=fe(a,16):(97===e&&91===t&&104===s&&We(r,2)||91===e&&104===t&&We(r,1))&&(a=fe(a,32)))}return new Ve({mask:a,rawLine:!0===t?i:void 0,selector:r,style:o,domains:n})}static deserialize(e){const t=e.getUint8(),s=ue(t,4),i=e.getUint8(),r=s?e.getUTF8():e.getCosmeticSelector();return new Ve({mask:t,selector:r,domains:1&~i?void 0:Oe.deserialize(e),rawLine:2&~i?void 0:e.getRawCosmetic(),style:4&~i?void 0:e.getASCII()})}constructor({mask:e,selector:t,domains:s,rawLine:i,style:r}){this.mask=e,this.selector=t,this.domains=s,this.style=r,this.id=void 0,this.rawLine=i}isCosmeticFilter(){return!0}isNetworkFilter(){return!1}serialize(e){e.pushUint8(this.mask);const t=e.getPos();e.pushUint8(0),this.isUnicode()?e.pushUTF8(this.selector):e.pushCosmeticSelector(this.selector);let s=0;void 0!==this.domains&&(s|=1,this.domains.serialize(e)),void 0!==this.rawLine&&(s|=2,e.pushRawCosmetic(this.rawLine)),void 0!==this.style&&(s|=4,e.pushASCII(this.style)),e.setByte(t,s)}getSerializedSize(e){let t=2;return this.isUnicode()?t+=q(this.selector):t+=function(e,t){return!0===t?P($().cosmeticSelector.getCompressedSize(e),!1):D(e)}(this.selector,e),void 0!==this.domains&&(t+=this.domains.getSerializedSize()),void 0!==this.rawLine&&(t+=function(e,t){return!0===t?P($().cosmeticRaw.getCompressedSize(E(e)),!1):q(e)}(this.rawLine,e)),void 0!==this.style&&(t+=D(this.style)),t}toString(){if(void 0!==this.rawLine)return this.rawLine;let e="";return void 0!==this.domains&&(void 0!==this.domains.parts?e+=this.domains.parts:e+="<hostnames>"),this.isUnhide()?e+="#@#":e+="##",this.isScriptInject()?(e+="+js(",e+=this.selector,e+=")"):e+=this.selector,e}match(e,t){return!1===this.hasHostnameConstraint()||!(!e&&this.hasHostnameConstraint())&&(void 0===this.domains||this.domains.match(0===e.length?T:Le(e,t),0===e.length?T:He(e,t)))}getTokens(){const e=[];if(void 0!==this.domains){const{hostnames:t,entities:s}=this.domains;if(void 0!==t)for(const s of t)e.push(new Uint32Array([s]));if(void 0!==s)for(const t of s)e.push(new Uint32Array([t]))}if(0===e.length&&!1===this.isUnhide())if(this.isIdSelector()||this.isClassSelector()){let t=1;const s=this.selector;for(;t<s.length;t+=1){const e=s.charCodeAt(t);if(32===e||46===e||58===e||91===e)break}const i=new Uint32Array(1);i[0]=ge(s,1,t),e.push(i)}else if(!0===this.isHrefSelector()){const t=this.getSelector();let s=t.indexOf("href");if(-1===s)return _e;s+=4;let i=!1,r=!0;42===t.charCodeAt(s)?(i=!0,s+=1):94===t.charCodeAt(s)?s+=1:r=!1,s+=2;const n=t.indexOf('"',s);if(-1===n)return _e;e.push(function(e,t,s){return he.reset(),Se(e,t,s,he),he.slice()}(this.selector.slice(s,n),i,r))}return 0===e.length?_e:e}parseScript(){const e=this.getSelector();if(0===e.length)return;const t=[];let s=0,i=-1,r=!1,n=!1,o=!1,a=0,h=!1,l=!1;for(;s<e.length;s+=1){const c=e[s];!1===h&&(!0===r?'"'===c&&(r=!1):!0===n?"'"===c&&(n=!1):0!==a?"{"===c?a+=1:"}"===c?a-=1:'"'===c?r=!0:"'"===c&&(n=!0):!0===o?"/"===c&&(o=!1):(!1===l&&(" "===c||('"'===c&&e.indexOf('"',s+1)>0?r=!0:"'"===c&&e.indexOf("'",s+1)>0?n=!0:"{"===c&&e.indexOf("}",s+1)>0?a+=1:"/"===c&&e.indexOf("/",s+1)>0?o=!0:l=!0)),","===c&&(t.push(e.slice(i+1,s).trim()),i=s,l=!1))),h="\\"===c}if(t.push(e.slice(i+1).trim()),0===t.length)return;const c=t.slice(1).map((e=>e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.substring(1,e.length-1):e)).map((e=>e.replace(Pe,",").replace(De,"\\").replace(qe,",")));return{name:t[0],args:c}}getScript(e){const t=this.parseScript();if(void 0===t)return;const{name:s,args:i}=t;let r=e.get(s);if(void 0!==r){for(let e=0;e<i.length;e+=1){const t=i[e].replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r=r.replace(`{{${e+1}}}`,t)}return r}}hasHostnameConstraint(){return void 0!==this.domains}getId(){return void 0===this.id&&(this.id=function(e,t,s,i){let r=ce*le^e;if(void 0!==t)for(let e=0;e<t.length;e+=1)r=r*le^t.charCodeAt(e);if(void 0!==s&&(r=s.updateId(r)),void 0!==i)for(let e=0;e<i.length;e+=1)r=r*le^i.charCodeAt(e);return r>>>0}(this.mask,this.selector,this.domains,this.style)),this.id}hasCustomStyle(){return void 0!==this.style}getStyle(){return this.style||Me}getStyleAttributeHash(){return`s${me(this.getStyle())}`}getSelector(){return this.selector}getSelectorAST(){return s.parse(this.getSelector())}getExtendedSelector(){return Be(this.selector)}isExtended(){return ue(this.mask,128)}isRemove(){return ue(this.mask,64)}isUnhide(){return ue(this.mask,1)}isScriptInject(){return ue(this.mask,2)}isCSS(){return!1===this.isScriptInject()}isIdSelector(){return ue(this.mask,16)}isClassSelector(){return ue(this.mask,8)}isHrefSelector(){return ue(this.mask,32)}isUnicode(){return ue(this.mask,4)}isHtmlFiltering(){return this.getSelector().startsWith("^")}isGenericHide(){var e,t;return void 0===(null===(e=null==this?void 0:this.domains)||void 0===e?void 0:e.hostnames)&&void 0===(null===(t=null==this?void 0:this.domains)||void 0===t?void 0:t.entities)}}const Ze=me("http"),Ke=me("https");const Xe=16371,Je={beacon:256,document:1,cspviolationreport:128,fetch:8192,font:2,image:16,imageset:16,mainFrame:1,main_frame:1,media:32,object:64,object_subrequest:64,ping:256,script:512,stylesheet:1024,subFrame:2048,sub_frame:2048,webSocket:4096,websocket:4096,xhr:8192,xmlhttprequest:8192,cspReport:128,csp_report:128,eventsource:128,manifest:128,other:128,prefetch:128,preflight:128,signedexchange:128,speculative:128,texttrack:128,web_manifest:128,xml_dtd:128,xslt:128};function Qe(e){const t=[];return e.fromDocument()&&t.push("document"),e.fromImage()&&t.push("image"),e.fromMedia()&&t.push("media"),e.fromObject()&&t.push("object"),e.fromOther()&&t.push("other"),e.fromPing()&&t.push("ping"),e.fromScript()&&t.push("script"),e.fromStylesheet()&&t.push("stylesheet"),e.fromSubdocument()&&t.push("sub_frame"),e.fromWebsocket()&&t.push("websocket"),e.fromXmlHttpRequest()&&t.push("xhr"),e.fromFont()&&t.push("font"),t}function Ye(e,t,s,i,r,n,o){let a=ce*le^t;if(void 0!==e)for(let t=0;t<e.length;t+=1)a=a*le^e.charCodeAt(t);if(void 0!==r&&(a=r.updateId(a)),void 0!==n&&(a=n.updateId(a)),void 0!==s)for(let e=0;e<s.length;e+=1)a=a*le^s.charCodeAt(e);if(void 0!==i)for(let e=0;e<i.length;e+=1)a=a*le^i.charCodeAt(e);if(void 0!==o)for(let e=0;e<o.length;e+=1)a=a*le^o.charCodeAt(e);return a>>>0}function et(e,t,s,i){return!0===i?new RegExp(e.slice(1,e.length-1),"i"):(e=(e=(e=e.replace(/([|.$+?{}()[\]\\])/g,"\\$1")).replace(/\*/g,".*")).replace(/\^/g,"(?:[^\\w\\d_.%-]|$)"),s&&(e=`${e}$`),t&&(e=`^${e}`),new RegExp(e))}const tt=new RegExp("");class st{static parse(e,t=!1){let s,i,r,n,o,a=49164,h=0,l=Xe,c=0,d=e.length;64===e.charCodeAt(0)&&64===e.charCodeAt(1)&&(c+=2,a=fe(a,134217728));const u=function(e,t){let s=e.lastIndexOf(t);if(-1===s)return-1;for(;s>0&&92===e.charCodeAt(s-1);)s=e.lastIndexOf(t,s-1);return s}(e,"$");if(-1!==u&&47!==e.charCodeAt(u+1)){d=u;for(const s of e.slice(u+1).split(",")){const e=126===s.charCodeAt(0);let c=!0===e?s.slice(1):s,d="";const u=c.indexOf("=");switch(-1!==u&&(d=c.slice(u+1),c=c.slice(0,u)),c){case"denyallow":r=Oe.parse(d.split("|"),t);break;case"domain":case"from":if(124===d.charCodeAt(0)||124===d.charCodeAt(d.length-1))return null;i=Oe.parse(d.split("|"),t);break;case"badfilter":a=fe(a,131072);break;case"important":if(e)return null;a=fe(a,1048576);break;case"match-case":if(e)return null;break;case"3p":case"third-party":a=pe(a,e?32768:16384);break;case"1p":case"first-party":a=pe(a,e?16384:32768);break;case"redirect-rule":case"redirect":if(e)return null;if(0===d.length)return null;"redirect-rule"===c&&(a=fe(a,536870912)),n=d;break;case"csp":if(e)return null;a=fe(a,262144),d.length>0&&(o=d);break;case"ehide":case"elemhide":if(e)return null;a=fe(a,524288),a=fe(a,2097152);break;case"shide":case"specifichide":if(e)return null;a=fe(a,2097152);break;case"ghide":case"generichide":if(e)return null;a=fe(a,524288);break;case"inline-script":if(e)return null;a=fe(a,262144),o="script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:";break;case"inline-font":if(e)return null;a=fe(a,262144),o="font-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:";break;default:{let t=0;switch(c){case"all":if(e)return null;break;case"image":t=16;break;case"media":t=32;break;case"object":case"object-subrequest":t=64;break;case"other":t=128;break;case"ping":case"beacon":t=256;break;case"script":t=512;break;case"css":case"stylesheet":t=1024;break;case"frame":case"subdocument":t=2048;break;case"xhr":case"xmlhttprequest":t=8192;break;case"websocket":t=4096;break;case"font":t=2;break;case"doc":case"document":t=1;break;default:return null}e?l=pe(l,t):h=fe(h,t);break}}}}let f;if(a|=0===h?l:l===Xe?h:h&l,d-c>=2&&47===e.charCodeAt(c)&&47===e.charCodeAt(d-1)){f=e.slice(c,d);try{et(f,!1,!1,!0)}catch(e){return null}a=fe(a,4194304)}else{if(d>0&&124===e.charCodeAt(d-1)&&(a=fe(a,67108864),d-=1),c<d&&124===e.charCodeAt(c)&&(c<d-1&&124===e.charCodeAt(c+1)?(a=fe(a,268435456),c+=2):(a=fe(a,33554432),c+=1)),ue(a,268435456)){let t=c;for(;t<d&&!0===(ve(p=e.charCodeAt(t))||ke(p)||95===p||45===p||46===p);)t+=1;if(t===d)s=e.slice(c,d),c=d;else{s=e.slice(c,t),c=t;const i=e.charCodeAt(t);94===i?d-c==1?(c=d,a=fe(a,67108864)):(a=fe(a,8388608),a=fe(a,33554432)):a=fe(a,42===i?8388608:33554432)}}d-c>0&&42===e.charCodeAt(d-1)&&(d-=1),!1===ue(a,268435456)&&d-c>0&&42===e.charCodeAt(c)&&(a=pe(a,33554432),c+=1),ue(a,33554432)&&(d-c==5&&we(e,"ws://",c)?(a=fe(a,4096),a=pe(a,33554432),a=pe(a,4),a=pe(a,8),c=d):d-c==7&&we(e,"http://",c)?(a=fe(a,4),a=pe(a,8),a=pe(a,33554432),c=d):d-c==8&&we(e,"https://",c)?(a=fe(a,8),a=pe(a,4),a=pe(a,33554432),c=d):d-c==8&&we(e,"http*://",c)&&(a=fe(a,8),a=fe(a,4),a=pe(a,33554432),c=d)),d-c>0&&(f=e.slice(c,d).toLowerCase(),a=it(a,16777216,Ce(f)),!1===ue(a,8388608)&&(a=it(a,8388608,function(e,t,s){const i=e.indexOf("^",t);if(-1!==i&&i<s)return!0;const r=e.indexOf("*",t);return-1!==r&&r<s}(f,0,f.length)))),void 0!==s&&(s=s.toLowerCase(),Ce(s)&&(a=it(a,16777216,!0),s=H(s)))}var p;return new st({csp:o,filter:f,hostname:s,mask:a,domains:i,denyallow:r,rawLine:!0===t?e:void 0,redirect:n,regex:void 0})}static deserialize(e){const t=e.getUint32(),s=e.getUint8(),i=ue(t,16777216);return new st({mask:t,csp:1&~s?void 0:e.getNetworkCSP(),filter:2&~s?void 0:i?e.getUTF8():e.getNetworkFilter(),hostname:4&~s?void 0:e.getNetworkHostname(),domains:8&~s?void 0:Oe.deserialize(e),rawLine:16&~s?void 0:e.getRawNetwork(),redirect:32&~s?void 0:e.getNetworkRedirect(),denyallow:64&~s?void 0:Oe.deserialize(e),regex:void 0})}constructor({csp:e,filter:t,hostname:s,mask:i,domains:r,denyallow:n,rawLine:o,redirect:a,regex:h}){this.csp=e,this.filter=t,this.hostname=s,this.mask=i,this.domains=r,this.denyallow=n,this.redirect=a,this.rawLine=o,this.id=void 0,this.regex=h}isCosmeticFilter(){return!1}isNetworkFilter(){return!0}match(e){return function(e,t){if(!1===e.isCptAllowed(t.type)||!0===t.isHttps&&!1===e.fromHttps()||!0===t.isHttp&&!1===e.fromHttp()||!1===e.firstParty()&&!0===t.isFirstParty||!1===e.thirdParty()&&!0===t.isThirdParty)return!1;if(void 0!==e.domains&&!1===e.domains.match(t.sourceHostnameHashes,t.sourceEntityHashes))return!1;if(void 0!==e.denyallow&&!0===e.denyallow.match(t.getHostnameHashes(),t.getEntityHashes()))return!1;return!0}(this,e)&&function(e,t){const s=e.getFilter();if(!0===e.isHostnameAnchor()){const i=e.getHostname();if(!1===function(e,t,s){if(0===e.length)return!0;if(e.length>t.length)return!1;if(e.length===t.length)return e===t;const i=t.indexOf(e);if(-1===i)return!1;if(0===i)return!0===s||46===t.charCodeAt(e.length)||46===e.charCodeAt(e.length-1);if(t.length===i+e.length)return 46===t.charCodeAt(i-1)||46===e.charCodeAt(0);return!(!0!==s&&46!==t.charCodeAt(e.length)&&46!==e.charCodeAt(e.length-1)||46!==t.charCodeAt(i-1)&&46!==e.charCodeAt(0))}(i,t.hostname,void 0!==e.filter&&42===e.filter.charCodeAt(0)))return!1;if(e.isRegex())return e.getRegex().test(t.url.slice(t.url.indexOf(i)+i.length));if(e.isRightAnchor()&&e.isLeftAnchor()){return s===t.url.slice(t.url.indexOf(i)+i.length)}if(e.isRightAnchor()){const r=t.hostname;return!1===e.hasFilter()?i.length===r.length||r.endsWith(i):t.url.endsWith(s)}return e.isLeftAnchor()?we(t.url,s,t.url.indexOf(i)+i.length):!1===e.hasFilter()||-1!==t.url.indexOf(s,t.url.indexOf(i)+i.length)}if(e.isRegex())return e.getRegex().test(t.url);if(e.isLeftAnchor()&&e.isRightAnchor())return t.url===s;if(e.isLeftAnchor())return be(t.url,s);if(e.isRightAnchor())return t.url.endsWith(s);if(!1===e.hasFilter())return!0;return-1!==t.url.indexOf(s)}(this,e)}serialize(e){e.pushUint32(this.mask);const t=e.getPos();e.pushUint8(0);let s=0;void 0!==this.csp&&(s|=1,e.pushNetworkCSP(this.csp)),void 0!==this.filter&&(s|=2,this.isUnicode()?e.pushUTF8(this.filter):e.pushNetworkFilter(this.filter)),void 0!==this.hostname&&(s|=4,e.pushNetworkHostname(this.hostname)),void 0!==this.domains&&(s|=8,this.domains.serialize(e)),void 0!==this.rawLine&&(s|=16,e.pushRawNetwork(this.rawLine)),void 0!==this.redirect&&(s|=32,e.pushNetworkRedirect(this.redirect)),void 0!==this.denyallow&&(s|=64,this.denyallow.serialize(e)),e.setByte(t,s)}getSerializedSize(e){let t=5;return void 0!==this.csp&&(t+=function(e,t){return!0===t?P($().networkCSP.getCompressedSize(e),!1):D(e)}(this.csp,e)),void 0!==this.filter&&(!0===this.isUnicode()?t+=q(this.filter):t+=function(e,t){return!0===t?P($().networkFilter.getCompressedSize(e),!1):D(e)}(this.filter,e)),void 0!==this.hostname&&(t+=function(e,t){return!0===t?P($().networkHostname.getCompressedSize(e),!1):D(e)}(this.hostname,e)),void 0!==this.domains&&(t+=this.domains.getSerializedSize()),void 0!==this.rawLine&&(t+=function(e,t){return!0===t?P($().networkRaw.getCompressedSize(E(e)),!1):q(e)}(this.rawLine,e)),void 0!==this.redirect&&(t+=function(e,t){return!0===t?P($().networkRedirect.getCompressedSize(e),!1):D(e)}(this.redirect,e)),void 0!==this.denyallow&&(t+=this.denyallow.getSerializedSize()),t}toString(e){if(void 0!==this.rawLine)return this.rawLine;let t="";this.isException()&&(t+="@@"),this.isHostnameAnchor()?t+="||":this.fromHttp()!==this.fromHttps()?this.fromHttp()?t+="|http://":t+="|https://":this.isLeftAnchor()&&(t+="|"),this.hasHostname()&&(t+=this.getHostname(),t+="^"),this.isFullRegex()?t+=`/${this.getRegex().source}/`:this.isRegex()?t+=this.getRegex().source:t+=this.getFilter(),this.isRightAnchor()&&"^"!==t[t.length-1]&&(t+="|");const s=[];if(!1===this.fromAny()){const e=de(this.getCptMask());if(de(Xe)-e<e)for(const e of function(e){const t=[];return!1===e.fromDocument()&&t.push("document"),!1===e.fromImage()&&t.push("image"),!1===e.fromMedia()&&t.push("media"),!1===e.fromObject()&&t.push("object"),!1===e.fromOther()&&t.push("other"),!1===e.fromPing()&&t.push("ping"),!1===e.fromScript()&&t.push("script"),!1===e.fromStylesheet()&&t.push("stylesheet"),!1===e.fromSubdocument()&&t.push("sub_frame"),!1===e.fromWebsocket()&&t.push("websocket"),!1===e.fromXmlHttpRequest()&&t.push("xhr"),!1===e.fromFont()&&t.push("font"),t}(this))s.push(`~${e}`);else for(const e of Qe(this))s.push(e)}return this.isImportant()&&s.push("important"),this.isRedirectRule()?s.push(`redirect-rule=${this.getRedirect()}`):this.isRedirect()&&s.push(`redirect=${this.getRedirect()}`),this.isCSP()&&s.push(`csp=${this.csp}`),this.isElemHide()&&s.push("elemhide"),this.isSpecificHide()&&s.push("specifichide"),this.isGenericHide()&&s.push("generichide"),this.firstParty()!==this.thirdParty()&&(this.firstParty()&&s.push("1p"),this.thirdParty()&&s.push("3p")),void 0!==this.domains&&(void 0!==this.domains.parts?s.push(`domain=${this.domains.parts}`):s.push("domain=<hashed>")),void 0!==this.denyallow&&(void 0!==this.denyallow.parts?s.push(`denyallow=${this.denyallow.parts}`):s.push("denyallow=<hashed>")),this.isBadFilter()&&s.push("badfilter"),s.length>0&&(t+="function"==typeof e?`$${s.map(e).join(",")}`:`$${s.join(",")}`),t}getIdWithoutBadFilter(){return Ye(this.csp,-131073&this.mask,this.filter,this.hostname,this.domains,this.denyallow,this.redirect)}getId(){return void 0===this.id&&(this.id=Ye(this.csp,this.mask,this.filter,this.hostname,this.domains,this.denyallow,this.redirect)),this.id}hasFilter(){return void 0!==this.filter}hasDomains(){return void 0!==this.domains}getMask(){return this.mask}getCptMask(){return this.getMask()&Xe}isRedirect(){return void 0!==this.redirect}isRedirectRule(){return ue(this.mask,536870912)}getRedirect(){return this.redirect||""}hasHostname(){return void 0!==this.hostname}getHostname(){return this.hostname||""}getFilter(){return this.filter||""}getRegex(){return void 0===this.regex&&(this.regex=void 0!==this.filter&&this.isRegex()?et(this.filter,this.isLeftAnchor(),this.isRightAnchor(),this.isFullRegex()):tt),this.regex}getTokens(){if(he.reset(),void 0!==this.domains&&void 0!==this.domains.hostnames&&void 0===this.domains.entities&&void 0===this.domains.notHostnames&&void 0===this.domains.notEntities&&1===this.domains.hostnames.length&&he.push(this.domains.hostnames[0]),!1===this.isFullRegex()){if(void 0!==this.filter){const e=!this.isRightAnchor(),t=!this.isLeftAnchor();!function(e,t,s,i){const r=Math.min(e.length,2*i.remaining());let n=!1,o=0,a=0,h=ce;for(let s=0;s<r;s+=1){const r=e.charCodeAt(s);!0===xe(r)?(!1===n&&(h=ce,n=!0,a=s),h=h*le^r):(!0===n&&(n=!1,s-a>1&&42!==r&&42!==o&&(!1===t||0!==a)&&i.push(h>>>0)),o=r)}!1===s&&!0===n&&42!==o&&e.length-a>1&&!1===i.full()&&i.push(h>>>0)}(this.filter,t,e,he)}void 0!==this.hostname&&Se(this.hostname,!1,void 0!==this.filter&&42===this.filter.charCodeAt(0),he)}else void 0!==this.filter&&function(e,t){let s=e.length-1,i=1,r=0;for(;i<s;i+=1){const t=e.charCodeAt(i);if(124===t)return;if(40===t||42===t||43===t||63===t||91===t||123===t||46===t&&92!==r||92===t&&ke(e.charCodeAt(i+1)))break;r=t}for(r=0;s>=i;s-=1){const t=e.charCodeAt(s);if(124===t)return;if(41===t||42===t||43===t||63===t||93===t||125===t||46===t&&92!==e.charCodeAt(s-1)||92===t&&ke(r))break;r=t}if(s<i){const s=94!==e.charCodeAt(1),i=36!==e.charCodeAt(e.length-1);Se(e.slice(1,e.length-1),s,i,t)}else i>1&&Se(e.slice(1,i),94!==e.charCodeAt(1),!0,t),s<e.length-1&&Se(e.slice(s+1,e.length-1),!0,94!==e.charCodeAt(e.length-1),t)}(this.filter,he);if(!0===he.empty()&&void 0!==this.domains&&void 0!==this.domains.hostnames&&void 0===this.domains.entities&&void 0===this.domains.notHostnames&&void 0===this.domains.notEntities){const e=[];for(const t of this.domains.hostnames){const s=new Uint32Array(1);s[0]=t,e.push(s)}return e}if(!0===he.empty()&&!1===this.fromAny()){const e=Qe(this);if(0!==e.length){const t=[];for(const s of e){const e=new Uint32Array(1);e[0]=Re[s],t.push(e)}return t}}return!0===this.fromHttp()&&!1===this.fromHttps()?he.push(Ze):!0===this.fromHttps()&&!1===this.fromHttp()&&he.push(Ke),[he.slice()]}isCptAllowed(e){const t=Je[e];return void 0!==t?ue(this.mask,t):this.fromAny()}isException(){return ue(this.mask,134217728)}isHostnameAnchor(){return ue(this.mask,268435456)}isRightAnchor(){return ue(this.mask,67108864)}isLeftAnchor(){return ue(this.mask,33554432)}isImportant(){return ue(this.mask,1048576)}isFullRegex(){return ue(this.mask,4194304)}isRegex(){return ue(this.mask,8388608)||ue(this.mask,4194304)}isPlain(){return!this.isRegex()}isCSP(){return ue(this.mask,262144)}isElemHide(){return this.isSpecificHide()&&this.isGenericHide()}isSpecificHide(){return ue(this.mask,2097152)}isGenericHide(){return ue(this.mask,524288)}isBadFilter(){return ue(this.mask,131072)}isUnicode(){return ue(this.mask,16777216)}fromAny(){return this.getCptMask()===Xe}thirdParty(){return ue(this.mask,32768)}firstParty(){return ue(this.mask,16384)}fromImage(){return ue(this.mask,16)}fromMedia(){return ue(this.mask,32)}fromObject(){return ue(this.mask,64)}fromOther(){return ue(this.mask,128)}fromPing(){return ue(this.mask,256)}fromScript(){return ue(this.mask,512)}fromStylesheet(){return ue(this.mask,1024)}fromDocument(){return ue(this.mask,1)}fromSubdocument(){return ue(this.mask,2048)}fromWebsocket(){return ue(this.mask,4096)}fromHttp(){return ue(this.mask,4)}fromHttps(){return ue(this.mask,8)}fromXmlHttpRequest(){return ue(this.mask,8192)}fromFont(){return ue(this.mask,2)}}function it(e,t,s){return!0===s?fe(e,t):pe(e,t)}class rt extends Map{}function nt(e){return e.length<6||33!==e.charCodeAt(0)||35!==e.charCodeAt(1)?0:e.startsWith("!#if ")?1:e.startsWith("!#else")?2:e.startsWith("!#endif")?3:0}const ot=/(!|&&|\|\||\(|\)|[a-zA-Z0-9_]+)/g,at=/^[a-zA-Z0-9_]+$/,ht={"!":2,"&&":1,"||":0},lt=e=>Object.prototype.hasOwnProperty.call(ht,e),ct=(e,t)=>"true"===e&&!t.has("true")||!("false"===e&&!t.has("false"))&&!!t.get(e),dt=(e,t)=>{if(0===e.length)return!1;if((e=>at.test(e))(e))return"!"===e[0]?!ct(e.slice(1),t):ct(e,t);const s=(e=>e.match(ot))(e);if(!s||0===s.length)return!1;if(e.length!==s.reduce(((e,t)=>e+t.length),0))return!1;const i=[],r=[];for(const e of s)if("("===e)r.push(e);else if(")"===e){for(;0!==r.length&&"("!==r[r.length-1];)i.push(r.pop());if(0===r.length)return!1;r.pop()}else if(lt(e)){for(;r.length&&lt(r[r.length-1])&&ht[e]<=ht[r[r.length-1]];)i.push(r.pop());r.push(e)}else i.push(ct(e,t));if("("===r[0]||")"===r[0])return!1;for(;0!==r.length;)i.push(r.pop());for(const e of i)if(!0===e||!1===e)r.push(e);else if("!"===e)r.push(!r.pop());else if(lt(e)){const t=r.pop(),s=r.pop();"&&"===e?r.push(s&&t):r.push(s||t)}return!0===r[0]};class ut{static getCondition(e){return e.slice(5).replace(/\s/g,"")}static parse(e,t){return new this({condition:ut.getCondition(e),filterIDs:t})}static deserialize(e){const t=e.getUTF8(),s=new Set;for(let t=0,i=e.getUint32();t<i;t++)s.add(e.getUint32());return new this({condition:t,filterIDs:s})}constructor({condition:e,filterIDs:t=new Set}){this.condition=e,this.filterIDs=t}evaluate(e){return dt(this.condition,e)}serialize(e){e.pushUTF8(this.condition),e.pushUint32(this.filterIDs.size);for(const t of this.filterIDs)e.pushUint32(t)}getSerializedSize(){let e=q(this.condition);return e+=4*(1+this.filterIDs.size),e}}function ft(e){if(0===e.length||1===e.length)return 0;const t=e.charCodeAt(0),s=e.charCodeAt(1);if(33===t||35===t&&s<=32||91===t&&be(e,"[Adblock"))return 0;const i=e.charCodeAt(e.length-1);if(36===t||38===t||42===t||45===t||46===t||47===t||58===t||61===t||63===t||64===t||95===t||124===t||124===i)return 1;const r=e.indexOf("$");if(-1!==r&&r!==e.length-1){const t=r+1,s=e.charCodeAt(t);if(36===s||64===s&&we(e,"@$",t))return 0}const n=e.indexOf("#");if(-1!==n&&n!==e.length-1){const t=n+1,s=e.charCodeAt(t);if(35===s||64===s&&we(e,"@#",t))return 2;if(64===s&&(we(e,"@$#",t)||we(e,"@%#",t))||37===s&&we(e,"%#",t)||36===s&&we(e,"$#",t)||63===s&&we(e,"?#",t))return 0}return 1}function pt(e){const t=ft(e);return 1===t?st.parse(e,!0):2===t?Ve.parse(e,!0):null}function gt(e,t=new G){t=new G(t);const s=[],i=[],r=e.split("\n"),n=[],o=[];for(let e=0;e<r.length;e+=1){let a=r[e];if(0!==a.length&&a.charCodeAt(0)<=32&&(a=a.trim()),a.length>2)for(;e<r.length-1&&92===a.charCodeAt(a.length-1)&&32===a.charCodeAt(a.length-2);){a=a.slice(0,-2);const t=r[e+1];if(!(t.length>4&&32===t.charCodeAt(0)&&32===t.charCodeAt(1)&&32===t.charCodeAt(2)&&32===t.charCodeAt(3)&&32!==t.charCodeAt(4)))break;a+=t.slice(4),e+=1}0!==a.length&&a.charCodeAt(a.length-1)<=32&&(a=a.trim());const h=ft(a);if(1===h&&!0===t.loadNetworkFilters){const e=st.parse(a,t.debug);null!==e&&(s.push(e),o.length>0&&o[o.length-1].filterIDs.add(e.getId()))}else if(2===h&&!0===t.loadCosmeticFilters){const e=Ve.parse(a,t.debug);null!==e&&(!0!==t.loadGenericCosmeticsFilters&&!1!==e.isGenericHide()||(i.push(e),o.length>0&&o[o.length-1].filterIDs.add(e.getId())))}else if(t.loadPreprocessors){const e=nt(a);if(1===e)o.length>0?o.push(new ut({condition:`(${o[o.length-1].condition})&&(${ut.getCondition(a)})`})):o.push(ut.parse(a));else if((3===e||2===e)&&o.length>0){const t=o.pop();n.push(t),2===e&&o.push(new ut({condition:`!(${t.condition})`}))}}}return{networkFilters:s,cosmeticFilters:i,preprocessors:n.filter((e=>e.filterIDs.size>0))}}function mt(e,t){const{networkFilters:s,cosmeticFilters:i,preprocessors:r}=gt(e,t);return{filters:[].concat(s).concat(i),preprocessors:r}}class yt{static deserialize(e){const t=e.getASCII(),s=new Map,i=e.getUint16();for(let t=0;t<i;t+=1)s.set(e.getASCII(),{contentType:e.getASCII(),body:e.getUTF8()});const r=new Map;return s.forEach((({contentType:e,body:t},s)=>{"application/javascript"===e&&r.set(s,t)})),new yt({checksum:t,js:r,resources:s})}static parse(e,{checksum:t}){const s=new Map,i=e.split("\n\n");for(const e of i){const t=(r=e,r.replace(/^\s*#.*$/gm,"")).trim();if(0!==t.length){const e=t.indexOf("\n"),i=t.slice(0,e).split(/\s+/),r=i[0],n=i[1],o=t.slice(e+1);if(void 0===r||void 0===n||void 0===o)continue;let a=s.get(n);void 0===a&&(a=new Map,s.set(n,a)),a.set(r,o)}}var r;const n=s.get("application/javascript")||new Map;for(const[e,t]of n.entries())e.endsWith(".js")&&n.set(e.slice(0,-3),t);const o=new Map;return s.forEach(((e,t)=>{e.forEach(((e,s)=>{o.set(s,{contentType:t,body:e})}))})),new yt({checksum:t,js:n,resources:o})}constructor({checksum:e="",js:t=new Map,resources:s=new Map}={}){this.checksum=e,this.js=t,this.resources=s}getResource(e){const{body:t,contentType:s}=this.resources.get(e)||n.getResourceForMime(e);let i;var r;return i=-1!==s.indexOf(";")?`data:${s},${t}`:`data:${s};base64,${r=t,"undefined"!=typeof btoa?btoa(r):"undefined"!=typeof Buffer?Buffer.from(r).toString("base64"):r}`,{body:t,contentType:s,dataUrl:i}}getSerializedSize(){let e=D(this.checksum)+2;return this.resources.forEach((({contentType:t,body:s},i)=>{e+=D(i)+D(t)+q(s)})),e}serialize(e){e.pushASCII(this.checksum),e.pushUint16(this.resources.size),this.resources.forEach((({contentType:t,body:s},i)=>{e.pushASCII(i),e.pushASCII(t),e.pushUTF8(s)}))}}const bt=new Uint32Array(0);function wt(e){return`(?:${e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")})`}function vt(e,t,s){let i=e.get(t);void 0===i&&(i=[],e.set(t,i)),i.push(s)}function kt(e,t){const s=new Map;for(const i of e)vt(s,t(i),i);return Array.from(s.values())}function xt(e,t){const s=[],i=[];for(const r of e)t(r)?s.push(r):i.push(r);return{negative:i,positive:s}}const St=[{description:"Remove duplicated filters by ID",fusion:e=>e[0],groupByCriteria:e=>""+e.getId(),select:()=>!0},{description:"Group idential filter with same mask but different domains in single filters",fusion:e=>{const t=[],s=new Set,i=new Set,r=new Set,n=new Set;for(const{domains:o}of e)if(void 0!==o){if(void 0!==o.parts&&t.push(o.parts),void 0!==o.hostnames)for(const e of o.hostnames)s.add(e);if(void 0!==o.entities)for(const e of o.entities)r.add(e);if(void 0!==o.notHostnames)for(const e of o.notHostnames)i.add(e);if(void 0!==o.notEntities)for(const e of o.notEntities)n.add(e)}return new st(Object.assign({},e[0],{domains:new Oe({hostnames:0!==s.size?new Uint32Array(s).sort():void 0,entities:0!==r.size?new Uint32Array(r).sort():void 0,notHostnames:0!==i.size?new Uint32Array(i).sort():void 0,notEntities:0!==n.size?new Uint32Array(n).sort():void 0,parts:0!==t.length?t.join(","):void 0}),rawLine:void 0!==e[0].rawLine?e.map((({rawLine:e})=>e)).join(" <+> "):void 0}))},groupByCriteria:e=>e.getHostname()+e.getFilter()+e.getMask()+e.getRedirect(),select:e=>!e.isCSP()&&void 0===e.denyallow&&void 0!==e.domains},{description:"Group simple patterns, into a single filter",fusion:e=>{const t=[];for(const s of e)s.isRegex()?t.push(`(?:${s.getRegex().source})`):s.isRightAnchor()?t.push(`${wt(s.getFilter())}$`):s.isLeftAnchor()?t.push(`^${wt(s.getFilter())}`):t.push(wt(s.getFilter()));return new st(Object.assign({},e[0],{mask:fe(e[0].mask,8388608),rawLine:void 0!==e[0].rawLine?e.map((({rawLine:e})=>e)).join(" <+> "):void 0,regex:new RegExp(t.join("|"))}))},groupByCriteria:e=>""+(-8388609&e.getMask()&-4194305),select:e=>void 0===e.domains&&void 0===e.denyallow&&!e.isHostnameAnchor()&&!e.isRedirect()&&!e.isCSP()}];function zt(e){return e}function Ft(e){return e}function At(e){const t=[];let s=e;for(const{select:e,fusion:i,groupByCriteria:r}of St){const{positive:n,negative:o}=xt(s,e);s=o;const a=kt(n,r);for(const e of a)e.length>1?t.push(i(e)):s.push(e[0])}for(const e of s)t.push(e);return t}function It(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}let Ct=1;const Ut=Number.MAX_SAFE_INTEGER>>>0;class Rt{static deserialize(e,t,s,i){const r=e.getUint32(),n=e.getUint32(),o=e.getUint32(),a=W.fromUint8Array(e.getBytes(!0),i),h=a.getUint32ArrayView(r),l=a.getUint32ArrayView(n),c=a.pos;return a.seekZero(),new Rt({config:i,deserialize:t,filters:[],optimize:s}).updateInternals({bucketsIndex:l,filtersIndexStart:c,numberOfFilters:o,tokensLookupIndex:h,view:a})}constructor({deserialize:e,filters:t,optimize:s,config:i}){this.bucketsIndex=T,this.filtersIndexStart=0,this.numberOfFilters=0,this.tokensLookupIndex=T,this.cache=new Map,this.view=W.empty(i),this.deserializeFilter=e,this.optimize=s,this.config=i,0!==t.length&&this.update(t,void 0)}getFilters(){const e=[];if(0===this.numberOfFilters)return e;this.view.setPos(this.filtersIndexStart);for(let t=0;t<this.numberOfFilters;t+=1)e.push(this.deserializeFilter(this.view));return this.view.seekZero(),e}getTokens(){const e=new Set;for(let t=0;t<this.bucketsIndex.length;t+=2)e.add(this.bucketsIndex[t]);return new Uint32Array(e)}getSerializedSize(){return 12+M(this.view.buffer,!0)}serialize(e){e.pushUint32(this.tokensLookupIndex.length),e.pushUint32(this.bucketsIndex.length),e.pushUint32(this.numberOfFilters),e.pushBytes(this.view.buffer,!0)}iterMatchingFilters(e,t){const s=function(){const e=Ct;return Ct=(Ct+1)%1e9,e}();for(const i of e)if(!1===this.iterBucket(i,s,t))return;this.iterBucket(0,s,t)}update(e,t){0!==this.cache.size&&this.cache.clear();const s=this.config.enableCompression;let i=0,r=0;const n=[];let o=0,a=this.view.buffer.byteLength-this.filtersIndexStart,h=this.getFilters();if(0!==h.length){void 0!==t&&0!==t.size&&(h=h.filter((e=>!t.has(e.getId())||(a-=e.getSerializedSize(s),!1))));for(const t of e)a+=t.getSerializedSize(s),h.push(t)}else{h=e;for(const t of e)a+=t.getSerializedSize(s)}if(0===h.length)return void this.updateInternals({bucketsIndex:T,filtersIndexStart:0,numberOfFilters:0,tokensLookupIndex:T,view:W.empty(this.config)});!0===this.config.debug&&h.sort(((e,t)=>e.getId()-t.getId()));const l=new Uint32Array(Math.max(It(2*h.length),256));for(const e of h){const t=e.getTokens();n.push(t),o+=2*t.length,r+=t.length;for(const e of t){i+=e.length;for(const t of e)l[t%l.length]+=1}}a+=4*o;const c=Math.max(2,It(r)),d=c-1,u=[];for(let e=0;e<c;e+=1)u.push([]);a+=4*c;const f=W.allocate(a,this.config),p=f.getUint32ArrayView(c),g=f.getUint32ArrayView(o),m=f.getPos();for(let e=0;e<n.length;e+=1){const t=h[e],s=n[e],r=f.pos;t.serialize(f);for(const e of s){let t=0,s=i+1;for(const i of e){const e=l[i%l.length];if(e<s&&(s=e,t=i,1===s))break}u[t&d].push([t,r])}}let y=0;for(let e=0;e<c;e+=1){const t=u[e];p[e]=y;for(const[e,s]of t)g[y++]=e,g[y++]=s}f.seekZero(),this.updateInternals({bucketsIndex:g,filtersIndexStart:m,numberOfFilters:n.length,tokensLookupIndex:p,view:f})}updateInternals({bucketsIndex:e,filtersIndexStart:t,numberOfFilters:s,tokensLookupIndex:i,view:r}){return this.bucketsIndex=e,this.filtersIndexStart=t,this.numberOfFilters=s,this.tokensLookupIndex=i,this.view=r,r.seekZero(),this}iterBucket(e,t,s){let i=!0===this.config.enableInMemoryCache?this.cache.get(e):void 0;if(void 0===i){const t=e&this.tokensLookupIndex.length-1,s=this.tokensLookupIndex[t];if(s===Ut)return!0;const r=t===this.tokensLookupIndex.length-1?this.bucketsIndex.length:this.tokensLookupIndex[t+1],n=[];for(let t=s;t<r;t+=2){this.bucketsIndex[t]===e&&n.push(this.bucketsIndex[t+1])}if(0===n.length)return!0;const o=[],a=this.view;for(let e=0;e<n.length;e+=1)a.setPos(n[e]),o.push(this.deserializeFilter(a));i={filters:o.length>1?this.optimize(o):o,lastRequestSeen:-1},!0===this.config.enableInMemoryCache&&this.cache.set(e,i)}if(i.lastRequestSeen!==t){i.lastRequestSeen=t;const e=i.filters;for(let t=0;t<e.length;t+=1)if(!1===s(e[t])){if(t>0){const s=e[t];e[t]=e[t-1],e[t-1]=s}return!1}}return!0}}const jt=new Uint8Array(4);class Et{static deserialize(e,t,s){const i=new Et({deserialize:t,config:s,filters:[]});return i.filters=e.getBytes(),i}constructor({config:e,deserialize:t,filters:s}){this.deserialize=t,this.filters=jt,this.config=e,0!==s.length&&this.update(s,void 0)}update(e,t){let s=this.filters.byteLength,i=[];const r=this.config.enableCompression,n=this.getFilters();if(0!==n.length)if(void 0===t||0===t.size)i=n;else for(const e of n)!1===t.has(e.getId())?i.push(e):s-=e.getSerializedSize(r);const o=i.length!==n.length,a=i.length;for(const t of e)s+=t.getSerializedSize(r),i.push(t);const h=i.length>a;if(0===i.length)this.filters=jt;else if(!0===h||!0===o){const e=W.allocate(s,this.config);e.pushUint32(i.length),!0===this.config.debug&&i.sort(((e,t)=>e.getId()-t.getId()));for(const t of i)t.serialize(e);this.filters=e.buffer}}getSerializedSize(){return M(this.filters,!1)}serialize(e){e.pushBytes(this.filters)}getFilters(){if(this.filters.byteLength<=4)return[];const e=[],t=W.fromUint8Array(this.filters,this.config),s=t.getUint32();for(let i=0;i<s;i+=1)e.push(this.deserialize(t));return e}}function Ht(e,t){if(0===e.length)return"";const s=1024,i=[],r=` { ${t} }`;for(let t=0;t<e.length;t+=s){let n=e[t];for(let i=t+1,r=Math.min(e.length,t+s);i<r;i+=1)n+=",\n"+e[i];if(n+=r,e.length<s)return n;i.push(n)}return i.join("\n")}function Lt(e){const t=new Map;for(const s of e){const e=s.getStyle(),i=t.get(e);void 0===i?t.set(e,[s.getSelector()]):i.push(s.getSelector())}const s=[],i=Array.from(t.entries());for(const[e,t]of i)s.push(Ht(t,e));return s.join("\n\n")}function Tt(e){const t=[];for(const s of e){if(s.hasCustomStyle())return Lt(e);t.push(s.selector)}return Ht(t,Me)}function Ot(e,t){const s=Le(e,t),i=He(e,t),r=new Uint32Array(s.length+i.length);let n=0;for(const e of s)r[n++]=e;for(const e of i)r[n++]=e;return r}class Bt{static deserialize(e,t){const s=new Bt({config:t});return s.genericRules=Et.deserialize(e,Ve.deserialize,t),s.classesIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s.hostnameIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s.hrefsIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s.htmlIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s.idsIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s.unhideIndex=Rt.deserialize(e,Ve.deserialize,Ft,t),s}constructor({filters:e=[],config:t}){this.genericRules=new Et({config:t,deserialize:Ve.deserialize,filters:[]}),this.classesIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.hostnameIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.hrefsIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.htmlIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.idsIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.unhideIndex=new Rt({config:t,deserialize:Ve.deserialize,filters:[],optimize:Ft}),this.baseStylesheet=null,this.extraGenericRules=null,0!==e.length&&this.update(e,void 0,t)}getFilters(){return[].concat(this.genericRules.getFilters(),this.classesIndex.getFilters(),this.hostnameIndex.getFilters(),this.hrefsIndex.getFilters(),this.htmlIndex.getFilters(),this.idsIndex.getFilters(),this.unhideIndex.getFilters())}update(e,t,s){const i=[],r=[],n=[],o=[],a=[],h=[],l=[];for(const t of e)t.isUnhide()?l.push(t):t.isHtmlFiltering()?a.push(t):t.isGenericHide()?t.isClassSelector()?i.push(t):t.isIdSelector()?h.push(t):t.isHrefSelector()?o.push(t):r.push(t):!1!==t.isExtended()&&!0!==s.loadExtendedSelectors||n.push(t);this.genericRules.update(r,t),this.classesIndex.update(i,t),this.hostnameIndex.update(n,t),this.hrefsIndex.update(o,t),this.htmlIndex.update(a,t),this.idsIndex.update(h,t),this.unhideIndex.update(l,t)}getSerializedSize(){return this.genericRules.getSerializedSize()+this.classesIndex.getSerializedSize()+this.hostnameIndex.getSerializedSize()+this.hrefsIndex.getSerializedSize()+this.htmlIndex.getSerializedSize()+this.idsIndex.getSerializedSize()+this.unhideIndex.getSerializedSize()}serialize(e){this.genericRules.serialize(e),this.classesIndex.serialize(e),this.hostnameIndex.serialize(e),this.hrefsIndex.serialize(e),this.htmlIndex.serialize(e),this.idsIndex.serialize(e),this.unhideIndex.serialize(e)}getHtmlRules({domain:e,hostname:t,isFilterExcluded:s}){const i=Ot(t,e),r=[];this.htmlIndex.iterMatchingFilters(i,(i=>(i.match(t,e)&&!(null==s?void 0:s(i))&&r.push(i),!0)));const n=new Set;return 0!==r.length&&this.unhideIndex.iterMatchingFilters(i,(i=>(i.match(t,e)&&!(null==s?void 0:s(i))&&n.add(i.getSelector()),!0))),r.filter((e=>0===n.size||!1===n.has(e.getSelector())))}getCosmeticsFilters({domain:e,hostname:t,classes:s=[],hrefs:i=[],ids:r=[],allowGenericHides:n=!0,allowSpecificHides:o=!0,getBaseRules:a=!0,getInjectionRules:h=!0,getExtendedRules:l=!0,getRulesFromDOM:c=!0,getRulesFromHostname:d=!0,isFilterExcluded:u}){const f=Ot(t,e),p=[];if(!0===d&&this.hostnameIndex.iterMatchingFilters(f,(s=>(!0!==o&&!0!==s.isScriptInject()||!s.match(t,e)||(null==u?void 0:u(s))||p.push(s),!0))),!0===n&&!0===d){const s=this.getGenericRules();for(const i of s)!0!==i.match(t,e)||(null==u?void 0:u(i))||p.push(i)}!0===n&&!0===c&&0!==s.length&&this.classesIndex.iterMatchingFilters(ye(s),(s=>(s.match(t,e)&&!(null==u?void 0:u(s))&&p.push(s),!0))),!0===n&&!0===c&&0!==r.length&&this.idsIndex.iterMatchingFilters(ye(r),(s=>(s.match(t,e)&&!(null==u?void 0:u(s))&&p.push(s),!0))),!0===n&&!0===c&&0!==i.length&&this.hrefsIndex.iterMatchingFilters(function(e){const t=e.sort();let s=1;for(let e=1;e<t.length;e+=1)t[s-1]!==t[e]&&(t[s++]=t[e]);return t.subarray(0,s)}(function(e){if(0===e.length)return bt;if(1===e.length)return e[0];let t=0;for(let s=0;s<e.length;s+=1)t+=e[s].length;const s=new Uint32Array(t);let i=0;for(let t=0;t<e.length;t+=1){const r=e[t];for(let e=0;e<r.length;e+=1)s[i++]=r[e]}return s}(i.map((e=>Fe(e))))),(s=>(s.match(t,e)&&!(null==u?void 0:u(s))&&p.push(s),!0)));const g=[],m=[],y=[];if(0!==p.length){let s=!1;const i=new Set;this.unhideIndex.iterMatchingFilters(f,(r=>(r.match(t,e)&&!(null==u?void 0:u(r))&&(i.add(r.getSelector()),!0===r.isScriptInject()&&!0===r.isUnhide()&&0===r.getSelector().length&&(s=!0)),!0)));for(const e of p)0!==i.size&&i.has(e.getSelector())||(!0===e.isScriptInject()?!0===h&&!1===s&&m.push(e):e.isExtended()?!0===l&&g.push(e):y.push(e))}let b=!1===a||!1===n?"":this.getBaseStylesheet();0!==y.length&&(0!==b.length&&(b+="\n\n"),b+=Tt(y));const w=[];if(0!==g.length){const e=new Map;for(const t of g){const s=t.getSelectorAST();if(void 0!==s){const i=t.isRemove()?void 0:t.getStyleAttributeHash();void 0!==i&&e.set(t.getStyle(),i),w.push({ast:s,remove:t.isRemove(),attribute:i})}}0!==e.size&&(0!==b.length&&(b+="\n\n"),b+=[...e.entries()].map((([e,t])=>`[${t}] { ${e} }`)).join("\n\n"))}return{extended:w,injections:m,stylesheet:b}}getGenericRules(){return null===this.extraGenericRules?this.lazyPopulateGenericRulesCache().genericRules:this.extraGenericRules}getBaseStylesheet(){return null===this.baseStylesheet?this.lazyPopulateGenericRulesCache().baseStylesheet:this.baseStylesheet}lazyPopulateGenericRulesCache(){if(null===this.baseStylesheet||null===this.extraGenericRules){const e=this.unhideIndex.getFilters(),t=new Set;for(const s of e)t.add(s.getSelector());const s=this.genericRules.getFilters(),i=[],r=[];for(const e of s)e.hasCustomStyle()||e.isScriptInject()||e.hasHostnameConstraint()||t.has(e.getSelector())?r.push(e):i.push(e);this.baseStylesheet=Tt(i),this.extraGenericRules=r}return{baseStylesheet:this.baseStylesheet,genericRules:this.extraGenericRules}}}class $t{static deserialize(e,t){const s=new $t({config:t});return s.index=Rt.deserialize(e,st.deserialize,t.enableOptimizations?At:zt,t),s.badFilters=Et.deserialize(e,st.deserialize,t),s}constructor({filters:e=[],config:t}){this.index=new Rt({config:t,deserialize:st.deserialize,filters:[],optimize:t.enableOptimizations?At:zt}),this.badFiltersIds=null,this.badFilters=new Et({config:t,deserialize:st.deserialize,filters:[]}),0!==e.length&&this.update(e,void 0)}getFilters(){return[].concat(this.badFilters.getFilters(),this.index.getFilters())}update(e,t){const s=[],i=[];for(const t of e)t.isBadFilter()?s.push(t):i.push(t);this.badFilters.update(s,t),this.index.update(i,t),this.badFiltersIds=null}getSerializedSize(){return this.badFilters.getSerializedSize()+this.index.getSerializedSize()}serialize(e){this.index.serialize(e),this.badFilters.serialize(e)}matchAll(e,t){const s=[];return this.index.iterMatchingFilters(e.getTokens(),(i=>(i.match(e)&&!1===this.isFilterDisabled(i)&&!(null==t?void 0:t(i))&&s.push(i),!0))),s}match(e,t){let s;return this.index.iterMatchingFilters(e.getTokens(),(i=>!(i.match(e)&&!1===this.isFilterDisabled(i)&&!(null==t?void 0:t(i)))||(s=i,!1))),s}isFilterDisabled(e){if(null===this.badFiltersIds){const e=this.badFilters.getFilters();if(0===e.length)return!1;const t=new Set;for(const s of e)t.add(s.getIdWithoutBadFilter());this.badFiltersIds=t}return this.badFiltersIds.has(e.getId())}}const _t=Number.MAX_SAFE_INTEGER>>>0;class Mt{static deserialize(e,t){const s=e.getUint32(),i=e.getUint32(),r=e.getUint32(),n=W.fromUint8Array(e.getBytes(!0),{enableCompression:!1}),o=n.getUint32ArrayView(s),a=n.getUint32ArrayView(i),h=n.pos;return n.seekZero(),new Mt({deserialize:t,values:[],getKeys:()=>[],getSerializedSize:()=>0,serialize:()=>{}}).updateInternals({bucketsIndex:a,valuesIndexStart:h,numberOfValues:r,tokensLookupIndex:o,view:n})}constructor({serialize:e,deserialize:t,getKeys:s,getSerializedSize:i,values:r}){if(this.cache=new Map,this.bucketsIndex=T,this.tokensLookupIndex=T,this.valuesIndexStart=0,this.numberOfValues=0,this.view=W.empty({enableCompression:!1}),this.deserializeValue=t,0!==r.length){const t=[];let n=0,o=0;for(const e of r)o+=i(e);if(0===r.length)return void this.updateInternals({bucketsIndex:T,valuesIndexStart:0,numberOfValues:0,tokensLookupIndex:T,view:W.empty({enableCompression:!1})});for(const e of r){const i=s(e);t.push(i),n+=2*i.length}o+=4*n;const a=Math.max(2,It(r.length)),h=a-1,l=[];for(let e=0;e<a;e+=1)l.push([]);o+=4*a;const c=W.allocate(o,{enableCompression:!1}),d=c.getUint32ArrayView(a),u=c.getUint32ArrayView(n),f=c.getPos();for(let s=0;s<t.length;s+=1){const i=r[s],n=t[s],o=c.pos;e(i,c);for(const e of n)l[e&h].push([e,o])}let p=0;for(let e=0;e<a;e+=1){const t=l[e];d[e]=p;for(const[e,s]of t)u[p++]=e,u[p++]=s}this.updateInternals({bucketsIndex:u,valuesIndexStart:f,numberOfValues:t.length,tokensLookupIndex:d,view:c})}}updateInternals({bucketsIndex:e,valuesIndexStart:t,numberOfValues:s,tokensLookupIndex:i,view:r}){return this.bucketsIndex=e,this.valuesIndexStart=t,this.numberOfValues=s,this.tokensLookupIndex=i,this.view=r,r.seekZero(),this}getValues(){const e=[];if(0===this.numberOfValues)return e;this.view.setPos(this.valuesIndexStart);for(let t=0;t<this.numberOfValues;t+=1)e.push(this.deserializeValue(this.view));return this.view.seekZero(),e}getSerializedSize(){return 12+M(this.view.buffer,!0)}serialize(e){e.pushUint32(this.tokensLookupIndex.length),e.pushUint32(this.bucketsIndex.length),e.pushUint32(this.numberOfValues),e.pushBytes(this.view.buffer,!0)}get(e){const t=this.cache.get(e);if(void 0!==t)return t;const s=e&this.tokensLookupIndex.length-1,i=this.tokensLookupIndex[s];if(i===_t)return[];const r=s===this.tokensLookupIndex.length-1?this.bucketsIndex.length:this.tokensLookupIndex[s+1],n=[];for(let t=i;t<r;t+=2){this.bucketsIndex[t]===e&&n.push(this.bucketsIndex[t+1])}if(0===n.length)return[];const o=[],a=this.view;for(let e=0;e<n.length;e+=1)a.setPos(n[e]),o.push(this.deserializeValue(a));return this.cache.set(e,o),o}}function Pt(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,color:i,description:r}=e;return"string"==typeof t&&("string"==typeof s&&("string"==typeof i&&"string"==typeof r))}function Dt(e){return me(e.key)}function qt(e){return q(e.key)+q(e.name)+q(e.color)+q(e.description)}function Nt(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.color),t.pushUTF8(e.description)}function Wt(e){return{key:e.getUTF8(),name:e.getUTF8(),color:e.getUTF8(),description:e.getUTF8()}}function Gt(e){return new Mt({getSerializedSize:qt,getKeys:e=>[Dt(e)],serialize:Nt,deserialize:Wt,values:e})}function Vt(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,description:i,country:r,website_url:n,privacy_policy_url:o,privacy_contact:a,ghostery_id:h}=e;return"string"==typeof t&&("string"==typeof s&&((null===i||"string"==typeof i)&&((null===r||"string"==typeof r)&&((null===n||"string"==typeof n)&&((null===o||"string"==typeof o)&&((null===a||"string"==typeof a)&&(null===h||"string"==typeof h)))))))}function Zt(e){return me(e.key)}function Kt(e){return q(e.key)+q(e.name)+q(e.description||"")+q(e.website_url||"")+q(e.country||"")+q(e.privacy_policy_url||"")+q(e.privacy_contact||"")+q(e.ghostery_id||"")}function Xt(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.description||""),t.pushUTF8(e.website_url||""),t.pushUTF8(e.country||""),t.pushUTF8(e.privacy_policy_url||""),t.pushUTF8(e.privacy_contact||""),t.pushUTF8(e.ghostery_id||"")}function Jt(e){return{key:e.getUTF8(),name:e.getUTF8(),description:e.getUTF8()||null,website_url:e.getUTF8()||null,country:e.getUTF8()||null,privacy_policy_url:e.getUTF8()||null,privacy_contact:e.getUTF8()||null,ghostery_id:e.getUTF8()||null}}function Qt(e){return new Mt({getSerializedSize:Kt,getKeys:e=>[Zt(e)],serialize:Xt,deserialize:Jt,values:e})}function Yt(e){if(null===e)return!1;if("object"!=typeof e)return!1;const{key:t,name:s,category:i,organization:r,alias:n,website_url:o,domains:a,filters:h}=e;return"string"==typeof t&&("string"==typeof s&&("string"==typeof i&&((null===r||"string"==typeof r)&&(("string"==typeof n||null===n)&&((null===o||"string"==typeof o)&&(!(!Array.isArray(a)||!a.every((e=>"string"==typeof e)))&&!(!Array.isArray(h)||!h.every((e=>"string"==typeof e)))))))))}function es(e){const t=[];for(const s of e.filters){const e=st.parse(s);null!==e&&t.push(e.getId())}for(const s of e.domains){const e=st.parse(`||${s}^`);null!==e&&t.push(e.getId())}return[...new Set(t)]}function ts(e){let t=_(e.domains.length);for(const s of e.domains)t+=q(s);let s=_(e.filters.length);for(const t of e.filters)s+=q(t);return q(e.key)+q(e.name)+q(e.category)+q(e.organization||"")+q(e.alias||"")+q(e.website_url||"")+q(e.ghostery_id||"")+t+s}function ss(e,t){t.pushUTF8(e.key),t.pushUTF8(e.name),t.pushUTF8(e.category),t.pushUTF8(e.organization||""),t.pushUTF8(e.alias||""),t.pushUTF8(e.website_url||""),t.pushUTF8(e.ghostery_id||""),t.pushLength(e.domains.length);for(const s of e.domains)t.pushUTF8(s);t.pushLength(e.filters.length);for(const s of e.filters)t.pushUTF8(s)}function is(e){const t=e.getUTF8(),s=e.getUTF8(),i=e.getUTF8(),r=e.getUTF8()||null,n=e.getUTF8()||null,o=e.getUTF8()||null,a=e.getUTF8()||null,h=e.getLength(),l=[];for(let t=0;t<h;t+=1)l.push(e.getUTF8());const c=e.getLength(),d=[];for(let t=0;t<c;t+=1)d.push(e.getUTF8());return{key:t,name:s,category:i,organization:r,alias:n,website_url:o,ghostery_id:a,domains:l,filters:d}}function rs(e){return new Mt({getSerializedSize:ts,getKeys:es,serialize:ss,deserialize:is,values:e})}class ns{static deserialize(e){const t=new ns(null);return t.categories=Mt.deserialize(e,Wt),t.organizations=Mt.deserialize(e,Jt),t.patterns=Mt.deserialize(e,is),t}constructor(e){if(!e)return this.organizations=Qt([]),this.categories=Gt([]),void(this.patterns=rs([]));const{patterns:t,organizations:s,categories:i}=e,r=[];if("object"==typeof i)for(const[e,t]of Object.entries(i)){if("object"!=typeof t)continue;const s={key:e,...t};Pt(s)?r.push(s):console.error("?? invalid category",s)}this.categories=Gt(r);const n=[];if("object"==typeof s)for(const[e,t]of Object.entries(s)){if("object"!=typeof t)continue;const s={key:e,...t};Vt(s)?n.push(s):console.error("?? invalid organization",s)}this.organizations=Qt(n);const o=[];if("object"==typeof t)for(const[e,s]of Object.entries(t)){if("object"!=typeof s)continue;const t={key:e,...s};Yt(t)?o.push(t):console.error("?? invalid pattern",t)}this.patterns=rs(o)}getCategories(){return this.categories.getValues()}getOrganizations(){return this.organizations.getValues()}getPatterns(){return this.patterns.getValues()}getSerializedSize(){return this.categories.getSerializedSize()+this.organizations.getSerializedSize()+this.patterns.getSerializedSize()}serialize(e){this.categories.serialize(e),this.organizations.serialize(e),this.patterns.serialize(e)}fromFilter(e){return this.fromId(e.getId())}fromDomain(e){const t=e.split(".");for(;t.length>=2;t.shift()){const e=t.join("."),s=st.parse(`||${e}^`);if(null===s)continue;const i=this.fromId(s.getId());if(i.length>0)return i}return[]}fromId(e){var t,s;const i=[];for(const r of this.patterns.get(e))i.push({pattern:r,category:null===(t=this.categories.get(Dt({key:r.category})))||void 0===t?void 0:t[0],organization:null!==r.organization?null===(s=this.organizations.get(Zt({key:r.organization})))||void 0===s?void 0:s[0]:null});return i}}class os{static deserialize(e){const t=new Set;for(let s=0,i=e.getUint32();s<i;s++)t.add(e.getUint32());const s=[];for(let t=0,i=e.getUint32();t<i;t++)s.push(ut.deserialize(e));return new this({excluded:t,preprocessors:s})}constructor({excluded:e=new Set,preprocessors:t=[]}){this.excluded=e,this.preprocessors=t}isFilterExcluded(e){return this.excluded.has(e.getId())}updateEnv(e){this.excluded.clear();for(const t of this.preprocessors)if(!t.evaluate(e))for(const e of t.filterIDs)this.excluded.add(e)}update({added:e,removed:t},s){if(t)for(const e of t){const t=this.preprocessors.find((t=>t.condition===e.condition));if(t)for(const s of e.filterIDs)t.filterIDs.delete(s)}if(e)for(const t of e){const e=this.preprocessors.find((e=>e.condition===t.condition));if(e)for(const s of t.filterIDs)e.filterIDs.add(s);else this.preprocessors.push(t)}(t&&0!==t.length||e&&0!==e.length)&&this.updateEnv(s)}serialize(e){e.pushUint32(this.excluded.size);for(const t of this.excluded)e.pushUint32(t);e.pushUint32(this.preprocessors.length);for(const t of this.preprocessors)t.serialize(e)}getSerializedSize(){let e=4*(1+this.excluded.size);e+=4;for(const t of this.preprocessors)e+=t.getSerializedSize();return e}}const as=654;function hs(e){if(0===e.length)return!1;let t,s=0;for(const i of e){const e=(i.isImportant()?4:0)|(i.isException()?1:2);e>=s&&(s=e,t=i)}return void 0!==t&&t.isException()}const ls=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,10,3,3,3,3,3,3,3,3,3,3,3,3,4,3,3,11,6,6,6,5,8,8,8,8,8,8,8,8,8,8,8,0,1,2,3,5,8,7,1,1,1,4,6,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,3,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);e.Config=G,e.CosmeticFilter=Ve,e.ENGINE_VERSION=as,e.FiltersEngine=class extends J{static fromCached(e,t){if(void 0===t)return e();const{path:s,read:i,write:r}=t;return i(s).then((e=>this.deserialize(e))).catch((()=>e().then((e=>r(s,e.serialize()).then((()=>e))))))}static empty(e={}){return new this({config:e})}static fromLists(e,t,s={},i){return this.fromCached((()=>{const i=re(e,t),r=ne(e);return Promise.all([i,r]).then((([e,t])=>{const i=this.parse(e.join("\n"),s);return void 0!==t&&i.updateResources(t,""+t.length),i}))}),i)}static fromPrebuiltAdsOnly(e=fetch,t){return this.fromLists(e,te,{},t)}static fromPrebuiltAdsAndTracking(e=fetch,t){return this.fromLists(e,se,{},t)}static fromPrebuiltFull(e=fetch,t){return this.fromLists(e,ie,{},t)}static fromTrackerDB(e,t={}){const s=new G(t),i=new ns(e),r=[];for(const e of i.getPatterns())r.push(...e.filters);const n=this.parse(r.join("\n"),s);return n.metadata=i,n}static parse(e,t={}){const s=new G(t);return new this({...gt(e,s),config:s})}static deserialize(e){const t=W.fromUint8Array(e,{enableCompression:!1}),s=t.getUint16();if(as!==s)throw new Error(`serialized engine version mismatch, expected 654 but got ${s}`);const i=G.deserialize(t);if(i.enableCompression&&t.enableCompression(),i.integrityCheck){const s=t.pos;t.pos=e.length-4;const i=t.checksum(),r=t.getUint32();if(i!==r)throw new Error(`serialized engine checksum mismatch, expected ${r} but got ${i}`);t.pos=s}const r=new this({config:i});r.resources=yt.deserialize(t);const n=new Map,o=t.getUint16();for(let e=0;e<o;e+=1)n.set(t.getASCII(),t.getASCII());r.lists=n,r.preprocessors=os.deserialize(t),r.importants=$t.deserialize(t,i),r.redirects=$t.deserialize(t,i),r.filters=$t.deserialize(t,i),r.exceptions=$t.deserialize(t,i),r.csp=$t.deserialize(t,i),r.cosmetics=Bt.deserialize(t,i),r.hideExceptions=$t.deserialize(t,i);return t.getBool()&&(r.metadata=ns.deserialize(t)),t.seekZero(),r}constructor({cosmeticFilters:e=[],networkFilters:t=[],preprocessors:s=[],config:i=new G,lists:r=new Map}={}){super(),this.config=new G(i),this.lists=r,this.preprocessors=new os({}),this.csp=new $t({config:this.config}),this.hideExceptions=new $t({config:this.config}),this.exceptions=new $t({config:this.config}),this.importants=new $t({config:this.config}),this.redirects=new $t({config:this.config}),this.filters=new $t({config:this.config}),this.cosmetics=new Bt({config:this.config}),this.resources=new yt,0===t.length&&0===e.length||this.update({newCosmeticFilters:e,newNetworkFilters:t,newPreprocessors:s})}isFilterExcluded(e){return this.preprocessors.isFilterExcluded(e)}updateEnv(e){this.preprocessors.updateEnv(e)}getSerializedSize(){let e=1+this.config.getSerializedSize()+this.resources.getSerializedSize()+this.preprocessors.getSerializedSize()+this.filters.getSerializedSize()+this.exceptions.getSerializedSize()+this.importants.getSerializedSize()+this.redirects.getSerializedSize()+this.csp.getSerializedSize()+this.cosmetics.getSerializedSize()+this.hideExceptions.getSerializedSize()+4;for(const[t,s]of this.lists)e+=D(t)+D(s);return e+=1,void 0!==this.metadata&&(e+=this.metadata.getSerializedSize()),e}serialize(e){const t=W.fromUint8Array(e||new Uint8Array(this.getSerializedSize()),this.config);t.pushUint16(as),this.config.serialize(t),this.resources.serialize(t),t.pushUint16(this.lists.size);for(const[e,s]of Array.from(this.lists.entries()).sort())t.pushASCII(e),t.pushASCII(s);return this.preprocessors.serialize(t),this.importants.serialize(t),this.redirects.serialize(t),this.filters.serialize(t),this.exceptions.serialize(t),this.csp.serialize(t),this.cosmetics.serialize(t),this.hideExceptions.serialize(t),t.pushBool(void 0!==this.metadata),void 0!==this.metadata&&this.metadata.serialize(t),this.config.integrityCheck&&t.pushUint32(t.checksum()),t.subarray()}loadedLists(){return Array.from(this.lists.keys())}hasList(e,t){return this.lists.has(e)&&this.lists.get(e)===t}updateResources(e,t){return this.resources.checksum!==t&&(this.resources=yt.parse(e,{checksum:t}),!0)}getFilters(){return{cosmeticFilters:[].concat(this.cosmetics.getFilters()),networkFilters:[].concat(this.filters.getFilters(),this.exceptions.getFilters(),this.importants.getFilters(),this.redirects.getFilters(),this.csp.getFilters(),this.hideExceptions.getFilters())}}update({newNetworkFilters:e=[],newCosmeticFilters:t=[],newPreprocessors:s=[],removedCosmeticFilters:i=[],removedNetworkFilters:r=[],removedPreprocessors:n=[]},o=new rt){let a=!1;if(!this.config.loadPreprocessors||0===s.length&&0===n.length||(a=!0,this.preprocessors.update({added:s,removed:n},o)),!this.config.loadCosmeticFilters||0===t.length&&0===i.length||(a=!0,this.cosmetics.update(t,0===i.length?void 0:new Set(i),this.config)),this.config.loadNetworkFilters&&(0!==e.length||0!==r.length)){a=!0;const t=[],s=[],i=[],n=[],o=[],h=[];for(const r of e)r.isCSP()?s.push(r):r.isGenericHide()||r.isSpecificHide()?h.push(r):r.isException()?i.push(r):r.isImportant()?n.push(r):r.isRedirect()?o.push(r):t.push(r);const l=0===r.length?void 0:new Set(r);this.importants.update(n,l),this.redirects.update(o,l),this.filters.update(t,l),!0===this.config.loadExceptionFilters&&this.exceptions.update(i,l),!0===this.config.loadCSPFilters&&this.csp.update(s,l),this.hideExceptions.update(h,l)}return a}updateFromDiff({added:e,removed:t,preprocessors:s},i){const r=[],n=[],o=[],a=[],h=[],l=[];if(void 0!==t&&0!==t.length){const{networkFilters:e,cosmeticFilters:s}=gt(t.join("\n"),this.config);Array.prototype.push.apply(a,s),Array.prototype.push.apply(h,e)}if(void 0!==e&&0!==e.length){const{networkFilters:t,cosmeticFilters:s}=gt(e.join("\n"),this.config);Array.prototype.push.apply(r,s),Array.prototype.push.apply(n,t)}if(void 0!==s)for(const[e,t]of Object.entries(s)){if(void 0!==t.removed&&0!==t.removed.length){const{networkFilters:s,cosmeticFilters:i}=gt(t.removed.join("\n"),this.config),r=new Set([].concat(i.map((e=>e.getId()))).concat(s.map((e=>e.getId()))));l.push(new ut({condition:e,filterIDs:r}))}if(void 0!==t.added&&0!==t.added.length){const{networkFilters:s,cosmeticFilters:i}=gt(t.added.join("\n"),this.config),r=new Set([].concat(i.map((e=>e.getId()))).concat(s.map((e=>e.getId()))));o.push(new ut({condition:e,filterIDs:r}))}}return this.update({newCosmeticFilters:r,newNetworkFilters:n,newPreprocessors:o,removedCosmeticFilters:a.map((e=>e.getId())),removedNetworkFilters:h.map((e=>e.getId())),removedPreprocessors:l},i)}getHtmlFilters({url:e,hostname:t,domain:s}){const i=[];if(!1===this.config.enableHtmlFiltering||!1===this.config.loadCosmeticFilters)return i;const r=this.cosmetics.getHtmlRules({domain:s||"",hostname:t,isFilterExcluded:this.isFilterExcluded.bind(this)});for(const e of r){const t=e.getExtendedSelector();void 0!==t&&i.push(t)}return 0!==i.length&&this.emit("html-filtered",i,e),i}getCosmeticsFilters({url:e,hostname:t,domain:s,classes:i,hrefs:r,ids:n,getBaseRules:o=!0,getInjectionRules:a=!0,getExtendedRules:h=!0,getRulesFromDOM:l=!0,getRulesFromHostname:c=!0}){if(!1===this.config.loadCosmeticFilters)return{active:!1,extended:[],scripts:[],styles:""};let d=!0,u=!0;const f=this.hideExceptions.matchAll(Te.fromRawDetails({domain:s||"",hostname:t,url:e,sourceDomain:"",sourceHostname:"",sourceUrl:""}),this.isFilterExcluded.bind(this)),p=[],g=[];for(const e of f){if(e.isElemHide()){d=!1,u=!1;break}e.isSpecificHide()?g.push(e):e.isGenericHide()&&p.push(e)}!0===d&&(d=!1===hs(p)),!0===u&&(u=!1===hs(g));const{injections:m,stylesheet:y,extended:b}=this.cosmetics.getCosmeticsFilters({domain:s||"",hostname:t,classes:i,hrefs:r,ids:n,allowGenericHides:d,allowSpecificHides:u,getBaseRules:o,getInjectionRules:a,getExtendedRules:h,getRulesFromDOM:l,getRulesFromHostname:c,isFilterExcluded:this.isFilterExcluded.bind(this)}),w=[];for(const t of m){const s=t.getScript(this.resources.js);void 0!==s&&(this.emit("script-injected",s,e),w.push(s))}return 0!==y.length&&this.emit("style-injected",y,e),{active:!0,extended:b,scripts:w,styles:y}}matchAll(e){const t=[];return e.isSupported&&(Array.prototype.push.apply(t,this.importants.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.filters.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.exceptions.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.csp.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.hideExceptions.matchAll(e,this.isFilterExcluded.bind(this))),Array.prototype.push.apply(t,this.redirects.matchAll(e,this.isFilterExcluded.bind(this)))),new Set(t)}getCSPDirectives(e){if(!this.config.loadNetworkFilters)return;if(!0!==e.isSupported||!1===e.isMainFrame())return;const t=this.csp.matchAll(e,this.isFilterExcluded.bind(this));if(0===t.length)return;const s=new Set,i=new Set;for(const e of t)if(e.isException()){if(void 0===e.csp)return;s.add(e.csp)}else i.add(e.csp);const r=Array.from(i).filter((e=>!s.has(e))).join("; ")||void 0;return void 0!==r&&this.emit("csp-injected",r,e),r}match(e,t=!1){const s={exception:void 0,filter:void 0,match:!1,redirect:void 0,metadata:void 0};if(!this.config.loadNetworkFilters)return s;if(e.isSupported){let t,i;if(s.filter=this.importants.match(e,this.isFilterExcluded.bind(this)),void 0===s.filter){const r=this.redirects.matchAll(e,this.isFilterExcluded.bind(this));if(0!==r.length)for(const e of r)"none"===e.getRedirect()?t=e:e.isRedirectRule()?i=e:s.filter=e;void 0===s.filter&&(s.filter=this.filters.match(e,this.isFilterExcluded.bind(this)),void 0!==i&&void 0!==s.filter&&(s.filter=i)),void 0!==s.filter&&(s.exception=this.exceptions.match(e,this.isFilterExcluded.bind(this)))}void 0!==s.filter&&void 0===s.exception&&s.filter.isRedirect()&&(void 0!==t?s.exception=t:s.redirect=this.resources.getResource(s.filter.getRedirect()))}return s.match=void 0===s.exception&&void 0!==s.filter,void 0!==s.exception?this.emit("request-whitelisted",e,s):void 0!==s.redirect?this.emit("request-redirected",e,s):void 0!==s.filter?this.emit("request-blocked",e,s):this.emit("request-allowed",e,s),!0===t&&void 0!==s.filter&&this.metadata&&(s.metadata=this.metadata.fromFilter(s.filter)),s}getPatternMetadata(e,{getDomainMetadata:t=!1}={}){if(void 0===this.metadata)return[];const s=new Set,i=[];for(const t of this.matchAll(e))for(const e of this.metadata.fromFilter(t))s.has(e.pattern.key)||(s.add(e.pattern.key),i.push(e));if(t)for(const t of this.metadata.fromDomain(e.hostname))s.has(t.pattern.key)||(s.add(t.pattern.key),i.push(t));return i}blockScripts(){return this.updateFromDiff({added:[ae().scripts().redirectTo("javascript").toString()]}),this}blockImages(){return this.updateFromDiff({added:[ae().images().redirectTo("png").toString()]}),this}blockMedias(){return this.updateFromDiff({added:[ae().medias().redirectTo("mp4").toString()]}),this}blockFrames(){return this.updateFromDiff({added:[ae().frames().redirectTo("html").toString()]}),this}blockFonts(){return this.updateFromDiff({added:[ae().fonts().toString()]}),this}blockStyles(){return this.updateFromDiff({added:[ae().styles().toString()]}),this}},e.NetworkFilter=st,e.Request=Te,e.Resources=yt,e.ReverseIndex=Rt,e.StreamingHtmlFilter=class{constructor(e){this.buffer="",this.patterns=function(e){const t=[];for(const[,s]of e){const e=[],i=[];for(const t of s)47===t.charCodeAt(0)?t.endsWith("/")?i.push(new RegExp(t.slice(1,-1))):t.endsWith("/i")&&i.push(new RegExp(t.slice(1,-2),"i")):e.push(t);0===e.length&&0===i.length||t.push([e,i])}return t}(e)}flush(){return this.buffer}write(e){if(0===this.patterns.length)return e;if(0===e.length)return e;this.buffer+=e;const[t,s,i]=function(e,t){const s=[],i=`<${t}`,r=`</${t}>`;let n=e.indexOf(i),o=0;for(;-1!==n;){const t=e.indexOf(">",n+i.length);if(-1===t)return[s,e.slice(0,n),e.slice(n)];if(47===e.charCodeAt(t-1))o=t+1,s.push([n,e.slice(n,o)]);else{const i=e.indexOf(r,t);if(-1===i)return[s,e.slice(0,n),e.slice(n)];s.push([n,e.slice(n,i+r.length)]),o=i+r.length}n=e.indexOf(i,o)}let a=e.lastIndexOf(">");-1===a&&(a=o);const h=e.indexOf("<",a);return-1===h||e.length-h>=i.length||!1===i.startsWith(e.slice(h))?[s,e,""]:[s,e.slice(0,h),e.slice(h)]}(this.buffer,"script");return this.buffer=i,0===t.length?s:function(e,t){if(0===t.length)return e;let s=e;t.reverse();for(const[e,i]of t)s=s.slice(0,e)+s.slice(e+i.length);return s}(s,function(e,t){const s=[];for(const i of t)for(const[t,r]of e)if($e(i[1],t,r)){s.push(i);break}return s}(this.patterns,t))}},e.adsAndTrackingLists=se,e.adsLists=te,e.detectFilterType=ft,e.f=function(e){return pt(e[0])},e.fetchLists=re,e.fetchResources=ne,e.fetchWithRetry=Q,e.fullLists=ie,e.generateDiff=function(e,t,s=new G){const i=new G(Object.assign({},s,{debug:!0})),r=mt(e,i),n=new Set(r.filters.map((e=>e.getId()))),o=mt(t,i),a=new Set(o.filters.map((e=>e.getId()))),h=new Set;for(const e of o.filters)n.has(e.getId())||h.add(e.rawLine);const l=new Set;for(const e of r.filters)a.has(e.getId())||l.add(e.rawLine);if(!s.loadPreprocessors)return{added:Array.from(h),removed:Array.from(l),preprocessors:{}};const c=new Map;for(const e of o.filters)c.set(e.getId(),e.rawLine);for(const e of r.filters)c.set(e.getId(),e.rawLine);const d={};for(const e of r.preprocessors){const t=o.preprocessors.find((t=>t.condition===e.condition));if(!t){const t=new Set;for(const s of e.filterIDs)t.add(c.get(s));d[e.condition]={added:[],removed:Array.from(t)};continue}const s={added:new Set,removed:new Set};for(const i of e.filterIDs)t.filterIDs.has(i)||s.removed.add(c.get(i));for(const i of t.filterIDs)e.filterIDs.has(i)||s.added.add(c.get(i));d[e.condition]={added:Array.from(s.added),removed:Array.from(s.removed)}}for(const e of o.preprocessors)if(!d[e.condition]){const t=new Set;for(const s of e.filterIDs)t.add(c.get(s));d[e.condition]={added:Array.from(t),removed:[]}}for(const[e,{added:t,removed:s}]of Object.entries(d))0===t.length&&0===s.length&&delete d[e];return{added:Array.from(h),removed:Array.from(l),preprocessors:d}},e.getHostnameHashesFromLabelsBackward=Le,e.getLinesWithFilters=function(e,t=new G){return new Set(mt(e,new G(Object.assign({},t,{debug:!0}))).filters.map((({rawLine:e})=>e)))},e.hasUnicode=Ce,e.isUTF8=function(e){if(0===e.length)return!0;if(!0===function(e){if(0===e.length)return!0;for(let t=0;t<e.length;t+=1)if(e[t]>127)return!1;return!0}(e))return!0;let t=0;for(let s=0;s<e.length;s+=1){const i=ls[e[s]];if(t=ls[256+16*t+i],1===t||void 0===t)return!1}return!0},e.makeRequest=function(e){return Te.fromRawDetails(e)},e.mergeDiffs=function(e){const t=new Set,s=new Set,i={};for(const{added:r,removed:n,preprocessors:o}of e){if(void 0!==r)for(const e of r)s.has(e)&&s.delete(e),t.add(e);if(void 0!==n)for(const e of n)t.has(e)&&t.delete(e),s.add(e);if(o)for(const[e,t]of Object.entries(o))if(i[e]){if(void 0!==t.added)for(const s of t.added)i[e].removed.has(s)&&i[e].removed.delete(s),i[e].added.add(s);if(void 0!==t.removed)for(const s of t.removed)i[e].added.has(s)&&i[e].added.delete(s),i[e].removed.add(s)}else i[e]={added:void 0!==t.added?new Set(t.added):new Set,removed:void 0!==t.removed?new Set(t.removed):new Set}}return{added:Array.from(t),removed:Array.from(s),preprocessors:Object.fromEntries(Object.entries(i).map((([e,t])=>[e,{added:Array.from(t.added),removed:Array.from(t.removed)}])))}},e.parseFilter=pt,e.parseFilters=gt,e.tokenize=Fe}));
//# sourceMappingURL=adblocker.umd.min.js.map
