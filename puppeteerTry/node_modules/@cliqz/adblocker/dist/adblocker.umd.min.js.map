{"version":3,"file":"adblocker.umd.min.js","sources":["esm/codebooks/cosmetic-selector.js","esm/codebooks/network-csp.js","esm/codebooks/network-filter.js","esm/codebooks/network-hostname.js","esm/codebooks/network-redirect.js","esm/codebooks/raw-network.js","esm/codebooks/raw-cosmetic.js","esm/compression.js","esm/crc32.js","esm/punycode.js","esm/data-view.js","esm/queue-microtask.js","esm/config.js","esm/events.js","esm/fetch.js","esm/filters/dsl.js","esm/tokens-buffer.js","esm/utils.js","esm/request.js","esm/engine/domains.js","esm/html-filtering.js","esm/filters/cosmetic.js","esm/filters/network.js","esm/preprocessor.js","esm/lists.js","esm/resources.js","esm/compact-set.js","esm/engine/optimizer.js","esm/engine/reverse-index.js","esm/engine/bucket/filters.js","esm/engine/bucket/cosmetic.js","esm/engine/bucket/network.js","esm/engine/map.js","esm/engine/metadata/categories.js","esm/engine/metadata/organizations.js","esm/engine/metadata/patterns.js","esm/engine/metadata.js","esm/engine/bucket/preprocessor.js","esm/engine/engine.js","esm/encoding.js"],"sourcesContent":["/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"%3D%3D%2527%252Cnecessary%3Atrue%252Cpreferences%3Afalse%252Cstatistics%3Afalse%252Cmarketing%3Afalse%252Cmethod%3A%2527explicit%2527%252Cve\",\n    \"div[style=\\\"position: absolute; inset: 0px; overflow: hidden; z-index: 160; background: transparent none repeat scroll 0% 0%; display: block;\",\n    \"div[style=\\\"position: fixed; display: block; width: 100%; height: 100%; inset: 0px; background-color: rgba(0, 0, 0, 0); z-index: 300000;\\\"]\",\n    \"\\\"]:not([style^=\\\"width: 1px; height: 1px; position: absolute; left: -10000px; top: -\\\"])\",\n    \"acs, document.createElement, %2Fl%5C.parentNode%5C.insertBefore%5C(s%2F\",\n    \"%2Fvisit%2F%22%5D%5Btitle%5E%3D%22https%3A%2F%2F%22%5D, %5Btitle%5D\",\n    \"rmnt, script, %2Fh%3DdecodeURIComponent%7CpopundersPerIP%2F\",\n    \":not([style^=\\\"position: absolute; left: -5000px\\\"])\",\n    \"href-sanitizer, a%5Bhref%5E%3D%22https%3A%2F%2F\",\n    \"ra, oncontextmenu%7Condragstart%7Conselectstart\",\n    \"acs, document.querySelectorAll, popMagic\",\n    \"acs, addEventListener, google_ad_client\",\n    \"aost, String.prototype.charCodeAt, ai_\",\n    \"aopr, app_vars.force_disable_adblock\",\n    \"paid.outbrain.com/network/redir?\\\"]\",\n    \"acs, document.addEventListener, \",\n    \"acs, document.getElementById, \",\n    \"no-fetch-if, googlesyndication\",\n    \"aopr, document.dispatchEvent\",\n    \"no-xhr-if, googlesyndication\",\n    \", document.createElement, \",\n    \"acs, String.fromCharCode, \",\n    \"%2522%253Afalse%252C%2522\",\n    \", document.oncontextmenu\",\n    \"aeld, DOMContentLoaded, \",\n    \"nosiif, visibility, 1000\",\n    \"set-local-storage-item, \",\n    \"trusted-click-element, \",\n    \"set, blurred, false\",\n    \"acs, eval, replace\",\n    \"decodeURIComponent\",\n    \"[target=\\\"_blank\\\"]\",\n    \"%22%3Afalse%2C%22\",\n    \"^script:has-text(\",\n    \"Object.prototype.\",\n    \"[href^=\\\"https://\",\n    \"[href^=\\\"http://\",\n    \"[href=\\\"https://\",\n    \"[src^=\\\"https://\",\n    \"modal-backdrop\",\n    \"rmnt, script, \",\n    \"BlockDetected\",\n    \"console.clear\",\n    \"trusted-set-\",\n    \"contextmenu\",\n    \"no-fetch-if\",\n    \"otification\",\n    \":has-text(\",\n    \"background\",\n    \"[class*=\\\"\",\n    \"[class^=\\\"\",\n    \"AAAAAAAAA\",\n    \"body,html\",\n    \"container\",\n    \"Container\",\n    \"decodeURI\",\n    \"div[class\",\n    \"div[id^=\\\"\",\n    \"div[style\",\n    \"document.\",\n    \"no-xhr-if\",\n    \"ompliance\",\n    \"placehold\",\n    \"sbygoogle\",\n    \"[href*=\\\"\",\n    \"#wpsafe-\",\n    \"Detector\",\n    \"disclaim\",\n    \"nano-sib\",\n    \"nextFunc\",\n    \"noopFunc\",\n    \"nostif, \",\n    \"nowebrtc\",\n    \".com/\\\"]\",\n    \"300x250\",\n    \"article\",\n    \"consent\",\n    \"Consent\",\n    \"content\",\n    \"display\",\n    \"message\",\n    \"Message\",\n    \"overlay\",\n    \"privacy\",\n    \"sidebar\",\n    \"sponsor\",\n    \"wrapper\",\n    \"[data-\",\n    \"%7B%7D\",\n    \"728x90\",\n    \"accept\",\n    \"Accept\",\n    \"aopr, \",\n    \"banner\",\n    \"bottom\",\n    \"cookie\",\n    \"Cookie\",\n    \"nosiif\",\n    \"notice\",\n    \"nowoif\",\n    \"policy\",\n    \"Policy\",\n    \"script\",\n    \"Script\",\n    \"widget\",\n    \":has(\",\n    \":not(\",\n    \"block\",\n    \"Block\",\n    \"click\",\n    \"deskt\",\n    \"disab\",\n    \"fixed\",\n    \"frame\",\n    \"modal\",\n    \"popup\",\n    \"video\",\n    \"0px;\",\n    \"2%3A\",\n    \"aeld\",\n    \"body\",\n    \"butt\",\n    \"down\",\n    \"foot\",\n    \"gdpr\",\n    \"goog\",\n    \"html\",\n    \"icky\",\n    \"ight\",\n    \"show\",\n    \"tion\",\n    \"true\",\n    \" > \",\n    \"%3D\",\n    \"%7C\",\n    \"age\",\n    \"box\",\n    \"div\",\n    \"ent\",\n    \"out\",\n    \"rap\",\n    \"set\",\n    \"__\",\n    \", \",\n    \".t\",\n    \"\\\"]\",\n    \"%2\",\n    \"%5\",\n    \"=\\\"\",\n    \"00\",\n    \"ac\",\n    \"ad\",\n    \"Ad\",\n    \"al\",\n    \"an\",\n    \"ar\",\n    \"at\",\n    \"e-\",\n    \"ed\",\n    \"en\",\n    \"er\",\n    \"he\",\n    \"id\",\n    \"in\",\n    \"is\",\n    \"la\",\n    \"le\",\n    \"lo\",\n    \"od\",\n    \"ol\",\n    \"om\",\n    \"on\",\n    \"op\",\n    \"or\",\n    \"re\",\n    \"s_\",\n    \"s-\",\n    \"se\",\n    \"st\",\n    \"t-\",\n    \"te\",\n    \"ti\",\n    \"un\",\n    \" \",\n    \"_\",\n    \"-\",\n    \";\",\n    \":\",\n    \".\",\n    \"(\",\n    \")\",\n    \"[\",\n    \"]\",\n    \"*\",\n    \"/\",\n    \"#\",\n    \"^\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"b\",\n    \"B\",\n    \"c\",\n    \"C\",\n    \"d\",\n    \"D\",\n    \"e\",\n    \"E\",\n    \"f\",\n    \"F\",\n    \"g\",\n    \"G\",\n    \"h\",\n    \"H\",\n    \"I\",\n    \"j\",\n    \"J\",\n    \"k\",\n    \"l\",\n    \"L\",\n    \"m\",\n    \"M\",\n    \"n\",\n    \"N\",\n    \"o\",\n    \"O\",\n    \"p\",\n    \"P\",\n    \"q\",\n    \"Q\",\n    \"r\",\n    \"R\",\n    \"s\",\n    \"S\",\n    \"t\",\n    \"T\",\n    \"u\",\n    \"U\",\n    \"v\",\n    \"V\",\n    \"w\",\n    \"W\",\n    \"x\",\n    \"y\",\n    \"Y\",\n    \"z\",\n    \"Z\"\n];\n//# sourceMappingURL=cosmetic-selector.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"sandbox allow-forms allow-same-origin allow-scripts allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-top-navigation\",\n    \"script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:\",\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval' \",\n    \" *.google.com *.gstatic.com *.googleapis.com\",\n    \".com *.google.com *.googletagmanager.com *.\",\n    \"script-src 'self' '*' 'unsafe-inline'\",\n    \"default-src 'unsafe-inline' 'self'\",\n    \" *.google.com *.gstatic.com *.\",\n    \"t-src 'self' 'unsafe-inline' \",\n    \"script-src * 'unsafe-inline'\",\n    \".com *.googleapis.com *.\",\n    \" *.googletagmanager.com\",\n    \"default-src 'self' *.\",\n    \"frame-src 'self' *\",\n    \" *.cloudflare.com\",\n    \"child-src 'none';\",\n    \"worker-src 'none'\",\n    \" 'unsafe-inline'\",\n    \"google-analytics\",\n    \" 'unsafe-eval'\",\n    \"bootstrapcdn\",\n    \"connect-src \",\n    \"child-src *\",\n    \" *.gstatic\",\n    \"googleapis\",\n    \"script-src\",\n    \"style-src \",\n    \"frame-src\",\n    \"facebook\",\n    \"https://\",\n    \" 'self'\",\n    \".com *.\",\n    \".net *.\",\n    \"addthis\",\n    \"captcha\",\n    \"gstatic\",\n    \"youtube\",\n    \"defaul\",\n    \"disqus\",\n    \"google\",\n    \"jquery\",\n    \"data:\",\n    \"scrip\",\n    \"-src\",\n    \".com\",\n    \".net\",\n    \"n.cc\",\n    \" *.\",\n    \"age\",\n    \"dia\",\n    \"img\",\n    \"vic\",\n    \" *\",\n    \"*.\",\n    \"ch\",\n    \"el\",\n    \"im\",\n    \"in\",\n    \"ra\",\n    \"re\",\n    \"tt\",\n    \"wi\",\n    \"wp\",\n    \"yt\",\n    \" \",\n    \"-\",\n    \";\",\n    \":\",\n    \".\",\n    \"'\",\n    \"*\",\n    \"/\",\n    \"3\",\n    \"a\",\n    \"b\",\n    \"c\",\n    \"d\",\n    \"e\",\n    \"f\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"q\",\n    \"r\",\n    \"s\",\n    \"t\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\"\n];\n//# sourceMappingURL=network-csp.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"/homad-global-configs.schneevonmorgen.com/global_config\",\n    \"/videojs-vast-vpaid@2.0.2/bin/videojs_5.vast.vpaid.min\",\n    \"/etc.clientlibs/logitech-common/clientlibs/onetrust.\",\n    \"[\\\\/]{1,}.*[a-zA-Z0-9]{3,7}\\\\/[a-zA-Z0-9]{6,}\\\\/.*/\",\n    \"/pagead/managed/js/adsense/*/show_ads_impl\",\n    \"/pagead/managed/js/gpt/*/pubads_impl\",\n    \"/pagead/js/adsbygoogle.js\",\n    \"/vans-adapter-google-ima\",\n    \"/js/sdkloader/ima3_dai\",\n    \"/js/sdkloader/ima3.js\",\n    \"/videojs-contrib-ads\",\n    \"/wp-content/plugins/\",\n    \"/wp-content/uploads/\",\n    \"/wp-content/themes/\",\n    \"/detroitchicago/\",\n    \"/appmeasurement\",\n    \"/413gkwmt/init\",\n    \"/cdn-cgi/trace\",\n    \"/style/03/img/\",\n    \"\\\\/[a-zA-Z0-9]{\",\n    \"/^https?:\\\\/\\\\/\",\n    \"/^https:\\\\/\\\\/\",\n    \"notification\",\n    \"fingerprint\",\n    \"/ljub4etb/\",\n    \"impression\",\n    \"[a-z0-9]{\",\n    \"/plugins/\",\n    \"affiliate\",\n    \"analytics\",\n    \"(.+?\\\\.)?\",\n    \"[0-9a-z]\",\n    \"/assets/\",\n    \"/images/\",\n    \"/pagead/\",\n    \"pageview\",\n    \"template\",\n    \"tracking\",\n    \"300x250\",\n    \"collect\",\n    \"consent\",\n    \"content\",\n    \"counter\",\n    \"default\",\n    \"metrics\",\n    \"privacy\",\n    \"[a-z]{\",\n    \"/embed\",\n    \"/video\",\n    \"728x90\",\n    \"aptcha\",\n    \"banner\",\n    \"bundle\",\n    \"client\",\n    \"cookie\",\n    \"detect\",\n    \"dn-cgi\",\n    \"google\",\n    \"iframe\",\n    \"module\",\n    \"prebid\",\n    \"public\",\n    \"script\",\n    \"source\",\n    \"widget\",\n    \".aspx\",\n    \".cgi?\",\n    \".com/\",\n    \".html\",\n    \"/api/\",\n    \"/beac\",\n    \"/html\",\n    \"/java\",\n    \"/stat\",\n    \"block\",\n    \"click\",\n    \"count\",\n    \"event\",\n    \"manag\",\n    \"media\",\n    \"pixel\",\n    \"popup\",\n    \"track\",\n    \"type=\",\n    \".css\",\n    \".gif\",\n    \".jpg\",\n    \".min\",\n    \".php\",\n    \".png\",\n    \"/img\",\n    \"/jqu\",\n    \"/js/\",\n    \"/lib\",\n    \"/log\",\n    \"/web\",\n    \"/wp-\",\n    \"468x\",\n    \"data\",\n    \"gdpr\",\n    \"gi-b\",\n    \"ight\",\n    \"mail\",\n    \"plug\",\n    \"show\",\n    \"stat\",\n    \"uild\",\n    \"view\",\n    \".js\",\n    \"/ad\",\n    \"=*&\",\n    \"age\",\n    \"fig\",\n    \"jax\",\n    \"key\",\n    \"lay\",\n    \"log\",\n    \"sdk\",\n    \"tag\",\n    \"web\",\n    \"ync\",\n    \"*/\",\n    \"*^\",\n    \"/_\",\n    \"/?\",\n    \"/*\",\n    \"/1\",\n    \"/d\",\n    \"/f\",\n    \"/g\",\n    \"/h\",\n    \"/l\",\n    \"/n\",\n    \"/r\",\n    \"/u\",\n    \"/v\",\n    \"/w\",\n    \"\\\\/\",\n    \"^*\",\n    \"00\",\n    \"ac\",\n    \"ad\",\n    \"al\",\n    \"am\",\n    \"an\",\n    \"ap\",\n    \"ar\",\n    \"as\",\n    \"at\",\n    \"bo\",\n    \"ce\",\n    \"ch\",\n    \"ck\",\n    \"co\",\n    \"de\",\n    \"di\",\n    \"e/\",\n    \"ed\",\n    \"el\",\n    \"en\",\n    \"eo\",\n    \"er\",\n    \"et\",\n    \"g/\",\n    \"he\",\n    \"ic\",\n    \"id\",\n    \"im\",\n    \"in\",\n    \"is\",\n    \"it\",\n    \"js\",\n    \"la\",\n    \"le\",\n    \"li\",\n    \"lo\",\n    \"mp\",\n    \"o/\",\n    \"ol\",\n    \"om\",\n    \"on\",\n    \"op\",\n    \"or\",\n    \"ot\",\n    \"re\",\n    \"ro\",\n    \"s_\",\n    \"s-\",\n    \"s?\",\n    \"s/\",\n    \"sp\",\n    \"ss\",\n    \"st\",\n    \"t/\",\n    \"te\",\n    \"ti\",\n    \"tm\",\n    \"tr\",\n    \"ub\",\n    \"um\",\n    \"un\",\n    \"ur\",\n    \"us\",\n    \"ut\",\n    \"ve\",\n    \"_\",\n    \"-\",\n    \",\",\n    \":\",\n    \"?\",\n    \".\",\n    \"}\",\n    \"*\",\n    \"/\",\n    \"\\\\\",\n    \"&\",\n    \"^\",\n    \"=\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"a\",\n    \"b\",\n    \"c\",\n    \"d\",\n    \"e\",\n    \"f\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"q\",\n    \"r\",\n    \"s\",\n    \"t\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\",\n    \"z\"\n];\n//# sourceMappingURL=network-filter.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"securepubads.g.doubleclick\",\n    \".xx.fbcdn.net.iberostar\",\n    \"googlesyndication\",\n    \"imasdk.googleapis\",\n    \".cloudfront.net\",\n    \".actonservice\",\n    \"analytics.\",\n    \"marketing.\",\n    \"tracking.\",\n    \"metrics.\",\n    \"images.\",\n    \".co.uk\",\n    \"a8clk.\",\n    \"stats.\",\n    \"a8cv.\",\n    \"media\",\n    \"track\",\n    \".com\",\n    \".net\",\n    \".top\",\n    \".xyz\",\n    \"tion\",\n    \"www.\",\n    \".io\",\n    \".jp\",\n    \"app\",\n    \"cdn\",\n    \"new\",\n    \"web\",\n    \".b\",\n    \".c\",\n    \".d\",\n    \".f\",\n    \".g\",\n    \".h\",\n    \".k\",\n    \".m\",\n    \".n\",\n    \".p\",\n    \".s\",\n    \".t\",\n    \".v\",\n    \".w\",\n    \"a1\",\n    \"a4\",\n    \"a8\",\n    \"ab\",\n    \"ac\",\n    \"ad\",\n    \"af\",\n    \"ag\",\n    \"ai\",\n    \"ak\",\n    \"al\",\n    \"am\",\n    \"an\",\n    \"ap\",\n    \"ar\",\n    \"as\",\n    \"at\",\n    \"au\",\n    \"av\",\n    \"aw\",\n    \"ax\",\n    \"ay\",\n    \"az\",\n    \"be\",\n    \"bl\",\n    \"bo\",\n    \"br\",\n    \"bu\",\n    \"ca\",\n    \"ce\",\n    \"ch\",\n    \"ci\",\n    \"ck\",\n    \"cl\",\n    \"cr\",\n    \"ct\",\n    \"cu\",\n    \"de\",\n    \"di\",\n    \"dn\",\n    \"do\",\n    \"dr\",\n    \"ds\",\n    \"du\",\n    \"dy\",\n    \"e-\",\n    \"eb\",\n    \"ec\",\n    \"ed\",\n    \"ef\",\n    \"eg\",\n    \"el\",\n    \"em\",\n    \"en\",\n    \"ep\",\n    \"er\",\n    \"es\",\n    \"et\",\n    \"eu\",\n    \"ev\",\n    \"ew\",\n    \"ex\",\n    \"ey\",\n    \"fe\",\n    \"ff\",\n    \"fi\",\n    \"fl\",\n    \"fo\",\n    \"fr\",\n    \"ge\",\n    \"gh\",\n    \"go\",\n    \"gr\",\n    \"gu\",\n    \"he\",\n    \"ho\",\n    \"ia\",\n    \"ib\",\n    \"ic\",\n    \"id\",\n    \"ie\",\n    \"if\",\n    \"ig\",\n    \"ik\",\n    \"il\",\n    \"im\",\n    \"in\",\n    \"ip\",\n    \"ir\",\n    \"is\",\n    \"it\",\n    \"iv\",\n    \"ix\",\n    \"iz\",\n    \"jo\",\n    \"ks\",\n    \"la\",\n    \"ld\",\n    \"le\",\n    \"li\",\n    \"ll\",\n    \"lo\",\n    \"lu\",\n    \"ly\",\n    \"ma\",\n    \"me\",\n    \"mo\",\n    \"mp\",\n    \"my\",\n    \"ne\",\n    \"no\",\n    \"ob\",\n    \"ok\",\n    \"ol\",\n    \"om\",\n    \"on\",\n    \"oo\",\n    \"op\",\n    \"or\",\n    \"ot\",\n    \"ou\",\n    \"ow\",\n    \"pa\",\n    \"pe\",\n    \"ph\",\n    \"pl\",\n    \"po\",\n    \"pr\",\n    \"pu\",\n    \"qu\",\n    \"ra\",\n    \"re\",\n    \"ro\",\n    \"ru\",\n    \"ry\",\n    \"s-\",\n    \"sc\",\n    \"se\",\n    \"sh\",\n    \"si\",\n    \"sk\",\n    \"sn\",\n    \"so\",\n    \"sp\",\n    \"ss\",\n    \"st\",\n    \"su\",\n    \"sw\",\n    \"sy\",\n    \"t-\",\n    \"ta\",\n    \"te\",\n    \"th\",\n    \"ti\",\n    \"tn\",\n    \"to\",\n    \"tr\",\n    \"ts\",\n    \"tu\",\n    \"tw\",\n    \"ty\",\n    \"ub\",\n    \"ul\",\n    \"um\",\n    \"un\",\n    \"up\",\n    \"ur\",\n    \"us\",\n    \"ut\",\n    \"ve\",\n    \"vi\",\n    \"vo\",\n    \"we\",\n    \"-\",\n    \".\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"a\",\n    \"b\",\n    \"c\",\n    \"d\",\n    \"e\",\n    \"f\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"q\",\n    \"r\",\n    \"s\",\n    \"t\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\",\n    \"z\"\n];\n//# sourceMappingURL=network-hostname.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"google-analytics.com/analytics.js\",\n    \"googlesyndication_adsbygoogle.js\",\n    \"googletagmanager.com/gtm.js\",\n    \"googletagservices_gpt.js\",\n    \"googletagmanager_gtm.js\",\n    \"fuckadblock.js-3.2.0\",\n    \"amazon_apstag.js\",\n    \"google-analytics\",\n    \"fingerprint2.js\",\n    \"noop-1s.mp4:10\",\n    \"google-ima.js\",\n    \"noop-0.1s.mp3\",\n    \"prebid-ads.js\",\n    \"nobab2.js:10\",\n    \"noopmp3-0.1s\",\n    \"noop-1s.mp4\",\n    \"hd-main.js\",\n    \"noopmp4-1s\",\n    \"32x32.png\",\n    \"noop.html\",\n    \"noopframe\",\n    \"noop.txt\",\n    \"nooptext\",\n    \"1x1.gif\",\n    \"2x2.png\",\n    \"noop.js\",\n    \"noopjs\",\n    \".com/\",\n    \".js:5\",\n    \"noop\",\n    \":10\",\n    \".js\",\n    \"ads\",\n    \"bea\",\n    \"_a\",\n    \":5\",\n    \"am\",\n    \"ar\",\n    \"ch\",\n    \"ic\",\n    \"in\",\n    \"le\",\n    \"on\",\n    \"re\",\n    \"st\",\n    \"_\",\n    \"-\",\n    \":\",\n    \".\",\n    \"/\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"a\",\n    \"b\",\n    \"c\",\n    \"d\",\n    \"e\",\n    \"f\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"r\",\n    \"s\",\n    \"t\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\",\n    \"z\"\n];\n//# sourceMappingURL=network-redirect.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"/js/sdkloader/ima3.j\",\n    \",redirect-rule=noop\",\n    \".com^$third-party\",\n    \"googlesyndication\",\n    \"imasdk.googleapis\",\n    \".cloudfront.net^\",\n    \",redirect-rule=\",\n    \"$script,domain=\",\n    \",redirect=noop\",\n    \"xmlhttprequest\",\n    \".actonservice\",\n    \"^$third-party\",\n    \"||smetrics.\",\n    \"third-party\",\n    \"marketing.\",\n    \"analytics\",\n    \",domain=\",\n    \"metrics.\",\n    \"tracking\",\n    \"$script\",\n    \".co.uk\",\n    \"$ghide\",\n    \"a8clk.\",\n    \"cookie\",\n    \"google\",\n    \"script\",\n    \"stats.\",\n    \".com^\",\n    \".top^\",\n    \".xyz^\",\n    \"/wp-c\",\n    \"$doma\",\n    \"a8cv.\",\n    \"image\",\n    \"media\",\n    \"track\",\n    \".au^\",\n    \".com\",\n    \".fr^\",\n    \".gif\",\n    \".jp^\",\n    \".net\",\n    \"/js/\",\n    \"$doc\",\n    \"$xhr\",\n    \"www.\",\n    \",1p\",\n    \",3p\",\n    \".jp\",\n    \".js\",\n    \"app\",\n    \"cdn\",\n    \"ent\",\n    \"new\",\n    \"web\",\n    \".b\",\n    \".c\",\n    \".d\",\n    \".f\",\n    \".k\",\n    \".m\",\n    \".n\",\n    \".p\",\n    \".s\",\n    \".t\",\n    \"@@\",\n    \"/*\",\n    \"/p\",\n    \"||\",\n    \"ab\",\n    \"ac\",\n    \"ad\",\n    \"af\",\n    \"ag\",\n    \"ak\",\n    \"al\",\n    \"am\",\n    \"an\",\n    \"ap\",\n    \"ar\",\n    \"as\",\n    \"at\",\n    \"au\",\n    \"av\",\n    \"aw\",\n    \"ax\",\n    \"ay\",\n    \"az\",\n    \"be\",\n    \"bo\",\n    \"br\",\n    \"ca\",\n    \"ce\",\n    \"ch\",\n    \"ck\",\n    \"cl\",\n    \"cr\",\n    \"ct\",\n    \"de\",\n    \"di\",\n    \"do\",\n    \"ds\",\n    \"e-\",\n    \"e^\",\n    \"eb\",\n    \"ec\",\n    \"ed\",\n    \"el\",\n    \"em\",\n    \"en\",\n    \"ep\",\n    \"er\",\n    \"es\",\n    \"et\",\n    \"ev\",\n    \"ew\",\n    \"ex\",\n    \"fe\",\n    \"ff\",\n    \"fi\",\n    \"fo\",\n    \"fr\",\n    \"g^\",\n    \"ge\",\n    \"gi\",\n    \"go\",\n    \"gr\",\n    \"gu\",\n    \"he\",\n    \"hi\",\n    \"ho\",\n    \"hp\",\n    \"ht\",\n    \"ic\",\n    \"id\",\n    \"ig\",\n    \"il\",\n    \"im\",\n    \"in\",\n    \"io\",\n    \"ip\",\n    \"ir\",\n    \"is\",\n    \"it\",\n    \"ix\",\n    \"iz\",\n    \"jo\",\n    \"js\",\n    \"ke\",\n    \"le\",\n    \"li\",\n    \"lo\",\n    \"lu\",\n    \"ly\",\n    \"me\",\n    \"mo\",\n    \"mp\",\n    \"my\",\n    \"ne\",\n    \"no\",\n    \"od\",\n    \"ok\",\n    \"ol\",\n    \"om\",\n    \"on\",\n    \"op\",\n    \"or\",\n    \"ot\",\n    \"pl\",\n    \"po\",\n    \"pr\",\n    \"qu\",\n    \"re\",\n    \"ri\",\n    \"ro\",\n    \"ru\",\n    \"s-\",\n    \"s/\",\n    \"sc\",\n    \"se\",\n    \"sh\",\n    \"si\",\n    \"so\",\n    \"sp\",\n    \"ss\",\n    \"st\",\n    \"su\",\n    \"sw\",\n    \"te\",\n    \"th\",\n    \"ti\",\n    \"to\",\n    \"tr\",\n    \"ts\",\n    \"ub\",\n    \"ud\",\n    \"ul\",\n    \"um\",\n    \"un\",\n    \"up\",\n    \"ur\",\n    \"us\",\n    \"ut\",\n    \"ve\",\n    \"vi\",\n    \"yo\",\n    \"_\",\n    \"-\",\n    \",\",\n    \"?\",\n    \".\",\n    \"*\",\n    \"/\",\n    \"^\",\n    \"=\",\n    \"|\",\n    \"~\",\n    \"$\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"a\",\n    \"b\",\n    \"c\",\n    \"d\",\n    \"e\",\n    \"f\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"m\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"q\",\n    \"r\",\n    \"s\",\n    \"t\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\",\n    \"z\"\n];\n//# sourceMappingURL=raw-network.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable prettier/prettier */\nexport default [\n    \"-webkit-touch-callou\",\n    \"app_vars.force_disab\",\n    \"nosiif, visibility, \",\n    \"overflow: auto !impo\",\n    \"rtant; position: ini\",\n    \"set-local-storage-it\",\n    \"set, blurred, false)\",\n    \"user-select: text !i\",\n    \"##^script:has-text(\",\n    \"##body,html:style(\",\n    \"decodeURIComponent\",\n    \"[href^=\\\"https://\",\n    \"acs, document.\",\n    \"rmnt, script, \",\n    \" !important;\",\n    \"trusted-set-\",\n    \", noopFunc)\",\n    \"contextmenu\",\n    \"no-fetch-if\",\n    \"otification\",\n    \".com##+js(\",\n    \"%2522%253A\",\n    \"%252C%2522\",\n    \"=\\\"https://\",\n    \"background\",\n    \"t: default\",\n    \" -webkit-\",\n    \".*,xhamst\",\n    \"container\",\n    \"mportant;\",\n    \"AAAAAAAA\",\n    \"disclaim\",\n    \"nostif, \",\n    \",google\",\n    \":style(\",\n    \".co.uk,\",\n    \"consent\",\n    \"content\",\n    \"message\",\n    \"nowoif)\",\n    \"privacy\",\n    \"-wrapp\",\n    \",kayak\",\n    \"[class\",\n    \"##+js(\",\n    \"accept\",\n    \"aopr, \",\n    \"banner\",\n    \"bottom\",\n    \"cookie\",\n    \"Cookie\",\n    \"notice\",\n    \"policy\",\n    \"widget\",\n    \":has(\",\n    \"##div\",\n    \"block\",\n    \"cript\",\n    \"true)\",\n    \".co.\",\n    \".com\",\n    \".de,\",\n    \".fr,\",\n    \".net\",\n    \".nl,\",\n    \".pl,\",\n    \".xyz\",\n    \"#@#.\",\n    \"2%3A\",\n    \"gdpr\",\n    \"goog\",\n    \"html\",\n    \"ight\",\n    \"news\",\n    \"text\",\n    \"wrap\",\n    \" > \",\n    \".*,\",\n    \"##.\",\n    \"###\",\n    \"%3D\",\n    \"%7C\",\n    \"ent\",\n    \"lay\",\n    \"web\",\n    \"__\",\n    \"-s\",\n    \", \",\n    \",b\",\n    \",c\",\n    \",f\",\n    \",g\",\n    \",m\",\n    \",p\",\n    \",s\",\n    \",t\",\n    \": \",\n    \".*\",\n    \".b\",\n    \".c\",\n    \".m\",\n    \".p\",\n    \".s\",\n    \"\\\"]\",\n    \"##\",\n    \"%2\",\n    \"%5\",\n    \"=\\\"\",\n    \"00\",\n    \"a-\",\n    \"ab\",\n    \"ac\",\n    \"ad\",\n    \"Ad\",\n    \"af\",\n    \"ag\",\n    \"ak\",\n    \"al\",\n    \"am\",\n    \"an\",\n    \"ap\",\n    \"ar\",\n    \"as\",\n    \"at\",\n    \"au\",\n    \"av\",\n    \"ay\",\n    \"az\",\n    \"bo\",\n    \"ch\",\n    \"ck\",\n    \"co\",\n    \"ct\",\n    \"de\",\n    \"di\",\n    \"do\",\n    \"e-\",\n    \"ed\",\n    \"el\",\n    \"em\",\n    \"en\",\n    \"er\",\n    \"es\",\n    \"et\",\n    \"ex\",\n    \"fi\",\n    \"fo\",\n    \"he\",\n    \"ic\",\n    \"id\",\n    \"if\",\n    \"il\",\n    \"im\",\n    \"in\",\n    \"is\",\n    \"it\",\n    \"le\",\n    \"li\",\n    \"lo\",\n    \"mo\",\n    \"mp\",\n    \"ol\",\n    \"om\",\n    \"on\",\n    \"op\",\n    \"or\",\n    \"ot\",\n    \"ov\",\n    \"ow\",\n    \"po\",\n    \"re\",\n    \"ro\",\n    \"s_\",\n    \"s-\",\n    \"se\",\n    \"sh\",\n    \"si\",\n    \"sp\",\n    \"st\",\n    \"t-\",\n    \"th\",\n    \"ti\",\n    \"tr\",\n    \"tv\",\n    \"ub\",\n    \"ul\",\n    \"um\",\n    \"un\",\n    \"up\",\n    \"ur\",\n    \"us\",\n    \"ut\",\n    \"ve\",\n    \"vi\",\n    \" \",\n    \"_\",\n    \"-\",\n    \",\",\n    \";\",\n    \":\",\n    \".\",\n    \"(\",\n    \")\",\n    \"[\",\n    \"/\",\n    \"^\",\n    \"0\",\n    \"1\",\n    \"2\",\n    \"3\",\n    \"4\",\n    \"5\",\n    \"6\",\n    \"7\",\n    \"8\",\n    \"9\",\n    \"a\",\n    \"b\",\n    \"B\",\n    \"c\",\n    \"C\",\n    \"d\",\n    \"D\",\n    \"e\",\n    \"E\",\n    \"f\",\n    \"F\",\n    \"g\",\n    \"h\",\n    \"i\",\n    \"I\",\n    \"j\",\n    \"k\",\n    \"l\",\n    \"L\",\n    \"m\",\n    \"M\",\n    \"n\",\n    \"o\",\n    \"p\",\n    \"P\",\n    \"q\",\n    \"r\",\n    \"R\",\n    \"s\",\n    \"S\",\n    \"t\",\n    \"T\",\n    \"u\",\n    \"v\",\n    \"w\",\n    \"x\",\n    \"y\",\n    \"z\"\n];\n//# sourceMappingURL=raw-cosmetic.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { Smaz } from '@remusao/smaz';\nimport cosmeticSelectorCodebook from './codebooks/cosmetic-selector.js';\nimport networkCSPCodebook from './codebooks/network-csp.js';\nimport networkFilterCodebook from './codebooks/network-filter.js';\nimport networkHostnameCodebook from './codebooks/network-hostname.js';\nimport networkRedirectCodebook from './codebooks/network-redirect.js';\nimport networkRawCodebook from './codebooks/raw-network.js';\nimport cosmeticRawCodebook from './codebooks/raw-cosmetic.js';\nexport default class Compression {\n    constructor() {\n        this.cosmeticSelector = new Smaz(cosmeticSelectorCodebook);\n        this.networkCSP = new Smaz(networkCSPCodebook);\n        this.networkRedirect = new Smaz(networkRedirectCodebook);\n        this.networkHostname = new Smaz(networkHostnameCodebook);\n        this.networkFilter = new Smaz(networkFilterCodebook);\n        this.networkRaw = new Smaz(networkRawCodebook);\n        this.cosmeticRaw = new Smaz(cosmeticRawCodebook);\n    }\n}\n//# sourceMappingURL=compression.js.map","/* crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */\n/* From: https://github.com/SheetJS/js-crc32/ */\nconst T = (() => {\n    let c = 0;\n    const table = new Int32Array(256);\n    for (let n = 0; n !== 256; n += 1) {\n        c = n;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        c = c & 1 ? -306674912 ^ (c >>> 1) : c >>> 1;\n        table[n] = c;\n    }\n    return table;\n})();\nexport default function crc32(buf, start, end) {\n    let C = 0 ^ -1;\n    const L = end - 7;\n    let i = start;\n    while (i < L) {\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    }\n    while (i < L + 7) {\n        C = (C >>> 8) ^ T[(C ^ buf[i++]) & 0xff];\n    }\n    return (C ^ -1) >>> 0;\n}\n//# sourceMappingURL=crc32.js.map","/*!\n * Copyright Mathias Bynens <https://mathiasbynens.be/>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n/** Highest positive signed 32-bit float value */\nconst maxInt = 2147483647; // aka. 0x7FFFFFFF or 2^31-1\n/** Bootstring parameters */\nconst base = 36;\nconst tMin = 1;\nconst tMax = 26;\nconst skew = 38;\nconst damp = 700;\nconst initialBias = 72;\nconst initialN = 128; // 0x80\nconst delimiter = '-'; // '\\x2D'\n/** Regular expressions */\nconst regexNonASCII = /[^\\0-\\x7E]/; // non-ASCII chars\nconst regexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g; // RFC 3490 separators\nconst errors = {\n    'invalid-input': 'Invalid input',\n    'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n    'overflow': 'Overflow: input needs wider integers to process',\n};\n/** Convenience shortcuts */\nconst baseMinusTMin = base - tMin;\n/*--------------------------------------------------------------------------*/\n/**\n * A generic error utility function.\n * @private\n * @param {String} type The error type.\n * @returns {Error} Throws a `RangeError` with the applicable error message.\n */\nfunction error(type) {\n    throw new RangeError(errors[type]);\n}\n/**\n * Creates an array containing the numeric code points of each Unicode\n * character in the string. While JavaScript uses UCS-2 internally,\n * this function will convert a pair of surrogate halves (each of which\n * UCS-2 exposes as separate characters) into a single code point,\n * matching UTF-16.\n * @see `punycode.ucs2.encode`\n * @see <https://mathiasbynens.be/notes/javascript-encoding>\n * @memberOf punycode.ucs2\n * @name decode\n * @param {String} string The Unicode input string (UCS-2).\n * @returns {Array} The new array of code points.\n */\nfunction ucs2decode(str) {\n    const output = [];\n    let counter = 0;\n    const length = str.length;\n    while (counter < length) {\n        const value = str.charCodeAt(counter++);\n        if (value >= 0xd800 && value <= 0xdbff && counter < length) {\n            // It's a high surrogate, and there is a next character.\n            const extra = str.charCodeAt(counter++);\n            if ((extra & 0xfc00) === 0xdc00) {\n                // Low surrogate.\n                output.push(((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000);\n            }\n            else {\n                // It's an unmatched surrogate; only append this code unit, in case the\n                // next code unit is the high surrogate of a surrogate pair.\n                output.push(value);\n                counter--;\n            }\n        }\n        else {\n            output.push(value);\n        }\n    }\n    return output;\n}\n/**\n * Converts a basic code point into a digit/integer.\n * @see `digitToBasic()`\n * @private\n * @param {Number} codePoint The basic numeric code point value.\n * @returns {Number} The numeric value of a basic code point (for use in\n * representing integers) in the range `0` to `base - 1`, or `base` if\n * the code point does not represent a value.\n */\nfunction basicToDigit(codePoint) {\n    if (codePoint - 0x30 < 0x0a) {\n        return codePoint - 0x16;\n    }\n    if (codePoint - 0x41 < 0x1a) {\n        return codePoint - 0x41;\n    }\n    if (codePoint - 0x61 < 0x1a) {\n        return codePoint - 0x61;\n    }\n    return base;\n}\n/**\n * Converts a digit/integer into a basic code point.\n * @see `basicToDigit()`\n * @private\n * @param {Number} digit The numeric value of a basic code point.\n * @returns {Number} The basic code point whose value (when used for\n * representing integers) is `digit`, which needs to be in the range\n * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n * used; else, the lowercase form is used. The behavior is undefined\n * if `flag` is non-zero and `digit` has no uppercase form.\n */\nfunction digitToBasic(digit, flag) {\n    //  0..25 map to ASCII a..z or A..Z\n    // 26..35 map to ASCII 0..9\n    return digit + 22 + 75 * (digit < 26 ? 1 : 0) - ((flag !== 0 ? 1 : 0) << 5);\n}\n/**\n * Bias adaptation function as per section 3.4 of RFC 3492.\n * https://tools.ietf.org/html/rfc3492#section-3.4\n * @private\n */\nfunction adapt(delta, numPoints, firstTime) {\n    let k = 0;\n    delta = firstTime ? Math.floor(delta / damp) : delta >> 1;\n    delta += Math.floor(delta / numPoints);\n    for (; /* no initialization */ delta > (baseMinusTMin * tMax) >> 1; k += base) {\n        delta = Math.floor(delta / baseMinusTMin);\n    }\n    return Math.floor(k + ((baseMinusTMin + 1) * delta) / (delta + skew));\n}\n/**\n * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n * symbols.\n * @memberOf punycode\n * @param {String} input The Punycode string of ASCII-only symbols.\n * @returns {String} The resulting string of Unicode symbols.\n */\nexport function decode(input) {\n    // Don't use UCS-2.\n    const output = [];\n    const inputLength = input.length;\n    let i = 0;\n    let n = initialN;\n    let bias = initialBias;\n    // Handle the basic code points: let `basic` be the number of input code\n    // points before the last delimiter, or `0` if there is none, then copy\n    // the first basic code points to the output.\n    let basic = input.lastIndexOf(delimiter);\n    if (basic < 0) {\n        basic = 0;\n    }\n    for (let j = 0; j < basic; ++j) {\n        // if it's not a basic code point\n        if (input.charCodeAt(j) >= 0x80) {\n            error('not-basic');\n        }\n        output.push(input.charCodeAt(j));\n    }\n    // Main decoding loop: start just after the last delimiter if any basic code\n    // points were copied; start at the beginning otherwise.\n    for (let index = basic > 0 ? basic + 1 : 0; index < inputLength /* no final expression */;) {\n        // `index` is the index of the next character to be consumed.\n        // Decode a generalized variable-length integer into `delta`,\n        // which gets added to `i`. The overflow checking is easier\n        // if we increase `i` as we go, then subtract off its starting\n        // value at the end to obtain `delta`.\n        const oldi = i;\n        for (let w = 1, k = base /* no condition */;; k += base) {\n            if (index >= inputLength) {\n                error('invalid-input');\n            }\n            const digit = basicToDigit(input.charCodeAt(index++));\n            if (digit >= base || digit > Math.floor((maxInt - i) / w)) {\n                error('overflow');\n            }\n            i += digit * w;\n            const t = k <= bias ? tMin : k >= bias + tMax ? tMax : k - bias;\n            if (digit < t) {\n                break;\n            }\n            const baseMinusT = base - t;\n            if (w > Math.floor(maxInt / baseMinusT)) {\n                error('overflow');\n            }\n            w *= baseMinusT;\n        }\n        const out = output.length + 1;\n        bias = adapt(i - oldi, out, oldi === 0);\n        // `i` was supposed to wrap around from `out` to `0`,\n        // incrementing `n` each time, so we'll fix that now:\n        if (Math.floor(i / out) > maxInt - n) {\n            error('overflow');\n        }\n        n += Math.floor(i / out);\n        i %= out;\n        // Insert `n` at position `i` of the output.\n        output.splice(i++, 0, n);\n    }\n    return String.fromCodePoint.apply(null, output);\n}\n/**\n * Converts a string of Unicode symbols (e.g. a domain name label) to a\n * Punycode string of ASCII-only symbols.\n * @memberOf punycode\n * @param {String} input The string of Unicode symbols.\n * @returns {String} The resulting Punycode string of ASCII-only symbols.\n */\nexport function encode(str) {\n    const output = [];\n    // Convert the input in UCS-2 to an array of Unicode code points.\n    const input = ucs2decode(str);\n    // Cache the length.\n    const inputLength = input.length;\n    // Initialize the state.\n    let n = initialN;\n    let delta = 0;\n    let bias = initialBias;\n    // Handle the basic code points.\n    for (let i = 0; i < input.length; i += 1) {\n        const currentValue = input[i];\n        if (currentValue < 0x80) {\n            output.push(String.fromCharCode(currentValue));\n        }\n    }\n    const basicLength = output.length;\n    let handledCPCount = basicLength;\n    // `handledCPCount` is the number of code points that have been handled;\n    // `basicLength` is the number of basic code points.\n    // Finish the basic string with a delimiter unless it's empty.\n    if (basicLength) {\n        output.push(delimiter);\n    }\n    // Main encoding loop:\n    while (handledCPCount < inputLength) {\n        // All non-basic code points < n have been handled already. Find the next\n        // larger one:\n        let m = maxInt;\n        for (let i = 0; i < input.length; i += 1) {\n            const currentValue = input[i];\n            if (currentValue >= n && currentValue < m) {\n                m = currentValue;\n            }\n        }\n        // Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n        // but guard against overflow.\n        const handledCPCountPlusOne = handledCPCount + 1;\n        if (m - n > Math.floor((maxInt - delta) / handledCPCountPlusOne)) {\n            error('overflow');\n        }\n        delta += (m - n) * handledCPCountPlusOne;\n        n = m;\n        for (let i = 0; i < input.length; i += 1) {\n            const currentValue = input[i];\n            if (currentValue < n && ++delta > maxInt) {\n                error('overflow');\n            }\n            if (currentValue === n) {\n                // Represent delta as a generalized variable-length integer.\n                let q = delta;\n                for (let k = base /* no condition */;; k += base) {\n                    const t = k <= bias ? tMin : k >= bias + tMax ? tMax : k - bias;\n                    if (q < t) {\n                        break;\n                    }\n                    const qMinusT = q - t;\n                    const baseMinusT = base - t;\n                    output.push(String.fromCharCode(digitToBasic(t + (qMinusT % baseMinusT), 0)));\n                    q = Math.floor(qMinusT / baseMinusT);\n                }\n                output.push(String.fromCharCode(digitToBasic(q, 0)));\n                bias = adapt(delta, handledCPCountPlusOne, handledCPCount === basicLength);\n                delta = 0;\n                ++handledCPCount;\n            }\n        }\n        ++delta;\n        ++n;\n    }\n    return output.join('');\n}\n/**\n * Converts a Punycode string representing a domain name or an email address\n * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n * it doesn't matter if you call it on a string that has already been\n * converted to Unicode.\n * @memberOf punycode\n * @param {String} input The Punycoded domain name or email address to\n * convert to Unicode.\n * @returns {String} The Unicode representation of the given Punycode\n * string.\n */\nexport function toUnicode(input) {\n    const labels = input.replace(regexSeparators, '\\x2E').split('.');\n    const encoded = [];\n    for (let i = 0; i < labels.length; i += 1) {\n        encoded.push(labels[i].startsWith('xn--') ? decode(labels[i].slice(4).toLowerCase()) : labels[i]);\n    }\n    return encoded.join('.');\n}\n/**\n * Converts a Unicode string representing a domain name or an email address to\n * Punycode. Only the non-ASCII parts of the domain name will be converted,\n * i.e. it doesn't matter if you call it with a domain that's already in\n * ASCII.\n * @memberOf punycode\n * @param {String} input The domain name or email address to convert, as a\n * Unicode string.\n * @returns {String} The Punycode representation of the given domain name or\n * email address.\n */\nexport function toASCII(input) {\n    // Avoid `split(regex)` for IE8 compatibility. See #17.\n    const labels = input.replace(regexSeparators, '\\x2E').split('.');\n    const encoded = [];\n    for (let i = 0; i < labels.length; i += 1) {\n        encoded.push(regexNonASCII.test(labels[i]) ? 'xn--' + encode(labels[i]) : labels[i]);\n    }\n    return encoded.join('.');\n}\n/**\n * A string representing the current Punycode.js version number.\n * @memberOf punycode\n * @type String\n */\nexport const version = '2.1.0';\n//# sourceMappingURL=punycode.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport Compression from './compression.js';\nimport crc32 from './crc32.js';\nimport { decode, encode } from './punycode.js';\nexport const EMPTY_UINT8_ARRAY = new Uint8Array(0);\nexport const EMPTY_UINT32_ARRAY = new Uint32Array(0);\n// Check if current architecture is little endian\nconst LITTLE_ENDIAN = new Int8Array(new Int16Array([1]).buffer)[0] === 1;\n// Store compression in a lazy, global singleton\nlet getCompressionSingleton = () => {\n    const COMPRESSION = new Compression();\n    getCompressionSingleton = () => COMPRESSION;\n    return COMPRESSION;\n};\nfunction align4(pos) {\n    // From: https://stackoverflow.com/a/2022194\n    return (pos + 3) & ~0x03;\n}\n/**\n * Return size of of a serialized byte value.\n */\nexport function sizeOfByte() {\n    return 1;\n}\n/**\n * Return size of of a serialized boolean value.\n */\nexport function sizeOfBool() {\n    return 1;\n}\n/**\n * Return number of bytes needed to serialize `length`.\n */\nexport function sizeOfLength(length) {\n    return length <= 127 ? 1 : 5;\n}\n/**\n * Return number of bytes needed to serialize `array` Uint8Array typed array.\n *\n * WARNING: this only returns the correct size if `align` is `false`.\n */\nexport function sizeOfBytes(array, align) {\n    return sizeOfBytesWithLength(array.length, align);\n}\n/**\n * Return number of bytes needed to serialize `array` Uint8Array typed array.\n *\n * WARNING: this only returns the correct size if `align` is `false`.\n */\nexport function sizeOfBytesWithLength(length, align) {\n    // Alignment is a tricky thing because it depends on the current offset in\n    // the buffer at the time of serialization; which we cannot anticipate\n    // before actually starting serialization. This means that we need to\n    // potentially over-estimate the size (at most by 3 bytes) to make sure the\n    // final size is at least equal or a bit bigger than necessary.\n    return (align ? 3 : 0) + length + sizeOfLength(length);\n}\n/**\n * Return number of bytes needed to serialize `str` ASCII string.\n */\nexport function sizeOfASCII(str) {\n    return str.length + sizeOfLength(str.length);\n}\n/**\n * Return number of bytes needed to serialize `str` UTF8 string.\n */\nexport function sizeOfUTF8(str) {\n    const encodedLength = encode(str).length;\n    return encodedLength + sizeOfLength(encodedLength);\n}\n/**\n * Return number of bytes needed to serialize `array`.\n */\nexport function sizeOfUint32Array(array) {\n    return array.byteLength + sizeOfLength(array.length);\n}\nexport function sizeOfNetworkRedirect(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().networkRedirect.getCompressedSize(str), false)\n        : sizeOfASCII(str);\n}\nexport function sizeOfNetworkHostname(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().networkHostname.getCompressedSize(str), false)\n        : sizeOfASCII(str);\n}\nexport function sizeOfNetworkCSP(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().networkCSP.getCompressedSize(str), false)\n        : sizeOfASCII(str);\n}\nexport function sizeOfNetworkFilter(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().networkFilter.getCompressedSize(str), false)\n        : sizeOfASCII(str);\n}\nexport function sizeOfCosmeticSelector(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().cosmeticSelector.getCompressedSize(str), false)\n        : sizeOfASCII(str);\n}\nexport function sizeOfRawNetwork(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().networkRaw.getCompressedSize(encode(str)), false)\n        : sizeOfUTF8(str);\n}\nexport function sizeOfRawCosmetic(str, compression) {\n    return compression === true\n        ? sizeOfBytesWithLength(getCompressionSingleton().cosmeticRaw.getCompressedSize(encode(str)), false)\n        : sizeOfUTF8(str);\n}\n/**\n * This abstraction allows to serialize efficiently low-level values of types:\n * string, uint8, uint16, uint32, etc. while hiding the complexity of managing\n * the current offset and growing. It should always be instantiated with a\n * big-enough length because this will not allow for resizing. To allow\n * deciding the required total size, function estimating the size needed to\n * store different primitive values are exposes as static methods.\n *\n * This class is also more efficient than the built-in `DataView`.\n *\n * The way this is used in practice is that you write pairs of function to\n * serialize and deserialize a given structure/class (with code being pretty\n * symetrical). In the serializer you `pushX` values, and in the deserializer\n * you use `getX` functions to get back the values.\n */\nexport class StaticDataView {\n    /**\n     * Create an empty (i.e.: size = 0) StaticDataView.\n     */\n    static empty(options) {\n        return StaticDataView.fromUint8Array(EMPTY_UINT8_ARRAY, options);\n    }\n    /**\n     * Instantiate a StaticDataView instance from `array` of type Uint8Array.\n     */\n    static fromUint8Array(array, options) {\n        return new StaticDataView(array, options);\n    }\n    /**\n     * Instantiate a StaticDataView with given `capacity` number of bytes.\n     */\n    static allocate(capacity, options) {\n        return new StaticDataView(new Uint8Array(capacity), options);\n    }\n    constructor(buffer, { enableCompression }) {\n        if (LITTLE_ENDIAN === false) {\n            // This check makes sure that we will not load the adblocker on a\n            // big-endian system. This would not work since byte ordering is important\n            // at the moment (mainly for performance reasons).\n            throw new Error('Adblocker currently does not support Big-endian systems');\n        }\n        if (enableCompression === true) {\n            this.enableCompression();\n        }\n        this.buffer = buffer;\n        this.pos = 0;\n    }\n    enableCompression() {\n        this.compression = getCompressionSingleton();\n    }\n    checksum() {\n        return crc32(this.buffer, 0, this.pos);\n    }\n    dataAvailable() {\n        return this.pos < this.buffer.byteLength;\n    }\n    setPos(pos) {\n        this.pos = pos;\n    }\n    getPos() {\n        return this.pos;\n    }\n    seekZero() {\n        this.pos = 0;\n    }\n    slice() {\n        this.checkSize();\n        return this.buffer.slice(0, this.pos);\n    }\n    subarray() {\n        if (this.pos === this.buffer.byteLength) {\n            return this.buffer;\n        }\n        this.checkSize();\n        return this.buffer.subarray(0, this.pos);\n    }\n    /**\n     * Make sure that `this.pos` is aligned on a multiple of 4.\n     */\n    align4() {\n        this.pos = align4(this.pos);\n    }\n    set(buffer) {\n        this.buffer = new Uint8Array(buffer);\n        this.seekZero();\n    }\n    pushBool(bool) {\n        this.pushByte(Number(bool));\n    }\n    getBool() {\n        return Boolean(this.getByte());\n    }\n    setByte(pos, byte) {\n        this.buffer[pos] = byte;\n    }\n    pushByte(octet) {\n        this.pushUint8(octet);\n    }\n    getByte() {\n        return this.getUint8();\n    }\n    pushBytes(bytes, align = false) {\n        this.pushLength(bytes.length);\n        if (align === true) {\n            this.align4();\n        }\n        this.buffer.set(bytes, this.pos);\n        this.pos += bytes.byteLength;\n    }\n    getBytes(align = false) {\n        const numberOfBytes = this.getLength();\n        if (align === true) {\n            this.align4();\n        }\n        const bytes = this.buffer.subarray(this.pos, this.pos + numberOfBytes);\n        this.pos += numberOfBytes;\n        return bytes;\n    }\n    /**\n     * Allows row access to the internal buffer through a Uint32Array acting like\n     * a view. This is used for super fast writing/reading of large chunks of\n     * Uint32 numbers in the byte array.\n     */\n    getUint32ArrayView(desiredSize) {\n        // Round this.pos to next multiple of 4 for alignement\n        this.align4();\n        // Short-cut when empty array\n        if (desiredSize === 0) {\n            return EMPTY_UINT32_ARRAY;\n        }\n        // Create non-empty view\n        const view = new Uint32Array(this.buffer.buffer, this.pos + this.buffer.byteOffset, desiredSize);\n        this.pos += desiredSize * 4;\n        return view;\n    }\n    pushUint8(uint8) {\n        this.buffer[this.pos++] = uint8;\n    }\n    getUint8() {\n        return this.buffer[this.pos++];\n    }\n    pushUint16(uint16) {\n        this.buffer[this.pos++] = uint16 >>> 8;\n        this.buffer[this.pos++] = uint16;\n    }\n    getUint16() {\n        return ((this.buffer[this.pos++] << 8) | this.buffer[this.pos++]) >>> 0;\n    }\n    pushUint32(uint32) {\n        this.buffer[this.pos++] = uint32 >>> 24;\n        this.buffer[this.pos++] = uint32 >>> 16;\n        this.buffer[this.pos++] = uint32 >>> 8;\n        this.buffer[this.pos++] = uint32;\n    }\n    getUint32() {\n        return ((((this.buffer[this.pos++] << 24) >>> 0) +\n            ((this.buffer[this.pos++] << 16) |\n                (this.buffer[this.pos++] << 8) |\n                this.buffer[this.pos++])) >>>\n            0);\n    }\n    pushUint32Array(arr) {\n        this.pushLength(arr.length);\n        // TODO - use `set` to push the full buffer at once?\n        for (const n of arr) {\n            this.pushUint32(n);\n        }\n    }\n    getUint32Array() {\n        const length = this.getLength();\n        const arr = new Uint32Array(length);\n        // TODO - use `subarray`?\n        for (let i = 0; i < length; i += 1) {\n            arr[i] = this.getUint32();\n        }\n        return arr;\n    }\n    pushUTF8(raw) {\n        const str = encode(raw);\n        this.pushLength(str.length);\n        for (let i = 0; i < str.length; i += 1) {\n            this.buffer[this.pos++] = str.charCodeAt(i);\n        }\n    }\n    getUTF8() {\n        const byteLength = this.getLength();\n        this.pos += byteLength;\n        return decode(String.fromCharCode.apply(null, \n        // @ts-ignore\n        this.buffer.subarray(this.pos - byteLength, this.pos)));\n    }\n    pushASCII(str) {\n        this.pushLength(str.length);\n        for (let i = 0; i < str.length; i += 1) {\n            this.buffer[this.pos++] = str.charCodeAt(i);\n        }\n    }\n    getASCII() {\n        const byteLength = this.getLength();\n        this.pos += byteLength;\n        // @ts-ignore\n        return String.fromCharCode.apply(null, this.buffer.subarray(this.pos - byteLength, this.pos));\n    }\n    pushNetworkRedirect(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.networkRedirect.compress(str));\n        }\n        else {\n            this.pushASCII(str);\n        }\n    }\n    getNetworkRedirect() {\n        if (this.compression !== undefined) {\n            return this.compression.networkRedirect.decompress(this.getBytes());\n        }\n        return this.getASCII();\n    }\n    pushNetworkHostname(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.networkHostname.compress(str));\n        }\n        else {\n            this.pushASCII(str);\n        }\n    }\n    getNetworkHostname() {\n        if (this.compression !== undefined) {\n            return this.compression.networkHostname.decompress(this.getBytes());\n        }\n        return this.getASCII();\n    }\n    pushNetworkCSP(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.networkCSP.compress(str));\n        }\n        else {\n            this.pushASCII(str);\n        }\n    }\n    getNetworkCSP() {\n        if (this.compression !== undefined) {\n            return this.compression.networkCSP.decompress(this.getBytes());\n        }\n        return this.getASCII();\n    }\n    pushNetworkFilter(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.networkFilter.compress(str));\n        }\n        else {\n            this.pushASCII(str);\n        }\n    }\n    getNetworkFilter() {\n        if (this.compression !== undefined) {\n            return this.compression.networkFilter.decompress(this.getBytes());\n        }\n        return this.getASCII();\n    }\n    pushCosmeticSelector(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.cosmeticSelector.compress(str));\n        }\n        else {\n            this.pushASCII(str);\n        }\n    }\n    getCosmeticSelector() {\n        if (this.compression !== undefined) {\n            return this.compression.cosmeticSelector.decompress(this.getBytes());\n        }\n        return this.getASCII();\n    }\n    pushRawCosmetic(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.cosmeticRaw.compress(encode(str)));\n        }\n        else {\n            this.pushUTF8(str);\n        }\n    }\n    getRawCosmetic() {\n        if (this.compression !== undefined) {\n            return decode(this.compression.cosmeticRaw.decompress(this.getBytes()));\n        }\n        return this.getUTF8();\n    }\n    pushRawNetwork(str) {\n        if (this.compression !== undefined) {\n            this.pushBytes(this.compression.networkRaw.compress(encode(str)));\n        }\n        else {\n            this.pushUTF8(str);\n        }\n    }\n    getRawNetwork() {\n        if (this.compression !== undefined) {\n            return decode(this.compression.networkRaw.decompress(this.getBytes()));\n        }\n        return this.getUTF8();\n    }\n    checkSize() {\n        if (this.pos !== 0 && this.pos > this.buffer.byteLength) {\n            throw new Error(`StaticDataView too small: ${this.buffer.byteLength}, but required ${this.pos} bytes`);\n        }\n    }\n    // Serialiez `length` with variable encoding to save space\n    pushLength(length) {\n        if (length <= 127) {\n            this.pushUint8(length);\n        }\n        else {\n            this.pushUint8(128);\n            this.pushUint32(length);\n        }\n    }\n    getLength() {\n        const lengthShort = this.getUint8();\n        return lengthShort === 128 ? this.getUint32() : lengthShort;\n    }\n}\n//# sourceMappingURL=data-view.js.map","/**\n * The MIT License (MIT)\n *\n * Copyright (c) Feross Aboukhadijeh\n *\n * Originally from: https://github.com/feross/queue-microtask\n */\nlet promise;\nexport const queueMicrotask = typeof window !== 'undefined' && typeof window.queueMicrotask === 'function'\n    ? (cb) => window.queueMicrotask(cb)\n    : // reuse resolved promise, and allocate it lazily\n        (cb) => (promise || (promise = Promise.resolve())).then(cb).catch((err) => setTimeout(() => {\n            throw err;\n        }, 0));\n//# sourceMappingURL=queue-microtask.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { sizeOfBool } from './data-view.js';\nexport default class Config {\n    static deserialize(buffer) {\n        return new Config({\n            debug: buffer.getBool(),\n            enableCompression: buffer.getBool(),\n            enableHtmlFiltering: buffer.getBool(),\n            enableInMemoryCache: buffer.getBool(),\n            enableMutationObserver: buffer.getBool(),\n            enableOptimizations: buffer.getBool(),\n            enablePushInjectionsOnNavigationEvents: buffer.getBool(),\n            guessRequestTypeFromUrl: buffer.getBool(),\n            integrityCheck: buffer.getBool(),\n            loadCSPFilters: buffer.getBool(),\n            loadCosmeticFilters: buffer.getBool(),\n            loadExceptionFilters: buffer.getBool(),\n            loadExtendedSelectors: buffer.getBool(),\n            loadGenericCosmeticsFilters: buffer.getBool(),\n            loadNetworkFilters: buffer.getBool(),\n            loadPreprocessors: buffer.getBool(),\n        });\n    }\n    constructor({ debug = false, enableCompression = false, enableHtmlFiltering = false, enableInMemoryCache = true, enableMutationObserver = true, enableOptimizations = true, enablePushInjectionsOnNavigationEvents = true, guessRequestTypeFromUrl = false, integrityCheck = true, loadCSPFilters = true, loadCosmeticFilters = true, loadExceptionFilters = true, loadExtendedSelectors = false, loadGenericCosmeticsFilters = true, loadNetworkFilters = true, loadPreprocessors = false, } = {}) {\n        this.debug = debug;\n        this.enableCompression = enableCompression;\n        this.enableHtmlFiltering = enableHtmlFiltering;\n        this.enableInMemoryCache = enableInMemoryCache;\n        this.enableMutationObserver = enableMutationObserver;\n        this.enableOptimizations = enableOptimizations;\n        this.enablePushInjectionsOnNavigationEvents = enablePushInjectionsOnNavigationEvents;\n        this.guessRequestTypeFromUrl = guessRequestTypeFromUrl;\n        this.integrityCheck = integrityCheck;\n        this.loadCSPFilters = loadCSPFilters;\n        this.loadCosmeticFilters = loadCosmeticFilters;\n        this.loadExceptionFilters = loadExceptionFilters;\n        this.loadExtendedSelectors = loadExtendedSelectors;\n        this.loadGenericCosmeticsFilters = loadGenericCosmeticsFilters;\n        this.loadNetworkFilters = loadNetworkFilters;\n        this.loadPreprocessors = loadPreprocessors;\n    }\n    getSerializedSize() {\n        // NOTE: this should always be the number of attributes and needs to be\n        // updated when `Config` changes.\n        return 16 * sizeOfBool();\n    }\n    serialize(buffer) {\n        buffer.pushBool(this.debug);\n        buffer.pushBool(this.enableCompression);\n        buffer.pushBool(this.enableHtmlFiltering);\n        buffer.pushBool(this.enableInMemoryCache);\n        buffer.pushBool(this.enableMutationObserver);\n        buffer.pushBool(this.enableOptimizations);\n        buffer.pushBool(this.enablePushInjectionsOnNavigationEvents);\n        buffer.pushBool(this.guessRequestTypeFromUrl);\n        buffer.pushBool(this.integrityCheck);\n        buffer.pushBool(this.loadCSPFilters);\n        buffer.pushBool(this.loadCosmeticFilters);\n        buffer.pushBool(this.loadExceptionFilters);\n        buffer.pushBool(this.loadExtendedSelectors);\n        buffer.pushBool(this.loadGenericCosmeticsFilters);\n        buffer.pushBool(this.loadNetworkFilters);\n        buffer.pushBool(this.loadPreprocessors);\n    }\n}\n//# sourceMappingURL=config.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { queueMicrotask } from './queue-microtask.js';\n/**\n * Add `callback` listener for `event` in `listeners` Map.\n */\nfunction registerCallback(event, callback, listeners) {\n    let listenersForEvent = listeners.get(event);\n    if (listenersForEvent === undefined) {\n        listenersForEvent = [];\n        listeners.set(event, listenersForEvent);\n    }\n    listenersForEvent.push(callback);\n}\n/**\n * Remove `callback` listener for `event` from `listeners` Map.\n */\nfunction unregisterCallback(event, callback, listeners) {\n    const listenersForEvent = listeners.get(event);\n    if (listenersForEvent !== undefined) {\n        const indexOfCallback = listenersForEvent.indexOf(callback);\n        if (indexOfCallback !== -1) {\n            listenersForEvent.splice(indexOfCallback, 1);\n        }\n    }\n}\n/**\n * Call all registered listeners for `event` with `args` as arguments. Return\n * `true` if at least one callback was registered and `false` otherwise.\n */\nfunction triggerCallback(event, args, listeners) {\n    // Fast-path for cases where no listener is registered\n    if (listeners.size === 0) {\n        return false;\n    }\n    const listenersForEvent = listeners.get(event);\n    if (listenersForEvent !== undefined) {\n        queueMicrotask(() => {\n            for (const listener of listenersForEvent) {\n                listener(...args);\n            }\n        });\n        return true;\n    }\n    return false;\n}\n/**\n * Simple and efficient `EventEmitter` abstraction (following conventions from\n * Node.js) allowing partially typed event emitting. The set of event names is\n * specified as a type parameter while instantiating the event emitter.\n */\nexport class EventEmitter {\n    constructor() {\n        this.onceListeners = new Map();\n        this.onListeners = new Map();\n    }\n    /**\n     * Register an event listener for `event`.\n     */\n    on(event, callback) {\n        registerCallback(event, callback, this.onListeners);\n    }\n    /**\n     * Register an event listener for `event`; but only listen to first instance\n     * of this event. The listener is automatically deleted afterwards.\n     */\n    once(event, callback) {\n        registerCallback(event, callback, this.onceListeners);\n    }\n    /**\n     * Remove `callback` from list of listeners for `event`.\n     */\n    unsubscribe(event, callback) {\n        unregisterCallback(event, callback, this.onListeners);\n        unregisterCallback(event, callback, this.onceListeners);\n    }\n    /**\n     * Emit an event. Call all registered listeners to this event.\n     */\n    emit(event, ...args) {\n        triggerCallback(event, args, this.onListeners);\n        if (triggerCallback(event, args, this.onceListeners) === true) {\n            this.onceListeners.delete(event);\n        }\n    }\n}\n//# sourceMappingURL=events.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/**\n * Built-in fetch helpers can be used to initialize the adblocker from\n * pre-built presets or raw lists (fetched from multiple sources). In case of\n * failure (e.g. timeout), the whole process of initialization fails. Timeouts\n * are not so uncommon, and retrying to fetch usually succeeds.\n */\nexport function fetchWithRetry(fetch, url) {\n    let retry = 3;\n    // Wrap `fetch` into a lightweight retry function which makes sure that if\n    // fetching fails, it can be retried up to three times. Failure can happen if\n    // the remote server times-out, but retrying fetching of the same URL will\n    // usually succeed.\n    const fetchWrapper = () => {\n        return fetch(url).catch((ex) => {\n            if (retry > 0) {\n                retry -= 1;\n                return new Promise((resolve, reject) => {\n                    setTimeout(() => {\n                        fetchWrapper().then(resolve).catch(reject);\n                    }, 500);\n                });\n            }\n            throw ex;\n        });\n    };\n    return fetchWrapper();\n}\nfunction fetchResource(fetch, url) {\n    return fetchWithRetry(fetch, url).then((response) => response.text());\n}\nconst PREFIX = 'https://raw.githubusercontent.com/ghostery/adblocker/master/packages/adblocker/assets';\nexport const adsLists = [\n    `${PREFIX}/easylist/easylist.txt`,\n    `${PREFIX}/peter-lowe/serverlist.txt`,\n    `${PREFIX}/ublock-origin/badware.txt`,\n    `${PREFIX}/ublock-origin/filters-2020.txt`,\n    `${PREFIX}/ublock-origin/filters-2021.txt`,\n    `${PREFIX}/ublock-origin/filters-2022.txt`,\n    `${PREFIX}/ublock-origin/filters-2023.txt`,\n    `${PREFIX}/ublock-origin/filters-2024.txt`,\n    `${PREFIX}/ublock-origin/filters.txt`,\n    `${PREFIX}/ublock-origin/quick-fixes.txt`,\n    `${PREFIX}/ublock-origin/resource-abuse.txt`,\n    `${PREFIX}/ublock-origin/unbreak.txt`,\n];\nexport const adsAndTrackingLists = [\n    ...adsLists,\n    `${PREFIX}/easylist/easyprivacy.txt`,\n    `${PREFIX}/ublock-origin/privacy.txt`,\n];\nexport const fullLists = [\n    ...adsAndTrackingLists,\n    `${PREFIX}/easylist/easylist-cookie.txt`,\n    `${PREFIX}/ublock-origin/annoyances-others.txt`,\n    `${PREFIX}/ublock-origin/annoyances-cookies.txt`,\n];\n/**\n * Fetch latest version of enabledByDefault blocking lists.\n */\nexport function fetchLists(fetch, urls) {\n    return Promise.all(urls.map((url) => fetchResource(fetch, url)));\n}\n/**\n * Fetch latest version of uBlock Origin's resources, used to inject scripts in\n * the page or redirect request to data URLs.\n */\nexport function fetchResources(fetch) {\n    return fetchResource(fetch, `${PREFIX}/ublock-origin/resources.txt`);\n}\n//# sourceMappingURL=fetch.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nclass HidingBuilder {\n}\nclass NetworkBuilder {\n    constructor() {\n        this.options = new Set();\n        this.prefix = undefined;\n        this.infix = undefined;\n        this.suffix = undefined;\n        this.redirect = undefined;\n    }\n    blockRequestsWithType(t) {\n        if (this.options.has(t)) {\n            throw new Error(`Already blocking type ${t}`);\n        }\n        this.options.add(t);\n        return this;\n    }\n    images() {\n        return this.blockRequestsWithType('image');\n    }\n    scripts() {\n        return this.blockRequestsWithType('script');\n    }\n    frames() {\n        return this.blockRequestsWithType('frame');\n    }\n    fonts() {\n        return this.blockRequestsWithType('font');\n    }\n    medias() {\n        return this.blockRequestsWithType('media');\n    }\n    styles() {\n        return this.blockRequestsWithType('css');\n    }\n    redirectTo(redirect) {\n        if (this.redirect !== undefined) {\n            throw new Error(`Already redirecting: ${this.redirect}`);\n        }\n        this.redirect = `redirect=${redirect}`;\n        return this;\n    }\n    urlContains(infix) {\n        if (this.infix !== undefined) {\n            throw new Error(`Already matching pattern: ${this.infix}`);\n        }\n        this.infix = infix;\n        return this;\n    }\n    urlStartsWith(prefix) {\n        if (this.prefix !== undefined) {\n            throw new Error(`Already matching prefix: ${this.prefix}`);\n        }\n        this.prefix = `|${prefix}`;\n        return this;\n    }\n    urlEndsWith(suffix) {\n        if (this.suffix !== undefined) {\n            throw new Error(`Already matching suffix: ${this.suffix}`);\n        }\n        this.suffix = `${suffix}|`;\n        return this;\n    }\n    withHostname(hostname) {\n        if (this.prefix !== undefined) {\n            throw new Error(`Cannot match hostname if filter already has prefix: ${this.prefix}`);\n        }\n        this.prefix = `||${hostname}^`;\n        return this;\n    }\n    toString() {\n        const parts = [];\n        if (this.prefix !== undefined) {\n            parts.push(this.prefix);\n        }\n        if (this.infix !== undefined) {\n            parts.push(this.infix);\n        }\n        if (this.suffix !== undefined) {\n            parts.push(this.suffix);\n        }\n        const options = ['important'];\n        if (this.options.size !== 0) {\n            for (const option of this.options) {\n                options.push(option);\n            }\n        }\n        if (this.redirect !== undefined) {\n            options.push(this.redirect);\n        }\n        return `${parts.length === 0 ? '*' : parts.join('*')}$${options.join(',')}`;\n    }\n}\nexport function block() {\n    return new NetworkBuilder();\n}\nexport function hide() {\n    return new HidingBuilder();\n}\n//# sourceMappingURL=dsl.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/**\n * Thin abstraction around a Uint32Array which allows to push tokens\n * whithout caring for the offset. It is used as a way to avoid multiple\n * allocations while calling tokenization (mostly beneficitial for\n * `NetworkFilter.getTokens()`).\n */\nexport class TokensBuffer {\n    constructor(size) {\n        this.pos = 0;\n        this.buffer = new Uint32Array(size);\n    }\n    reset() {\n        this.pos = 0;\n    }\n    slice() {\n        return this.buffer.slice(0, this.pos);\n    }\n    push(token) {\n        this.buffer[this.pos++] = token;\n    }\n    empty() {\n        return this.pos === 0;\n    }\n    full() {\n        return this.pos === this.buffer.length;\n    }\n    remaining() {\n        return this.buffer.length - this.pos;\n    }\n}\nexport const TOKENS_BUFFER = new TokensBuffer(1024);\n//# sourceMappingURL=tokens-buffer.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { TOKENS_BUFFER } from './tokens-buffer.js';\nexport const HASH_INTERNAL_MULT = 37;\nexport const HASH_SEED = 5011;\n/***************************************************************************\n *  Bitwise helpers\n * ************************************************************************* */\n// From: https://stackoverflow.com/a/43122214/1185079\nexport function bitCount(n) {\n    n = n - ((n >> 1) & 0x55555555);\n    n = (n & 0x33333333) + ((n >> 2) & 0x33333333);\n    return (((n + (n >> 4)) & 0xf0f0f0f) * 0x1010101) >> 24;\n}\nexport function getBit(n, mask) {\n    return !!(n & mask);\n}\nexport function setBit(n, mask) {\n    return n | mask;\n}\nexport function clearBit(n, mask) {\n    return n & ~mask;\n}\nexport function fastHashBetween(str, begin, end) {\n    let hash = HASH_SEED;\n    for (let i = begin; i < end; i += 1) {\n        hash = (hash * HASH_INTERNAL_MULT) ^ str.charCodeAt(i);\n    }\n    return hash >>> 0;\n}\nexport function fastHash(str) {\n    if (typeof str !== 'string') {\n        return HASH_SEED;\n    }\n    if (str.length === 0) {\n        return HASH_SEED;\n    }\n    return fastHashBetween(str, 0, str.length);\n}\nexport function hashStrings(strings) {\n    const result = new Uint32Array(strings.length);\n    let index = 0;\n    for (const str of strings) {\n        result[index++] = fastHash(str);\n    }\n    return result;\n}\n// https://jsperf.com/string-startswith/21\nexport function fastStartsWith(haystack, needle) {\n    if (haystack.length < needle.length) {\n        return false;\n    }\n    const ceil = needle.length;\n    for (let i = 0; i < ceil; i += 1) {\n        if (haystack[i] !== needle[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function fastStartsWithFrom(haystack, needle, start) {\n    if (haystack.length - start < needle.length) {\n        return false;\n    }\n    const ceil = start + needle.length;\n    for (let i = start; i < ceil; i += 1) {\n        if (haystack[i] !== needle[i - start]) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function isDigit(ch) {\n    // 48 == '0'\n    // 57 == '9'\n    return ch >= 48 && ch <= 57;\n}\nexport function isAlpha(ch) {\n    // 65 == 'A'\n    // 90 == 'Z'\n    // 97 == 'a'\n    // 122 === 'z'\n    return (ch >= 97 && ch <= 122) || (ch >= 65 && ch <= 90);\n}\nfunction isAlphaExtended(ch) {\n    // 192 -> 450\n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                                                 \n    //                 \n    return ch >= 192 && ch <= 450;\n}\nfunction isCyrillic(ch) {\n    // 1024 -> 1279\n    //                                      \n    //                                      \n    //                                    \n    //                                          \n    //                                     \n    //                                      \n    //                           \n    return ch >= 1024 && ch <= 1279;\n}\nfunction isAllowedCode(ch) {\n    return (isAlpha(ch) || isDigit(ch) || ch === 37 /* '%' */ || isAlphaExtended(ch) || isCyrillic(ch));\n}\nexport function tokenizeWithWildcardsInPlace(pattern, skipFirstToken, skipLastToken, buffer) {\n    // TODO maybe better to check if buffer is full?\n    // Otherwise we are under-using the space.\n    const len = Math.min(pattern.length, buffer.remaining() * 2);\n    let inside = false;\n    let precedingCh = 0;\n    let start = 0;\n    let hash = HASH_SEED;\n    for (let i = 0; i < len; i += 1) {\n        const ch = pattern.charCodeAt(i);\n        if (isAllowedCode(ch) === true) {\n            if (inside === false) {\n                hash = HASH_SEED;\n                inside = true;\n                start = i;\n            }\n            hash = (hash * HASH_INTERNAL_MULT) ^ ch;\n        }\n        else {\n            if (inside === true) {\n                inside = false;\n                if (i - start > 1 && // Ignore tokens of 1 character\n                    ch !== 42 && // Ignore tokens followed by a '*'\n                    precedingCh !== 42 && // Ignore tokens preceeded by a '*'\n                    (skipFirstToken === false || start !== 0)) {\n                    buffer.push(hash >>> 0);\n                }\n            }\n            precedingCh = ch;\n        }\n    }\n    if (skipLastToken === false &&\n        inside === true &&\n        precedingCh !== 42 && // Ignore tokens preceeded by a '*'\n        pattern.length - start > 1 && // Ignore tokens of 1 character\n        buffer.full() === false) {\n        buffer.push(hash >>> 0);\n    }\n}\nexport function tokenizeInPlace(pattern, skipFirstToken, skipLastToken, buffer) {\n    const len = Math.min(pattern.length, buffer.remaining() * 2);\n    let inside = false;\n    let start = 0;\n    let hash = HASH_SEED;\n    for (let i = 0; i < len; i += 1) {\n        const ch = pattern.charCodeAt(i);\n        if (isAllowedCode(ch) === true) {\n            if (inside === false) {\n                hash = HASH_SEED;\n                inside = true;\n                start = i;\n            }\n            hash = (hash * HASH_INTERNAL_MULT) ^ ch;\n        }\n        else if (inside === true) {\n            inside = false;\n            if (i - start > 1 && // Ignore tokens of 1 character\n                (skipFirstToken === false || start !== 0)) {\n                buffer.push(hash >>> 0);\n            }\n        }\n    }\n    if (inside === true &&\n        skipLastToken === false &&\n        pattern.length - start > 1 && // Ignore tokens of 1 character\n        buffer.full() === false) {\n        buffer.push(hash >>> 0);\n    }\n}\nexport function tokenizeNoSkipInPlace(pattern, buffer) {\n    const len = Math.min(pattern.length, buffer.remaining() * 2);\n    let inside = false;\n    let start = 0;\n    let hash = HASH_SEED;\n    for (let i = 0; i < len; i += 1) {\n        const ch = pattern.charCodeAt(i);\n        if (isAllowedCode(ch) === true) {\n            if (inside === false) {\n                hash = HASH_SEED;\n                inside = true;\n                start = i;\n            }\n            hash = (hash * HASH_INTERNAL_MULT) ^ ch;\n        }\n        else if (inside === true) {\n            inside = false;\n            if (i - start > 1) {\n                buffer.push(hash >>> 0);\n            }\n        }\n    }\n    if (inside === true && pattern.length - start > 1 && buffer.full() === false) {\n        buffer.push(hash >>> 0);\n    }\n}\nexport function tokenizeNoSkip(pattern) {\n    TOKENS_BUFFER.reset();\n    tokenizeNoSkipInPlace(pattern, TOKENS_BUFFER);\n    return TOKENS_BUFFER.slice();\n}\nexport function tokenizeWithWildcards(pattern, skipFirstToken, skipLastToken) {\n    TOKENS_BUFFER.reset();\n    tokenizeWithWildcardsInPlace(pattern, skipFirstToken, skipLastToken, TOKENS_BUFFER);\n    return TOKENS_BUFFER.slice();\n}\nexport function tokenize(pattern, skipFirstToken, skipLastToken) {\n    TOKENS_BUFFER.reset();\n    tokenizeInPlace(pattern, skipFirstToken, skipLastToken, TOKENS_BUFFER);\n    return TOKENS_BUFFER.slice();\n}\nexport function tokenizeRegexInPlace(selector, tokens) {\n    let end = selector.length - 1;\n    let begin = 1;\n    let prev = 0;\n    // Try to find the longest safe *prefix* that we can tokenize\n    for (; begin < end; begin += 1) {\n        const code = selector.charCodeAt(begin);\n        // If we encounter '|' before any other opening bracket, then it's not safe\n        // to tokenize this filter (e.g.: 'foo|bar'). Instead we abort tokenization\n        // to be safe.\n        if (code === 124 /* '|' */) {\n            return;\n        }\n        if (code === 40 /* '(' */ ||\n            code === 42 /* '*' */ ||\n            code === 43 /* '+' */ ||\n            code === 63 /* '?' */ ||\n            code === 91 /* '[' */ ||\n            code === 123 /* '{' */ ||\n            (code === 46 /* '.' */ && prev !== 92) /* '\\' */ ||\n            (code === 92 /* '\\' */ && isAlpha(selector.charCodeAt(begin + 1)))) {\n            break;\n        }\n        prev = code;\n    }\n    // Try to find the longest safe *suffix* that we can tokenize\n    prev = 0;\n    for (; end >= begin; end -= 1) {\n        const code = selector.charCodeAt(end);\n        // If we encounter '|' before any other opening bracket, then it's not safe\n        // to tokenize this filter (e.g.: 'foo|bar'). Instead we abort tokenization\n        // to be safe.\n        if (code === 124 /* '|' */) {\n            return;\n        }\n        if (code === 41 /* ')' */ ||\n            code === 42 /* '*' */ ||\n            code === 43 /* '+' */ ||\n            code === 63 /* '?' */ ||\n            code === 93 /* ']' */ ||\n            code === 125 /* '}' */ ||\n            (code === 46 /* '.' */ && selector.charCodeAt(end - 1) !== 92) /* '\\' */ ||\n            (code === 92 /* '\\' */ && isAlpha(prev))) {\n            break;\n        }\n        prev = code;\n    }\n    if (end < begin) {\n        // Full selector is safe\n        const skipFirstToken = selector.charCodeAt(1) !== 94; /* '^' */\n        const skipLastToken = selector.charCodeAt(selector.length - 1) !== 36; /* '$' */\n        tokenizeInPlace(selector.slice(1, selector.length - 1), skipFirstToken, skipLastToken, tokens);\n    }\n    else {\n        // Tokenize prefix\n        if (begin > 1) {\n            tokenizeInPlace(selector.slice(1, begin), selector.charCodeAt(1) !== 94 /* '^' */, // skipFirstToken\n            true, tokens);\n        }\n        // Tokenize suffix\n        if (end < selector.length - 1) {\n            tokenizeInPlace(selector.slice(end + 1, selector.length - 1), true, selector.charCodeAt(selector.length - 1) !== 94 /* '^' */, // skipLastToken\n            tokens);\n        }\n    }\n}\nexport function binSearch(arr, elt) {\n    if (arr.length === 0) {\n        return -1;\n    }\n    let low = 0;\n    let high = arr.length - 1;\n    while (low <= high) {\n        const mid = (low + high) >>> 1;\n        const midVal = arr[mid];\n        if (midVal < elt) {\n            low = mid + 1;\n        }\n        else if (midVal > elt) {\n            high = mid - 1;\n        }\n        else {\n            return mid;\n        }\n    }\n    return -1;\n}\nexport function binLookup(arr, elt) {\n    return binSearch(arr, elt) !== -1;\n}\n// eslint-disable-next-line no-control-regex\nconst hasUnicodeRe = /[^\\u0000-\\u00ff]/;\nexport function hasUnicode(str) {\n    return hasUnicodeRe.test(str);\n}\n//# sourceMappingURL=utils.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport guessUrlType from '@remusao/guess-url-type';\nimport { parse } from 'tldts-experimental';\nimport { EMPTY_UINT32_ARRAY } from './data-view.js';\nimport { TOKENS_BUFFER } from './tokens-buffer.js';\nimport { fastHash, tokenizeNoSkipInPlace, HASH_SEED, HASH_INTERNAL_MULT } from './utils.js';\nconst TLDTS_OPTIONS = {\n    extractHostname: true,\n    mixedInputs: false,\n    validateHostname: false,\n};\nexport const NORMALIZED_TYPE_TOKEN = {\n    beacon: fastHash('type:beacon'),\n    cspReport: fastHash('type:csp'),\n    csp_report: fastHash('type:csp'),\n    cspviolationreport: fastHash('type:cspviolationreport'),\n    document: fastHash('type:document'),\n    eventsource: fastHash('type:other'),\n    fetch: fastHash('type:xhr'),\n    font: fastHash('type:font'),\n    image: fastHash('type:image'),\n    imageset: fastHash('type:image'),\n    mainFrame: fastHash('type:document'),\n    main_frame: fastHash('type:document'),\n    manifest: fastHash('type:other'),\n    media: fastHash('type:media'),\n    object: fastHash('type:object'),\n    object_subrequest: fastHash('type:object'),\n    other: fastHash('type:other'),\n    ping: fastHash('type:ping'),\n    prefetch: fastHash('type:other'),\n    preflight: fastHash('type:preflight'),\n    script: fastHash('type:script'),\n    signedexchange: fastHash('type:signedexchange'),\n    speculative: fastHash('type:other'),\n    stylesheet: fastHash('type:stylesheet'),\n    subFrame: fastHash('type:subdocument'),\n    sub_frame: fastHash('type:subdocument'),\n    texttrack: fastHash('type:other'),\n    webSocket: fastHash('type:websocket'),\n    web_manifest: fastHash('type:other'),\n    websocket: fastHash('type:websocket'),\n    xhr: fastHash('type:xhr'),\n    xml_dtd: fastHash('type:other'),\n    xmlhttprequest: fastHash('type:xhr'),\n    xslt: fastHash('type:other'),\n};\nexport function hashHostnameBackward(hostname) {\n    let hash = HASH_SEED;\n    for (let j = hostname.length - 1; j >= 0; j -= 1) {\n        hash = (hash * HASH_INTERNAL_MULT) ^ hostname.charCodeAt(j);\n    }\n    return hash >>> 0;\n}\nexport function getHashesFromLabelsBackward(hostname, end, startOfDomain) {\n    TOKENS_BUFFER.reset();\n    let hash = HASH_SEED;\n    // Compute hash backward, label per label\n    for (let i = end - 1; i >= 0; i -= 1) {\n        const code = hostname.charCodeAt(i);\n        // Process label\n        if (code === 46 /* '.' */ && i < startOfDomain) {\n            TOKENS_BUFFER.push(hash >>> 0);\n        }\n        // Update hash\n        hash = (hash * HASH_INTERNAL_MULT) ^ code;\n    }\n    TOKENS_BUFFER.push(hash >>> 0);\n    return TOKENS_BUFFER.slice();\n}\n/**\n * Given a hostname and its domain, return the hostname without the public\n * suffix. We know that the domain, with one less label on the left, will be a\n * the public suffix; and from there we know which trailing portion of\n * `hostname` we should remove.\n */\nexport function getHostnameWithoutPublicSuffix(hostname, domain) {\n    let hostnameWithoutPublicSuffix = null;\n    const indexOfDot = domain.indexOf('.');\n    if (indexOfDot !== -1) {\n        const publicSuffix = domain.slice(indexOfDot + 1);\n        hostnameWithoutPublicSuffix = hostname.slice(0, -publicSuffix.length - 1);\n    }\n    return hostnameWithoutPublicSuffix;\n}\nexport function getEntityHashesFromLabelsBackward(hostname, domain) {\n    const hostnameWithoutPublicSuffix = getHostnameWithoutPublicSuffix(hostname, domain);\n    if (hostnameWithoutPublicSuffix !== null) {\n        return getHashesFromLabelsBackward(hostnameWithoutPublicSuffix, hostnameWithoutPublicSuffix.length, hostnameWithoutPublicSuffix.length);\n    }\n    return EMPTY_UINT32_ARRAY;\n}\nexport function getHostnameHashesFromLabelsBackward(hostname, domain) {\n    return getHashesFromLabelsBackward(hostname, hostname.length, hostname.length - domain.length);\n}\nfunction isThirdParty(hostname, domain, sourceHostname, sourceDomain, type) {\n    if (type === 'main_frame' || type === 'mainFrame') {\n        return false;\n    }\n    else if (domain.length !== 0 && sourceDomain.length !== 0) {\n        return domain !== sourceDomain;\n    }\n    else if (domain.length !== 0 && sourceHostname.length !== 0) {\n        return domain !== sourceHostname;\n    }\n    else if (sourceDomain.length !== 0 && hostname.length !== 0) {\n        return hostname !== sourceDomain;\n    }\n    return false;\n}\nexport default class Request {\n    /**\n     * Create an instance of `Request` from raw request details.\n     */\n    static fromRawDetails({ requestId = '0', tabId = 0, url = '', hostname, domain, sourceUrl = '', sourceHostname, sourceDomain, type = 'main_frame', _originalRequestDetails, }) {\n        url = url.toLowerCase();\n        if (hostname === undefined || domain === undefined) {\n            const parsed = parse(url, TLDTS_OPTIONS);\n            hostname = hostname || parsed.hostname || '';\n            domain = domain || parsed.domain || '';\n        }\n        // Initialize source URL\n        if (sourceHostname === undefined || sourceDomain === undefined) {\n            const parsed = parse(sourceHostname || sourceDomain || sourceUrl, TLDTS_OPTIONS);\n            sourceHostname = sourceHostname || parsed.hostname || '';\n            sourceDomain = sourceDomain || parsed.domain || sourceHostname || '';\n        }\n        return new Request({\n            requestId,\n            tabId,\n            domain,\n            hostname,\n            url,\n            sourceDomain,\n            sourceHostname,\n            sourceUrl,\n            type,\n            _originalRequestDetails,\n        });\n    }\n    constructor({ requestId, tabId, type, domain, hostname, url, sourceDomain, sourceHostname, _originalRequestDetails, }) {\n        // Lazy attributes\n        this.tokens = undefined;\n        this.hostnameHashes = undefined;\n        this.entityHashes = undefined;\n        this._originalRequestDetails = _originalRequestDetails;\n        this.id = requestId;\n        this.tabId = tabId;\n        this.type = type;\n        this.url = url;\n        this.hostname = hostname;\n        this.domain = domain;\n        this.sourceHostnameHashes =\n            sourceHostname.length === 0\n                ? EMPTY_UINT32_ARRAY\n                : getHostnameHashesFromLabelsBackward(sourceHostname, sourceDomain);\n        this.sourceEntityHashes =\n            sourceHostname.length === 0\n                ? EMPTY_UINT32_ARRAY\n                : getEntityHashesFromLabelsBackward(sourceHostname, sourceDomain);\n        // Decide on partiness\n        this.isThirdParty = isThirdParty(hostname, domain, sourceHostname, sourceDomain, type);\n        this.isFirstParty = !this.isThirdParty;\n        // Check protocol\n        this.isSupported = true;\n        if (this.type === 'websocket' || this.url.startsWith('ws:') || this.url.startsWith('wss:')) {\n            this.isHttp = false;\n            this.isHttps = false;\n            this.type = 'websocket';\n            this.isSupported = true;\n        }\n        else if (this.url.startsWith('http:')) {\n            this.isHttp = true;\n            this.isHttps = false;\n        }\n        else if (this.url.startsWith('https:')) {\n            this.isHttps = true;\n            this.isHttp = false;\n        }\n        else if (this.url.startsWith('data:')) {\n            this.isHttp = false;\n            this.isHttps = false;\n            // Only keep prefix of URL\n            const indexOfComa = this.url.indexOf(',');\n            if (indexOfComa !== -1) {\n                this.url = this.url.slice(0, indexOfComa);\n            }\n        }\n        else {\n            this.isHttp = false;\n            this.isHttps = false;\n            this.isSupported = false;\n        }\n    }\n    getHostnameHashes() {\n        if (this.hostnameHashes === undefined) {\n            this.hostnameHashes =\n                this.hostname.length === 0\n                    ? EMPTY_UINT32_ARRAY\n                    : getHostnameHashesFromLabelsBackward(this.hostname, this.domain);\n        }\n        return this.hostnameHashes;\n    }\n    getEntityHashes() {\n        if (this.entityHashes === undefined) {\n            this.entityHashes =\n                this.hostname.length === 0\n                    ? EMPTY_UINT32_ARRAY\n                    : getEntityHashesFromLabelsBackward(this.hostname, this.domain);\n        }\n        return this.entityHashes;\n    }\n    getTokens() {\n        if (this.tokens === undefined) {\n            TOKENS_BUFFER.reset();\n            for (const hash of this.sourceHostnameHashes) {\n                TOKENS_BUFFER.push(hash);\n            }\n            // Add token corresponding to request type\n            TOKENS_BUFFER.push(NORMALIZED_TYPE_TOKEN[this.type]);\n            tokenizeNoSkipInPlace(this.url, TOKENS_BUFFER);\n            this.tokens = TOKENS_BUFFER.slice();\n        }\n        return this.tokens;\n    }\n    isMainFrame() {\n        return this.type === 'main_frame' || this.type === 'mainFrame';\n    }\n    isSubFrame() {\n        return this.type === 'sub_frame' || this.type === 'subFrame';\n    }\n    /**\n     * Calling this method will attempt to guess the type of a request based on\n     * information found in `url` only. This can be useful to try and fine-tune\n     * the type of a Request when it is not otherwise available or if it was\n     * inferred as 'other'.\n     */\n    guessTypeOfRequest() {\n        const currentType = this.type;\n        this.type = guessUrlType(this.url);\n        if (currentType !== this.type) {\n            this.tokens = undefined;\n        }\n        return this.type;\n    }\n}\n/**\n * Kept for backward compatibility. The recommended way is to call\n * `Request.fromRawDetails` directly.\n */\nexport function makeRequest(details) {\n    return Request.fromRawDetails(details);\n}\n//# sourceMappingURL=request.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { hashHostnameBackward } from '../request.js';\nimport { toASCII } from '../punycode.js';\nimport { sizeOfUint32Array, sizeOfUTF8 } from '../data-view.js';\nimport { binLookup, hasUnicode, HASH_INTERNAL_MULT } from '../utils.js';\nexport class Domains {\n    static parse(parts, debug = false) {\n        if (parts.length === 0) {\n            return undefined;\n        }\n        const entities = [];\n        const notEntities = [];\n        const hostnames = [];\n        const notHostnames = [];\n        for (let hostname of parts) {\n            if (hasUnicode(hostname)) {\n                hostname = toASCII(hostname);\n            }\n            const negation = hostname.charCodeAt(0) === 126; /* '~' */\n            const entity = hostname.charCodeAt(hostname.length - 1) === 42 /* '*' */ &&\n                hostname.charCodeAt(hostname.length - 2) === 46; /* '.' */\n            const start = negation ? 1 : 0;\n            const end = entity ? hostname.length - 2 : hostname.length;\n            const hash = hashHostnameBackward(negation === true || entity === true ? hostname.slice(start, end) : hostname);\n            if (negation) {\n                if (entity) {\n                    notEntities.push(hash);\n                }\n                else {\n                    notHostnames.push(hash);\n                }\n            }\n            else {\n                if (entity) {\n                    entities.push(hash);\n                }\n                else {\n                    hostnames.push(hash);\n                }\n            }\n        }\n        return new Domains({\n            entities: entities.length !== 0 ? new Uint32Array(entities).sort() : undefined,\n            hostnames: hostnames.length !== 0 ? new Uint32Array(hostnames).sort() : undefined,\n            notEntities: notEntities.length !== 0 ? new Uint32Array(notEntities).sort() : undefined,\n            notHostnames: notHostnames.length !== 0 ? new Uint32Array(notHostnames).sort() : undefined,\n            parts: debug === true ? parts.join(',') : undefined,\n        });\n    }\n    static deserialize(buffer) {\n        const optionalParts = buffer.getUint8();\n        // The order of these fields should be the same as when we serialize them.\n        return new Domains({\n            entities: (optionalParts & 1) === 1 ? buffer.getUint32Array() : undefined,\n            hostnames: (optionalParts & 2) === 2 ? buffer.getUint32Array() : undefined,\n            notEntities: (optionalParts & 4) === 4 ? buffer.getUint32Array() : undefined,\n            notHostnames: (optionalParts & 8) === 8 ? buffer.getUint32Array() : undefined,\n            parts: (optionalParts & 16) === 16 ? buffer.getUTF8() : undefined,\n        });\n    }\n    constructor({ entities, hostnames, notEntities, notHostnames, parts, }) {\n        // Hostname constraints\n        this.entities = entities;\n        this.hostnames = hostnames;\n        // Hostname exceptions\n        this.notEntities = notEntities;\n        this.notHostnames = notHostnames;\n        // Debug\n        this.parts = parts;\n    }\n    updateId(hash) {\n        const { hostnames, entities, notHostnames, notEntities } = this;\n        if (hostnames !== undefined) {\n            for (const hostname of hostnames) {\n                hash = (hash * HASH_INTERNAL_MULT) ^ hostname;\n            }\n        }\n        if (entities !== undefined) {\n            for (const entity of entities) {\n                hash = (hash * HASH_INTERNAL_MULT) ^ entity;\n            }\n        }\n        if (notHostnames !== undefined) {\n            for (const notHostname of notHostnames) {\n                hash = (hash * HASH_INTERNAL_MULT) ^ notHostname;\n            }\n        }\n        if (notEntities !== undefined) {\n            for (const notEntity of notEntities) {\n                hash = (hash * HASH_INTERNAL_MULT) ^ notEntity;\n            }\n        }\n        return hash;\n    }\n    serialize(buffer) {\n        // Mandatory fields\n        const index = buffer.getPos();\n        buffer.pushUint8(0);\n        // This bit-mask indicates which optional parts of the filter were serialized.\n        let optionalParts = 0;\n        if (this.entities !== undefined) {\n            optionalParts |= 1;\n            buffer.pushUint32Array(this.entities);\n        }\n        if (this.hostnames !== undefined) {\n            optionalParts |= 2;\n            buffer.pushUint32Array(this.hostnames);\n        }\n        if (this.notEntities !== undefined) {\n            optionalParts |= 4;\n            buffer.pushUint32Array(this.notEntities);\n        }\n        if (this.notHostnames !== undefined) {\n            optionalParts |= 8;\n            buffer.pushUint32Array(this.notHostnames);\n        }\n        if (this.parts !== undefined) {\n            optionalParts |= 16;\n            buffer.pushUTF8(this.parts);\n        }\n        buffer.setByte(index, optionalParts);\n    }\n    getSerializedSize() {\n        let estimate = 1; // optional parts (1 byte)\n        if (this.entities !== undefined) {\n            estimate += sizeOfUint32Array(this.entities);\n        }\n        if (this.hostnames !== undefined) {\n            estimate += sizeOfUint32Array(this.hostnames);\n        }\n        if (this.notHostnames !== undefined) {\n            estimate += sizeOfUint32Array(this.notHostnames);\n        }\n        if (this.notEntities !== undefined) {\n            estimate += sizeOfUint32Array(this.notEntities);\n        }\n        if (this.parts !== undefined) {\n            estimate += sizeOfUTF8(this.parts);\n        }\n        return estimate;\n    }\n    match(hostnameHashes, entityHashes) {\n        // Check if `hostname` is blacklisted\n        if (this.notHostnames !== undefined) {\n            for (const hash of hostnameHashes) {\n                if (binLookup(this.notHostnames, hash)) {\n                    return false;\n                }\n            }\n        }\n        // Check if `hostname` is blacklisted by *entity*\n        if (this.notEntities !== undefined) {\n            for (const hash of entityHashes) {\n                if (binLookup(this.notEntities, hash)) {\n                    return false;\n                }\n            }\n        }\n        // Check if `hostname` is allowed\n        if (this.hostnames !== undefined || this.entities !== undefined) {\n            if (this.hostnames !== undefined) {\n                for (const hash of hostnameHashes) {\n                    if (binLookup(this.hostnames, hash)) {\n                        return true;\n                    }\n                }\n            }\n            if (this.entities !== undefined) {\n                for (const hash of entityHashes) {\n                    if (binLookup(this.entities, hash)) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n        return true;\n    }\n}\n//# sourceMappingURL=domains.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nexport function extractHTMLSelectorFromRule(rule) {\n    if (rule.startsWith('^script') === false) {\n        return undefined;\n    }\n    const prefix = ':has-text(';\n    const selectors = [];\n    let index = 7;\n    // ^script:has-text\n    //        ^ 7\n    // Prepare for finding one or more ':has-text(' selectors in a row\n    while (rule.startsWith(prefix, index)) {\n        index += prefix.length;\n        let currentParsingDepth = 1;\n        const startOfSelectorIndex = index;\n        let prev = -1; // previous character\n        for (; index < rule.length && currentParsingDepth !== 0; index += 1) {\n            const code = rule.charCodeAt(index);\n            if (prev !== 92 /* '\\' */) {\n                if (code === 40 /* '(' */) {\n                    currentParsingDepth += 1;\n                }\n                if (code === 41 /* ')' */) {\n                    currentParsingDepth -= 1;\n                }\n            }\n            prev = code;\n        }\n        selectors.push(rule.slice(startOfSelectorIndex, index - 1));\n    }\n    if (index !== rule.length) {\n        return undefined;\n    }\n    return ['script', selectors];\n}\nexport function extractTagsFromHtml(html, tag) {\n    const tags = [];\n    const prefix = `<${tag}`;\n    const suffix = `</${tag}>`;\n    // Keep track of the beginning of current identified tag\n    let index = html.indexOf(prefix);\n    // Keep tracks of index immediately following last extracted tag\n    let endOfLastTag = 0;\n    while (index !== -1) {\n        // Find index of end of current tag. If we do not find it, it could be\n        // because it will come in the next chunk and we should try parsing it\n        // again then.\n        const endOfTagIndex = html.indexOf('>', index + prefix.length);\n        if (endOfTagIndex === -1) {\n            return [tags, html.slice(0, index), html.slice(index)];\n        }\n        // Handle short tag form <tag/> which will not have a closing tag.\n        if (html.charCodeAt(endOfTagIndex - 1) === 47 /* '/' */) {\n            endOfLastTag = endOfTagIndex + 1;\n            tags.push([index, html.slice(index, endOfLastTag)]);\n        }\n        else {\n            // Find index of closing tag '</tag>'. If we do not find it, again, it\n            // could mean that it will come in next chunk and we need to try parsing\n            // it again with more input.\n            const indexOfClosingTag = html.indexOf(suffix, endOfTagIndex);\n            if (indexOfClosingTag === -1) {\n                return [tags, html.slice(0, index), html.slice(index)];\n            }\n            tags.push([index, html.slice(index, indexOfClosingTag + suffix.length)]);\n            endOfLastTag = indexOfClosingTag + suffix.length;\n        }\n        index = html.indexOf(prefix, endOfLastTag);\n    }\n    // Make sure we consume as much input as possible so that we do not parse the\n    // same portion of HTML again next time and we can stream chunks as early as\n    // possible.\n    //\n    // We check if there is at least one '<' char after the end of the last\n    // extracted tag; this would indicate that the next chunk might contain the\n    // remaining of a valid tag. We then look up to N characters after this '<'\n    // character, where N is the size of 'prefix'. The rational is that if we\n    // reached this part of the code, then it cannot be a match otherwise we\n    // would have returned earlier (from the loop).\n    let lastClosingTagIndex = html.lastIndexOf('>');\n    if (lastClosingTagIndex === -1) {\n        lastClosingTagIndex = endOfLastTag;\n    }\n    const indexOfNextTag = html.indexOf('<', lastClosingTagIndex);\n    // If no '<' in the remaining of input, then it means we can count this chunk\n    // as fully parsed (i.e.: next chunk can be parsed independently without\n    // missing a tag which would start in this one).\n    if (indexOfNextTag === -1) {\n        return [tags, html, ''];\n    }\n    // In case of a partial tag ending this 'html' chunk. Then check if we have\n    // enough information to discard it already based on the kind of tags we are\n    // looking for.\n    if (html.length - indexOfNextTag >= prefix.length ||\n        prefix.startsWith(html.slice(indexOfNextTag)) === false) {\n        return [tags, html, ''];\n    }\n    return [tags, html.slice(0, indexOfNextTag), html.slice(indexOfNextTag)];\n}\nexport function extractSelectorsFromRules(filter) {\n    const patterns = [];\n    for (const [, selectors] of filter) {\n        const plainPatterns = [];\n        const regexpPatterns = [];\n        for (const selector of selectors) {\n            if (selector.charCodeAt(0) === 47 /* '/' */) {\n                if (selector.endsWith('/')) {\n                    regexpPatterns.push(new RegExp(selector.slice(1, -1)));\n                }\n                else if (selector.endsWith('/i')) {\n                    regexpPatterns.push(new RegExp(selector.slice(1, -2), 'i'));\n                }\n            }\n            else {\n                plainPatterns.push(selector);\n            }\n        }\n        if (plainPatterns.length !== 0 || regexpPatterns.length !== 0) {\n            patterns.push([plainPatterns, regexpPatterns]);\n        }\n    }\n    return patterns;\n}\n/**\n * Check if `tag` should be removed from HTML based on `plainPatterns` and\n * `regexpPatterns`. For a tag to be removed, all elements from `plainPatterns`\n * and `regexpPatterns` must match.\n */\nfunction tagShouldBeRemoved(tag, plainPatterns, regexpPatterns) {\n    for (const pattern of plainPatterns) {\n        if (tag.indexOf(pattern) === -1) {\n            return false;\n        }\n    }\n    for (const pattern of regexpPatterns) {\n        if (pattern.test(tag) === false) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function selectTagsToRemove(patterns, tags) {\n    const toRemove = [];\n    for (const tag of tags) {\n        for (const [plainPatterns, regexpPatterns] of patterns) {\n            if (tagShouldBeRemoved(tag[1], plainPatterns, regexpPatterns)) {\n                toRemove.push(tag);\n                break;\n            }\n        }\n    }\n    return toRemove;\n}\nexport function removeTagsFromHtml(html, toRemove) {\n    if (toRemove.length === 0) {\n        return html;\n    }\n    let filteredHtml = html;\n    toRemove.reverse(); // make sure to remove from last to first tag (preserve indices)\n    for (const [index, tag] of toRemove) {\n        filteredHtml = filteredHtml.slice(0, index) + filteredHtml.slice(index + tag.length);\n    }\n    return filteredHtml;\n}\nexport default class StreamingHtmlFilter {\n    constructor(selectors) {\n        this.buffer = '';\n        this.patterns = extractSelectorsFromRules(selectors);\n    }\n    flush() {\n        return this.buffer;\n    }\n    write(chunk) {\n        // If there are no valid selectors, abort.\n        if (this.patterns.length === 0) {\n            return chunk;\n        }\n        // If given an empty string, abort.\n        if (chunk.length === 0) {\n            return chunk;\n        }\n        // Accumulate buffer + new data\n        this.buffer += chunk;\n        // Parse tags from `this.buffer`\n        const [tags, parsed, rest] = extractTagsFromHtml(this.buffer, 'script');\n        this.buffer = rest;\n        // If no tags were found, just return the parsed version\n        if (tags.length === 0) {\n            return parsed;\n        }\n        // Perform tags filtering using `this.patterns` and `this.regexps`.\n        return removeTagsFromHtml(parsed, selectTagsToRemove(this.patterns, tags));\n    }\n}\n//# sourceMappingURL=html-filtering.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { classifySelector, SelectorType, parse as parseCssSelector, } from '@cliqz/adblocker-extended-selectors';\nimport { Domains } from '../engine/domains.js';\nimport { EMPTY_UINT32_ARRAY, sizeOfASCII, sizeOfCosmeticSelector, sizeOfUTF8, sizeOfRawCosmetic, } from '../data-view.js';\nimport { getHostnameHashesFromLabelsBackward, getEntityHashesFromLabelsBackward, } from '../request.js';\nimport { fastHash, fastHashBetween, fastStartsWithFrom, getBit, hasUnicode, setBit, tokenize, HASH_SEED, HASH_INTERNAL_MULT, } from '../utils.js';\nimport { extractHTMLSelectorFromRule } from '../html-filtering.js';\nconst EMPTY_TOKENS = [EMPTY_UINT32_ARRAY];\nexport const DEFAULT_HIDDING_STYLE = 'display: none !important;';\nconst REGEXP_UNICODE_COMMA = new RegExp(/\\\\u002C/, 'g');\nconst REGEXP_UNICODE_BACKSLASH = new RegExp(/\\\\u005C/, 'g');\nconst REGEXP_ESCAPED_COMMA = new RegExp(/\\\\,/, 'g');\n/**\n * Given a `selector` starting with either '#' or '.' check if what follows is\n * a simple CSS selector: /^-?[_a-zA-Z]+[_a-zA-Z0-9-]*$/\n */\nfunction isSimpleSelector(selector) {\n    for (let i = 1; i < selector.length; i += 1) {\n        const code = selector.charCodeAt(i);\n        if (!(code === 45 /* '-' */ ||\n            code === 95 /* '_' */ ||\n            (code >= 48 && code <= 57) /* [0-9] */ ||\n            (code >= 65 && code <= 90) /* [A-Z] */ ||\n            (code >= 97 && code <= 122)) /* [a-z] */) {\n            if (i < selector.length - 1) {\n                // Check if what follows is a ' >' or ' ~' or ' +', in which case we\n                // also consider it a simple selector and the token this filter can be\n                // indexed with is the first selector.\n                const nextCode = selector.charCodeAt(i + 1);\n                if (code === 91 /* '[' */ ||\n                    code === 46 /* '.' */ ||\n                    code === 58 /* ':' */ ||\n                    (code === 32 /* ' ' */ &&\n                        (nextCode === 62 /* '>' */ ||\n                            nextCode === 43 /* '+' */ ||\n                            nextCode === 126 /* '~' */ ||\n                            nextCode === 46 /* '.' */ ||\n                            nextCode === 35)) /* '#' */) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Given a `selector` starting with either 'a[' or '[', check if what follows\n * is a simple href attribute selector of the form: 'href^=' or 'href*='.\n */\nfunction isSimpleHrefSelector(selector, start) {\n    return (selector.startsWith('href^=\"', start) ||\n        selector.startsWith('href*=\"', start) ||\n        selector.startsWith('href=\"', start));\n}\n/**\n * Validate CSS selector. There is a fast path for simple selectors (e.g.: #foo\n * or .bar) which are the most common case. For complex ones, we rely on\n * `Element.matches` (if available).\n */\nconst isValidCss = (() => {\n    const div = typeof document !== 'undefined'\n        ? document.createElement('div')\n        : {\n            matches: () => {\n                /* noop */\n            },\n        };\n    const matches = (selector) => div.matches(selector);\n    const validSelectorRe = /^[#.]?[\\w-.]+$/;\n    return function isValidCssImpl(selector) {\n        if (validSelectorRe.test(selector)) {\n            return true;\n        }\n        try {\n            matches(selector);\n        }\n        catch (ex) {\n            return false;\n        }\n        return true;\n    };\n})();\nfunction computeFilterId(mask, selector, domains, style) {\n    let hash = (HASH_SEED * HASH_INTERNAL_MULT) ^ mask;\n    if (selector !== undefined) {\n        for (let i = 0; i < selector.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ selector.charCodeAt(i);\n        }\n    }\n    if (domains !== undefined) {\n        hash = domains.updateId(hash);\n    }\n    if (style !== undefined) {\n        for (let i = 0; i < style.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ style.charCodeAt(i);\n        }\n    }\n    return hash >>> 0;\n}\n/***************************************************************************\n *  Cosmetic filters parsing\n * ************************************************************************ */\nexport default class CosmeticFilter {\n    /**\n     * Given a line that we know contains a cosmetic filter, create a CosmeticFiler\n     * instance out of it. This function should be *very* efficient, as it will be\n     * used to parse tens of thousands of lines.\n     */\n    static parse(line, debug = false) {\n        const rawLine = line;\n        // Mask to store attributes. Each flag (unhide, scriptInject, etc.) takes\n        // only 1 bit at a specific offset defined in COSMETICS_MASK.\n        // cf: COSMETICS_MASK for the offset of each property\n        let mask = 0;\n        let selector;\n        let domains;\n        let style;\n        const sharpIndex = line.indexOf('#');\n        // Start parsing the line\n        const afterSharpIndex = sharpIndex + 1;\n        let suffixStartIndex = afterSharpIndex + 1;\n        // hostname1,hostname2#?#.selector\n        // hostname1,hostname2#@#.selector\n        //                    ^^ ^\n        //                    || |\n        //                    || suffixStartIndex\n        //                    |afterSharpIndex\n        //                    sharpIndex\n        // Check if unhide\n        if (line.length > afterSharpIndex) {\n            if (line[afterSharpIndex] === '@') {\n                mask = setBit(mask, 1 /* COSMETICS_MASK.unhide */);\n                suffixStartIndex += 1;\n            }\n            else if (line[afterSharpIndex] === '?') {\n                suffixStartIndex += 1;\n            }\n        }\n        if (suffixStartIndex >= line.length) {\n            return null;\n        }\n        // Parse hostnames and entitites as well as their negations.\n        //\n        // - ~hostname##.selector\n        // - hostname##.selector\n        // - entity.*##.selector\n        // - ~entity.*##.selector\n        //\n        // Each kind will have its own Uint32Array containing hashes, sorted by\n        // number of labels considered. This allows a compact representation of\n        // hostnames and fast matching without any string copy.\n        if (sharpIndex > 0) {\n            domains = Domains.parse(line.slice(0, sharpIndex).split(','), debug);\n        }\n        if (line.endsWith(':remove()')) {\n            // ##selector:remove()\n            mask = setBit(mask, 64 /* COSMETICS_MASK.remove */);\n            mask = setBit(mask, 128 /* COSMETICS_MASK.extended */);\n            line = line.slice(0, -9);\n        }\n        else if (line.length - suffixStartIndex >= 8 &&\n            line.endsWith(')') &&\n            line.indexOf(':style(', suffixStartIndex) !== -1) {\n            // ##selector:style(...)\n            const indexOfStyle = line.indexOf(':style(', suffixStartIndex);\n            style = line.slice(indexOfStyle + 7, -1);\n            line = line.slice(0, indexOfStyle);\n        }\n        // Deal with HTML filters\n        if (line.charCodeAt(suffixStartIndex) === 94 /* '^' */) {\n            if (fastStartsWithFrom(line, 'script:has-text(', suffixStartIndex + 1) === false ||\n                line.charCodeAt(line.length - 1) !== 41 /* ')' */) {\n                return null;\n            }\n            // NOTE: currently only ^script:has-text(...) is supported.\n            //\n            //   ^script:has-text(selector)\n            //   ^                         ^\n            //   |                         |\n            //   |                         |\n            //   |                         line.length\n            //   |\n            //   suffixStartIndex\n            //\n            selector = line.slice(suffixStartIndex, line.length);\n            if (extractHTMLSelectorFromRule(selector) === undefined) {\n                return null;\n            }\n        }\n        else if (line.length - suffixStartIndex > 4 &&\n            line.charCodeAt(suffixStartIndex) === 43 /* '+' */ &&\n            fastStartsWithFrom(line, '+js(', suffixStartIndex)) {\n            // Generic scriptlets are invalid, unless they are un-hide\n            if ((domains === undefined ||\n                (domains.hostnames === undefined && domains.entities === undefined)) &&\n                getBit(mask, 1 /* COSMETICS_MASK.unhide */) === false) {\n                return null;\n            }\n            mask = setBit(mask, 2 /* COSMETICS_MASK.scriptInject */);\n            selector = line.slice(suffixStartIndex + 4, line.length - 1);\n            // An empty scriptlet (i.e. '+js()') can be specified to cancel injections\n            // on a specific domain or globally. It does not make sense though to have\n            // an empty scriptlet without an exception (i.e. '#@#' is mandatory).\n            if (getBit(mask, 1 /* COSMETICS_MASK.unhide */) === false && selector.length === 0) {\n                return null;\n            }\n        }\n        else {\n            selector = line.slice(suffixStartIndex);\n            const selectorType = classifySelector(selector);\n            if (selectorType === SelectorType.Extended) {\n                mask = setBit(mask, 128 /* COSMETICS_MASK.extended */);\n            }\n            else if (selectorType === SelectorType.Invalid || !isValidCss(selector)) {\n                // console.error('Invalid', line);\n                // TODO - maybe perform `isValidCss` from the other module.\n                return null;\n            }\n        }\n        // Extended selectors should always be specific to some domain.\n        if (domains === undefined && getBit(mask, 128 /* COSMETICS_MASK.extended */) === true) {\n            return null;\n        }\n        if (selector !== undefined) {\n            // Check if unicode appears in selector\n            if (hasUnicode(selector)) {\n                mask = setBit(mask, 4 /* COSMETICS_MASK.isUnicode */);\n            }\n            // Classify selector\n            if (getBit(mask, 2 /* COSMETICS_MASK.scriptInject */) === false &&\n                getBit(mask, 64 /* COSMETICS_MASK.remove */) === false &&\n                getBit(mask, 128 /* COSMETICS_MASK.extended */) === false &&\n                selector.startsWith('^') === false) {\n                const c0 = selector.charCodeAt(0);\n                const c1 = selector.charCodeAt(1);\n                const c2 = selector.charCodeAt(2);\n                // Check if we have a specific case of simple selector (id, class or\n                // href) These are the most common filters and will benefit greatly from\n                // a custom dispatch mechanism.\n                if (getBit(mask, 2 /* COSMETICS_MASK.scriptInject */) === false) {\n                    if (c0 === 46 /* '.' */ && isSimpleSelector(selector)) {\n                        mask = setBit(mask, 8 /* COSMETICS_MASK.isClassSelector */);\n                    }\n                    else if (c0 === 35 /* '#' */ && isSimpleSelector(selector)) {\n                        mask = setBit(mask, 16 /* COSMETICS_MASK.isIdSelector */);\n                    }\n                    else if (c0 === 97 /* a */ &&\n                        c1 === 91 /* '[' */ &&\n                        c2 === 104 /* 'h' */ &&\n                        isSimpleHrefSelector(selector, 2)) {\n                        mask = setBit(mask, 32 /* COSMETICS_MASK.isHrefSelector */);\n                    }\n                    else if (c0 === 91 /* '[' */ &&\n                        c1 === 104 /* 'h' */ &&\n                        isSimpleHrefSelector(selector, 1)) {\n                        mask = setBit(mask, 32 /* COSMETICS_MASK.isHrefSelector */);\n                    }\n                }\n            }\n        }\n        return new CosmeticFilter({\n            mask,\n            rawLine: debug === true ? rawLine : undefined,\n            selector,\n            style,\n            domains,\n        });\n    }\n    /**\n     * Deserialize cosmetic filters. The code accessing the buffer should be\n     * symetrical to the one in `serializeCosmeticFilter`.\n     */\n    static deserialize(buffer) {\n        const mask = buffer.getUint8();\n        const isUnicode = getBit(mask, 4 /* COSMETICS_MASK.isUnicode */);\n        const optionalParts = buffer.getUint8();\n        const selector = isUnicode ? buffer.getUTF8() : buffer.getCosmeticSelector();\n        // The order of these fields should be the same as when we serialize them.\n        return new CosmeticFilter({\n            // Mandatory fields\n            mask,\n            selector,\n            // Optional fields\n            domains: (optionalParts & 1) === 1 ? Domains.deserialize(buffer) : undefined,\n            rawLine: (optionalParts & 2) === 2 ? buffer.getRawCosmetic() : undefined,\n            style: (optionalParts & 4) === 4 ? buffer.getASCII() : undefined,\n        });\n    }\n    constructor({ mask, selector, domains, rawLine, style, }) {\n        this.mask = mask;\n        this.selector = selector;\n        this.domains = domains;\n        this.style = style;\n        this.id = undefined;\n        this.rawLine = rawLine;\n    }\n    isCosmeticFilter() {\n        return true;\n    }\n    isNetworkFilter() {\n        return false;\n    }\n    /**\n     * The format of a cosmetic filter is:\n     *\n     * | mask | selector length | selector... | hostnames length | hostnames...\n     *   32     16                              16\n     *\n     * The header (mask) is 32 bits, then we have a total of 32 bits to store the\n     * length of `selector` and `hostnames` (16 bits each).\n     *\n     * Improvements similar to the onces mentioned in `serializeNetworkFilters`\n     * could be applied here, to get a more compact representation.\n     */\n    serialize(buffer) {\n        // Mandatory fields\n        buffer.pushUint8(this.mask);\n        const index = buffer.getPos();\n        buffer.pushUint8(0);\n        if (this.isUnicode()) {\n            buffer.pushUTF8(this.selector);\n        }\n        else {\n            buffer.pushCosmeticSelector(this.selector);\n        }\n        // This bit-mask indicates which optional parts of the filter were serialized.\n        let optionalParts = 0;\n        if (this.domains !== undefined) {\n            optionalParts |= 1;\n            this.domains.serialize(buffer);\n        }\n        if (this.rawLine !== undefined) {\n            optionalParts |= 2;\n            buffer.pushRawCosmetic(this.rawLine);\n        }\n        if (this.style !== undefined) {\n            optionalParts |= 4;\n            buffer.pushASCII(this.style);\n        }\n        buffer.setByte(index, optionalParts);\n    }\n    /**\n     * Return an estimation of the size (in bytes) needed to persist this filter\n     * in a DataView. This does not need to be 100% accurate but should be an\n     * upper-bound. It should also be as fast as possible.\n     */\n    getSerializedSize(compression) {\n        let estimate = 1 + 1; // mask (1 byte) + optional parts (1 byte)\n        if (this.isUnicode()) {\n            estimate += sizeOfUTF8(this.selector);\n        }\n        else {\n            estimate += sizeOfCosmeticSelector(this.selector, compression);\n        }\n        if (this.domains !== undefined) {\n            estimate += this.domains.getSerializedSize();\n        }\n        if (this.rawLine !== undefined) {\n            estimate += sizeOfRawCosmetic(this.rawLine, compression);\n        }\n        if (this.style !== undefined) {\n            estimate += sizeOfASCII(this.style);\n        }\n        return estimate;\n    }\n    /**\n     * Create a more human-readable version of this filter. It is mainly used for\n     * debugging purpose, as it will expand the values stored in the bit mask.\n     */\n    toString() {\n        if (this.rawLine !== undefined) {\n            return this.rawLine;\n        }\n        let filter = '';\n        if (this.domains !== undefined) {\n            if (this.domains.parts !== undefined) {\n                filter += this.domains.parts;\n            }\n            else {\n                filter += '<hostnames>';\n            }\n        }\n        if (this.isUnhide()) {\n            filter += '#@#';\n        }\n        else {\n            filter += '##';\n        }\n        if (this.isScriptInject()) {\n            filter += '+js(';\n            filter += this.selector;\n            filter += ')';\n        }\n        else {\n            filter += this.selector;\n        }\n        return filter;\n    }\n    match(hostname, domain) {\n        // Not constraint on hostname, match is true\n        if (this.hasHostnameConstraint() === false) {\n            return true;\n        }\n        // No `hostname` available but this filter has some constraints on hostname.\n        if (!hostname && this.hasHostnameConstraint()) {\n            return false;\n        }\n        if (this.domains !== undefined) {\n            // TODO - this hashing could be re-used between cosmetics by using an\n            // abstraction like `Request` (similar to network filters matching).\n            // Maybe could we reuse `Request` directly without any change?\n            return this.domains.match(hostname.length === 0\n                ? EMPTY_UINT32_ARRAY\n                : getHostnameHashesFromLabelsBackward(hostname, domain), hostname.length === 0\n                ? EMPTY_UINT32_ARRAY\n                : getEntityHashesFromLabelsBackward(hostname, domain));\n        }\n        return true;\n    }\n    /**\n     * Get tokens for this filter. It can be indexed multiple times if multiple\n     * hostnames are specified (e.g.: host1,host2##.selector).\n     */\n    getTokens() {\n        const tokens = [];\n        // Note, we do not need to use negated domains or entities as tokens here\n        // since they will by definition not match on their own, unless accompanied\n        // by a domain or entity. Instead, they are handled in\n        // `CosmeticFilterBucket.getCosmeticsFilters(...)`.\n        if (this.domains !== undefined) {\n            const { hostnames, entities } = this.domains;\n            if (hostnames !== undefined) {\n                for (const hostname of hostnames) {\n                    tokens.push(new Uint32Array([hostname]));\n                }\n            }\n            if (entities !== undefined) {\n                for (const entity of entities) {\n                    tokens.push(new Uint32Array([entity]));\n                }\n            }\n        }\n        // Here we only take selector into account if the filter is not unHide.\n        if (tokens.length === 0 && this.isUnhide() === false) {\n            if (this.isIdSelector() || this.isClassSelector()) {\n                // Here we try to identify the end of selector si that we can extract a\n                // valid token out of it. In all these examples, 'selector' is our\n                // token:\n                //\n                //   .selector[...]\n                //   #selector[...]\n                //   #selector ~ foo\n                //   .selector:not(...)\n                //   .selector.foo\n                //\n                // We now try to identify the first valid end of selector which will\n                // also be the end of our token: space, bracket, colon, dot.\n                let endOfSelector = 1;\n                const selector = this.selector;\n                for (; endOfSelector < selector.length; endOfSelector += 1) {\n                    const code = selector.charCodeAt(endOfSelector);\n                    if (code === 32 /* ' ' */ ||\n                        code === 46 /* '.' */ ||\n                        code === 58 /* ':' */ ||\n                        code === 91 /* '[' */) {\n                        break;\n                    }\n                }\n                const arr = new Uint32Array(1);\n                arr[0] = fastHashBetween(selector, 1, endOfSelector);\n                tokens.push(arr);\n            }\n            else if (this.isHrefSelector() === true) {\n                const selector = this.getSelector();\n                // Locate 'href' in selector\n                let hrefIndex = selector.indexOf('href');\n                if (hrefIndex === -1) {\n                    return EMPTY_TOKENS;\n                }\n                hrefIndex += 4;\n                // Tokenize optimally depending on the kind of selector: 'href=',\n                // 'href*=', 'href^='.\n                let skipFirstToken = false;\n                let skipLastToken = true;\n                if (selector.charCodeAt(hrefIndex) === 42 /* '*' */) {\n                    // skip: '*'\n                    skipFirstToken = true;\n                    hrefIndex += 1;\n                }\n                else if (selector.charCodeAt(hrefIndex) === 94 /* '^' */) {\n                    // skip: '^'\n                    hrefIndex += 1;\n                }\n                else {\n                    skipLastToken = false;\n                }\n                hrefIndex += 2; // skip:  '=\"'\n                // Locate end of href\n                const hrefEnd = selector.indexOf('\"', hrefIndex);\n                if (hrefEnd === -1) {\n                    // That cannot happen unless the filter is not well-formed. In this\n                    // case, we just return no tokens, which will result in this filter\n                    // ending up in the \"wildcard\" bucket of the index.\n                    return EMPTY_TOKENS;\n                }\n                tokens.push(tokenize(this.selector.slice(hrefIndex, hrefEnd), skipFirstToken, skipLastToken));\n            }\n        }\n        if (tokens.length === 0) {\n            return EMPTY_TOKENS;\n        }\n        return tokens;\n    }\n    parseScript() {\n        const selector = this.getSelector();\n        if (selector.length === 0) {\n            return undefined;\n        }\n        const parts = [];\n        let index = 0;\n        let lastComaIndex = -1;\n        let inDoubleQuotes = false;\n        let inSingleQuotes = false;\n        let inRegexp = false;\n        let objectNesting = 0;\n        let lastCharIsBackslash = false;\n        let inArgument = false;\n        for (; index < selector.length; index += 1) {\n            const char = selector[index];\n            if (lastCharIsBackslash === false) {\n                if (inDoubleQuotes === true) {\n                    if (char === '\"') {\n                        inDoubleQuotes = false;\n                    }\n                }\n                else if (inSingleQuotes === true) {\n                    if (char === \"'\") {\n                        inSingleQuotes = false;\n                    }\n                }\n                else if (objectNesting !== 0) {\n                    if (char === '{') {\n                        objectNesting += 1;\n                    }\n                    else if (char === '}') {\n                        objectNesting -= 1;\n                    }\n                    else if (char === '\"') {\n                        inDoubleQuotes = true;\n                    }\n                    else if (char === \"'\") {\n                        inSingleQuotes = true;\n                    }\n                }\n                else if (inRegexp === true) {\n                    if (char === '/') {\n                        inRegexp = false;\n                    }\n                }\n                else {\n                    if (inArgument === false) {\n                        if (char === ' ') {\n                            // ignore\n                        }\n                        else if (char === '\"' && selector.indexOf('\"', index + 1) > 0) {\n                            inDoubleQuotes = true;\n                        }\n                        else if (char === \"'\" && selector.indexOf(\"'\", index + 1) > 0) {\n                            inSingleQuotes = true;\n                        }\n                        else if (char === '{' && selector.indexOf('}', index + 1) > 0) {\n                            objectNesting += 1;\n                        }\n                        else if (char === '/' && selector.indexOf('/', index + 1) > 0) {\n                            inRegexp = true;\n                        }\n                        else {\n                            inArgument = true;\n                        }\n                    }\n                    if (char === ',') {\n                        parts.push(selector.slice(lastComaIndex + 1, index).trim());\n                        lastComaIndex = index;\n                        inArgument = false;\n                    }\n                }\n            }\n            lastCharIsBackslash = char === '\\\\';\n        }\n        parts.push(selector.slice(lastComaIndex + 1).trim());\n        if (parts.length === 0) {\n            return undefined;\n        }\n        const args = parts\n            .slice(1)\n            .map((part) => {\n            if ((part.startsWith(`'`) && part.endsWith(`'`)) ||\n                (part.startsWith(`\"`) && part.endsWith(`\"`))) {\n                return part.substring(1, part.length - 1);\n            }\n            return part;\n        })\n            .map((part) => part\n            .replace(REGEXP_UNICODE_COMMA, ',')\n            .replace(REGEXP_UNICODE_BACKSLASH, '\\\\')\n            .replace(REGEXP_ESCAPED_COMMA, ','));\n        return { name: parts[0], args };\n    }\n    getScript(js) {\n        const parsed = this.parseScript();\n        if (parsed === undefined) {\n            return undefined;\n        }\n        const { name, args } = parsed;\n        let script = js.get(name);\n        if (script !== undefined) {\n            for (let i = 0; i < args.length; i += 1) {\n                // escape some characters so they wont get evaluated with escape characters during script injection\n                const arg = args[i].replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n                script = script.replace(`{{${i + 1}}}`, arg);\n            }\n            return script;\n        } // TODO - else throw an exception?\n        return undefined;\n    }\n    hasHostnameConstraint() {\n        return this.domains !== undefined;\n    }\n    getId() {\n        if (this.id === undefined) {\n            this.id = computeFilterId(this.mask, this.selector, this.domains, this.style);\n        }\n        return this.id;\n    }\n    hasCustomStyle() {\n        return this.style !== undefined;\n    }\n    getStyle() {\n        return this.style || DEFAULT_HIDDING_STYLE;\n    }\n    getStyleAttributeHash() {\n        return `s${fastHash(this.getStyle())}`;\n    }\n    getSelector() {\n        return this.selector;\n    }\n    getSelectorAST() {\n        return parseCssSelector(this.getSelector());\n    }\n    getExtendedSelector() {\n        return extractHTMLSelectorFromRule(this.selector);\n    }\n    isExtended() {\n        return getBit(this.mask, 128 /* COSMETICS_MASK.extended */);\n    }\n    isRemove() {\n        return getBit(this.mask, 64 /* COSMETICS_MASK.remove */);\n    }\n    isUnhide() {\n        return getBit(this.mask, 1 /* COSMETICS_MASK.unhide */);\n    }\n    isScriptInject() {\n        return getBit(this.mask, 2 /* COSMETICS_MASK.scriptInject */);\n    }\n    isCSS() {\n        return this.isScriptInject() === false;\n    }\n    isIdSelector() {\n        return getBit(this.mask, 16 /* COSMETICS_MASK.isIdSelector */);\n    }\n    isClassSelector() {\n        return getBit(this.mask, 8 /* COSMETICS_MASK.isClassSelector */);\n    }\n    isHrefSelector() {\n        return getBit(this.mask, 32 /* COSMETICS_MASK.isHrefSelector */);\n    }\n    isUnicode() {\n        return getBit(this.mask, 4 /* COSMETICS_MASK.isUnicode */);\n    }\n    isHtmlFiltering() {\n        return this.getSelector().startsWith('^');\n    }\n    // A generic hide cosmetic filter is one that:\n    //\n    // * Do not have a domain specified. \"Hide this element on all domains\"\n    // * Have only domain exceptions specified. \"Hide this element on all domains except example.com\"\n    //\n    // For example: ~example.com##.ad  is a generic filter as well!\n    isGenericHide() {\n        var _a, _b;\n        return ((_a = this === null || this === void 0 ? void 0 : this.domains) === null || _a === void 0 ? void 0 : _a.hostnames) === undefined && ((_b = this === null || this === void 0 ? void 0 : this.domains) === null || _b === void 0 ? void 0 : _b.entities) === undefined;\n    }\n}\n//# sourceMappingURL=cosmetic.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { Domains } from '../engine/domains.js';\nimport { sizeOfNetworkCSP, sizeOfNetworkFilter, sizeOfNetworkHostname, sizeOfNetworkRedirect, sizeOfUTF8, sizeOfRawNetwork, } from '../data-view.js';\nimport { toASCII } from '../punycode.js';\nimport { NORMALIZED_TYPE_TOKEN } from '../request.js';\nimport { TOKENS_BUFFER } from '../tokens-buffer.js';\nimport { bitCount, clearBit, fastHash, fastStartsWith, fastStartsWithFrom, getBit, hasUnicode, isAlpha, isDigit, setBit, tokenizeInPlace, tokenizeRegexInPlace, tokenizeWithWildcardsInPlace, HASH_SEED, HASH_INTERNAL_MULT, } from '../utils.js';\nconst HTTP_HASH = fastHash('http');\nconst HTTPS_HASH = fastHash('https');\nfunction isAllowedHostname(ch) {\n    return (isDigit(ch) || isAlpha(ch) || ch === 95 /* '_' */ || ch === 45 /* '-' */ || ch === 46 /* '.' */);\n}\nconst NORMALIZE_OPTIONS = {\n    'document': 'doc',\n    'first-party': '1p',\n    'generichide': 'ghide',\n    'object-subrequest': 'object',\n    'stylesheet': 'css',\n    'subdocument': 'frame',\n    'third-party': '3p',\n    'xmlhttprequest': 'xhr',\n    '~first-party': '3p',\n    '~third-party': '1p',\n    'all': '',\n};\n/**\n * Normalize a raw filter by replacing options with their canonical forms. For\n * example `||foo.com$stylesheet,first-party,xhr` would be normalized to\n * `||foo.com$css,1p,xhr`.\n */\nconst REGEX = /all|~third-party|~first-party|third-party|first-party|object-subrequest|stylesheet|subdocument|xmlhttprequest|document|generichide/g;\nexport function normalizeRawFilterOptions(rawFilter) {\n    rawFilter = rawFilter.toLowerCase();\n    let indexOfOptions = rawFilter.lastIndexOf('$');\n    if (indexOfOptions === -1) {\n        return rawFilter;\n    }\n    // Remove trailing '*' if possible\n    if (indexOfOptions !== 0 && rawFilter[indexOfOptions - 1] === '*') {\n        rawFilter = rawFilter.slice(0, indexOfOptions - 1) + rawFilter.slice(indexOfOptions);\n        indexOfOptions -= 1;\n    }\n    // Normalize options\n    const options = rawFilter.slice(indexOfOptions + 1);\n    const normalizedOptions = options\n        .replace(REGEX, (option) => {\n        const normalized = NORMALIZE_OPTIONS[option];\n        if (normalized === undefined) {\n            return option;\n        }\n        return normalized;\n    })\n        .split(',')\n        .sort()\n        .join(',');\n    if (options === normalizedOptions) {\n        return rawFilter;\n    }\n    if (normalizedOptions === '') {\n        return rawFilter.slice(0, indexOfOptions);\n    }\n    return `${rawFilter.slice(0, indexOfOptions)}$${normalizedOptions}`;\n}\n/**\n * Mask used when a network filter can be applied on any content type.\n */\nconst FROM_ANY = 1 /* NETWORK_FILTER_MASK.fromDocument */ |\n    2 /* NETWORK_FILTER_MASK.fromFont */ |\n    16 /* NETWORK_FILTER_MASK.fromImage */ |\n    32 /* NETWORK_FILTER_MASK.fromMedia */ |\n    64 /* NETWORK_FILTER_MASK.fromObject */ |\n    128 /* NETWORK_FILTER_MASK.fromOther */ |\n    256 /* NETWORK_FILTER_MASK.fromPing */ |\n    512 /* NETWORK_FILTER_MASK.fromScript */ |\n    1024 /* NETWORK_FILTER_MASK.fromStylesheet */ |\n    2048 /* NETWORK_FILTER_MASK.fromSubdocument */ |\n    4096 /* NETWORK_FILTER_MASK.fromWebsocket */ |\n    8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */;\n/**\n * Map content type value to mask the corresponding mask.\n * ref: https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy\n */\nconst REQUEST_TYPE_TO_MASK = {\n    beacon: 256 /* NETWORK_FILTER_MASK.fromPing */, // fromOther?\n    document: 1 /* NETWORK_FILTER_MASK.fromDocument */,\n    cspviolationreport: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    fetch: 8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */,\n    font: 2 /* NETWORK_FILTER_MASK.fromFont */,\n    image: 16 /* NETWORK_FILTER_MASK.fromImage */,\n    imageset: 16 /* NETWORK_FILTER_MASK.fromImage */,\n    mainFrame: 1 /* NETWORK_FILTER_MASK.fromDocument */,\n    main_frame: 1 /* NETWORK_FILTER_MASK.fromDocument */,\n    media: 32 /* NETWORK_FILTER_MASK.fromMedia */,\n    object: 64 /* NETWORK_FILTER_MASK.fromObject */,\n    object_subrequest: 64 /* NETWORK_FILTER_MASK.fromObject */,\n    ping: 256 /* NETWORK_FILTER_MASK.fromPing */, // fromOther?\n    script: 512 /* NETWORK_FILTER_MASK.fromScript */,\n    stylesheet: 1024 /* NETWORK_FILTER_MASK.fromStylesheet */,\n    subFrame: 2048 /* NETWORK_FILTER_MASK.fromSubdocument */,\n    sub_frame: 2048 /* NETWORK_FILTER_MASK.fromSubdocument */,\n    webSocket: 4096 /* NETWORK_FILTER_MASK.fromWebsocket */,\n    websocket: 4096 /* NETWORK_FILTER_MASK.fromWebsocket */,\n    xhr: 8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */,\n    xmlhttprequest: 8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */,\n    // Other\n    cspReport: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    csp_report: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    eventsource: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    manifest: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    other: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    prefetch: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    preflight: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    signedexchange: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    speculative: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    texttrack: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    web_manifest: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    xml_dtd: 128 /* NETWORK_FILTER_MASK.fromOther */,\n    xslt: 128 /* NETWORK_FILTER_MASK.fromOther */,\n};\nfunction getListOfRequestTypesNegated(filter) {\n    const types = [];\n    if (filter.fromDocument() === false) {\n        types.push('document');\n    }\n    if (filter.fromImage() === false) {\n        types.push('image');\n    }\n    if (filter.fromMedia() === false) {\n        types.push('media');\n    }\n    if (filter.fromObject() === false) {\n        types.push('object');\n    }\n    if (filter.fromOther() === false) {\n        types.push('other');\n    }\n    if (filter.fromPing() === false) {\n        types.push('ping');\n    }\n    if (filter.fromScript() === false) {\n        types.push('script');\n    }\n    if (filter.fromStylesheet() === false) {\n        types.push('stylesheet');\n    }\n    if (filter.fromSubdocument() === false) {\n        types.push('sub_frame');\n    }\n    if (filter.fromWebsocket() === false) {\n        types.push('websocket');\n    }\n    if (filter.fromXmlHttpRequest() === false) {\n        types.push('xhr');\n    }\n    if (filter.fromFont() === false) {\n        types.push('font');\n    }\n    return types;\n}\nfunction getListOfRequestTypes(filter) {\n    const types = [];\n    if (filter.fromDocument()) {\n        types.push('document');\n    }\n    if (filter.fromImage()) {\n        types.push('image');\n    }\n    if (filter.fromMedia()) {\n        types.push('media');\n    }\n    if (filter.fromObject()) {\n        types.push('object');\n    }\n    if (filter.fromOther()) {\n        types.push('other');\n    }\n    if (filter.fromPing()) {\n        types.push('ping');\n    }\n    if (filter.fromScript()) {\n        types.push('script');\n    }\n    if (filter.fromStylesheet()) {\n        types.push('stylesheet');\n    }\n    if (filter.fromSubdocument()) {\n        types.push('sub_frame');\n    }\n    if (filter.fromWebsocket()) {\n        types.push('websocket');\n    }\n    if (filter.fromXmlHttpRequest()) {\n        types.push('xhr');\n    }\n    if (filter.fromFont()) {\n        types.push('font');\n    }\n    return types;\n}\nfunction computeFilterId(csp, mask, filter, hostname, domains, denyallow, redirect) {\n    let hash = (HASH_SEED * HASH_INTERNAL_MULT) ^ mask;\n    if (csp !== undefined) {\n        for (let i = 0; i < csp.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ csp.charCodeAt(i);\n        }\n    }\n    if (domains !== undefined) {\n        hash = domains.updateId(hash);\n    }\n    if (denyallow !== undefined) {\n        hash = denyallow.updateId(hash);\n    }\n    if (filter !== undefined) {\n        for (let i = 0; i < filter.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ filter.charCodeAt(i);\n        }\n    }\n    if (hostname !== undefined) {\n        for (let i = 0; i < hostname.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ hostname.charCodeAt(i);\n        }\n    }\n    if (redirect !== undefined) {\n        for (let i = 0; i < redirect.length; i += 1) {\n            hash = (hash * HASH_INTERNAL_MULT) ^ redirect.charCodeAt(i);\n        }\n    }\n    return hash >>> 0;\n}\n/**\n * Compiles a filter pattern to a regex. This is only performed *lazily* for\n * filters containing at least a * or ^ symbol. Because Regexes are expansive,\n * we try to convert some patterns to plain filters.\n */\nfunction compileRegex(filter, isLeftAnchor, isRightAnchor, isFullRegex) {\n    if (isFullRegex === true) {\n        return new RegExp(filter.slice(1, filter.length - 1), 'i');\n    }\n    // Escape special regex characters: |.$+?{}()[]\\\n    filter = filter.replace(/([|.$+?{}()[\\]\\\\])/g, '\\\\$1');\n    // * can match anything\n    filter = filter.replace(/\\*/g, '.*');\n    // ^ can match any separator or the end of the pattern\n    filter = filter.replace(/\\^/g, '(?:[^\\\\w\\\\d_.%-]|$)');\n    // Should match end of url\n    if (isRightAnchor) {\n        filter = `${filter}$`;\n    }\n    if (isLeftAnchor) {\n        filter = `^${filter}`;\n    }\n    return new RegExp(filter);\n}\nexport function findLastIndexOfUnescapedCharacter(text, character) {\n    let lastIndex = text.lastIndexOf(character);\n    if (lastIndex === -1) {\n        return -1;\n    }\n    while (lastIndex > 0 && text.charCodeAt(lastIndex - 1) === 92 /* '\\\\' */) {\n        lastIndex = text.lastIndexOf(character, lastIndex - 1);\n    }\n    return lastIndex;\n}\nconst MATCH_ALL = new RegExp('');\nexport default class NetworkFilter {\n    static parse(line, debug = false) {\n        // Represent options as a bitmask\n        let mask = 32768 /* NETWORK_FILTER_MASK.thirdParty */ |\n            16384 /* NETWORK_FILTER_MASK.firstParty */ |\n            8 /* NETWORK_FILTER_MASK.fromHttps */ |\n            4 /* NETWORK_FILTER_MASK.fromHttp */;\n        // Temporary masks for positive (e.g.: $script) and negative (e.g.: $~script)\n        // content type options.\n        let cptMaskPositive = 0;\n        let cptMaskNegative = FROM_ANY;\n        let hostname;\n        let domains;\n        let denyallow;\n        let redirect;\n        let csp;\n        // Start parsing\n        let filterIndexStart = 0;\n        let filterIndexEnd = line.length;\n        // @@filter == Exception\n        if (line.charCodeAt(0) === 64 /* '@' */ && line.charCodeAt(1) === 64 /* '@' */) {\n            filterIndexStart += 2;\n            mask = setBit(mask, 134217728 /* NETWORK_FILTER_MASK.isException */);\n        }\n        // filter$options == Options\n        // ^     ^\n        // |     |\n        // |     optionsIndex\n        // filterIndexStart\n        const optionsIndex = findLastIndexOfUnescapedCharacter(line, '$');\n        if (optionsIndex !== -1 && line.charCodeAt(optionsIndex + 1) !== 47 /* '/' */) {\n            // Parse options and set flags\n            filterIndexEnd = optionsIndex;\n            // --------------------------------------------------------------------- //\n            // parseOptions\n            // --------------------------------------------------------------------- //\n            for (const rawOption of line.slice(optionsIndex + 1).split(',')) {\n                const negation = rawOption.charCodeAt(0) === 126; /* '~' */\n                let option = negation === true ? rawOption.slice(1) : rawOption;\n                // Check for options: option=value1|value2\n                let optionValue = '';\n                const indexOfEqual = option.indexOf('=');\n                if (indexOfEqual !== -1) {\n                    optionValue = option.slice(indexOfEqual + 1);\n                    option = option.slice(0, indexOfEqual);\n                }\n                switch (option) {\n                    case 'denyallow': {\n                        denyallow = Domains.parse(optionValue.split('|'), debug);\n                        break;\n                    }\n                    case 'domain':\n                    case 'from': {\n                        // domain list starting or ending with '|' is invalid\n                        if (optionValue.charCodeAt(0) === 124 /* '|' */ ||\n                            optionValue.charCodeAt(optionValue.length - 1) === 124 /* '|' */) {\n                            return null;\n                        }\n                        domains = Domains.parse(optionValue.split('|'), debug);\n                        break;\n                    }\n                    case 'badfilter':\n                        mask = setBit(mask, 131072 /* NETWORK_FILTER_MASK.isBadFilter */);\n                        break;\n                    case 'important':\n                        // Note: `negation` should always be `false` here.\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 1048576 /* NETWORK_FILTER_MASK.isImportant */);\n                        break;\n                    case 'match-case':\n                        // Note: `negation` should always be `false` here.\n                        if (negation) {\n                            return null;\n                        }\n                        // We currently consider all filters to be case-insensitive.\n                        break;\n                    case '3p':\n                    case 'third-party':\n                        if (negation) {\n                            // ~third-party means we should clear the flag\n                            mask = clearBit(mask, 32768 /* NETWORK_FILTER_MASK.thirdParty */);\n                        }\n                        else {\n                            // third-party means ~first-party\n                            mask = clearBit(mask, 16384 /* NETWORK_FILTER_MASK.firstParty */);\n                        }\n                        break;\n                    case '1p':\n                    case 'first-party':\n                        if (negation) {\n                            // ~first-party means we should clear the flag\n                            mask = clearBit(mask, 16384 /* NETWORK_FILTER_MASK.firstParty */);\n                        }\n                        else {\n                            // first-party means ~third-party\n                            mask = clearBit(mask, 32768 /* NETWORK_FILTER_MASK.thirdParty */);\n                        }\n                        break;\n                    case 'redirect-rule':\n                    case 'redirect':\n                        // Negation of redirection doesn't make sense\n                        if (negation) {\n                            return null;\n                        }\n                        // Ignore this filter if no redirection resource is specified\n                        if (optionValue.length === 0) {\n                            return null;\n                        }\n                        if (option === 'redirect-rule') {\n                            mask = setBit(mask, 536870912 /* NETWORK_FILTER_MASK.isRedirectRule */);\n                        }\n                        redirect = optionValue;\n                        break;\n                    case 'csp':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 262144 /* NETWORK_FILTER_MASK.isCSP */);\n                        if (optionValue.length > 0) {\n                            csp = optionValue;\n                        }\n                        break;\n                    case 'ehide':\n                    case 'elemhide':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 524288 /* NETWORK_FILTER_MASK.isGenericHide */);\n                        mask = setBit(mask, 2097152 /* NETWORK_FILTER_MASK.isSpecificHide */);\n                        break;\n                    case 'shide':\n                    case 'specifichide':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 2097152 /* NETWORK_FILTER_MASK.isSpecificHide */);\n                        break;\n                    case 'ghide':\n                    case 'generichide':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 524288 /* NETWORK_FILTER_MASK.isGenericHide */);\n                        break;\n                    case 'inline-script':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 262144 /* NETWORK_FILTER_MASK.isCSP */);\n                        csp =\n                            \"script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:\";\n                        break;\n                    case 'inline-font':\n                        if (negation) {\n                            return null;\n                        }\n                        mask = setBit(mask, 262144 /* NETWORK_FILTER_MASK.isCSP */);\n                        csp =\n                            \"font-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:\";\n                        break;\n                    default: {\n                        // Handle content type options separatly\n                        let optionMask = 0;\n                        switch (option) {\n                            case 'all':\n                                if (negation) {\n                                    return null;\n                                }\n                                // NOTE: Currently a filter cannot be both blocking and CSP, so\n                                // we will have to create multiple filters to keep the semantics\n                                // of 'all'.\n                                // mask = setBit(mask, NETWORK_FILTER_MASK.isCSP);\n                                // csp = [\n                                //   \"script-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:\",\n                                //   \"font-src 'self' 'unsafe-eval' http: https: data: blob: mediastream: filesystem:\",\n                                // ].join('; ');\n                                break;\n                            case 'image':\n                                optionMask = 16 /* NETWORK_FILTER_MASK.fromImage */;\n                                break;\n                            case 'media':\n                                optionMask = 32 /* NETWORK_FILTER_MASK.fromMedia */;\n                                break;\n                            case 'object':\n                            case 'object-subrequest':\n                                optionMask = 64 /* NETWORK_FILTER_MASK.fromObject */;\n                                break;\n                            case 'other':\n                                optionMask = 128 /* NETWORK_FILTER_MASK.fromOther */;\n                                break;\n                            case 'ping':\n                            case 'beacon':\n                                optionMask = 256 /* NETWORK_FILTER_MASK.fromPing */;\n                                break;\n                            case 'script':\n                                optionMask = 512 /* NETWORK_FILTER_MASK.fromScript */;\n                                break;\n                            case 'css':\n                            case 'stylesheet':\n                                optionMask = 1024 /* NETWORK_FILTER_MASK.fromStylesheet */;\n                                break;\n                            case 'frame':\n                            case 'subdocument':\n                                optionMask = 2048 /* NETWORK_FILTER_MASK.fromSubdocument */;\n                                break;\n                            case 'xhr':\n                            case 'xmlhttprequest':\n                                optionMask = 8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */;\n                                break;\n                            case 'websocket':\n                                optionMask = 4096 /* NETWORK_FILTER_MASK.fromWebsocket */;\n                                break;\n                            case 'font':\n                                optionMask = 2 /* NETWORK_FILTER_MASK.fromFont */;\n                                break;\n                            case 'doc':\n                            case 'document':\n                                optionMask = 1 /* NETWORK_FILTER_MASK.fromDocument */;\n                                break;\n                            default:\n                                // Disable this filter if we don't support all the options\n                                return null;\n                        }\n                        // We got a valid cpt option, update mask\n                        if (negation) {\n                            cptMaskNegative = clearBit(cptMaskNegative, optionMask);\n                        }\n                        else {\n                            cptMaskPositive = setBit(cptMaskPositive, optionMask);\n                        }\n                        break;\n                    }\n                }\n            }\n            // End of option parsing\n            // --------------------------------------------------------------------- //\n        }\n        if (cptMaskPositive === 0) {\n            mask |= cptMaskNegative;\n        }\n        else if (cptMaskNegative === FROM_ANY) {\n            mask |= cptMaskPositive;\n        }\n        else {\n            mask |= cptMaskPositive & cptMaskNegative;\n        }\n        // Identify kind of pattern\n        let filter;\n        // Detect Regexps (i.e.: /pattern/)\n        if (filterIndexEnd - filterIndexStart >= 2 &&\n            line.charCodeAt(filterIndexStart) === 47 /* '/' */ &&\n            line.charCodeAt(filterIndexEnd - 1) === 47 /* '/' */) {\n            // Some extra ideas which could be applied to RegExp filters:\n            // * convert rules without any special RegExp syntax to plain patterns\n            // * remove extra `isFullRegex` flag since `isRegex` might be enough\n            // * apply some optimizations on the fly: /^https?:\\\\/\\\\/rest => isHttp + isHttps + rest\n            filter = line.slice(filterIndexStart, filterIndexEnd);\n            // Validate RegExp to make sure this rule is fine\n            try {\n                compileRegex(filter, false /* isLeftAnchor */, false /* isRightAnchor */, true /* isFullRegex */);\n            }\n            catch (ex) {\n                return null; // invalid RegExp\n            }\n            mask = setBit(mask, 4194304 /* NETWORK_FILTER_MASK.isFullRegex */);\n        }\n        else {\n            // Deal with hostname pattern\n            if (filterIndexEnd > 0 && line.charCodeAt(filterIndexEnd - 1) === 124 /* '|' */) {\n                mask = setBit(mask, 67108864 /* NETWORK_FILTER_MASK.isRightAnchor */);\n                filterIndexEnd -= 1;\n            }\n            if (filterIndexStart < filterIndexEnd &&\n                line.charCodeAt(filterIndexStart) === 124 /* '|' */) {\n                if (filterIndexStart < filterIndexEnd - 1 &&\n                    line.charCodeAt(filterIndexStart + 1) === 124 /* '|' */) {\n                    mask = setBit(mask, 268435456 /* NETWORK_FILTER_MASK.isHostnameAnchor */);\n                    filterIndexStart += 2;\n                }\n                else {\n                    mask = setBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    filterIndexStart += 1;\n                }\n            }\n            // const isRegex = checkIsRegex(line, filterIndexStart, filterIndexEnd);\n            // mask = setNetworkMask(mask, NETWORK_FILTER_MASK.isRegex, isRegex);\n            if (getBit(mask, 268435456 /* NETWORK_FILTER_MASK.isHostnameAnchor */)) {\n                // Split at the first character which is not allowed in a hostname\n                let firstSeparator = filterIndexStart;\n                while (firstSeparator < filterIndexEnd &&\n                    isAllowedHostname(line.charCodeAt(firstSeparator)) === true) {\n                    firstSeparator += 1;\n                }\n                // No separator found so hostname has full length\n                if (firstSeparator === filterIndexEnd) {\n                    hostname = line.slice(filterIndexStart, filterIndexEnd);\n                    filterIndexStart = filterIndexEnd;\n                    // mask = setBit(mask, NETWORK_FILTER_MASK.isLeftAnchor);\n                }\n                else {\n                    // Found a separator\n                    hostname = line.slice(filterIndexStart, firstSeparator);\n                    filterIndexStart = firstSeparator;\n                    const separatorCode = line.charCodeAt(firstSeparator);\n                    if (separatorCode === 94 /* '^' */) {\n                        // If the only symbol remaining for the selector is '^' then ignore it\n                        // but set the filter as right anchored since there should not be any\n                        // other label on the right\n                        if (filterIndexEnd - filterIndexStart === 1) {\n                            filterIndexStart = filterIndexEnd;\n                            mask = setBit(mask, 67108864 /* NETWORK_FILTER_MASK.isRightAnchor */);\n                        }\n                        else {\n                            mask = setBit(mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */);\n                            mask = setBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                        }\n                    }\n                    else if (separatorCode === 42 /* '*' */) {\n                        mask = setBit(mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */);\n                        // mask = setBit(mask, NETWORK_FILTER_MASK.isLeftAnchor);\n                    }\n                    else {\n                        mask = setBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    }\n                }\n            }\n            // Remove trailing '*'\n            if (filterIndexEnd - filterIndexStart > 0 &&\n                line.charCodeAt(filterIndexEnd - 1) === 42 /* '*' */) {\n                filterIndexEnd -= 1;\n            }\n            // Remove leading '*' if the filter is not hostname anchored.\n            if (getBit(mask, 268435456 /* NETWORK_FILTER_MASK.isHostnameAnchor */) === false &&\n                filterIndexEnd - filterIndexStart > 0 &&\n                line.charCodeAt(filterIndexStart) === 42 /* '*' */) {\n                mask = clearBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                filterIndexStart += 1;\n            }\n            // Transform filters on protocol (http, https, ws)\n            if (getBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */)) {\n                if (filterIndexEnd - filterIndexStart === 5 &&\n                    fastStartsWithFrom(line, 'ws://', filterIndexStart)) {\n                    mask = setBit(mask, 4096 /* NETWORK_FILTER_MASK.fromWebsocket */);\n                    mask = clearBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    mask = clearBit(mask, 4 /* NETWORK_FILTER_MASK.fromHttp */);\n                    mask = clearBit(mask, 8 /* NETWORK_FILTER_MASK.fromHttps */);\n                    filterIndexStart = filterIndexEnd;\n                }\n                else if (filterIndexEnd - filterIndexStart === 7 &&\n                    fastStartsWithFrom(line, 'http://', filterIndexStart)) {\n                    mask = setBit(mask, 4 /* NETWORK_FILTER_MASK.fromHttp */);\n                    mask = clearBit(mask, 8 /* NETWORK_FILTER_MASK.fromHttps */);\n                    mask = clearBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    filterIndexStart = filterIndexEnd;\n                }\n                else if (filterIndexEnd - filterIndexStart === 8 &&\n                    fastStartsWithFrom(line, 'https://', filterIndexStart)) {\n                    mask = setBit(mask, 8 /* NETWORK_FILTER_MASK.fromHttps */);\n                    mask = clearBit(mask, 4 /* NETWORK_FILTER_MASK.fromHttp */);\n                    mask = clearBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    filterIndexStart = filterIndexEnd;\n                }\n                else if (filterIndexEnd - filterIndexStart === 8 &&\n                    fastStartsWithFrom(line, 'http*://', filterIndexStart)) {\n                    mask = setBit(mask, 8 /* NETWORK_FILTER_MASK.fromHttps */);\n                    mask = setBit(mask, 4 /* NETWORK_FILTER_MASK.fromHttp */);\n                    mask = clearBit(mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n                    filterIndexStart = filterIndexEnd;\n                }\n            }\n            if (filterIndexEnd - filterIndexStart > 0) {\n                filter = line.slice(filterIndexStart, filterIndexEnd).toLowerCase();\n                mask = setNetworkMask(mask, 16777216 /* NETWORK_FILTER_MASK.isUnicode */, hasUnicode(filter));\n                if (getBit(mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */) === false) {\n                    mask = setNetworkMask(mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */, checkIsRegex(filter, 0, filter.length));\n                }\n            }\n            // TODO\n            // - ignore hostname anchor is not hostname provided\n            if (hostname !== undefined) {\n                hostname = hostname.toLowerCase();\n                if (hasUnicode(hostname)) {\n                    mask = setNetworkMask(mask, 16777216 /* NETWORK_FILTER_MASK.isUnicode */, true);\n                    hostname = toASCII(hostname);\n                }\n            }\n        }\n        return new NetworkFilter({\n            csp,\n            filter,\n            hostname,\n            mask,\n            domains,\n            denyallow,\n            rawLine: debug === true ? line : undefined,\n            redirect,\n            regex: undefined,\n        });\n    }\n    /**\n     * Deserialize network filters. The code accessing the buffer should be\n     * symetrical to the one in `serializeNetworkFilter`.\n     */\n    static deserialize(buffer) {\n        const mask = buffer.getUint32();\n        const optionalParts = buffer.getUint8();\n        const isUnicode = getBit(mask, 16777216 /* NETWORK_FILTER_MASK.isUnicode */);\n        // The order of these statements is important. Since `buffer.getX()` will\n        // internally increment the position of next byte to read, they need to be\n        // retrieved in the exact same order they were serialized (check\n        // `serializeNetworkFilter`).\n        return new NetworkFilter({\n            // Mandatory field\n            mask,\n            // Optional parts\n            csp: (optionalParts & 1) === 1 ? buffer.getNetworkCSP() : undefined,\n            filter: (optionalParts & 2) === 2\n                ? isUnicode\n                    ? buffer.getUTF8()\n                    : buffer.getNetworkFilter()\n                : undefined,\n            hostname: (optionalParts & 4) === 4 ? buffer.getNetworkHostname() : undefined,\n            domains: (optionalParts & 8) === 8 ? Domains.deserialize(buffer) : undefined,\n            rawLine: (optionalParts & 16) === 16 ? buffer.getRawNetwork() : undefined,\n            redirect: (optionalParts & 32) === 32 ? buffer.getNetworkRedirect() : undefined,\n            denyallow: (optionalParts & 64) === 64 ? Domains.deserialize(buffer) : undefined,\n            regex: undefined,\n        });\n    }\n    constructor({ csp, filter, hostname, mask, domains, denyallow, rawLine, redirect, regex, }) {\n        this.csp = csp;\n        this.filter = filter;\n        this.hostname = hostname;\n        this.mask = mask;\n        this.domains = domains;\n        this.denyallow = denyallow;\n        this.redirect = redirect;\n        this.rawLine = rawLine;\n        this.id = undefined;\n        this.regex = regex;\n    }\n    isCosmeticFilter() {\n        return false;\n    }\n    isNetworkFilter() {\n        return true;\n    }\n    match(request) {\n        return checkOptions(this, request) && checkPattern(this, request);\n    }\n    /**\n     * To allow for a more compact representation of network filters, the\n     * representation is composed of a mandatory header, and some optional\n     *\n     * Header:\n     * =======\n     *\n     *  | opt | mask\n     *     8     32\n     *\n     * For an empty filter having no pattern, hostname, the minimum size is: 42 bits.\n     *\n     * Then for each optional part (filter, hostname optDomains, optNotDomains,\n     * redirect), it takes 16 bits for the length of the string + the length of the\n     * string in bytes.\n     *\n     * The optional parts are written in order of there number of occurrence in the\n     * filter list used by the adblocker. The most common being `hostname`, then\n     * `filter`, `optDomains`, `optNotDomains`, `redirect`.\n     *\n     * Example:\n     * ========\n     *\n     * @@||cliqz.com would result in a serialized version:\n     *\n     * | 1 | mask | 9 | c | l | i | q | z | . | c | o | m  (16 bytes)\n     *\n     * In this case, the serialized version is actually bigger than the original\n     * filter, but faster to deserialize. In the future, we could optimize the\n     * representation to compact small filters better.\n     *\n     * Ideas:\n     *  * variable length encoding for the mask (if not option, take max 1 byte).\n     *  * first byte could contain the mask as well if small enough.\n     *  * when packing ascii string, store several of them in each byte.\n     */\n    serialize(buffer) {\n        buffer.pushUint32(this.mask);\n        const index = buffer.getPos();\n        buffer.pushUint8(0);\n        // This bit-mask indicates which optional parts of the filter were serialized.\n        let optionalParts = 0;\n        if (this.csp !== undefined) {\n            optionalParts |= 1;\n            buffer.pushNetworkCSP(this.csp);\n        }\n        if (this.filter !== undefined) {\n            optionalParts |= 2;\n            if (this.isUnicode()) {\n                buffer.pushUTF8(this.filter);\n            }\n            else {\n                buffer.pushNetworkFilter(this.filter);\n            }\n        }\n        if (this.hostname !== undefined) {\n            optionalParts |= 4;\n            buffer.pushNetworkHostname(this.hostname);\n        }\n        if (this.domains !== undefined) {\n            optionalParts |= 8;\n            this.domains.serialize(buffer);\n        }\n        if (this.rawLine !== undefined) {\n            optionalParts |= 16;\n            buffer.pushRawNetwork(this.rawLine);\n        }\n        if (this.redirect !== undefined) {\n            optionalParts |= 32;\n            buffer.pushNetworkRedirect(this.redirect);\n        }\n        if (this.denyallow !== undefined) {\n            optionalParts |= 64;\n            this.denyallow.serialize(buffer);\n        }\n        buffer.setByte(index, optionalParts);\n    }\n    getSerializedSize(compression) {\n        let estimate = 4 + 1; // mask = 4 bytes // optional parts = 1 byte\n        if (this.csp !== undefined) {\n            estimate += sizeOfNetworkCSP(this.csp, compression);\n        }\n        if (this.filter !== undefined) {\n            if (this.isUnicode() === true) {\n                estimate += sizeOfUTF8(this.filter);\n            }\n            else {\n                estimate += sizeOfNetworkFilter(this.filter, compression);\n            }\n        }\n        if (this.hostname !== undefined) {\n            estimate += sizeOfNetworkHostname(this.hostname, compression);\n        }\n        if (this.domains !== undefined) {\n            estimate += this.domains.getSerializedSize();\n        }\n        if (this.rawLine !== undefined) {\n            estimate += sizeOfRawNetwork(this.rawLine, compression);\n        }\n        if (this.redirect !== undefined) {\n            estimate += sizeOfNetworkRedirect(this.redirect, compression);\n        }\n        if (this.denyallow !== undefined) {\n            estimate += this.denyallow.getSerializedSize();\n        }\n        return estimate;\n    }\n    /**\n     * Tries to recreate the original representation of the filter (adblock\n     * syntax) from the internal representation. If `rawLine` is set (when filters\n     * are parsed in `debug` mode for example), then it is returned directly.\n     * Otherwise, we try to stick as closely as possible to the original form;\n     * there are things which cannot be recovered though, like domains options\n     * of which only hashes are stored.\n     */\n    toString(modifierReplacer) {\n        if (this.rawLine !== undefined) {\n            return this.rawLine;\n        }\n        let filter = '';\n        if (this.isException()) {\n            filter += '@@';\n        }\n        if (this.isHostnameAnchor()) {\n            filter += '||';\n        }\n        else if (this.fromHttp() !== this.fromHttps()) {\n            if (this.fromHttp()) {\n                filter += '|http://';\n            }\n            else {\n                filter += '|https://';\n            }\n        }\n        else if (this.isLeftAnchor()) {\n            filter += '|';\n        }\n        if (this.hasHostname()) {\n            filter += this.getHostname();\n            filter += '^';\n        }\n        if (this.isFullRegex()) {\n            filter += `/${this.getRegex().source}/`;\n        }\n        else if (this.isRegex()) {\n            filter += this.getRegex().source;\n        }\n        else {\n            filter += this.getFilter();\n        }\n        if (this.isRightAnchor() && filter[filter.length - 1] !== '^') {\n            filter += '|';\n        }\n        // Options\n        const options = [];\n        if (this.fromAny() === false) {\n            const numberOfCptOptions = bitCount(this.getCptMask());\n            const numberOfNegatedOptions = bitCount(FROM_ANY) - numberOfCptOptions;\n            if (numberOfNegatedOptions < numberOfCptOptions) {\n                for (const type of getListOfRequestTypesNegated(this)) {\n                    options.push(`~${type}`);\n                }\n            }\n            else {\n                for (const type of getListOfRequestTypes(this)) {\n                    options.push(type);\n                }\n            }\n        }\n        if (this.isImportant()) {\n            options.push('important');\n        }\n        if (this.isRedirectRule()) {\n            options.push(`redirect-rule=${this.getRedirect()}`);\n        }\n        else if (this.isRedirect()) {\n            options.push(`redirect=${this.getRedirect()}`);\n        }\n        if (this.isCSP()) {\n            options.push(`csp=${this.csp}`);\n        }\n        if (this.isElemHide()) {\n            options.push('elemhide');\n        }\n        if (this.isSpecificHide()) {\n            options.push('specifichide');\n        }\n        if (this.isGenericHide()) {\n            options.push('generichide');\n        }\n        if (this.firstParty() !== this.thirdParty()) {\n            if (this.firstParty()) {\n                options.push('1p');\n            }\n            if (this.thirdParty()) {\n                options.push('3p');\n            }\n        }\n        if (this.domains !== undefined) {\n            if (this.domains.parts !== undefined) {\n                options.push(`domain=${this.domains.parts}`);\n            }\n            else {\n                options.push('domain=<hashed>');\n            }\n        }\n        if (this.denyallow !== undefined) {\n            if (this.denyallow.parts !== undefined) {\n                options.push(`denyallow=${this.denyallow.parts}`);\n            }\n            else {\n                options.push('denyallow=<hashed>');\n            }\n        }\n        if (this.isBadFilter()) {\n            options.push('badfilter');\n        }\n        if (options.length > 0) {\n            if (typeof modifierReplacer === 'function') {\n                filter += `$${options.map(modifierReplacer).join(',')}`;\n            }\n            else {\n                filter += `$${options.join(',')}`;\n            }\n        }\n        return filter;\n    }\n    // Public API (Read-Only)\n    getIdWithoutBadFilter() {\n        // This method computes the id ignoring the $badfilter option (which will\n        // correspond to the ID of filters being discarded). This allows us to\n        // eliminate bad filters by comparing IDs, which is more robust and faster\n        // than string comparison.\n        return computeFilterId(this.csp, this.mask & ~131072 /* NETWORK_FILTER_MASK.isBadFilter */, this.filter, this.hostname, this.domains, this.denyallow, this.redirect);\n    }\n    getId() {\n        if (this.id === undefined) {\n            this.id = computeFilterId(this.csp, this.mask, this.filter, this.hostname, this.domains, this.denyallow, this.redirect);\n        }\n        return this.id;\n    }\n    hasFilter() {\n        return this.filter !== undefined;\n    }\n    hasDomains() {\n        return this.domains !== undefined;\n    }\n    getMask() {\n        return this.mask;\n    }\n    getCptMask() {\n        return this.getMask() & FROM_ANY;\n    }\n    isRedirect() {\n        return this.redirect !== undefined;\n    }\n    isRedirectRule() {\n        return getBit(this.mask, 536870912 /* NETWORK_FILTER_MASK.isRedirectRule */);\n    }\n    getRedirect() {\n        return this.redirect || '';\n    }\n    hasHostname() {\n        return this.hostname !== undefined;\n    }\n    getHostname() {\n        return this.hostname || '';\n    }\n    getFilter() {\n        return this.filter || '';\n    }\n    getRegex() {\n        if (this.regex === undefined) {\n            this.regex =\n                this.filter !== undefined && this.isRegex()\n                    ? compileRegex(this.filter, this.isLeftAnchor(), this.isRightAnchor(), this.isFullRegex())\n                    : MATCH_ALL;\n        }\n        return this.regex;\n    }\n    getTokens() {\n        TOKENS_BUFFER.reset();\n        // If there is only one domain and no domain negation, we also use this\n        // domain as a token.\n        if (this.domains !== undefined &&\n            this.domains.hostnames !== undefined &&\n            this.domains.entities === undefined &&\n            this.domains.notHostnames === undefined &&\n            this.domains.notEntities === undefined &&\n            this.domains.hostnames.length === 1) {\n            TOKENS_BUFFER.push(this.domains.hostnames[0]);\n        }\n        // Get tokens from filter\n        if (this.isFullRegex() === false) {\n            if (this.filter !== undefined) {\n                const skipLastToken = !this.isRightAnchor();\n                const skipFirstToken = !this.isLeftAnchor();\n                tokenizeWithWildcardsInPlace(this.filter, skipFirstToken, skipLastToken, TOKENS_BUFFER);\n            }\n            // Append tokens from hostname, if any\n            if (this.hostname !== undefined) {\n                tokenizeInPlace(this.hostname, false, this.filter !== undefined && this.filter.charCodeAt(0) === 42 /* '*' */, TOKENS_BUFFER);\n            }\n        }\n        else if (this.filter !== undefined) {\n            tokenizeRegexInPlace(this.filter, TOKENS_BUFFER);\n        }\n        // If we got no tokens for the filter/hostname part, then we will dispatch\n        // this filter in multiple buckets based on the domains option.\n        if (TOKENS_BUFFER.empty() === true &&\n            this.domains !== undefined &&\n            this.domains.hostnames !== undefined &&\n            this.domains.entities === undefined &&\n            this.domains.notHostnames === undefined &&\n            this.domains.notEntities === undefined) {\n            const result = [];\n            for (const hostname of this.domains.hostnames) {\n                const arr = new Uint32Array(1);\n                arr[0] = hostname;\n                result.push(arr);\n            }\n            return result;\n        }\n        // Add optional token for types\n        if (TOKENS_BUFFER.empty() === true && this.fromAny() === false) {\n            const types = getListOfRequestTypes(this);\n            if (types.length !== 0) {\n                const result = [];\n                for (const type of types) {\n                    const arr = new Uint32Array(1);\n                    arr[0] = NORMALIZED_TYPE_TOKEN[type];\n                    result.push(arr);\n                }\n                return result;\n            }\n        }\n        // Add optional token for protocol\n        if (this.fromHttp() === true && this.fromHttps() === false) {\n            TOKENS_BUFFER.push(HTTP_HASH);\n        }\n        else if (this.fromHttps() === true && this.fromHttp() === false) {\n            TOKENS_BUFFER.push(HTTPS_HASH);\n        }\n        return [TOKENS_BUFFER.slice()];\n    }\n    /**\n     * Check if this filter should apply to a request with this content type.\n     */\n    isCptAllowed(cpt) {\n        const mask = REQUEST_TYPE_TO_MASK[cpt];\n        if (mask !== undefined) {\n            return getBit(this.mask, mask);\n        }\n        // If content type is not supported (or not specified), we return `true`\n        // only if the filter does not specify any resource type.\n        return this.fromAny();\n    }\n    isException() {\n        return getBit(this.mask, 134217728 /* NETWORK_FILTER_MASK.isException */);\n    }\n    isHostnameAnchor() {\n        return getBit(this.mask, 268435456 /* NETWORK_FILTER_MASK.isHostnameAnchor */);\n    }\n    isRightAnchor() {\n        return getBit(this.mask, 67108864 /* NETWORK_FILTER_MASK.isRightAnchor */);\n    }\n    isLeftAnchor() {\n        return getBit(this.mask, 33554432 /* NETWORK_FILTER_MASK.isLeftAnchor */);\n    }\n    isImportant() {\n        return getBit(this.mask, 1048576 /* NETWORK_FILTER_MASK.isImportant */);\n    }\n    isFullRegex() {\n        return getBit(this.mask, 4194304 /* NETWORK_FILTER_MASK.isFullRegex */);\n    }\n    isRegex() {\n        return (getBit(this.mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */) ||\n            getBit(this.mask, 4194304 /* NETWORK_FILTER_MASK.isFullRegex */));\n    }\n    isPlain() {\n        return !this.isRegex();\n    }\n    isCSP() {\n        return getBit(this.mask, 262144 /* NETWORK_FILTER_MASK.isCSP */);\n    }\n    isElemHide() {\n        return this.isSpecificHide() && this.isGenericHide();\n    }\n    isSpecificHide() {\n        return getBit(this.mask, 2097152 /* NETWORK_FILTER_MASK.isSpecificHide */);\n    }\n    isGenericHide() {\n        return getBit(this.mask, 524288 /* NETWORK_FILTER_MASK.isGenericHide */);\n    }\n    isBadFilter() {\n        return getBit(this.mask, 131072 /* NETWORK_FILTER_MASK.isBadFilter */);\n    }\n    isUnicode() {\n        return getBit(this.mask, 16777216 /* NETWORK_FILTER_MASK.isUnicode */);\n    }\n    fromAny() {\n        return this.getCptMask() === FROM_ANY;\n    }\n    thirdParty() {\n        return getBit(this.mask, 32768 /* NETWORK_FILTER_MASK.thirdParty */);\n    }\n    firstParty() {\n        return getBit(this.mask, 16384 /* NETWORK_FILTER_MASK.firstParty */);\n    }\n    fromImage() {\n        return getBit(this.mask, 16 /* NETWORK_FILTER_MASK.fromImage */);\n    }\n    fromMedia() {\n        return getBit(this.mask, 32 /* NETWORK_FILTER_MASK.fromMedia */);\n    }\n    fromObject() {\n        return getBit(this.mask, 64 /* NETWORK_FILTER_MASK.fromObject */);\n    }\n    fromOther() {\n        return getBit(this.mask, 128 /* NETWORK_FILTER_MASK.fromOther */);\n    }\n    fromPing() {\n        return getBit(this.mask, 256 /* NETWORK_FILTER_MASK.fromPing */);\n    }\n    fromScript() {\n        return getBit(this.mask, 512 /* NETWORK_FILTER_MASK.fromScript */);\n    }\n    fromStylesheet() {\n        return getBit(this.mask, 1024 /* NETWORK_FILTER_MASK.fromStylesheet */);\n    }\n    fromDocument() {\n        return getBit(this.mask, 1 /* NETWORK_FILTER_MASK.fromDocument */);\n    }\n    fromSubdocument() {\n        return getBit(this.mask, 2048 /* NETWORK_FILTER_MASK.fromSubdocument */);\n    }\n    fromWebsocket() {\n        return getBit(this.mask, 4096 /* NETWORK_FILTER_MASK.fromWebsocket */);\n    }\n    fromHttp() {\n        return getBit(this.mask, 4 /* NETWORK_FILTER_MASK.fromHttp */);\n    }\n    fromHttps() {\n        return getBit(this.mask, 8 /* NETWORK_FILTER_MASK.fromHttps */);\n    }\n    fromXmlHttpRequest() {\n        return getBit(this.mask, 8192 /* NETWORK_FILTER_MASK.fromXmlHttpRequest */);\n    }\n    fromFont() {\n        return getBit(this.mask, 2 /* NETWORK_FILTER_MASK.fromFont */);\n    }\n}\n// ---------------------------------------------------------------------------\n// Filter parsing\n// ---------------------------------------------------------------------------\nfunction setNetworkMask(mask, m, value) {\n    if (value === true) {\n        return setBit(mask, m);\n    }\n    return clearBit(mask, m);\n}\n/**\n * Check if the sub-string contained between the indices start and end is a\n * regex filter (it contains a '*' or '^' char).\n */\nfunction checkIsRegex(filter, start, end) {\n    const indexOfSeparator = filter.indexOf('^', start);\n    if (indexOfSeparator !== -1 && indexOfSeparator < end) {\n        return true;\n    }\n    const indexOfWildcard = filter.indexOf('*', start);\n    return indexOfWildcard !== -1 && indexOfWildcard < end;\n}\n/**\n * Handle hostname anchored filters, given 'hostname' from ||hostname and\n * request's hostname, check if there is a match. This is tricky because\n * filters authors rely and different assumptions. We can have prefix of suffix\n * matches of anchor.\n */\nexport function isAnchoredByHostname(filterHostname, hostname, isFollowedByWildcard) {\n    // Corner-case, if `filterHostname` is empty, then it's a match\n    if (filterHostname.length === 0) {\n        return true;\n    }\n    // `filterHostname` cannot be longer than actual hostname\n    if (filterHostname.length > hostname.length) {\n        return false;\n    }\n    // If they have the same length, they should be equal\n    if (filterHostname.length === hostname.length) {\n        return filterHostname === hostname;\n    }\n    // Check if `filterHostname` appears anywhere in `hostname`\n    const matchIndex = hostname.indexOf(filterHostname);\n    // No match\n    if (matchIndex === -1) {\n        return false;\n    }\n    // `filterHostname` is a prefix of `hostname` and needs to match full a label.\n    //\n    // Examples (filterHostname, hostname):\n    //   * (foo, foo.com)\n    //   * (sub.foo, sub.foo.com)\n    if (matchIndex === 0) {\n        return (isFollowedByWildcard === true ||\n            hostname.charCodeAt(filterHostname.length) === 46 /* '.' */ ||\n            filterHostname.charCodeAt(filterHostname.length - 1) === 46 /* '.' */);\n    }\n    // `filterHostname` is a suffix of `hostname`.\n    //\n    // Examples (filterHostname, hostname):\n    //    * (foo.com, sub.foo.com)\n    //    * (com, foo.com)\n    if (hostname.length === matchIndex + filterHostname.length) {\n        return (hostname.charCodeAt(matchIndex - 1) === 46 /* '.' */ ||\n            filterHostname.charCodeAt(0) === 46 /* '.' */);\n    }\n    // `filterHostname` is infix of `hostname` and needs match full labels\n    return ((isFollowedByWildcard === true ||\n        hostname.charCodeAt(filterHostname.length) === 46 /* '.' */ ||\n        filterHostname.charCodeAt(filterHostname.length - 1) === 46) /* '.' */ &&\n        (hostname.charCodeAt(matchIndex - 1) === 46 || filterHostname.charCodeAt(0) === 46));\n}\n/**\n * Specialize a network filter depending on its type. It allows for more\n * efficient matching function.\n */\nfunction checkPattern(filter, request) {\n    const pattern = filter.getFilter();\n    if (filter.isHostnameAnchor() === true) {\n        // Make sure request is anchored by hostname before proceeding to matching\n        const filterHostname = filter.getHostname();\n        if (isAnchoredByHostname(filterHostname, request.hostname, filter.filter !== undefined && filter.filter.charCodeAt(0) === 42 /* '*' */) === false) {\n            return false;\n        }\n        // At this point we know request is hostname anchored so we match the rest of the filter.\n        if (filter.isRegex()) {\n            // ||pattern*^\n            return filter\n                .getRegex()\n                .test(request.url.slice(request.url.indexOf(filterHostname) + filterHostname.length));\n        }\n        else if (filter.isRightAnchor() && filter.isLeftAnchor()) {\n            // |||pattern|\n            // Since this is not a regex, the filter pattern must follow the hostname\n            // with nothing in between. So we extract the part of the URL following\n            // after hostname and will perform the matching on it.\n            const urlAfterHostname = request.url.slice(request.url.indexOf(filterHostname) + filterHostname.length);\n            // Since it must follow immediatly after the hostname and be a suffix of\n            // the URL, we conclude that filter must be equal to the part of the\n            // url following the hostname.\n            return pattern === urlAfterHostname;\n        }\n        else if (filter.isRightAnchor()) {\n            // ||pattern|\n            const requestHostname = request.hostname;\n            if (filter.hasFilter() === false) {\n                // In this specific case it means that the specified hostname should match\n                // at the end of the hostname of the request. This allows to prevent false\n                // positive like ||foo.bar which would match https://foo.bar.baz where\n                // ||foo.bar^ would not.\n                return (filterHostname.length === requestHostname.length ||\n                    requestHostname.endsWith(filterHostname));\n            }\n            else {\n                // pattern|\n                return request.url.endsWith(pattern);\n            }\n        }\n        else if (filter.isLeftAnchor()) {\n            // ||pattern + left-anchor => This means that a plain pattern needs to appear\n            // exactly after the hostname, with nothing in between.\n            // Since this is not a regex, the filter pattern must follow the hostname\n            // with nothing in between. So we extract the part of the URL following\n            // after hostname and will perform the matching on it.\n            return fastStartsWithFrom(request.url, pattern, request.url.indexOf(filterHostname) + filterHostname.length);\n        }\n        if (filter.hasFilter() === false) {\n            return true;\n        }\n        // We consider this a match if the plain patter (i.e.: filter) appears anywhere.\n        return (request.url.indexOf(pattern, request.url.indexOf(filterHostname) + filterHostname.length) !==\n            -1);\n    }\n    else if (filter.isRegex()) {\n        // pattern*^\n        return filter.getRegex().test(request.url);\n    }\n    else if (filter.isLeftAnchor() && filter.isRightAnchor()) {\n        // |pattern|\n        return request.url === pattern;\n    }\n    else if (filter.isLeftAnchor()) {\n        // |pattern\n        return fastStartsWith(request.url, pattern);\n    }\n    else if (filter.isRightAnchor()) {\n        // pattern|\n        return request.url.endsWith(pattern);\n    }\n    // pattern\n    if (filter.hasFilter() === false) {\n        return true;\n    }\n    return request.url.indexOf(pattern) !== -1;\n}\nfunction checkOptions(filter, request) {\n    // We first discard requests based on type, protocol and party. This is really\n    // cheap and should be done first.\n    if (filter.isCptAllowed(request.type) === false ||\n        (request.isHttps === true && filter.fromHttps() === false) ||\n        (request.isHttp === true && filter.fromHttp() === false) ||\n        (filter.firstParty() === false && request.isFirstParty === true) ||\n        (filter.thirdParty() === false && request.isThirdParty === true)) {\n        return false;\n    }\n    // If `sourceHostname` is *not* matched by `domain` then the request should be allowed.\n    if (filter.domains !== undefined &&\n        filter.domains.match(request.sourceHostnameHashes, request.sourceEntityHashes) === false) {\n        return false;\n    }\n    // If `hostname` is matched by `denyallow` then the request should be allowed.\n    if (filter.denyallow !== undefined &&\n        filter.denyallow.match(request.getHostnameHashes(), request.getEntityHashes()) === true) {\n        return false;\n    }\n    return true;\n}\n//# sourceMappingURL=network.js.map","import { sizeOfUTF8 } from './data-view.js';\nexport class Env extends Map {\n}\nexport function detectPreprocessor(line) {\n    // Minimum size of a valid condition should be 6 for something like: \"!#if x\" or \"!#else\"\n    if (line.length < 6 ||\n        line.charCodeAt(0) !== 33 /* '!' */ ||\n        line.charCodeAt(1) !== 35 /* '#' */) {\n        return 0 /* PreprocessorTokens.INVALID */;\n    }\n    if (line.startsWith('!#if ')) {\n        return 1 /* PreprocessorTokens.BEGIF */;\n    }\n    if (line.startsWith('!#else')) {\n        return 2 /* PreprocessorTokens.ELSE */;\n    }\n    if (line.startsWith('!#endif')) {\n        return 3 /* PreprocessorTokens.ENDIF */;\n    }\n    return 0 /* PreprocessorTokens.INVALID */;\n}\nconst tokenizerPattern = /(!|&&|\\|\\||\\(|\\)|[a-zA-Z0-9_]+)/g;\nconst identifierPattern = /^[a-zA-Z0-9_]+$/;\nconst tokenize = (expression) => expression.match(tokenizerPattern);\nconst isIdentifier = (expression) => identifierPattern.test(expression);\nconst precedence = {\n    '!': 2,\n    '&&': 1,\n    '||': 0,\n};\nconst isOperator = (token) => Object.prototype.hasOwnProperty.call(precedence, token);\nconst testIdentifier = (identifier, env) => {\n    if (identifier === 'true' && !env.has('true')) {\n        return true;\n    }\n    if (identifier === 'false' && !env.has('false')) {\n        return false;\n    }\n    return !!env.get(identifier);\n};\n/// The parsing is done using the [Shunting yard algorithm](https://en.wikipedia.org/wiki/Shunting_yard_algorithm).\n/// This function takes as input a string expression and an environment Map.\n/// The expression is made of constants (identifiers), logical operators\n/// (&&, ||), negations (!constant) and parentheses.\n///\n/// The environment is a simple Map that associates identifiers to boolean values.\n///\n/// The function should return the result of evaluating the expression using\n/// the values from `environment`. The return value of this function is\n/// either `true` or `false`.\nexport const evaluate = (expression, env) => {\n    if (expression.length === 0) {\n        return false;\n    }\n    if (isIdentifier(expression)) {\n        if (expression[0] === '!') {\n            return !testIdentifier(expression.slice(1), env);\n        }\n        return testIdentifier(expression, env);\n    }\n    const tokens = tokenize(expression);\n    if (!tokens || tokens.length === 0) {\n        return false;\n    }\n    // Exit if an unallowed character found.\n    // Since we're tokenizing via String.prototype.match function,\n    // the total length of matched tokens will be different in case\n    // unallowed characters were injected.\n    // However, we expect all spaces were already removed in prior step.\n    if (expression.length !== tokens.reduce((partialSum, token) => partialSum + token.length, 0)) {\n        return false;\n    }\n    const output = [];\n    const stack = [];\n    for (const token of tokens) {\n        if (token === '(') {\n            stack.push(token);\n        }\n        else if (token === ')') {\n            while (stack.length !== 0 && stack[stack.length - 1] !== '(') {\n                output.push(stack.pop());\n            }\n            // If the opening parenthesis doesn't exist\n            if (stack.length === 0) {\n                return false;\n            }\n            stack.pop();\n        }\n        else if (isOperator(token)) {\n            while (stack.length &&\n                isOperator(stack[stack.length - 1]) &&\n                precedence[token] <= precedence[stack[stack.length - 1]]) {\n                output.push(stack.pop());\n            }\n            stack.push(token);\n        }\n        else {\n            output.push(testIdentifier(token, env));\n        }\n    }\n    // If there is incomplete parenthesis\n    if (stack[0] === '(' || stack[0] === ')') {\n        return false;\n    }\n    while (stack.length !== 0) {\n        output.push(stack.pop());\n    }\n    for (const token of output) {\n        if (token === true || token === false) {\n            stack.push(token);\n        }\n        else if (token === '!') {\n            stack.push(!stack.pop());\n        }\n        else if (isOperator(token)) {\n            const right = stack.pop();\n            const left = stack.pop();\n            if (token === '&&') {\n                stack.push(left && right);\n            }\n            else {\n                stack.push(left || right);\n            }\n        }\n    }\n    return stack[0] === true;\n};\nexport default class Preprocessor {\n    static getCondition(line) {\n        return line.slice(5 /* '!#if '.length */).replace(/\\s/g, '');\n    }\n    static parse(line, filterIDs) {\n        return new this({\n            condition: Preprocessor.getCondition(line),\n            filterIDs,\n        });\n    }\n    static deserialize(view) {\n        const condition = view.getUTF8();\n        const filterIDs = new Set();\n        for (let i = 0, l = view.getUint32(); i < l; i++) {\n            filterIDs.add(view.getUint32());\n        }\n        return new this({\n            condition,\n            filterIDs,\n        });\n    }\n    constructor({ condition, filterIDs = new Set(), }) {\n        this.condition = condition;\n        this.filterIDs = filterIDs;\n    }\n    evaluate(env) {\n        return evaluate(this.condition, env);\n    }\n    serialize(view) {\n        view.pushUTF8(this.condition);\n        view.pushUint32(this.filterIDs.size);\n        for (const filterID of this.filterIDs) {\n            view.pushUint32(filterID);\n        }\n    }\n    getSerializedSize() {\n        let estimatedSize = sizeOfUTF8(this.condition);\n        estimatedSize += (1 + this.filterIDs.size) * 4;\n        return estimatedSize;\n    }\n}\n//# sourceMappingURL=preprocessor.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport Config from './config.js';\nimport CosmeticFilter from './filters/cosmetic.js';\nimport NetworkFilter from './filters/network.js';\nimport Preprocessor, { detectPreprocessor } from './preprocessor.js';\nimport { fastStartsWith, fastStartsWithFrom } from './utils.js';\n/**\n * Given a single line (string), checks if this would likely be a cosmetic\n * filter, a network filter or something that is not supported. This check is\n * performed before calling a more specific parser to create an instance of\n * `NetworkFilter` or `CosmeticFilter`.\n */\nexport function detectFilterType(line) {\n    // Ignore empty line\n    if (line.length === 0 || line.length === 1) {\n        return 0 /* FilterType.NOT_SUPPORTED */;\n    }\n    // Ignore comments\n    const firstCharCode = line.charCodeAt(0);\n    const secondCharCode = line.charCodeAt(1);\n    if (firstCharCode === 33 /* '!' */ ||\n        (firstCharCode === 35 /* '#' */ && secondCharCode <= 32) ||\n        (firstCharCode === 91 /* '[' */ && fastStartsWith(line, '[Adblock'))) {\n        return 0 /* FilterType.NOT_SUPPORTED */;\n    }\n    // Fast heuristics to detect network filters\n    const lastCharCode = line.charCodeAt(line.length - 1);\n    if (firstCharCode === 36 /* '$' */ ||\n        firstCharCode === 38 /* '&' */ ||\n        firstCharCode === 42 /* '*' */ ||\n        firstCharCode === 45 /* '-' */ ||\n        firstCharCode === 46 /* '.' */ ||\n        firstCharCode === 47 /* '/' */ ||\n        firstCharCode === 58 /* ':' */ ||\n        firstCharCode === 61 /* '=' */ ||\n        firstCharCode === 63 /* '?' */ ||\n        firstCharCode === 64 /* '@' */ ||\n        firstCharCode === 95 /* '_' */ ||\n        firstCharCode === 124 /* '|' */ ||\n        lastCharCode === 124 /* '|' */) {\n        return 1 /* FilterType.NETWORK */;\n    }\n    // Ignore Adguard cosmetics\n    // `$$` = HTML filtering rules\n    const dollarIndex = line.indexOf('$');\n    if (dollarIndex !== -1 && dollarIndex !== line.length - 1) {\n        const afterDollarIndex = dollarIndex + 1;\n        const afterDollarCharCode = line.charCodeAt(afterDollarIndex);\n        // Ignore Adguard HTML rewrite rules\n        if (afterDollarCharCode === 36 /* '$' */ ||\n            (afterDollarCharCode === 64 /* '@' */ &&\n                fastStartsWithFrom(line, /* $@$ */ '@$', afterDollarIndex))) {\n            return 0 /* FilterType.NOT_SUPPORTED */;\n        }\n    }\n    // Check if filter is cosmetics\n    const sharpIndex = line.indexOf('#');\n    if (sharpIndex !== -1 && sharpIndex !== line.length - 1) {\n        const afterSharpIndex = sharpIndex + 1;\n        const afterSharpCharCode = line.charCodeAt(afterSharpIndex);\n        if (afterSharpCharCode === 35 /* '#'*/ ||\n            (afterSharpCharCode === 64 /* '@' */ &&\n                fastStartsWithFrom(line, /* #@# */ '@#', afterSharpIndex))\n        // TODO - support ADB/AdGuard extended css selectors\n        // || (afterSharpCharCode === 63 /* '?' */ &&\n        //   fastStartsWithFrom(line, /* #?# */ '?#', afterSharpIndex))\n        ) {\n            // Parse supported cosmetic filter\n            // `##` `#@#`\n            return 2 /* FilterType.COSMETIC */;\n        }\n        else if ((afterSharpCharCode === 64 /* '@'*/ &&\n            (fastStartsWithFrom(line, /* #@$# */ '@$#', afterSharpIndex) ||\n                fastStartsWithFrom(line, /* #@%# */ '@%#', afterSharpIndex))) ||\n            (afterSharpCharCode === 37 /* '%' */ &&\n                fastStartsWithFrom(line, /* #%# */ '%#', afterSharpIndex)) ||\n            (afterSharpCharCode === 36 /* '$' */ &&\n                fastStartsWithFrom(line, /* #$# */ '$#', afterSharpIndex)) ||\n            (afterSharpCharCode === 63 /* '?' */ &&\n                fastStartsWithFrom(line, /* #?# */ '?#', afterSharpIndex))) {\n            // Ignore Adguard cosmetics\n            // `#$#` `#@$#`\n            // `#%#` `#@%#`\n            // `#?#`\n            return 0 /* FilterType.NOT_SUPPORTED */;\n        }\n    }\n    // Everything else is a network filter\n    return 1 /* FilterType.NETWORK */;\n}\nexport function parseFilter(filter) {\n    const filterType = detectFilterType(filter);\n    if (filterType === 1 /* FilterType.NETWORK */) {\n        return NetworkFilter.parse(filter, true);\n    }\n    else if (filterType === 2 /* FilterType.COSMETIC */) {\n        return CosmeticFilter.parse(filter, true);\n    }\n    return null;\n}\nexport function f(strings) {\n    return parseFilter(strings[0]);\n}\nexport function parseFilters(list, config = new Config()) {\n    config = new Config(config);\n    const networkFilters = [];\n    const cosmeticFilters = [];\n    const lines = list.split('\\n');\n    const preprocessors = [];\n    const preprocessorStack = [];\n    for (let i = 0; i < lines.length; i += 1) {\n        let line = lines[i];\n        // Check if `line` should be left-trimmed\n        if (line.length !== 0 && line.charCodeAt(0) <= 32) {\n            line = line.trim();\n        }\n        // Handle continuations\n        if (line.length > 2) {\n            while (i < lines.length - 1 &&\n                line.charCodeAt(line.length - 1) === 92 &&\n                line.charCodeAt(line.length - 2) === 32) {\n                line = line.slice(0, -2);\n                const nextLine = lines[i + 1];\n                if (nextLine.length > 4 &&\n                    nextLine.charCodeAt(0) === 32 &&\n                    nextLine.charCodeAt(1) === 32 &&\n                    nextLine.charCodeAt(2) === 32 &&\n                    nextLine.charCodeAt(3) === 32 &&\n                    nextLine.charCodeAt(4) !== 32) {\n                    line += nextLine.slice(4);\n                    i += 1;\n                }\n                else {\n                    break;\n                }\n            }\n        }\n        // Check if `line` should be right-trimmed\n        if (line.length !== 0 && line.charCodeAt(line.length - 1) <= 32) {\n            line = line.trim();\n        }\n        // Detect if filter is supported, network or cosmetic\n        const filterType = detectFilterType(line);\n        if (filterType === 1 /* FilterType.NETWORK */ && config.loadNetworkFilters === true) {\n            const filter = NetworkFilter.parse(line, config.debug);\n            if (filter !== null) {\n                networkFilters.push(filter);\n                if (preprocessorStack.length > 0) {\n                    preprocessorStack[preprocessorStack.length - 1].filterIDs.add(filter.getId());\n                }\n            }\n        }\n        else if (filterType === 2 /* FilterType.COSMETIC */ && config.loadCosmeticFilters === true) {\n            const filter = CosmeticFilter.parse(line, config.debug);\n            if (filter !== null) {\n                if (config.loadGenericCosmeticsFilters === true || filter.isGenericHide() === false) {\n                    cosmeticFilters.push(filter);\n                    if (preprocessorStack.length > 0) {\n                        preprocessorStack[preprocessorStack.length - 1].filterIDs.add(filter.getId());\n                    }\n                }\n            }\n        }\n        else if (config.loadPreprocessors) {\n            const preprocessorToken = detectPreprocessor(line);\n            if (preprocessorToken === 1 /* PreprocessorTokens.BEGIF */) {\n                if (preprocessorStack.length > 0) {\n                    preprocessorStack.push(new Preprocessor({\n                        condition: `(${preprocessorStack[preprocessorStack.length - 1].condition})&&(${Preprocessor.getCondition(line)})`,\n                    }));\n                }\n                else {\n                    preprocessorStack.push(Preprocessor.parse(line));\n                }\n            }\n            else if ((preprocessorToken === 3 /* PreprocessorTokens.ENDIF */ ||\n                preprocessorToken === 2 /* PreprocessorTokens.ELSE */) &&\n                preprocessorStack.length > 0) {\n                const lastPreprocessor = preprocessorStack.pop();\n                preprocessors.push(lastPreprocessor);\n                if (preprocessorToken === 2 /* PreprocessorTokens.ELSE */) {\n                    preprocessorStack.push(new Preprocessor({\n                        condition: `!(${lastPreprocessor.condition})`,\n                    }));\n                }\n            }\n        }\n    }\n    return {\n        networkFilters,\n        cosmeticFilters,\n        preprocessors: preprocessors.filter((preprocessor) => preprocessor.filterIDs.size > 0),\n    };\n}\nfunction getFilters(list, config) {\n    const { networkFilters, cosmeticFilters, preprocessors } = parseFilters(list, config);\n    const filters = [];\n    return {\n        filters: filters.concat(networkFilters).concat(cosmeticFilters),\n        preprocessors,\n    };\n}\n/**\n * Helper used to return a set of lines as strings where each line is\n * guaranteed to be a valid filter (i.e.: comments, empty lines and\n * un-supported filters are dropped).\n */\nexport function getLinesWithFilters(list, config = new Config()) {\n    // Set config to `debug` so that we keep track of raw lines for each filter\n    return new Set(getFilters(list, new Config(Object.assign({}, config, { debug: true }))).filters.map(({ rawLine }) => rawLine));\n}\n/**\n * Given two versions of the same subscription (e.g.: EasyList) as a string,\n * generate a raw diff (i.e.: a list of filters added and filters removed, in\n * their raw string form).\n */\nexport function generateDiff(prevRevision, newRevision, config = new Config()) {\n    // Set config to `debug` so that we keep track of raw lines for each filter\n    const debugConfig = new Config(Object.assign({}, config, { debug: true }));\n    const prevRevisionData = getFilters(prevRevision, debugConfig);\n    const prevRevisionIds = new Set(prevRevisionData.filters.map((filter) => filter.getId()));\n    const newRevisionData = getFilters(newRevision, debugConfig);\n    const newRevisionIds = new Set(newRevisionData.filters.map((filter) => filter.getId()));\n    // Check which filters were added, based on ID\n    const added = new Set();\n    for (const filter of newRevisionData.filters) {\n        if (!prevRevisionIds.has(filter.getId())) {\n            added.add(filter.rawLine);\n        }\n    }\n    // Check which filters were removed, based on ID\n    const removed = new Set();\n    for (const filter of prevRevisionData.filters) {\n        if (!newRevisionIds.has(filter.getId())) {\n            removed.add(filter.rawLine);\n        }\n    }\n    // Fast exit if we don't want to handle preprocessors.\n    if (!config.loadPreprocessors) {\n        return {\n            added: Array.from(added),\n            removed: Array.from(removed),\n            preprocessors: {},\n        };\n    }\n    const index = new Map();\n    for (const filter of newRevisionData.filters) {\n        index.set(filter.getId(), filter.rawLine);\n    }\n    for (const filter of prevRevisionData.filters) {\n        index.set(filter.getId(), filter.rawLine);\n    }\n    // Create preprocessor diffs\n    const preprocessors = {};\n    // Get the diff of preprocessors\n    for (const preprocessor of prevRevisionData.preprocessors) {\n        // Find the same preprocessor in `newRevisionData`\n        const newPreprocessor = newRevisionData.preprocessors.find((newPreprocessor) => newPreprocessor.condition === preprocessor.condition);\n        // If the preprocessor in the revision is not found, it means the whole block was removed\n        if (!newPreprocessor) {\n            const removedInScope = new Set();\n            // Remove all filters\n            for (const filterID of preprocessor.filterIDs) {\n                removedInScope.add(index.get(filterID));\n            }\n            preprocessors[preprocessor.condition] = {\n                added: [],\n                removed: Array.from(removedInScope),\n            };\n            continue;\n        }\n        // If the preprocessor in the revision is found, it means the block was updated\n        // Create subsets\n        const scope = {\n            added: new Set(),\n            removed: new Set(),\n        };\n        for (const filterID of preprocessor.filterIDs) {\n            if (!newPreprocessor.filterIDs.has(filterID)) {\n                scope.removed.add(index.get(filterID));\n            }\n        }\n        for (const filterID of newPreprocessor.filterIDs) {\n            if (!preprocessor.filterIDs.has(filterID)) {\n                scope.added.add(index.get(filterID));\n            }\n        }\n        preprocessors[preprocessor.condition] = {\n            added: Array.from(scope.added),\n            removed: Array.from(scope.removed),\n        };\n    }\n    // Iterate over only \"added\" preprocessors\n    for (const preprocessor of newRevisionData.preprocessors) {\n        // If the preprocessor in the previous revision was not found, it means the whole block was added\n        if (!preprocessors[preprocessor.condition]) {\n            const addedInScope = new Set();\n            // Remove all filters\n            for (const filterID of preprocessor.filterIDs) {\n                addedInScope.add(index.get(filterID));\n            }\n            preprocessors[preprocessor.condition] = {\n                added: Array.from(addedInScope),\n                removed: [],\n            };\n        }\n    }\n    for (const [condition, { added, removed }] of Object.entries(preprocessors)) {\n        if (added.length === 0 && removed.length === 0) {\n            delete preprocessors[condition];\n        }\n    }\n    return {\n        added: Array.from(added),\n        removed: Array.from(removed),\n        // For the filters under `preprocessors` property, it doesn't mean those are \"filters\".\n        // Those are \"a list of filters affected by preprocessors\" not the \"filters\" itself.\n        // Therefore, they shouldn't be treated as filters.\n        // Instead, we put \"filters\" in `added` and `removed` properties.\n        // This provides backward-compatibility and simplicity.\n        preprocessors,\n    };\n}\n/**\n * Merge several raw diffs into one, taking care of accumulating added and\n * removed filters, even if several diffs add/remove the same ones.\n */\nexport function mergeDiffs(diffs) {\n    const addedCumul = new Set();\n    const removedCumul = new Set();\n    const preprocessorsCumul = {};\n    for (const { added, removed, preprocessors } of diffs) {\n        if (added !== undefined) {\n            for (const str of added) {\n                if (removedCumul.has(str)) {\n                    removedCumul.delete(str);\n                }\n                addedCumul.add(str);\n            }\n        }\n        if (removed !== undefined) {\n            for (const str of removed) {\n                if (addedCumul.has(str)) {\n                    addedCumul.delete(str);\n                }\n                removedCumul.add(str);\n            }\n        }\n        if (!preprocessors) {\n            continue;\n        }\n        for (const [condition, details] of Object.entries(preprocessors)) {\n            if (!preprocessorsCumul[condition]) {\n                preprocessorsCumul[condition] = {\n                    added: details.added !== undefined ? new Set(details.added) : new Set(),\n                    removed: details.removed !== undefined ? new Set(details.removed) : new Set(),\n                };\n            }\n            else {\n                if (details.added !== undefined) {\n                    for (const str of details.added) {\n                        if (preprocessorsCumul[condition].removed.has(str)) {\n                            preprocessorsCumul[condition].removed.delete(str);\n                        }\n                        preprocessorsCumul[condition].added.add(str);\n                    }\n                }\n                if (details.removed !== undefined) {\n                    for (const str of details.removed) {\n                        if (preprocessorsCumul[condition].added.has(str)) {\n                            preprocessorsCumul[condition].added.delete(str);\n                        }\n                        preprocessorsCumul[condition].removed.add(str);\n                    }\n                }\n            }\n        }\n    }\n    return {\n        added: Array.from(addedCumul),\n        removed: Array.from(removedCumul),\n        preprocessors: Object.fromEntries(Object.entries(preprocessorsCumul).map(([condition, details]) => [\n            condition,\n            {\n                added: Array.from(details.added),\n                removed: Array.from(details.removed),\n            },\n        ])),\n    };\n}\n//# sourceMappingURL=lists.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { getResourceForMime } from '@remusao/small';\nimport { sizeOfUTF8, sizeOfASCII, sizeOfByte } from './data-view.js';\n// Polyfill for `btoa`\nfunction btoaPolyfill(buffer) {\n    if (typeof btoa !== 'undefined') {\n        return btoa(buffer);\n    }\n    else if (typeof Buffer !== 'undefined') {\n        return Buffer.from(buffer).toString('base64');\n    }\n    return buffer;\n}\n// TODO - support # alias\n// TODO - support empty resource body\n/**\n * Abstraction on top of resources.txt used for redirections as well as script\n * injections. It contains logic to parse, serialize and get resources by name\n * for use in the engine.\n */\nexport default class Resources {\n    static deserialize(buffer) {\n        const checksum = buffer.getASCII();\n        // Deserialize `resources`\n        const resources = new Map();\n        const numberOfResources = buffer.getUint16();\n        for (let i = 0; i < numberOfResources; i += 1) {\n            resources.set(buffer.getASCII(), {\n                contentType: buffer.getASCII(),\n                body: buffer.getUTF8(),\n            });\n        }\n        // Deserialize `js`\n        const js = new Map();\n        resources.forEach(({ contentType, body }, name) => {\n            if (contentType === 'application/javascript') {\n                js.set(name, body);\n            }\n        });\n        return new Resources({\n            checksum,\n            js,\n            resources,\n        });\n    }\n    static parse(data, { checksum }) {\n        const typeToResource = new Map();\n        const trimComments = (str) => str.replace(/^\\s*#.*$/gm, '');\n        const chunks = data.split('\\n\\n');\n        for (const chunk of chunks) {\n            const resource = trimComments(chunk).trim();\n            if (resource.length !== 0) {\n                const firstNewLine = resource.indexOf('\\n');\n                const split = resource.slice(0, firstNewLine).split(/\\s+/);\n                const name = split[0];\n                const type = split[1];\n                const body = resource.slice(firstNewLine + 1);\n                if (name === undefined || type === undefined || body === undefined) {\n                    continue;\n                }\n                let resources = typeToResource.get(type);\n                if (resources === undefined) {\n                    resources = new Map();\n                    typeToResource.set(type, resources);\n                }\n                resources.set(name, body);\n            }\n        }\n        // The resource containing javascirpts to be injected\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const js = typeToResource.get('application/javascript') || new Map();\n        for (const [key, value] of js.entries()) {\n            if (key.endsWith('.js')) {\n                js.set(key.slice(0, -3), value);\n            }\n        }\n        // Create a mapping from resource name to { contentType, data }\n        // used for request redirection.\n        const resourcesByName = new Map();\n        typeToResource.forEach((resources, contentType) => {\n            resources.forEach((resource, name) => {\n                resourcesByName.set(name, {\n                    contentType,\n                    body: resource,\n                });\n            });\n        });\n        return new Resources({\n            checksum,\n            js,\n            resources: resourcesByName,\n        });\n    }\n    constructor({ checksum = '', js = new Map(), resources = new Map() } = {}) {\n        this.checksum = checksum;\n        this.js = js;\n        this.resources = resources;\n    }\n    getResource(name) {\n        const { body, contentType } = this.resources.get(name) || getResourceForMime(name);\n        let dataUrl;\n        if (contentType.indexOf(';') !== -1) {\n            dataUrl = `data:${contentType},${body}`;\n        }\n        else {\n            dataUrl = `data:${contentType};base64,${btoaPolyfill(body)}`;\n        }\n        return { body, contentType, dataUrl };\n    }\n    getSerializedSize() {\n        let estimatedSize = sizeOfASCII(this.checksum) + 2 * sizeOfByte(); // resources.size\n        this.resources.forEach(({ contentType, body }, name) => {\n            estimatedSize += sizeOfASCII(name) + sizeOfASCII(contentType) + sizeOfUTF8(body);\n        });\n        return estimatedSize;\n    }\n    serialize(buffer) {\n        // Serialize `checksum`\n        buffer.pushASCII(this.checksum);\n        // Serialize `resources`\n        buffer.pushUint16(this.resources.size);\n        this.resources.forEach(({ contentType, body }, name) => {\n            buffer.pushASCII(name);\n            buffer.pushASCII(contentType);\n            buffer.pushUTF8(body);\n        });\n    }\n}\n//# sourceMappingURL=resources.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nexport function compactTokens(tokens) {\n    const sorted = tokens.sort();\n    let lastIndex = 1;\n    for (let i = 1; i < sorted.length; i += 1) {\n        if (sorted[lastIndex - 1] !== sorted[i]) {\n            sorted[lastIndex++] = sorted[i];\n        }\n    }\n    return sorted.subarray(0, lastIndex);\n}\nexport function hasEmptyIntersection(s1, s2) {\n    let i = 0;\n    let j = 0;\n    while (i < s1.length && j < s2.length && s1[i] !== s2[j]) {\n        if (s1[i] < s2[j]) {\n            i += 1;\n        }\n        else {\n            j += 1;\n        }\n    }\n    return i === s1.length || j === s2.length;\n}\nconst EMPTY_UINT32_ARRAY = new Uint32Array(0);\nexport function concatTypedArrays(arrays) {\n    if (arrays.length === 0) {\n        return EMPTY_UINT32_ARRAY;\n    }\n    if (arrays.length === 1) {\n        return arrays[0];\n    }\n    let totalSize = 0;\n    for (let i = 0; i < arrays.length; i += 1) {\n        totalSize += arrays[i].length;\n    }\n    const result = new Uint32Array(totalSize);\n    let index = 0;\n    for (let i = 0; i < arrays.length; i += 1) {\n        const array = arrays[i];\n        for (let j = 0; j < array.length; j += 1) {\n            result[index++] = array[j];\n        }\n    }\n    return result;\n}\nexport function mergeCompactSets(arrays) {\n    return compactTokens(concatTypedArrays(arrays));\n}\n//# sourceMappingURL=compact-set.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport NetworkFilter from '../filters/network.js';\nimport { setBit } from '../utils.js';\nimport { Domains } from '../engine/domains.js';\nfunction processRegex(r) {\n    return `(?:${r.source})`;\n}\nfunction escape(s) {\n    return `(?:${s.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')})`;\n}\nfunction setWithDefault(map, key, value) {\n    let bucket = map.get(key);\n    if (bucket === undefined) {\n        bucket = [];\n        map.set(key, bucket);\n    }\n    bucket.push(value);\n}\nfunction groupBy(filters, criteria) {\n    const grouped = new Map();\n    for (const filter of filters) {\n        setWithDefault(grouped, criteria(filter), filter);\n    }\n    return Array.from(grouped.values());\n}\nfunction splitBy(filters, condition) {\n    const positive = [];\n    const negative = [];\n    for (const filter of filters) {\n        if (condition(filter)) {\n            positive.push(filter);\n        }\n        else {\n            negative.push(filter);\n        }\n    }\n    return {\n        negative,\n        positive,\n    };\n}\nconst OPTIMIZATIONS = [\n    {\n        description: 'Remove duplicated filters by ID',\n        fusion: (filters) => filters[0],\n        groupByCriteria: (filter) => '' + filter.getId(),\n        select: () => true,\n    },\n    {\n        description: 'Group idential filter with same mask but different domains in single filters',\n        fusion: (filters) => {\n            const parts = [];\n            const hostnames = new Set();\n            const notHostnames = new Set();\n            const entities = new Set();\n            const notEntities = new Set();\n            for (const { domains } of filters) {\n                if (domains !== undefined) {\n                    if (domains.parts !== undefined) {\n                        parts.push(domains.parts);\n                    }\n                    if (domains.hostnames !== undefined) {\n                        for (const hash of domains.hostnames) {\n                            hostnames.add(hash);\n                        }\n                    }\n                    if (domains.entities !== undefined) {\n                        for (const hash of domains.entities) {\n                            entities.add(hash);\n                        }\n                    }\n                    if (domains.notHostnames !== undefined) {\n                        for (const hash of domains.notHostnames) {\n                            notHostnames.add(hash);\n                        }\n                    }\n                    if (domains.notEntities !== undefined) {\n                        for (const hash of domains.notEntities) {\n                            notEntities.add(hash);\n                        }\n                    }\n                }\n            }\n            return new NetworkFilter(Object.assign({}, filters[0], {\n                domains: new Domains({\n                    hostnames: hostnames.size !== 0 ? new Uint32Array(hostnames).sort() : undefined,\n                    entities: entities.size !== 0 ? new Uint32Array(entities).sort() : undefined,\n                    notHostnames: notHostnames.size !== 0 ? new Uint32Array(notHostnames).sort() : undefined,\n                    notEntities: notEntities.size !== 0 ? new Uint32Array(notEntities).sort() : undefined,\n                    parts: parts.length !== 0 ? parts.join(',') : undefined,\n                }),\n                rawLine: filters[0].rawLine !== undefined\n                    ? filters.map(({ rawLine }) => rawLine).join(' <+> ')\n                    : undefined,\n            }));\n        },\n        groupByCriteria: (filter) => filter.getHostname() + filter.getFilter() + filter.getMask() + filter.getRedirect(),\n        select: (filter) => !filter.isCSP() && filter.denyallow === undefined && filter.domains !== undefined,\n    },\n    {\n        description: 'Group simple patterns, into a single filter',\n        fusion: (filters) => {\n            const patterns = [];\n            for (const f of filters) {\n                if (f.isRegex()) {\n                    patterns.push(processRegex(f.getRegex()));\n                }\n                else if (f.isRightAnchor()) {\n                    patterns.push(`${escape(f.getFilter())}$`);\n                }\n                else if (f.isLeftAnchor()) {\n                    patterns.push(`^${escape(f.getFilter())}`);\n                }\n                else {\n                    patterns.push(escape(f.getFilter()));\n                }\n            }\n            return new NetworkFilter(Object.assign({}, filters[0], {\n                mask: setBit(filters[0].mask, 8388608 /* NETWORK_FILTER_MASK.isRegex */),\n                rawLine: filters[0].rawLine !== undefined\n                    ? filters.map(({ rawLine }) => rawLine).join(' <+> ')\n                    : undefined,\n                regex: new RegExp(patterns.join('|')),\n            }));\n        },\n        groupByCriteria: (filter) => '' + (filter.getMask() & ~8388608 /* NETWORK_FILTER_MASK.isRegex */ & ~4194304 /* NETWORK_FILTER_MASK.isFullRegex */),\n        select: (filter) => filter.domains === undefined &&\n            filter.denyallow === undefined &&\n            !filter.isHostnameAnchor() &&\n            !filter.isRedirect() &&\n            !filter.isCSP(),\n    },\n];\n/**\n * Optimizer which returns the list of original filters.\n */\nexport function noopOptimizeNetwork(filters) {\n    return filters;\n}\nexport function noopOptimizeCosmetic(filters) {\n    return filters;\n}\n/**\n * Fusion a set of `filters` by applying optimizations sequentially.\n */\nexport function optimizeNetwork(filters) {\n    const fused = [];\n    let toFuse = filters;\n    for (const { select, fusion, groupByCriteria } of OPTIMIZATIONS) {\n        const { positive, negative } = splitBy(toFuse, select);\n        toFuse = negative;\n        const groups = groupBy(positive, groupByCriteria);\n        for (const group of groups) {\n            if (group.length > 1) {\n                fused.push(fusion(group));\n            }\n            else {\n                toFuse.push(group[0]);\n            }\n        }\n    }\n    for (const filter of toFuse) {\n        fused.push(filter);\n    }\n    return fused;\n}\n//# sourceMappingURL=optimizer.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { StaticDataView, EMPTY_UINT32_ARRAY, sizeOfBytes } from '../data-view.js';\n// https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2\nexport function nextPow2(v) {\n    v--;\n    v |= v >> 1;\n    v |= v >> 2;\n    v |= v >> 4;\n    v |= v >> 8;\n    v |= v >> 16;\n    v++;\n    return v;\n}\n/**\n * Generate unique IDs for requests, which is used to avoid matching the same\n * buckets multiple times on the same request (which can happen if a token\n * appears more than once in a URL).\n */\nlet UID = 1;\nfunction getNextId() {\n    const id = UID;\n    UID = (UID + 1) % 1000000000;\n    return id;\n}\nconst EMPTY_BUCKET = Number.MAX_SAFE_INTEGER >>> 0;\n/**\n * The ReverseIndex is an accelerating data structure which allows finding a\n * subset of the filters given a list of tokens seen in a URL. It is the core\n * of the adblocker's matching capabilities and speed.\n *\n * It has mainly two caracteristics:\n * 1. It is very compact and is able to load fast.\n * 2. It is *very fast* in finding potential candidates.\n *\n * Conceptually, the reverse index dispatches filters in \"buckets\" (an array of\n * one or more filters). Filters living in the same bucket are guaranteed to\n * share at least one of their tokens (appearing in the pattern). For example:\n *\n *   - Bucket 1 (ads):\n *       - /ads.js\n *       - /script/ads/tracking.js\n *       - /ads/\n *   - Bucket 2 (tracking)\n *       - /tracking.js\n *       - ||tracking.com/cdn\n *\n * We see that filters in \"Bucket 1\" are indexed using the token \"ads\" and\n * \"Bucket 2\" using token \"tracking\".\n *\n * This property allows to quickly discard most of the filters when we match a\n * URL. To achieve this, the URL is tokenized in the same way filters are\n * tokenized and for each token, we check if there are some filters available.\n *\n * For example:\n *\n *  URL \"https://tracking.com/\" has the following tokens: \"https\", \"tracking\"\n *  and \"com\". We immediatly see that we only check the two filters in the\n *  \"tracking\" bucket since they are the only ones having a common token with\n *  the URL.\n *\n * How do we pick the token for each filter?\n * =========================================\n *\n * Each filter is only indexed *once*, which means that we need to pick one of\n * the tokens appearing in the pattern. We choose the token such that each\n * filter is indexed using the token which was the *least seen* globally. In\n * other words, we pick the most discriminative token for each filter. This is\n * done using the following algorithm:\n *   1. Tokenize all the filters which will be stored in the index\n *   2. Compute a histogram of frequency of each token (globally)\n *   3. Select the best token for each filter (lowest frequency)\n */\nexport default class ReverseIndex {\n    static deserialize(buffer, deserialize, optimize, config) {\n        const tokensLookupIndexSize = buffer.getUint32();\n        const bucketsIndexSize = buffer.getUint32();\n        const numberOfFilters = buffer.getUint32();\n        // Alignement to 4 bytes is important here since `view` (Uint8Array) can\n        // appear at any offset of `buffer`. But to be sure we can read back\n        // Uint32Array directly from raw buffer, the alignement has to be a\n        // multiple of 4. The same alignement is taken care of in `serialize`.\n        const view = StaticDataView.fromUint8Array(buffer.getBytes(true /* align */), config);\n        const tokensLookupIndex = view.getUint32ArrayView(tokensLookupIndexSize);\n        const bucketsIndex = view.getUint32ArrayView(bucketsIndexSize);\n        const filtersIndexStart = view.pos;\n        view.seekZero(); // not strictly needed but make sure reverse index can be compared with deep equal\n        return new ReverseIndex({\n            config,\n            deserialize,\n            filters: [],\n            optimize,\n        }).updateInternals({\n            bucketsIndex,\n            filtersIndexStart,\n            numberOfFilters,\n            tokensLookupIndex,\n            view,\n        });\n    }\n    constructor({ deserialize, filters, optimize, config, }) {\n        // Internal, compact representation of the reverse index. It contains three\n        // distinct parts stored in the same typed array:\n        //\n        // 1. \"tokens lookup index\" allows to identify a sub-set of buckets which\n        // likely contain filters for a given token. It is an approximate dispatch\n        // table which maps a mask of N bits (N being smaller than 31 bits, the size\n        // of a token) to a list of buckets having a 'token' sharing these same N\n        // bits sub-set. If the binary representation of the token for bucket1 is\n        // 101010 and suffix has size 3, then we would lookup the \"tokens lookup\n        // index\" using the last 3 bits \"010\" which would give us the offset in our\n        // typed array where we can start reading the filters of buckets having a\n        // token ending with the same 3 bits. The value of N is always a power of 2\n        // depending on the total number of filters stored in the index; determined\n        // at the time `update(...)` is called.\n        //\n        // 2. \"buckets index\" is an array which associates tokens to filters. The\n        // structure is: token, filter, token, filter, etc. To identify all the\n        // filters indexed with 'token' a naive approach would be to iterate on\n        // \"buckets index\" and collect all the filters indexed with 'token'. This\n        // would be *very inefficient*! To make this process faster, filters in\n        // \"buckets index\" are grouped so that buckets sharing the same suffix of N\n        // bits in their indexing token (see \"tokens lookup index\") are stored side\n        // by side in the typed array. To know where this section start given a\n        // particular token, we use \"tokens lookup index\" which associated the suffix\n        // of size N to an index in \"buckets index\". From there we can iterate on the\n        // candidates.\n        //\n        // 3. \"filters index\" contains the filters themselves. \"buckets index\"\n        // presented earlier does not contain filters, but an index to the \"filters\n        // index\". This allows a filter to be indexed multiple times without\n        // introducing any overhead; the filter can be associated with multiple\n        // tokens in \"buckets index\" (each pointing to the same place in \"filters\n        // index\") but its actual representation is stored only once in \"filters\n        // index\".\n        this.bucketsIndex = EMPTY_UINT32_ARRAY;\n        this.filtersIndexStart = 0;\n        this.numberOfFilters = 0;\n        this.tokensLookupIndex = EMPTY_UINT32_ARRAY;\n        // In-memory cache used to keep track of buckets which have been loaded from\n        // the compact representation (i.e.: this.view). It is not strictly necessary\n        // but will speed-up retrival of popular filters (since we do not have to\n        // perform the lookup in \"tokens index\" and \"buckets index\" everytime).\n        this.cache = new Map();\n        this.view = StaticDataView.empty(config);\n        this.deserializeFilter = deserialize;\n        this.optimize = optimize;\n        this.config = config;\n        if (filters.length !== 0) {\n            this.update(filters, undefined);\n        }\n    }\n    /**\n     * Load all filters from this index in memory (i.e.: deserialize them from\n     * the byte array into NetworkFilter or CosmeticFilter instances). This is\n     * mostly useful for debugging or testing purposes.\n     */\n    getFilters() {\n        const filters = [];\n        if (this.numberOfFilters === 0) {\n            return filters;\n        }\n        // set view cursor at the start of \"filters index\"\n        this.view.setPos(this.filtersIndexStart);\n        for (let i = 0; i < this.numberOfFilters; i += 1) {\n            filters.push(this.deserializeFilter(this.view));\n        }\n        this.view.seekZero();\n        return filters;\n    }\n    /**\n     * Return an array of all the tokens currently used as keys of the \"buckets index\".\n     */\n    getTokens() {\n        const tokens = new Set();\n        for (let i = 0; i < this.bucketsIndex.length; i += 2) {\n            tokens.add(this.bucketsIndex[i]);\n        }\n        return new Uint32Array(tokens);\n    }\n    /**\n     * Estimate the number of bytes needed to serialize this instance of `ReverseIndex`.\n     */\n    getSerializedSize() {\n        // 12 = 4 bytes (tokensLookupIndex.length) + 4 bytes (bucketsIndex.length) + 4 bytes (numberOfFilters)\n        return 12 + sizeOfBytes(this.view.buffer, true /* align */);\n    }\n    /**\n     * Dump this index to `buffer`.\n     */\n    serialize(buffer) {\n        buffer.pushUint32(this.tokensLookupIndex.length);\n        buffer.pushUint32(this.bucketsIndex.length);\n        buffer.pushUint32(this.numberOfFilters);\n        // Aligmenent is crucial here, see comment in `deserialize` for more info.\n        buffer.pushBytes(this.view.buffer, true /* align */);\n    }\n    /**\n     * Iterate on all filters found in buckets associated with the given list of\n     * tokens. The callback is called on each of them. Early termination can be\n     * achieved if the callback returns `false`.\n     *\n     * This will not check if each filter returned would match a given request but\n     * is instead used as a list of potential candidates (much smaller than the\n     * total set of filters; typically between 5 and 10 filters will be checked).\n     */\n    iterMatchingFilters(tokens, cb) {\n        // Each request is assigned an ID so that we can keep track of the last\n        // request seen by each bucket in the reverse index. This provides a cheap\n        // way to prevent filters from being inspected more than once per request\n        // (which could happen if the same token appears more than once in the URL).\n        const requestId = getNextId();\n        for (const token of tokens) {\n            if (this.iterBucket(token, requestId, cb) === false) {\n                return;\n            }\n        }\n        // Fallback to 0 (i.e.: wildcard bucket) bucket if nothing was found before.\n        this.iterBucket(0, requestId, cb);\n    }\n    /**\n     * Re-create the internal data-structure of the reverse index *in-place*. It\n     * needs to be called with a list of new filters and optionally a list of ids\n     * (as returned by either NetworkFilter.getId() or CosmeticFilter.getId())\n     * which need to be removed from the index.\n     */\n    update(newFilters, removedFilters) {\n        // Reset internal cache on each update\n        if (this.cache.size !== 0) {\n            this.cache.clear();\n        }\n        const compression = this.config.enableCompression;\n        let totalNumberOfTokens = 0;\n        let totalNumberOfIndexedFilters = 0;\n        const filtersTokens = [];\n        // Keep track of the final size of the buckets index. `bucketsIndexSize` is\n        // the number of indexed filters, multiplied by 2 (since we store both the\n        // token a filter is indexed with and the index of the filter).\n        let bucketsIndexSize = 0;\n        // Re-use the current size of \"filters index\" as a starting point so that\n        // we only need to update with new or removed filters. This saves time if\n        // we perform a small update on an existing index.\n        let estimatedBufferSize = this.view.buffer.byteLength - this.filtersIndexStart;\n        // Create a list of all filters which will be part of the index. This means\n        // loading existing filters, removing the ones that need to be deleted and\n        // adding the new ones.  At the same time, we update the estimation of\n        // buffer size needed to store this index.\n        let filters = this.getFilters();\n        if (filters.length !== 0) {\n            // If there is at least one existing filter, then we check if some should\n            // be removed. We subtract their size from the total estimated buffer\n            // size.\n            if (removedFilters !== undefined && removedFilters.size !== 0) {\n                filters = filters.filter((f) => {\n                    if (removedFilters.has(f.getId())) {\n                        estimatedBufferSize -= f.getSerializedSize(compression);\n                        return false;\n                    }\n                    return true;\n                });\n            }\n            // Add new filters to the list and also update estimated size\n            for (const filter of newFilters) {\n                estimatedBufferSize += filter.getSerializedSize(compression);\n                filters.push(filter);\n            }\n        }\n        else {\n            // In the case where there is no existing filter in the index (happens on\n            // initialization), then we can take a fast-path and not check removed\n            // filters at all. There is also no need to copy the array of filters.\n            filters = newFilters;\n            for (const filter of newFilters) {\n                estimatedBufferSize += filter.getSerializedSize(compression);\n            }\n        }\n        // No filters given; reset to empty index and abort.\n        if (filters.length === 0) {\n            this.updateInternals({\n                bucketsIndex: EMPTY_UINT32_ARRAY,\n                filtersIndexStart: 0,\n                numberOfFilters: 0,\n                tokensLookupIndex: EMPTY_UINT32_ARRAY,\n                view: StaticDataView.empty(this.config),\n            });\n            return;\n        }\n        // When we run in `debug` mode, we enable fully deterministic updates of\n        // internal data-structures. To this effect, we sort all filters before\n        // insertion.\n        if (this.config.debug === true) {\n            filters.sort((f1, f2) => f1.getId() - f2.getId());\n        }\n        const histogram = new Uint32Array(Math.max(nextPow2(2 * filters.length), 256));\n        // Tokenize all filters stored in this index. And compute a histogram of\n        // tokens so that we can decide how to index each filter efficiently.\n        for (const filter of filters) {\n            // Tokenize `filter` and store the result in `filtersTokens` which will\n            // be used in the next step to select the best token for each filter.\n            const multiTokens = filter.getTokens();\n            filtersTokens.push(multiTokens);\n            // Update estimated size of \"buckets index\" based on number of times this\n            // particular filter will be indexed.\n            bucketsIndexSize += 2 * multiTokens.length; // token + filter index\n            totalNumberOfIndexedFilters += multiTokens.length;\n            // Each filter can be indexed more than once, so `getTokens(...)` returns\n            // multiple sets of tokens. We iterate on all of them and update the\n            // histogram for each.\n            for (const tokens of multiTokens) {\n                totalNumberOfTokens += tokens.length;\n                for (const token of tokens) {\n                    histogram[token % histogram.length] += 1;\n                }\n            }\n        }\n        // Add size of bucketsIndex to total size (x4 because these are 32 bits numbers)\n        estimatedBufferSize += bucketsIndexSize * 4;\n        // Prepare \"tokens index\" (see documentation in constructor of `ReverseIndex` class above).\n        const tokensLookupIndexSize = Math.max(2, nextPow2(totalNumberOfIndexedFilters));\n        const mask = tokensLookupIndexSize - 1;\n        const suffixes = [];\n        for (let i = 0; i < tokensLookupIndexSize; i += 1) {\n            suffixes.push([]);\n        }\n        // Add size of tokensLookupIndex to total size (x4 because these are 32 bits numbers)\n        estimatedBufferSize += tokensLookupIndexSize * 4;\n        // At this point we know the number of bytes needed for the compact\n        // representation of this reverse index (\"tokens index\" + \"buckets index\" +\n        // \"filters index\"). We allocate it at once and proceed with populating it.\n        const buffer = StaticDataView.allocate(estimatedBufferSize, this.config);\n        const tokensLookupIndex = buffer.getUint32ArrayView(tokensLookupIndexSize);\n        const bucketsIndex = buffer.getUint32ArrayView(bucketsIndexSize);\n        const filtersIndexStart = buffer.getPos();\n        // For each filter, find the best token (least seen) based on histogram.\n        // Since we are iterating again on the filters, we populate \"filters index\"\n        // in the same loop and keep track of their indices so that we can later\n        // populate \"buckets index\".\n        for (let i = 0; i < filtersTokens.length; i += 1) {\n            const filter = filters[i];\n            const multiTokens = filtersTokens[i];\n            // Serialize this filter and keep track of its index in the byte array;\n            // it will be used in \"buckets index\" to point to this filter.\n            const filterIndex = buffer.pos;\n            filter.serialize(buffer);\n            // Index the filter once per \"tokens\"\n            for (const tokens of multiTokens) {\n                // Find best token (least seen) from `tokens` using `histogram`.\n                let bestToken = 0; // default = wildcard bucket\n                let minCount = totalNumberOfTokens + 1;\n                for (const token of tokens) {\n                    const tokenCount = histogram[token % histogram.length];\n                    if (tokenCount < minCount) {\n                        minCount = tokenCount;\n                        bestToken = token;\n                        // Fast path, if the current token has only been seen once, we can\n                        // stop iterating since we will not find a better alternarive!\n                        if (minCount === 1) {\n                            break;\n                        }\n                    }\n                }\n                // `bestToken & mask` represents the N last bits of `bestToken`. We\n                // group all filters indexed with a token sharing the same N bits.\n                suffixes[bestToken & mask].push([bestToken, filterIndex]);\n            }\n        }\n        // Populate \"tokens index\" and \"buckets index\" based on best token found for each filter.\n        let indexInBucketsIndex = 0;\n        for (let i = 0; i < tokensLookupIndexSize; i += 1) {\n            const filtersForMask = suffixes[i];\n            tokensLookupIndex[i] = indexInBucketsIndex;\n            for (const [token, filterIndex] of filtersForMask) {\n                bucketsIndex[indexInBucketsIndex++] = token;\n                bucketsIndex[indexInBucketsIndex++] = filterIndex;\n            }\n        }\n        // Update internals\n        buffer.seekZero();\n        this.updateInternals({\n            bucketsIndex,\n            filtersIndexStart,\n            numberOfFilters: filtersTokens.length,\n            tokensLookupIndex,\n            view: buffer,\n        });\n    }\n    updateInternals({ bucketsIndex, filtersIndexStart, numberOfFilters, tokensLookupIndex, view, }) {\n        this.bucketsIndex = bucketsIndex;\n        this.filtersIndexStart = filtersIndexStart;\n        this.numberOfFilters = numberOfFilters;\n        this.tokensLookupIndex = tokensLookupIndex;\n        this.view = view;\n        view.seekZero();\n        return this;\n    }\n    /**\n     * If a bucket exists for the given token, call the callback on each filter\n     * found inside. An early termination mechanism is built-in, to stop iterating\n     * as soon as `false` is returned from the callback.\n     */\n    iterBucket(token, requestId, cb) {\n        let bucket = this.config.enableInMemoryCache === true ? this.cache.get(token) : undefined;\n        // Lazily create bucket if it does not yet exist in memory. Lookup the\n        // compact bucket representation and find all filters being associated with\n        // `token`. Create a `Bucket` out of them and store them in cache.\n        if (bucket === undefined) {\n            const offset = token & (this.tokensLookupIndex.length - 1);\n            const startOfBucket = this.tokensLookupIndex[offset];\n            // We do not have any filters for this token\n            if (startOfBucket === EMPTY_BUCKET) {\n                return true;\n            }\n            // Since we do not store explicitly the number of filters in each\n            // \"bucket\", we check the index of the next one and use it to infer the\n            // number of filters (each filter being stored as a token + index to the\n            // \"filters store\")\n            const endOfBucket = offset === this.tokensLookupIndex.length - 1\n                ? this.bucketsIndex.length\n                : this.tokensLookupIndex[offset + 1];\n            // Get indices of filters indexed with `token`, if any.\n            const filtersIndices = [];\n            for (let i = startOfBucket; i < endOfBucket; i += 2) {\n                const currentToken = this.bucketsIndex[i];\n                if (currentToken === token) {\n                    filtersIndices.push(this.bucketsIndex[i + 1]);\n                }\n            }\n            // No filter indexed with `token`.\n            if (filtersIndices.length === 0) {\n                return true; // continue looking for a match\n            }\n            // If we have filters for `token` then deserialize filters in memory and\n            // create a `Bucket` instance to hold them for future access.\n            const filters = [];\n            const view = this.view;\n            for (let i = 0; i < filtersIndices.length; i += 1) {\n                view.setPos(filtersIndices[i]);\n                filters.push(this.deserializeFilter(view));\n            }\n            // Create new bucket with found filters (only optimize if we have more\n            // than one filter).\n            bucket = {\n                filters: filters.length > 1 ? this.optimize(filters) : filters,\n                lastRequestSeen: -1, // safe because all ids are positive\n            };\n            if (this.config.enableInMemoryCache === true) {\n                this.cache.set(token, bucket);\n            }\n        }\n        // Look for matching filter in this bucket\n        if (bucket.lastRequestSeen !== requestId) {\n            bucket.lastRequestSeen = requestId;\n            const filters = bucket.filters;\n            for (let i = 0; i < filters.length; i += 1) {\n                // Break the loop if the callback returns `false`\n                if (cb(filters[i]) === false) {\n                    // Whenever we get a match from a filter, we also swap it one\n                    // position up in the list. This way, over time, popular filters will\n                    // be first and might match earlier. This should decrease the time\n                    // needed to get a match.\n                    if (i > 0) {\n                        const filter = filters[i];\n                        filters[i] = filters[i - 1];\n                        filters[i - 1] = filter;\n                    }\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n}\n//# sourceMappingURL=reverse-index.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { StaticDataView, sizeOfBytes } from '../../data-view.js';\n// Empty filters is 4 bytes because we need at least one 32 bits number to keep\n// track of the number of filters in the container. If there is no filter then\n// the number will be 0.\nconst EMPTY_FILTERS = new Uint8Array(4);\n/**\n * Generic filters container (for both CosmeticFilter and NetworkFilter\n * instances). This abstracts away some of the logic to serialize/lazy-load\n * lists of filters (which is useful for things like generic cosmetic filters\n * or $badfilter).\n */\nexport default class FiltersContainer {\n    static deserialize(buffer, deserialize, config) {\n        const container = new FiltersContainer({ deserialize, config, filters: [] });\n        container.filters = buffer.getBytes();\n        return container;\n    }\n    constructor({ config, deserialize, filters, }) {\n        this.deserialize = deserialize;\n        this.filters = EMPTY_FILTERS;\n        this.config = config;\n        if (filters.length !== 0) {\n            this.update(filters, undefined);\n        }\n    }\n    /**\n     * Update filters based on `newFilters` and `removedFilters`.\n     */\n    update(newFilters, removedFilters) {\n        // Estimate size of the buffer we will need to store filters. This avoids\n        // having to allocate a big chunk of memory up-front if it's not needed.\n        // We start with the current size of `this.filters` then update it with\n        // removed/added filters.\n        let bufferSizeEstimation = this.filters.byteLength;\n        let selected = [];\n        const compression = this.config.enableCompression;\n        // Add existing rules (removing the ones with ids in `removedFilters`)\n        const currentFilters = this.getFilters();\n        if (currentFilters.length !== 0) {\n            // If no filter was removed (we only add new ones), we don't need to\n            // filter out removed existing filters. So we just assign the array to\n            // `selected` directly to save a bit of effort.\n            if (removedFilters === undefined || removedFilters.size === 0) {\n                selected = currentFilters;\n            }\n            else {\n                // There might be some removed selected filters, so we iterate through\n                // them and make sure we keep only the ones not having been deleted.\n                for (const filter of currentFilters) {\n                    if (removedFilters.has(filter.getId()) === false) {\n                        selected.push(filter);\n                    }\n                    else {\n                        bufferSizeEstimation -= filter.getSerializedSize(compression);\n                    }\n                }\n            }\n        }\n        // If `selected` and `currentFilters` have the same length then no filter was removed.\n        const storedFiltersRemoved = selected.length !== currentFilters.length;\n        // Add new rules.\n        const numberOfExistingFilters = selected.length;\n        for (const filter of newFilters) {\n            bufferSizeEstimation += filter.getSerializedSize(compression);\n            selected.push(filter);\n        }\n        // Check if any new filter was added in `selected` (from `newFilters`).\n        const storedFiltersAdded = selected.length > numberOfExistingFilters;\n        // If selected changed, then update the compact representation of filters.\n        if (selected.length === 0) {\n            this.filters = EMPTY_FILTERS;\n        }\n        else if (storedFiltersAdded === true || storedFiltersRemoved === true) {\n            // Store filters in their compact form\n            const buffer = StaticDataView.allocate(bufferSizeEstimation, this.config);\n            buffer.pushUint32(selected.length);\n            // When we run in `debug` mode, we enable fully deterministic updates of\n            // internal data-structure. To this effect, we sort all filters before\n            // insertion.\n            if (this.config.debug === true) {\n                selected.sort((f1, f2) => f1.getId() - f2.getId());\n            }\n            for (const filter of selected) {\n                filter.serialize(buffer);\n            }\n            // Update internals\n            this.filters = buffer.buffer;\n        }\n    }\n    getSerializedSize() {\n        return sizeOfBytes(this.filters, false /* no alignement */);\n    }\n    serialize(buffer) {\n        buffer.pushBytes(this.filters);\n    }\n    getFilters() {\n        // No filter stored in the container\n        if (this.filters.byteLength <= 4) {\n            return [];\n        }\n        // Load all filters in memory and store them in `cache`\n        const filters = [];\n        const buffer = StaticDataView.fromUint8Array(this.filters, this.config);\n        const numberOfFilters = buffer.getUint32();\n        for (let i = 0; i < numberOfFilters; i += 1) {\n            filters.push(this.deserialize(buffer));\n        }\n        return filters;\n    }\n}\n//# sourceMappingURL=filters.js.map","/* eslint-disable @typescript-eslint/unbound-method */\n/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { compactTokens, concatTypedArrays } from '../../compact-set.js';\nimport CosmeticFilter, { DEFAULT_HIDDING_STYLE } from '../../filters/cosmetic.js';\nimport { getEntityHashesFromLabelsBackward, getHostnameHashesFromLabelsBackward, } from '../../request.js';\nimport { hashStrings, tokenizeNoSkip } from '../../utils.js';\nimport { noopOptimizeCosmetic } from '../optimizer.js';\nimport ReverseIndex from '../reverse-index.js';\nimport FiltersContainer from './filters.js';\n/**\n * Given a list of CSS selectors, create a valid stylesheet ready to be\n * injected in the page. This also takes care to no create rules with too many\n * selectors for Chrome, see: https://crbug.com/804179\n */\nexport function createStylesheet(rules, style) {\n    if (rules.length === 0) {\n        return '';\n    }\n    const maximumNumberOfSelectors = 1024;\n    const parts = [];\n    const styleStr = ` { ${style} }`;\n    for (let i = 0; i < rules.length; i += maximumNumberOfSelectors) {\n        // Accumulate up to `maximumNumberOfSelectors` selectors into `selector`.\n        // We use string concatenation here since it's faster than using\n        // `Array.prototype.join`.\n        let selector = rules[i];\n        for (let j = i + 1, end = Math.min(rules.length, i + maximumNumberOfSelectors); j < end; j += 1) {\n            selector += ',\\n' + rules[j];\n        }\n        // Insert CSS after last selector (e.g.: `{ display: none }`)\n        selector += styleStr;\n        // If `rules` has less than the limit, we can short-circuit here\n        if (rules.length < maximumNumberOfSelectors) {\n            return selector;\n        }\n        // Keep track of this chunk and process next ones\n        parts.push(selector);\n    }\n    // Join all chunks together\n    return parts.join('\\n');\n}\n/**\n * If at least one filter from `rules` has a custom style (e.g.: `##.foo\n * :style(...)`) then we fallback to `createStylesheetFromRulesWithCustomStyles`\n * which is slower than `createStylesheetFromRules`.\n */\nfunction createStylesheetFromRulesWithCustomStyles(rules) {\n    const selectorsPerStyle = new Map();\n    for (const rule of rules) {\n        const style = rule.getStyle();\n        const selectors = selectorsPerStyle.get(style);\n        if (selectors === undefined) {\n            selectorsPerStyle.set(style, [rule.getSelector()]);\n        }\n        else {\n            selectors.push(rule.getSelector());\n        }\n    }\n    const stylesheets = [];\n    const selectorsPerStyleArray = Array.from(selectorsPerStyle.entries());\n    for (const [style, selectors] of selectorsPerStyleArray) {\n        stylesheets.push(createStylesheet(selectors, style));\n    }\n    return stylesheets.join('\\n\\n');\n}\n/**\n * Given a list of cosmetic filters, create a stylesheet ready to be injected.\n * This function is optimistic and will assume there is no `:style` filter in\n * `rules`. In case one is found on the way, we fallback to the slower\n * `createStylesheetFromRulesWithCustomStyles` function.\n */\nfunction createStylesheetFromRules(rules) {\n    const selectors = [];\n    for (const rule of rules) {\n        if (rule.hasCustomStyle()) {\n            return createStylesheetFromRulesWithCustomStyles(rules);\n        }\n        selectors.push(rule.selector);\n    }\n    return createStylesheet(selectors, DEFAULT_HIDDING_STYLE);\n}\nfunction createLookupTokens(hostname, domain) {\n    const hostnamesHashes = getHostnameHashesFromLabelsBackward(hostname, domain);\n    const entitiesHashes = getEntityHashesFromLabelsBackward(hostname, domain);\n    const tokens = new Uint32Array(hostnamesHashes.length + entitiesHashes.length);\n    let index = 0;\n    for (const hash of hostnamesHashes) {\n        tokens[index++] = hash;\n    }\n    for (const hash of entitiesHashes) {\n        tokens[index++] = hash;\n    }\n    return tokens;\n}\n/**\n * Efficient container for CosmeticFilter instances. Allows to quickly\n * retrieved scripts and stylesheets to inject in pages for a specific\n * hostname/domain.\n */\nexport default class CosmeticFilterBucket {\n    static deserialize(buffer, config) {\n        const bucket = new CosmeticFilterBucket({ config });\n        bucket.genericRules = FiltersContainer.deserialize(buffer, CosmeticFilter.deserialize, config);\n        bucket.classesIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        bucket.hostnameIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        bucket.hrefsIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        bucket.htmlIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        bucket.idsIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        bucket.unhideIndex = ReverseIndex.deserialize(buffer, CosmeticFilter.deserialize, noopOptimizeCosmetic, config);\n        return bucket;\n    }\n    constructor({ filters = [], config }) {\n        this.genericRules = new FiltersContainer({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n        });\n        this.classesIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        this.hostnameIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        this.hrefsIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        this.htmlIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        this.idsIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        this.unhideIndex = new ReverseIndex({\n            config,\n            deserialize: CosmeticFilter.deserialize,\n            filters: [],\n            optimize: noopOptimizeCosmetic,\n        });\n        // In-memory cache, lazily initialized\n        this.baseStylesheet = null;\n        this.extraGenericRules = null;\n        if (filters.length !== 0) {\n            this.update(filters, undefined, config);\n        }\n    }\n    getFilters() {\n        const filters = [];\n        return filters.concat(this.genericRules.getFilters(), this.classesIndex.getFilters(), this.hostnameIndex.getFilters(), this.hrefsIndex.getFilters(), this.htmlIndex.getFilters(), this.idsIndex.getFilters(), this.unhideIndex.getFilters());\n    }\n    update(newFilters, removedFilters, config) {\n        const classSelectors = [];\n        const genericHideRules = [];\n        const hostnameSpecificRules = [];\n        const hrefSelectors = [];\n        const htmlRules = [];\n        const idSelectors = [];\n        const unHideRules = [];\n        for (const rule of newFilters) {\n            if (rule.isUnhide()) {\n                unHideRules.push(rule);\n            }\n            else if (rule.isHtmlFiltering()) {\n                htmlRules.push(rule);\n            }\n            else if (rule.isGenericHide()) {\n                if (rule.isClassSelector()) {\n                    classSelectors.push(rule);\n                }\n                else if (rule.isIdSelector()) {\n                    idSelectors.push(rule);\n                }\n                else if (rule.isHrefSelector()) {\n                    hrefSelectors.push(rule);\n                }\n                else {\n                    genericHideRules.push(rule);\n                }\n            }\n            else if (rule.isExtended() === false || config.loadExtendedSelectors === true) {\n                hostnameSpecificRules.push(rule);\n            }\n        }\n        this.genericRules.update(genericHideRules, removedFilters);\n        this.classesIndex.update(classSelectors, removedFilters);\n        this.hostnameIndex.update(hostnameSpecificRules, removedFilters);\n        this.hrefsIndex.update(hrefSelectors, removedFilters);\n        this.htmlIndex.update(htmlRules, removedFilters);\n        this.idsIndex.update(idSelectors, removedFilters);\n        this.unhideIndex.update(unHideRules, removedFilters);\n    }\n    getSerializedSize() {\n        return (this.genericRules.getSerializedSize() +\n            this.classesIndex.getSerializedSize() +\n            this.hostnameIndex.getSerializedSize() +\n            this.hrefsIndex.getSerializedSize() +\n            this.htmlIndex.getSerializedSize() +\n            this.idsIndex.getSerializedSize() +\n            this.unhideIndex.getSerializedSize());\n    }\n    serialize(buffer) {\n        this.genericRules.serialize(buffer);\n        this.classesIndex.serialize(buffer);\n        this.hostnameIndex.serialize(buffer);\n        this.hrefsIndex.serialize(buffer);\n        this.htmlIndex.serialize(buffer);\n        this.idsIndex.serialize(buffer);\n        this.unhideIndex.serialize(buffer);\n    }\n    getHtmlRules({ domain, hostname, isFilterExcluded, }) {\n        // Tokens from `hostname` and `domain` which will be used to lookup filters\n        // from the reverse index. The same tokens are re-used for multiple indices.\n        const hostnameTokens = createLookupTokens(hostname, domain);\n        const rules = [];\n        this.htmlIndex.iterMatchingFilters(hostnameTokens, (rule) => {\n            if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                rules.push(rule);\n            }\n            return true;\n        });\n        // If we found at least one candidate, check if we have unhidden rules.\n        const disabledRules = new Set();\n        if (rules.length !== 0) {\n            this.unhideIndex.iterMatchingFilters(hostnameTokens, (rule) => {\n                if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    disabledRules.add(rule.getSelector());\n                }\n                return true;\n            });\n        }\n        return rules.filter((rule) => disabledRules.size === 0 || disabledRules.has(rule.getSelector()) === false);\n    }\n    /**\n     * Request cosmetics and scripts to inject in a page.\n     */\n    getCosmeticsFilters({ domain, hostname, classes = [], hrefs = [], ids = [], allowGenericHides = true, allowSpecificHides = true, \n    // Allows to specify which rules to return\n    getBaseRules = true, getInjectionRules = true, getExtendedRules = true, getRulesFromDOM = true, getRulesFromHostname = true, isFilterExcluded, }) {\n        // Tokens from `hostname` and `domain` which will be used to lookup filters\n        // from the reverse index. The same tokens are re-used for multiple indices.\n        const hostnameTokens = createLookupTokens(hostname, domain);\n        const rules = [];\n        // =======================================================================\n        // Rules: hostname-specific\n        // =======================================================================\n        // Collect matching rules which specify a hostname constraint.\n        if (getRulesFromHostname === true) {\n            this.hostnameIndex.iterMatchingFilters(hostnameTokens, (rule) => {\n                // A hostname-specific filter is considered if it's a scriptlet (not\n                // impacted by disabling of specific filters) or specific hides are\n                // allowed.\n                if ((allowSpecificHides === true || rule.isScriptInject() === true) &&\n                    rule.match(hostname, domain) &&\n                    !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    rules.push(rule);\n                }\n                return true;\n            });\n        }\n        // =======================================================================\n        // Rules: generic hide\n        // =======================================================================\n        // Optionally, collect genericHide rules. We need to make sure the `rule`\n        // matches the hostname and domain since some generic rules can specify\n        // negated hostnames and entities (e.g.: ~foo.*##generic).\n        if (allowGenericHides === true && getRulesFromHostname === true) {\n            const genericRules = this.getGenericRules();\n            for (const rule of genericRules) {\n                if (rule.match(hostname, domain) === true && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    rules.push(rule);\n                }\n            }\n        }\n        // =======================================================================\n        // Class selector based\n        // =======================================================================\n        if (allowGenericHides === true && getRulesFromDOM === true && classes.length !== 0) {\n            this.classesIndex.iterMatchingFilters(hashStrings(classes), (rule) => {\n                if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    rules.push(rule);\n                }\n                return true;\n            });\n        }\n        // =======================================================================\n        // Id selector based\n        // =======================================================================\n        if (allowGenericHides === true && getRulesFromDOM === true && ids.length !== 0) {\n            this.idsIndex.iterMatchingFilters(hashStrings(ids), (rule) => {\n                if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    rules.push(rule);\n                }\n                return true;\n            });\n        }\n        // =======================================================================\n        // Href selector based\n        // =======================================================================\n        if (allowGenericHides === true && getRulesFromDOM === true && hrefs.length !== 0) {\n            this.hrefsIndex.iterMatchingFilters(compactTokens(concatTypedArrays(hrefs.map((href) => tokenizeNoSkip(href)))), (rule) => {\n                if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    rules.push(rule);\n                }\n                return true;\n            });\n        }\n        const extended = [];\n        const injections = [];\n        const styles = [];\n        // If we found at least one candidate, check if we have unhidden rules,\n        // apply them and dispatch rules into `injections` (i.e.: '+js(...)'),\n        // `extended` (i.e. :not(...)), and `styles` (i.e.: '##rule').\n        if (rules.length !== 0) {\n            // =======================================================================\n            // Rules: unhide\n            // =======================================================================\n            // Collect unhidden selectors. They will be used to filter-out canceled\n            // rules from other indices.\n            let injectionsDisabled = false;\n            const disabledRules = new Set();\n            this.unhideIndex.iterMatchingFilters(hostnameTokens, (rule) => {\n                if (rule.match(hostname, domain) && !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(rule))) {\n                    disabledRules.add(rule.getSelector());\n                    // Detect special +js() rules to disable scriptlet injections\n                    if (rule.isScriptInject() === true &&\n                        rule.isUnhide() === true &&\n                        rule.getSelector().length === 0) {\n                        injectionsDisabled = true;\n                    }\n                }\n                return true;\n            });\n            // Apply unhide rules + dispatch\n            for (const rule of rules) {\n                // Make sure `rule` is not un-hidden by a #@# filter\n                if (disabledRules.size !== 0 && disabledRules.has(rule.getSelector())) {\n                    continue;\n                }\n                // Dispatch rules in `injections` or `styles` depending on type\n                if (rule.isScriptInject() === true) {\n                    if (getInjectionRules === true && injectionsDisabled === false) {\n                        injections.push(rule);\n                    }\n                }\n                else if (rule.isExtended()) {\n                    if (getExtendedRules === true) {\n                        extended.push(rule);\n                    }\n                }\n                else {\n                    styles.push(rule);\n                }\n            }\n        }\n        // Create final stylesheet\n        let stylesheet = getBaseRules === false || allowGenericHides === false ? '' : this.getBaseStylesheet();\n        if (styles.length !== 0) {\n            if (stylesheet.length !== 0) {\n                stylesheet += '\\n\\n';\n            }\n            stylesheet += createStylesheetFromRules(styles);\n        }\n        const extendedProcessed = [];\n        if (extended.length !== 0) {\n            const extendedStyles = new Map();\n            for (const rule of extended) {\n                const ast = rule.getSelectorAST();\n                if (ast !== undefined) {\n                    const attribute = rule.isRemove() ? undefined : rule.getStyleAttributeHash();\n                    if (attribute !== undefined) {\n                        extendedStyles.set(rule.getStyle(), attribute);\n                    }\n                    extendedProcessed.push({\n                        ast,\n                        remove: rule.isRemove(),\n                        attribute,\n                    });\n                }\n            }\n            if (extendedStyles.size !== 0) {\n                if (stylesheet.length !== 0) {\n                    stylesheet += '\\n\\n';\n                }\n                stylesheet += [...extendedStyles.entries()]\n                    .map(([style, attribute]) => `[${attribute}] { ${style} }`)\n                    .join('\\n\\n');\n            }\n        }\n        return {\n            extended: extendedProcessed,\n            injections,\n            stylesheet,\n        };\n    }\n    /**\n     * Return the list of filters which can potentially be un-hidden by another\n     * rule currently contained in the cosmetic bucket.\n     */\n    getGenericRules() {\n        if (this.extraGenericRules === null) {\n            return this.lazyPopulateGenericRulesCache().genericRules;\n        }\n        return this.extraGenericRules;\n    }\n    /**\n     * The base stylesheet is made of generic filters (not specific to any\n     * hostname) which cannot be hidden (i.e.: there is currently no rule which\n     * might hide their selector). This means that it will never change and is\n     * the same for all sites. We generate it once and re-use it any-time we want\n     * to inject it.\n     */\n    getBaseStylesheet() {\n        if (this.baseStylesheet === null) {\n            return this.lazyPopulateGenericRulesCache().baseStylesheet;\n        }\n        return this.baseStylesheet;\n    }\n    /**\n     * This is used to lazily generate both the list of generic rules which can\n     * *potentially be un-hidden* (i.e.: there exists at least one unhide rule\n     * for the selector) and a stylesheet containing all selectors which cannot\n     * be un-hidden. Since this list will not change between updates we can\n     * generate once and use many times.\n     */\n    lazyPopulateGenericRulesCache() {\n        if (this.baseStylesheet === null || this.extraGenericRules === null) {\n            // Collect all selectors which can be subjected to an unhide rule\n            const unHideRules = this.unhideIndex.getFilters();\n            const canBeHiddenSelectors = new Set();\n            for (const rule of unHideRules) {\n                canBeHiddenSelectors.add(rule.getSelector());\n            }\n            // Split generic rules into two groups:\n            // 1. Rules which cannot be hidden\n            // 2. Rules which can be hidden on some domains\n            //\n            // This allows to create a base stylesheet which we know will never\n            // change then keep a minority of rules in-memory which can potentially\n            // be hidden.\n            const genericRules = this.genericRules.getFilters();\n            const cannotBeHiddenRules = [];\n            const canBeHiddenRules = [];\n            for (const rule of genericRules) {\n                if (rule.hasCustomStyle() ||\n                    rule.isScriptInject() ||\n                    rule.hasHostnameConstraint() ||\n                    canBeHiddenSelectors.has(rule.getSelector())) {\n                    canBeHiddenRules.push(rule);\n                }\n                else {\n                    cannotBeHiddenRules.push(rule);\n                }\n            }\n            this.baseStylesheet = createStylesheetFromRules(cannotBeHiddenRules);\n            this.extraGenericRules = canBeHiddenRules;\n        }\n        return {\n            baseStylesheet: this.baseStylesheet,\n            genericRules: this.extraGenericRules,\n        };\n    }\n}\n//# sourceMappingURL=cosmetic.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport NetworkFilter from '../../filters/network.js';\nimport { noopOptimizeNetwork, optimizeNetwork } from '../optimizer.js';\nimport ReverseIndex from '../reverse-index.js';\nimport FiltersContainer from './filters.js';\n/**\n * Accelerating data structure for network filters matching.\n */\nexport default class NetworkFilterBucket {\n    static deserialize(buffer, config) {\n        const bucket = new NetworkFilterBucket({ config });\n        bucket.index = ReverseIndex.deserialize(buffer, NetworkFilter.deserialize, config.enableOptimizations ? optimizeNetwork : noopOptimizeNetwork, config);\n        bucket.badFilters = FiltersContainer.deserialize(buffer, NetworkFilter.deserialize, config);\n        return bucket;\n    }\n    constructor({ filters = [], config }) {\n        this.index = new ReverseIndex({\n            config,\n            deserialize: NetworkFilter.deserialize,\n            filters: [],\n            optimize: config.enableOptimizations ? optimizeNetwork : noopOptimizeNetwork,\n        });\n        this.badFiltersIds = null;\n        this.badFilters = new FiltersContainer({\n            config,\n            deserialize: NetworkFilter.deserialize,\n            filters: [],\n        });\n        if (filters.length !== 0) {\n            this.update(filters, undefined);\n        }\n    }\n    getFilters() {\n        const filters = [];\n        return filters.concat(this.badFilters.getFilters(), this.index.getFilters());\n    }\n    update(newFilters, removedFilters) {\n        const badFilters = [];\n        const remaining = [];\n        for (const filter of newFilters) {\n            if (filter.isBadFilter()) {\n                badFilters.push(filter);\n            }\n            else {\n                remaining.push(filter);\n            }\n        }\n        this.badFilters.update(badFilters, removedFilters);\n        this.index.update(remaining, removedFilters);\n        this.badFiltersIds = null;\n    }\n    getSerializedSize() {\n        return this.badFilters.getSerializedSize() + this.index.getSerializedSize();\n    }\n    serialize(buffer) {\n        this.index.serialize(buffer);\n        this.badFilters.serialize(buffer);\n    }\n    matchAll(request, isFilterExcluded) {\n        const filters = [];\n        this.index.iterMatchingFilters(request.getTokens(), (filter) => {\n            if (filter.match(request) &&\n                this.isFilterDisabled(filter) === false &&\n                !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(filter))) {\n                filters.push(filter);\n            }\n            return true;\n        });\n        return filters;\n    }\n    match(request, isFilterExcluded) {\n        let match;\n        this.index.iterMatchingFilters(request.getTokens(), (filter) => {\n            if (filter.match(request) &&\n                this.isFilterDisabled(filter) === false &&\n                !(isFilterExcluded === null || isFilterExcluded === void 0 ? void 0 : isFilterExcluded(filter))) {\n                match = filter;\n                return false;\n            }\n            return true;\n        });\n        return match;\n    }\n    /**\n     * Given a matching filter, check if it is disabled by a $badfilter.\n     */\n    isFilterDisabled(filter) {\n        // Lazily load information about bad filters in memory. The only thing we\n        // keep in memory is the list of IDs from $badfilter (ignoring the\n        // $badfilter option from mask). This allows to check if a matching filter\n        // should be ignored just by doing a lookup in a set of IDs.\n        if (this.badFiltersIds === null) {\n            const badFilters = this.badFilters.getFilters();\n            // Shortcut if there is no badfilter in this bucket\n            if (badFilters.length === 0) {\n                return false;\n            }\n            // Create in-memory list of disabled filter IDs\n            const badFiltersIds = new Set();\n            for (const badFilter of badFilters) {\n                badFiltersIds.add(badFilter.getIdWithoutBadFilter());\n            }\n            this.badFiltersIds = badFiltersIds;\n        }\n        return this.badFiltersIds.has(filter.getId());\n    }\n}\n//# sourceMappingURL=network.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { StaticDataView, sizeOfBytes, EMPTY_UINT32_ARRAY } from '../data-view.js';\nimport { nextPow2 } from './reverse-index.js';\nconst EMPTY_BUCKET = Number.MAX_SAFE_INTEGER >>> 0;\n/**\n * This is a simpler version of reverse-index data structure which implements\n * a simple Map-like class, backed by compact typed arrays. This means that\n * the structure can be serialized to a typed array very quickly and loaded\n * back instantly.\n */\nexport class CompactMap {\n    static deserialize(buffer, deserialize) {\n        const tokensLookupIndexSize = buffer.getUint32();\n        const bucketsIndexSize = buffer.getUint32();\n        const numberOfValues = buffer.getUint32();\n        // Alignement to 4 bytes is important here since `view` (Uint8Array) can\n        // appear at any offset of `buffer`. But to be sure we can read back\n        // Uint32Array directly from raw buffer, the alignement has to be a\n        // multiple of 4. The same alignement is taken care of in `serialize`.\n        const view = StaticDataView.fromUint8Array(buffer.getBytes(true /* align */), {\n            enableCompression: false,\n        });\n        const tokensLookupIndex = view.getUint32ArrayView(tokensLookupIndexSize);\n        const bucketsIndex = view.getUint32ArrayView(bucketsIndexSize);\n        const valuesIndexStart = view.pos;\n        view.seekZero(); // not strictly needed but make sure reverse index can be compared with deep equal\n        return new CompactMap({\n            deserialize,\n            // Left empty on purpose since we don't need these to deserialize (all\n            // the data is already in the serialized data).\n            values: [],\n            getKeys: () => [],\n            getSerializedSize: () => 0,\n            serialize: () => {\n                /* Empty */\n            },\n        }).updateInternals({\n            bucketsIndex,\n            valuesIndexStart,\n            numberOfValues,\n            tokensLookupIndex,\n            view,\n        });\n    }\n    constructor({ serialize, deserialize, getKeys, getSerializedSize, values, }) {\n        // In-memory cache used to keep track of metadata which has already been\n        // loaded from the compact representation (i.e.: this.view). It is not\n        // strictly necessary but will speed-up retrival of popular patterns\n        // (since we do not have to perform the lookup again).\n        this.cache = new Map();\n        this.bucketsIndex = EMPTY_UINT32_ARRAY;\n        this.tokensLookupIndex = EMPTY_UINT32_ARRAY;\n        this.valuesIndexStart = 0;\n        this.numberOfValues = 0;\n        this.view = StaticDataView.empty({ enableCompression: false });\n        this.deserializeValue = deserialize;\n        if (values.length !== 0) {\n            const patternsKeys = [];\n            // Keep track of the final size of the buckets index. `bucketsIndexSize`\n            // is the number of indexed values, multiplied by 2 (since we store both\n            // the `key` a value is indexed with and the index of the value itself).\n            let bucketsIndexSize = 0;\n            // Create a list of all values which will be part of the map. This means\n            // computing an estimation of the buffer size needed to store this index.\n            let estimatedBufferSize = 0;\n            for (const value of values) {\n                estimatedBufferSize += getSerializedSize(value);\n            }\n            // No values given; reset to empty index and abort.\n            if (values.length === 0) {\n                this.updateInternals({\n                    bucketsIndex: EMPTY_UINT32_ARRAY,\n                    valuesIndexStart: 0,\n                    numberOfValues: 0,\n                    tokensLookupIndex: EMPTY_UINT32_ARRAY,\n                    view: StaticDataView.empty({ enableCompression: false }),\n                });\n                return;\n            }\n            for (const value of values) {\n                // Get keys from `value` and store the result in `patternsKeys` which\n                // will be used in the next step to select the best key for each value.\n                const keys = getKeys(value);\n                patternsKeys.push(keys);\n                bucketsIndexSize += 2 * keys.length; // key + value index\n            }\n            // Add size of bucketsIndex to total size (x4 because these are 32 bits numbers)\n            estimatedBufferSize += bucketsIndexSize * 4;\n            // Prepare \"tokens index\" (see documentation in constructor of `ReverseIndex` class).\n            const tokensLookupIndexSize = Math.max(2, nextPow2(values.length));\n            const mask = tokensLookupIndexSize - 1;\n            const suffixes = [];\n            for (let i = 0; i < tokensLookupIndexSize; i += 1) {\n                suffixes.push([]);\n            }\n            // Add size of tokensLookupIndex to total size (x4 because these are 32 bits numbers)\n            estimatedBufferSize += tokensLookupIndexSize * 4;\n            // At this point we know the number of bytes needed for the compact\n            // representation of this map (\"tokens index\" + \"buckets index\" +\n            // \"values index\"). We allocate it at once and proceed with populating it.\n            const buffer = StaticDataView.allocate(estimatedBufferSize, { enableCompression: false });\n            const tokensLookupIndex = buffer.getUint32ArrayView(tokensLookupIndexSize);\n            const bucketsIndex = buffer.getUint32ArrayView(bucketsIndexSize);\n            const valuesIndexStart = buffer.getPos();\n            // For each value, find the best token (least seen) based on histogram.\n            // Since we are iterating again on the values, we populate \"values index\"\n            // in the same loop and keep track of their indices so that we can later\n            // populate \"buckets index\".\n            for (let i = 0; i < patternsKeys.length; i += 1) {\n                const value = values[i];\n                const keys = patternsKeys[i];\n                // Serialize this value and keep track of its index in the byte array;\n                // it will be used in \"buckets index\" to point to this value.\n                const valueIndex = buffer.pos;\n                serialize(value, buffer);\n                for (const key of keys) {\n                    // `key & mask` represents the N last bits of `key`. We group all\n                    // values indexed with the same `key` sharing the same N bits.\n                    suffixes[key & mask].push([key, valueIndex]);\n                }\n            }\n            // Populate \"tokens index\" and \"buckets index\" based on keys for each value.\n            let indexInBucketsIndex = 0;\n            for (let i = 0; i < tokensLookupIndexSize; i += 1) {\n                const valuesForMask = suffixes[i];\n                tokensLookupIndex[i] = indexInBucketsIndex;\n                for (const [token, valueIndex] of valuesForMask) {\n                    bucketsIndex[indexInBucketsIndex++] = token;\n                    bucketsIndex[indexInBucketsIndex++] = valueIndex;\n                }\n            }\n            // Update internals\n            this.updateInternals({\n                bucketsIndex,\n                valuesIndexStart,\n                numberOfValues: patternsKeys.length,\n                tokensLookupIndex,\n                view: buffer,\n            });\n        }\n    }\n    updateInternals({ bucketsIndex, valuesIndexStart, numberOfValues, tokensLookupIndex, view, }) {\n        this.bucketsIndex = bucketsIndex;\n        this.valuesIndexStart = valuesIndexStart;\n        this.numberOfValues = numberOfValues;\n        this.tokensLookupIndex = tokensLookupIndex;\n        this.view = view;\n        view.seekZero();\n        return this;\n    }\n    getValues() {\n        const values = [];\n        if (this.numberOfValues === 0) {\n            return values;\n        }\n        // set view cursor at the start of \"values index\"\n        this.view.setPos(this.valuesIndexStart);\n        for (let i = 0; i < this.numberOfValues; i += 1) {\n            values.push(this.deserializeValue(this.view));\n        }\n        this.view.seekZero();\n        return values;\n    }\n    /**\n     * Estimate the number of bytes needed to serialize this instance of `Map`.\n     */\n    getSerializedSize() {\n        // 12 = 4 bytes (tokensLookupIndex.length) + 4 bytes (bucketsIndex.length) + 4 bytes (numberOfValues)\n        return 12 + sizeOfBytes(this.view.buffer, true /* align */);\n    }\n    /**\n     * Dump this index to `buffer`.\n     */\n    serialize(buffer) {\n        buffer.pushUint32(this.tokensLookupIndex.length);\n        buffer.pushUint32(this.bucketsIndex.length);\n        buffer.pushUint32(this.numberOfValues);\n        // Aligmenent is crucial here, see comment in `deserialize` for more info.\n        buffer.pushBytes(this.view.buffer, true /* align */);\n    }\n    get(key) {\n        const cachedValues = this.cache.get(key);\n        if (cachedValues !== undefined) {\n            return cachedValues;\n        }\n        const offset = key & (this.tokensLookupIndex.length - 1);\n        const startOfBucket = this.tokensLookupIndex[offset];\n        // We do not have any values for this token\n        if (startOfBucket === EMPTY_BUCKET) {\n            return [];\n        }\n        // Since we do not store explicitly the number of values in each\n        // \"bucket\", we check the index of the next one and use it to infer the\n        // number of values (each value being stored as a token + index to the\n        // \"values store\")\n        const endOfBucket = offset === this.tokensLookupIndex.length - 1\n            ? this.bucketsIndex.length\n            : this.tokensLookupIndex[offset + 1];\n        // Get indices of values indexed with `token`, if any.\n        const valuesIndices = [];\n        for (let i = startOfBucket; i < endOfBucket; i += 2) {\n            const currentToken = this.bucketsIndex[i];\n            if (currentToken === key) {\n                valuesIndices.push(this.bucketsIndex[i + 1]);\n            }\n        }\n        // No value indexed with `token`.\n        if (valuesIndices.length === 0) {\n            return []; // continue looking for a match\n        }\n        // If we have values for `token` then deserialize values in memory and\n        // create a `Bucket` instance to hold them for future access.\n        const values = [];\n        const view = this.view;\n        for (let i = 0; i < valuesIndices.length; i += 1) {\n            view.setPos(valuesIndices[i]);\n            values.push(this.deserializeValue(view));\n        }\n        this.cache.set(key, values);\n        return values;\n    }\n}\n//# sourceMappingURL=map.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { CompactMap } from '../map.js';\nimport { sizeOfUTF8 } from '../../data-view.js';\nimport { fastHash } from '../../utils.js';\nexport function isValid(category) {\n    if (category === null) {\n        return false;\n    }\n    if (typeof category !== 'object') {\n        return false;\n    }\n    const { key, name, color, description } = category;\n    if (typeof key !== 'string') {\n        return false;\n    }\n    if (typeof name !== 'string') {\n        return false;\n    }\n    if (typeof color !== 'string') {\n        return false;\n    }\n    if (typeof description !== 'string') {\n        return false;\n    }\n    return true;\n}\nexport function getKey(category) {\n    return fastHash(category.key);\n}\nexport function getSerializedSize(category) {\n    return (sizeOfUTF8(category.key) +\n        sizeOfUTF8(category.name) +\n        sizeOfUTF8(category.color) +\n        sizeOfUTF8(category.description));\n}\nexport function serialize(category, view) {\n    view.pushUTF8(category.key);\n    view.pushUTF8(category.name);\n    view.pushUTF8(category.color);\n    view.pushUTF8(category.description);\n}\nexport function deserialize(view) {\n    return {\n        key: view.getUTF8(),\n        name: view.getUTF8(),\n        color: view.getUTF8(),\n        description: view.getUTF8(),\n    };\n}\nexport function createMap(categories) {\n    return new CompactMap({\n        getSerializedSize,\n        getKeys: (category) => [getKey(category)],\n        serialize,\n        deserialize,\n        values: categories,\n    });\n}\n//# sourceMappingURL=categories.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { CompactMap } from '../map.js';\nimport { sizeOfUTF8 } from '../../data-view.js';\nimport { fastHash } from '../../utils.js';\n/**\n * This function takes an object representing an organization from TrackerDB\n * dump and validates its shape. The result is the same object, but strongly\n * typed.\n */\nexport function isValid(organization) {\n    if (organization === null) {\n        return false;\n    }\n    if (typeof organization !== 'object') {\n        return false;\n    }\n    const { key, name, description, country, website_url: websiteUrl, privacy_policy_url: privacyPolicyUrl, privacy_contact: privacyContact, ghostery_id: ghosteryId, } = organization;\n    if (typeof key !== 'string') {\n        return false;\n    }\n    if (typeof name !== 'string') {\n        return false;\n    }\n    if (description !== null && typeof description !== 'string') {\n        return false;\n    }\n    if (country !== null && typeof country !== 'string') {\n        return false;\n    }\n    if (websiteUrl !== null && typeof websiteUrl !== 'string') {\n        return false;\n    }\n    if (privacyPolicyUrl !== null && typeof privacyPolicyUrl !== 'string') {\n        return false;\n    }\n    if (privacyContact !== null && typeof privacyContact !== 'string') {\n        return false;\n    }\n    if (ghosteryId !== null && typeof ghosteryId !== 'string') {\n        return false;\n    }\n    return true;\n}\nexport function getKey(organization) {\n    return fastHash(organization.key);\n}\nexport function getSerializedSize(organization) {\n    return (sizeOfUTF8(organization.key) +\n        sizeOfUTF8(organization.name) +\n        sizeOfUTF8(organization.description || '') +\n        sizeOfUTF8(organization.website_url || '') +\n        sizeOfUTF8(organization.country || '') +\n        sizeOfUTF8(organization.privacy_policy_url || '') +\n        sizeOfUTF8(organization.privacy_contact || '') +\n        sizeOfUTF8(organization.ghostery_id || ''));\n}\nexport function serialize(organization, view) {\n    view.pushUTF8(organization.key);\n    view.pushUTF8(organization.name);\n    view.pushUTF8(organization.description || '');\n    view.pushUTF8(organization.website_url || '');\n    view.pushUTF8(organization.country || '');\n    view.pushUTF8(organization.privacy_policy_url || '');\n    view.pushUTF8(organization.privacy_contact || '');\n    view.pushUTF8(organization.ghostery_id || '');\n}\nexport function deserialize(view) {\n    return {\n        key: view.getUTF8(),\n        name: view.getUTF8(),\n        description: view.getUTF8() || null,\n        website_url: view.getUTF8() || null,\n        country: view.getUTF8() || null,\n        privacy_policy_url: view.getUTF8() || null,\n        privacy_contact: view.getUTF8() || null,\n        ghostery_id: view.getUTF8() || null,\n    };\n}\nexport function createMap(organizations) {\n    return new CompactMap({\n        getSerializedSize,\n        getKeys: (organization) => [getKey(organization)],\n        serialize,\n        deserialize,\n        values: organizations,\n    });\n}\n//# sourceMappingURL=organizations.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { CompactMap } from '../map.js';\nimport { sizeOfUTF8, sizeOfLength } from '../../data-view.js';\nimport NetworkFilter from '../../filters/network.js';\n/**\n * This function takes an object representing a pattern from TrackerDB dump\n * and validates its shape. The result is the same object, but strongly typed.\n */\nexport function isValid(pattern) {\n    if (pattern === null) {\n        return false;\n    }\n    if (typeof pattern !== 'object') {\n        return false;\n    }\n    const { key, name, category, organization, alias, website_url: websiteUrl, domains, filters, } = pattern;\n    if (typeof key !== 'string') {\n        return false;\n    }\n    if (typeof name !== 'string') {\n        return false;\n    }\n    if (typeof category !== 'string') {\n        return false;\n    }\n    if (organization !== null && typeof organization !== 'string') {\n        return false;\n    }\n    if (typeof alias !== 'string' && alias !== null) {\n        return false;\n    }\n    if (websiteUrl !== null && typeof websiteUrl !== 'string') {\n        return false;\n    }\n    if (!Array.isArray(domains) || !domains.every((domain) => typeof domain === 'string')) {\n        return false;\n    }\n    if (!Array.isArray(filters) || !filters.every((filter) => typeof filter === 'string')) {\n        return false;\n    }\n    return true;\n}\nexport function getKeys(pattern) {\n    const keys = [];\n    for (const filter of pattern.filters) {\n        const parsedFilter = NetworkFilter.parse(filter);\n        if (parsedFilter !== null) {\n            keys.push(parsedFilter.getId());\n        }\n    }\n    for (const domain of pattern.domains) {\n        const parsedFilter = NetworkFilter.parse(`||${domain}^`);\n        if (parsedFilter !== null) {\n            keys.push(parsedFilter.getId());\n        }\n    }\n    return [...new Set(keys)];\n}\nexport function getSerializedSize(pattern) {\n    let sizeOfDomains = sizeOfLength(pattern.domains.length);\n    for (const domain of pattern.domains) {\n        sizeOfDomains += sizeOfUTF8(domain);\n    }\n    let sizeOfFilters = sizeOfLength(pattern.filters.length);\n    for (const filter of pattern.filters) {\n        sizeOfFilters += sizeOfUTF8(filter);\n    }\n    return (sizeOfUTF8(pattern.key) +\n        sizeOfUTF8(pattern.name) +\n        sizeOfUTF8(pattern.category) +\n        sizeOfUTF8(pattern.organization || '') +\n        sizeOfUTF8(pattern.alias || '') +\n        sizeOfUTF8(pattern.website_url || '') +\n        sizeOfUTF8(pattern.ghostery_id || '') +\n        sizeOfDomains +\n        sizeOfFilters);\n}\nexport function serialize(pattern, view) {\n    view.pushUTF8(pattern.key);\n    view.pushUTF8(pattern.name);\n    view.pushUTF8(pattern.category);\n    view.pushUTF8(pattern.organization || '');\n    view.pushUTF8(pattern.alias || '');\n    view.pushUTF8(pattern.website_url || '');\n    view.pushUTF8(pattern.ghostery_id || '');\n    view.pushLength(pattern.domains.length);\n    for (const domain of pattern.domains) {\n        view.pushUTF8(domain);\n    }\n    view.pushLength(pattern.filters.length);\n    for (const filter of pattern.filters) {\n        view.pushUTF8(filter);\n    }\n}\nexport function deserialize(view) {\n    const key = view.getUTF8();\n    const name = view.getUTF8();\n    const category = view.getUTF8();\n    const organization = view.getUTF8() || null;\n    const alias = view.getUTF8() || null;\n    const website_url = view.getUTF8() || null;\n    const ghostery_id = view.getUTF8() || null;\n    const numberOfDomains = view.getLength();\n    const domains = [];\n    for (let i = 0; i < numberOfDomains; i += 1) {\n        domains.push(view.getUTF8());\n    }\n    const numberOfFilters = view.getLength();\n    const filters = [];\n    for (let i = 0; i < numberOfFilters; i += 1) {\n        filters.push(view.getUTF8());\n    }\n    return {\n        key,\n        name,\n        category,\n        organization,\n        alias,\n        website_url,\n        ghostery_id,\n        domains,\n        filters,\n    };\n}\nexport function createMap(patterns) {\n    return new CompactMap({\n        getSerializedSize,\n        getKeys,\n        serialize,\n        deserialize,\n        values: patterns,\n    });\n}\n//# sourceMappingURL=patterns.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport { CompactMap } from './map.js';\nimport NetworkFilter from '../filters/network.js';\nimport { createMap as createCategoriesMap, isValid as isValidCategory, deserialize as deserializeCategory, getKey as getCategoryKey, } from './metadata/categories.js';\nimport { createMap as createOrganizationsMap, isValid as isValidOrganization, deserialize as deserializeOrganization, getKey as getOrganizationKey, } from './metadata/organizations.js';\nimport { createMap as createPatternsMap, isValid as isValidPattern, deserialize as deserializePattern, } from './metadata/patterns.js';\n// Optionally, we can also compress their names and descriptions but I think that should not be necessary as it's probably pretty small.\n// Usage in MV3 extension\n// ======================\n// 1. The extension will load the binary engine containing metadata and store it locally\n// 2. Either on webRequest events or DNR filter IDs (requires to synchronize the IDs), we tag the request with their metadata\n// (2.) At runtime, we will either feed it a request and we expect to get metadata (match, get filter, then from filter ID, get metadata)\n//    Or we feed it the filter ID directly, from the DNR engine (but then it means we need to use the filter hash as an ID there as well and hope for no collision)\nexport class Metadata {\n    static deserialize(buffer) {\n        const metadata = new Metadata(null);\n        metadata.categories = CompactMap.deserialize(buffer, deserializeCategory);\n        metadata.organizations = CompactMap.deserialize(buffer, deserializeOrganization);\n        metadata.patterns = CompactMap.deserialize(buffer, deserializePattern);\n        return metadata;\n    }\n    constructor(rawTrackerDB) {\n        if (!rawTrackerDB) {\n            this.organizations = createOrganizationsMap([]);\n            this.categories = createCategoriesMap([]);\n            this.patterns = createPatternsMap([]);\n            return;\n        }\n        const { patterns: rawPatterns, organizations: rawOrganizations, categories: rawCategories, } = rawTrackerDB;\n        // Type-check categories\n        const categories = [];\n        if (typeof rawCategories === 'object') {\n            for (const [key, category] of Object.entries(rawCategories)) {\n                if (typeof category !== 'object') {\n                    continue;\n                }\n                const categoryWithKey = { key, ...category };\n                if (isValidCategory(categoryWithKey)) {\n                    categories.push(categoryWithKey);\n                }\n                else {\n                    console.error('?? invalid category', categoryWithKey);\n                }\n            }\n        }\n        this.categories = createCategoriesMap(categories);\n        // Type-check organizations\n        const organizations = [];\n        if (typeof rawOrganizations === 'object') {\n            for (const [key, organization] of Object.entries(rawOrganizations)) {\n                if (typeof organization !== 'object') {\n                    continue;\n                }\n                const organizationWithKey = { key, ...organization };\n                if (isValidOrganization(organizationWithKey)) {\n                    organizations.push(organizationWithKey);\n                }\n                else {\n                    console.error('?? invalid organization', organizationWithKey);\n                }\n            }\n        }\n        this.organizations = createOrganizationsMap(organizations);\n        // Type-check patterns\n        const patterns = [];\n        if (typeof rawPatterns === 'object') {\n            for (const [key, pattern] of Object.entries(rawPatterns)) {\n                if (typeof pattern !== 'object') {\n                    continue;\n                }\n                const patternWithKey = { key, ...pattern };\n                if (isValidPattern(patternWithKey)) {\n                    patterns.push(patternWithKey);\n                }\n                else {\n                    console.error('?? invalid pattern', patternWithKey);\n                }\n            }\n        }\n        this.patterns = createPatternsMap(patterns);\n    }\n    getCategories() {\n        return this.categories.getValues();\n    }\n    getOrganizations() {\n        return this.organizations.getValues();\n    }\n    getPatterns() {\n        return this.patterns.getValues();\n    }\n    /**\n     * Estimate the total serialized size of this Metadata instance.\n     */\n    getSerializedSize() {\n        return (this.categories.getSerializedSize() +\n            this.organizations.getSerializedSize() +\n            this.patterns.getSerializedSize());\n    }\n    /**\n     * Serialize this instance of Metadata into `view`\n     */\n    serialize(buffer) {\n        this.categories.serialize(buffer);\n        this.organizations.serialize(buffer);\n        this.patterns.serialize(buffer);\n    }\n    /**\n     * Given an instance of NetworkFilter, retrieve pattern, organization and\n     * category information.\n     */\n    fromFilter(filter) {\n        return this.fromId(filter.getId());\n    }\n    /**\n     * Given a domain, retrieve pattern, organization and category information.\n     */\n    fromDomain(domain) {\n        const domainParts = domain.split('.');\n        for (; domainParts.length >= 2; domainParts.shift()) {\n            const subdomain = domainParts.join('.');\n            const parsedDomainFilter = NetworkFilter.parse(`||${subdomain}^`);\n            if (parsedDomainFilter === null) {\n                continue;\n            }\n            const patterns = this.fromId(parsedDomainFilter.getId());\n            if (patterns.length > 0) {\n                return patterns;\n            }\n        }\n        return [];\n    }\n    /**\n     * Given an `id` from filter, retrieve using the NetworkFilter.getId() method,\n     * lookup associated patterns (including organization and category) in an\n     * efficient way.\n     */\n    fromId(id) {\n        var _a, _b;\n        const results = [];\n        for (const pattern of this.patterns.get(id)) {\n            results.push({\n                pattern,\n                category: (_a = this.categories.get(getCategoryKey({ key: pattern.category }))) === null || _a === void 0 ? void 0 : _a[0],\n                organization: pattern.organization !== null\n                    ? (_b = this.organizations.get(getOrganizationKey({ key: pattern.organization }))) === null || _b === void 0 ? void 0 : _b[0]\n                    : null,\n            });\n        }\n        return results;\n    }\n}\n//# sourceMappingURL=metadata.js.map","import Preprocessor from '../../preprocessor.js';\nexport default class PreprocessorBucket {\n    static deserialize(view) {\n        const excluded = new Set();\n        for (let i = 0, l = view.getUint32(); i < l; i++) {\n            excluded.add(view.getUint32());\n        }\n        const preprocessors = [];\n        for (let i = 0, l = view.getUint32(); i < l; i++) {\n            preprocessors.push(Preprocessor.deserialize(view));\n        }\n        return new this({\n            excluded,\n            preprocessors,\n        });\n    }\n    constructor({ excluded = new Set(), preprocessors = [], }) {\n        this.excluded = excluded;\n        this.preprocessors = preprocessors;\n    }\n    isFilterExcluded(filter) {\n        return this.excluded.has(filter.getId());\n    }\n    updateEnv(env) {\n        // Update excluded filter ids based on bindings\n        this.excluded.clear();\n        for (const preprocessor of this.preprocessors) {\n            if (!preprocessor.evaluate(env)) {\n                for (const filterID of preprocessor.filterIDs) {\n                    this.excluded.add(filterID);\n                }\n            }\n        }\n    }\n    update({ added, removed, }, env) {\n        if (removed) {\n            for (const preprocessor of removed) {\n                const local = this.preprocessors.find((local) => local.condition === preprocessor.condition);\n                // Skip if we don't have any preprocessor on local\n                // In the context of filters updates from CDN this should never happen.\n                if (!local) {\n                    continue;\n                }\n                for (const filterID of preprocessor.filterIDs) {\n                    local.filterIDs.delete(filterID);\n                }\n            }\n        }\n        if (added) {\n            for (const preprocessor of added) {\n                const local = this.preprocessors.find((local) => local.condition === preprocessor.condition);\n                if (!local) {\n                    this.preprocessors.push(preprocessor);\n                    continue;\n                }\n                for (const filterID of preprocessor.filterIDs) {\n                    local.filterIDs.add(filterID);\n                }\n            }\n        }\n        if ((removed && removed.length !== 0) || (added && added.length !== 0)) {\n            this.updateEnv(env);\n        }\n    }\n    serialize(view) {\n        view.pushUint32(this.excluded.size);\n        for (const filterID of this.excluded) {\n            view.pushUint32(filterID);\n        }\n        view.pushUint32(this.preprocessors.length);\n        for (const preprocessor of this.preprocessors) {\n            preprocessor.serialize(view);\n        }\n    }\n    getSerializedSize() {\n        let estimatedSize = (1 + this.excluded.size) * 4;\n        estimatedSize += 4;\n        for (const preprocessor of this.preprocessors) {\n            estimatedSize += preprocessor.getSerializedSize();\n        }\n        return estimatedSize;\n    }\n}\n//# sourceMappingURL=preprocessor.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\nimport Config from '../config.js';\nimport { StaticDataView, sizeOfASCII, sizeOfByte, sizeOfBool } from '../data-view.js';\nimport { EventEmitter } from '../events.js';\nimport { adsAndTrackingLists, adsLists, fetchLists, fetchResources, fullLists, } from '../fetch.js';\nimport { block } from '../filters/dsl.js';\nimport { parseFilters } from '../lists.js';\nimport Request from '../request.js';\nimport Resources from '../resources.js';\nimport CosmeticFilterBucket from './bucket/cosmetic.js';\nimport NetworkFilterBucket from './bucket/network.js';\nimport { Metadata } from './metadata.js';\nimport Preprocessor, { Env } from '../preprocessor.js';\nimport PreprocessorBucket from './bucket/preprocessor.js';\nexport const ENGINE_VERSION = 654;\nfunction shouldApplyHideException(filters) {\n    if (filters.length === 0) {\n        return false;\n    }\n    // Get $Xhide filter with highest priority:\n    // $Xhide,important > $Xhide > @@$Xhide\n    let genericHideFilter;\n    let currentScore = 0;\n    for (const filter of filters) {\n        // To encode priority between filters, we create a bitmask with the following:\n        // $important,Xhide = 100 (takes precedence)\n        // $Xhide           = 010 (exception to @@$Xhide)\n        // @@$Xhide         = 001 (forbids Xhide filters)\n        const score = (filter.isImportant() ? 4 : 0) | (filter.isException() ? 1 : 2);\n        // Highest `score` has precedence\n        if (score >= currentScore) {\n            currentScore = score;\n            genericHideFilter = filter;\n        }\n    }\n    if (genericHideFilter === undefined) {\n        return false;\n    }\n    // Check that there is at least one $generichide match and no exception\n    return genericHideFilter.isException();\n}\nexport default class FilterEngine extends EventEmitter {\n    static fromCached(init, caching) {\n        if (caching === undefined) {\n            return init();\n        }\n        const { path, read, write } = caching;\n        return read(path)\n            .then((buffer) => this.deserialize(buffer))\n            .catch(() => init().then((engine) => write(path, engine.serialize()).then(() => engine)));\n    }\n    static empty(config = {}) {\n        return new this({ config });\n    }\n    /**\n     * Create an instance of `FiltersEngine` (or subclass like `ElectronBlocker`,\n     * etc.), from the list of subscriptions provided as argument (e.g.:\n     * EasyList).\n     *\n     * Lists are fetched using the instance of `fetch` provided as a first\n     * argument. Optionally resources.txt and config can be provided.\n     */\n    static fromLists(fetch, urls, config = {}, caching) {\n        return this.fromCached(() => {\n            const listsPromises = fetchLists(fetch, urls);\n            const resourcesPromise = fetchResources(fetch);\n            return Promise.all([listsPromises, resourcesPromise]).then(([lists, resources]) => {\n                const engine = this.parse(lists.join('\\n'), config);\n                if (resources !== undefined) {\n                    engine.updateResources(resources, '' + resources.length);\n                }\n                return engine;\n            });\n        }, caching);\n    }\n    /**\n     * Initialize blocker of *ads only*.\n     *\n     * Attempt to initialize a blocking engine using a pre-built version served\n     * from Cliqz's CDN. If this fails (e.g.: if no pre-built engine is available\n     * for this version of the library), then falls-back to using `fromLists(...)`\n     * method with the same subscriptions.\n     */\n    static fromPrebuiltAdsOnly(fetchImpl = fetch, caching) {\n        return this.fromLists(fetchImpl, adsLists, {}, caching);\n    }\n    /**\n     * Same as `fromPrebuiltAdsOnly(...)` but also contains rules to block\n     * tracking (i.e.: using extra lists such as EasyPrivacy and more).\n     */\n    static fromPrebuiltAdsAndTracking(fetchImpl = fetch, caching) {\n        return this.fromLists(fetchImpl, adsAndTrackingLists, {}, caching);\n    }\n    /**\n     * Same as `fromPrebuiltAdsAndTracking(...)` but also contains annoyances\n     * rules to block things like cookie notices.\n     */\n    static fromPrebuiltFull(fetchImpl = fetch, caching) {\n        return this.fromLists(fetchImpl, fullLists, {}, caching);\n    }\n    static fromTrackerDB(rawJsonDump, options = {}) {\n        const config = new Config(options);\n        const metadata = new Metadata(rawJsonDump);\n        const filters = [];\n        for (const pattern of metadata.getPatterns()) {\n            filters.push(...pattern.filters);\n        }\n        const engine = this.parse(filters.join('\\n'), config);\n        engine.metadata = metadata;\n        return engine;\n    }\n    static parse(filters, options = {}) {\n        const config = new Config(options);\n        return new this({\n            ...parseFilters(filters, config),\n            config,\n        });\n    }\n    static deserialize(serialized) {\n        const buffer = StaticDataView.fromUint8Array(serialized, {\n            enableCompression: false,\n        });\n        // Before starting deserialization, we make sure that the version of the\n        // serialized engine is the same as the current source code. If not, we\n        // start fresh and create a new engine from the lists.\n        const serializedEngineVersion = buffer.getUint16();\n        if (ENGINE_VERSION !== serializedEngineVersion) {\n            throw new Error(`serialized engine version mismatch, expected ${ENGINE_VERSION} but got ${serializedEngineVersion}`);\n        }\n        // Create a new engine with same options\n        const config = Config.deserialize(buffer);\n        // Optionally turn compression ON\n        if (config.enableCompression) {\n            buffer.enableCompression();\n        }\n        // Also make sure that the built-in checksum is correct. This allows to\n        // detect data corruption and start fresh if the serialized version was\n        // altered.\n        if (config.integrityCheck) {\n            const currentPos = buffer.pos;\n            buffer.pos = serialized.length - 4;\n            const checksum = buffer.checksum();\n            const expected = buffer.getUint32();\n            if (checksum !== expected) {\n                throw new Error(`serialized engine checksum mismatch, expected ${expected} but got ${checksum}`);\n            }\n            buffer.pos = currentPos;\n        }\n        const engine = new this({ config });\n        // Deserialize resources\n        engine.resources = Resources.deserialize(buffer);\n        // Deserialize lists\n        const lists = new Map();\n        const numberOfLists = buffer.getUint16();\n        for (let i = 0; i < numberOfLists; i += 1) {\n            lists.set(buffer.getASCII(), buffer.getASCII());\n        }\n        engine.lists = lists;\n        // Deserialize preprocessors\n        engine.preprocessors = PreprocessorBucket.deserialize(buffer);\n        // Deserialize buckets\n        engine.importants = NetworkFilterBucket.deserialize(buffer, config);\n        engine.redirects = NetworkFilterBucket.deserialize(buffer, config);\n        engine.filters = NetworkFilterBucket.deserialize(buffer, config);\n        engine.exceptions = NetworkFilterBucket.deserialize(buffer, config);\n        engine.csp = NetworkFilterBucket.deserialize(buffer, config);\n        engine.cosmetics = CosmeticFilterBucket.deserialize(buffer, config);\n        engine.hideExceptions = NetworkFilterBucket.deserialize(buffer, config);\n        // Optionally deserialize metadata\n        const hasMetadata = buffer.getBool();\n        if (hasMetadata) {\n            engine.metadata = Metadata.deserialize(buffer);\n        }\n        buffer.seekZero();\n        return engine;\n    }\n    constructor({ \n    // Optionally initialize the engine with filters\n    cosmeticFilters = [], networkFilters = [], preprocessors = [], config = new Config(), lists = new Map(), } = {}) {\n        super(); // init super-class EventEmitter\n        this.config = new Config(config);\n        // Subscription management: disabled by default\n        this.lists = lists;\n        // Preprocessors\n        this.preprocessors = new PreprocessorBucket({});\n        // $csp=\n        this.csp = new NetworkFilterBucket({ config: this.config });\n        // $elemhide\n        // $generichide\n        // $specifichide\n        this.hideExceptions = new NetworkFilterBucket({ config: this.config });\n        // @@filter\n        this.exceptions = new NetworkFilterBucket({ config: this.config });\n        // $important\n        this.importants = new NetworkFilterBucket({ config: this.config });\n        // $redirect\n        this.redirects = new NetworkFilterBucket({ config: this.config });\n        // All other filters\n        this.filters = new NetworkFilterBucket({ config: this.config });\n        // Cosmetic filters\n        this.cosmetics = new CosmeticFilterBucket({ config: this.config });\n        // Injections\n        this.resources = new Resources();\n        if (networkFilters.length !== 0 || cosmeticFilters.length !== 0) {\n            this.update({\n                newCosmeticFilters: cosmeticFilters,\n                newNetworkFilters: networkFilters,\n                newPreprocessors: preprocessors,\n            });\n        }\n    }\n    isFilterExcluded(filter) {\n        return this.preprocessors.isFilterExcluded(filter);\n    }\n    updateEnv(env) {\n        this.preprocessors.updateEnv(env);\n    }\n    /**\n     * Estimate the number of bytes needed to serialize this instance of\n     * `FiltersEngine` using the `serialize(...)` method. It is used internally\n     * by `serialize(...)` to allocate a buffer of the right size and you should\n     * not have to call it yourself most of the time.\n     *\n     * There are cases where we cannot estimate statically the exact size of the\n     * resulting buffer (due to alignement which needs to be performed); this\n     * method will return a safe estimate which will always be at least equal to\n     * the real number of bytes needed, or bigger (usually of a few bytes only:\n     * ~20 bytes is to be expected).\n     */\n    getSerializedSize() {\n        let estimatedSize = sizeOfByte() + // engine version\n            this.config.getSerializedSize() +\n            this.resources.getSerializedSize() +\n            this.preprocessors.getSerializedSize() +\n            this.filters.getSerializedSize() +\n            this.exceptions.getSerializedSize() +\n            this.importants.getSerializedSize() +\n            this.redirects.getSerializedSize() +\n            this.csp.getSerializedSize() +\n            this.cosmetics.getSerializedSize() +\n            this.hideExceptions.getSerializedSize() +\n            4; // checksum\n        // Estimate size of `this.lists` which stores information of checksum for each list.\n        for (const [name, checksum] of this.lists) {\n            estimatedSize += sizeOfASCII(name) + sizeOfASCII(checksum);\n        }\n        estimatedSize += sizeOfBool();\n        if (this.metadata !== undefined) {\n            estimatedSize += this.metadata.getSerializedSize();\n        }\n        return estimatedSize;\n    }\n    /**\n     * Creates a binary representation of the full engine. It can be stored\n     * on-disk for faster loading of the adblocker. The `deserialize` static\n     * method of Engine can be used to restore the engine.\n     */\n    serialize(array) {\n        const buffer = StaticDataView.fromUint8Array(array || new Uint8Array(this.getSerializedSize()), this.config);\n        buffer.pushUint16(ENGINE_VERSION);\n        // Config\n        this.config.serialize(buffer);\n        // Resources (js, resources)\n        this.resources.serialize(buffer);\n        // Serialize the state of lists (names and checksums)\n        buffer.pushUint16(this.lists.size);\n        for (const [name, value] of Array.from(this.lists.entries()).sort()) {\n            buffer.pushASCII(name);\n            buffer.pushASCII(value);\n        }\n        // Preprocessors\n        this.preprocessors.serialize(buffer);\n        // Filters buckets\n        this.importants.serialize(buffer);\n        this.redirects.serialize(buffer);\n        this.filters.serialize(buffer);\n        this.exceptions.serialize(buffer);\n        this.csp.serialize(buffer);\n        this.cosmetics.serialize(buffer);\n        this.hideExceptions.serialize(buffer);\n        // Optionally serialize metadata\n        buffer.pushBool(this.metadata !== undefined);\n        if (this.metadata !== undefined) {\n            this.metadata.serialize(buffer);\n        }\n        // Optionally append a checksum at the end\n        if (this.config.integrityCheck) {\n            buffer.pushUint32(buffer.checksum());\n        }\n        return buffer.subarray();\n    }\n    /**\n     * Update engine with new filters or resources.\n     */\n    loadedLists() {\n        return Array.from(this.lists.keys());\n    }\n    hasList(name, checksum) {\n        return this.lists.has(name) && this.lists.get(name) === checksum;\n    }\n    /**\n     * Update engine with `resources.txt` content.\n     */\n    updateResources(data, checksum) {\n        if (this.resources.checksum === checksum) {\n            return false;\n        }\n        this.resources = Resources.parse(data, { checksum });\n        return true;\n    }\n    getFilters() {\n        const cosmeticFilters = [];\n        const networkFilters = [];\n        return {\n            cosmeticFilters: cosmeticFilters.concat(this.cosmetics.getFilters()),\n            networkFilters: networkFilters.concat(this.filters.getFilters(), this.exceptions.getFilters(), this.importants.getFilters(), this.redirects.getFilters(), this.csp.getFilters(), this.hideExceptions.getFilters()),\n        };\n    }\n    /**\n     * Update engine with new filters as well as optionally removed filters.\n     */\n    update({ newNetworkFilters = [], newCosmeticFilters = [], newPreprocessors = [], removedCosmeticFilters = [], removedNetworkFilters = [], removedPreprocessors = [], }, env = new Env()) {\n        let updated = false;\n        // Update preprocessors\n        if (this.config.loadPreprocessors &&\n            (newPreprocessors.length !== 0 || removedPreprocessors.length !== 0)) {\n            updated = true;\n            this.preprocessors.update({\n                added: newPreprocessors,\n                removed: removedPreprocessors,\n            }, env);\n        }\n        // Update cosmetic filters\n        if (this.config.loadCosmeticFilters &&\n            (newCosmeticFilters.length !== 0 || removedCosmeticFilters.length !== 0)) {\n            updated = true;\n            this.cosmetics.update(newCosmeticFilters, removedCosmeticFilters.length === 0 ? undefined : new Set(removedCosmeticFilters), this.config);\n        }\n        // Update network filters\n        if (this.config.loadNetworkFilters &&\n            (newNetworkFilters.length !== 0 || removedNetworkFilters.length !== 0)) {\n            updated = true;\n            const filters = [];\n            const csp = [];\n            const exceptions = [];\n            const importants = [];\n            const redirects = [];\n            const hideExceptions = [];\n            for (const filter of newNetworkFilters) {\n                // NOTE: it's important to check for $generichide, $elemhide,\n                // $specifichide and $csp before exceptions and important as we store\n                // all of them in the same filter bucket. The check for exceptions is\n                // done at match-time directly.\n                if (filter.isCSP()) {\n                    csp.push(filter);\n                }\n                else if (filter.isGenericHide() || filter.isSpecificHide()) {\n                    hideExceptions.push(filter);\n                }\n                else if (filter.isException()) {\n                    exceptions.push(filter);\n                }\n                else if (filter.isImportant()) {\n                    importants.push(filter);\n                }\n                else if (filter.isRedirect()) {\n                    redirects.push(filter);\n                }\n                else {\n                    filters.push(filter);\n                }\n            }\n            const removedNetworkFiltersSet = removedNetworkFilters.length === 0 ? undefined : new Set(removedNetworkFilters);\n            // Update buckets in-place\n            this.importants.update(importants, removedNetworkFiltersSet);\n            this.redirects.update(redirects, removedNetworkFiltersSet);\n            this.filters.update(filters, removedNetworkFiltersSet);\n            if (this.config.loadExceptionFilters === true) {\n                this.exceptions.update(exceptions, removedNetworkFiltersSet);\n            }\n            if (this.config.loadCSPFilters === true) {\n                this.csp.update(csp, removedNetworkFiltersSet);\n            }\n            this.hideExceptions.update(hideExceptions, removedNetworkFiltersSet);\n        }\n        return updated;\n    }\n    updateFromDiff({ added, removed, preprocessors }, env) {\n        const newCosmeticFilters = [];\n        const newNetworkFilters = [];\n        const newPreprocessors = [];\n        const removedCosmeticFilters = [];\n        const removedNetworkFilters = [];\n        const removedPreprocessors = [];\n        if (removed !== undefined && removed.length !== 0) {\n            const { networkFilters, cosmeticFilters } = parseFilters(removed.join('\\n'), this.config);\n            Array.prototype.push.apply(removedCosmeticFilters, cosmeticFilters);\n            Array.prototype.push.apply(removedNetworkFilters, networkFilters);\n        }\n        if (added !== undefined && added.length !== 0) {\n            const { networkFilters, cosmeticFilters } = parseFilters(added.join('\\n'), this.config);\n            Array.prototype.push.apply(newCosmeticFilters, cosmeticFilters);\n            Array.prototype.push.apply(newNetworkFilters, networkFilters);\n        }\n        if (preprocessors !== undefined) {\n            for (const [condition, details] of Object.entries(preprocessors)) {\n                if (details.removed !== undefined && details.removed.length !== 0) {\n                    const { networkFilters, cosmeticFilters } = parseFilters(details.removed.join('\\n'), this.config);\n                    const filterIDs = new Set([]\n                        .concat(cosmeticFilters.map((filter) => filter.getId()))\n                        .concat(networkFilters.map((filter) => filter.getId())));\n                    removedPreprocessors.push(new Preprocessor({\n                        condition,\n                        filterIDs,\n                    }));\n                }\n                if (details.added !== undefined && details.added.length !== 0) {\n                    const { networkFilters, cosmeticFilters } = parseFilters(details.added.join('\\n'), this.config);\n                    const filterIDs = new Set([]\n                        .concat(cosmeticFilters.map((filter) => filter.getId()))\n                        .concat(networkFilters.map((filter) => filter.getId())));\n                    newPreprocessors.push(new Preprocessor({\n                        condition,\n                        filterIDs,\n                    }));\n                }\n            }\n        }\n        return this.update({\n            newCosmeticFilters,\n            newNetworkFilters,\n            newPreprocessors,\n            removedCosmeticFilters: removedCosmeticFilters.map((f) => f.getId()),\n            removedNetworkFilters: removedNetworkFilters.map((f) => f.getId()),\n            removedPreprocessors,\n        }, env);\n    }\n    /**\n     * Return a list of HTML filtering rules.\n     */\n    getHtmlFilters({ \n    // Page information\n    url, hostname, domain, }) {\n        const htmlSelectors = [];\n        if (this.config.enableHtmlFiltering === false || this.config.loadCosmeticFilters === false) {\n            return htmlSelectors;\n        }\n        const rules = this.cosmetics.getHtmlRules({\n            domain: domain || '',\n            hostname,\n            isFilterExcluded: this.isFilterExcluded.bind(this),\n        });\n        for (const rule of rules) {\n            const extended = rule.getExtendedSelector();\n            if (extended !== undefined) {\n                htmlSelectors.push(extended);\n            }\n        }\n        if (htmlSelectors.length !== 0) {\n            this.emit('html-filtered', htmlSelectors, url);\n        }\n        return htmlSelectors;\n    }\n    /**\n     * Given `hostname` and `domain` of a page (or frame), return the list of\n     * styles and scripts to inject in the page.\n     */\n    getCosmeticsFilters({ \n    // Page information\n    url, hostname, domain, \n    // DOM information\n    classes, hrefs, ids, \n    // Allows to specify which rules to return\n    getBaseRules = true, getInjectionRules = true, getExtendedRules = true, getRulesFromDOM = true, getRulesFromHostname = true, }) {\n        if (this.config.loadCosmeticFilters === false) {\n            return {\n                active: false,\n                extended: [],\n                scripts: [],\n                styles: '',\n            };\n        }\n        let allowGenericHides = true;\n        let allowSpecificHides = true;\n        const exceptions = this.hideExceptions.matchAll(Request.fromRawDetails({\n            domain: domain || '',\n            hostname,\n            url,\n            sourceDomain: '',\n            sourceHostname: '',\n            sourceUrl: '',\n        }), this.isFilterExcluded.bind(this));\n        const genericHides = [];\n        const specificHides = [];\n        for (const filter of exceptions) {\n            if (filter.isElemHide()) {\n                allowGenericHides = false;\n                allowSpecificHides = false;\n                break;\n            }\n            if (filter.isSpecificHide()) {\n                specificHides.push(filter);\n            }\n            else if (filter.isGenericHide()) {\n                genericHides.push(filter);\n            }\n        }\n        if (allowGenericHides === true) {\n            allowGenericHides = shouldApplyHideException(genericHides) === false;\n        }\n        if (allowSpecificHides === true) {\n            allowSpecificHides = shouldApplyHideException(specificHides) === false;\n        }\n        // Lookup injections as well as stylesheets\n        const { injections, stylesheet, extended } = this.cosmetics.getCosmeticsFilters({\n            domain: domain || '',\n            hostname,\n            classes,\n            hrefs,\n            ids,\n            allowGenericHides,\n            allowSpecificHides,\n            getBaseRules,\n            getInjectionRules,\n            getExtendedRules,\n            getRulesFromDOM,\n            getRulesFromHostname,\n            isFilterExcluded: this.isFilterExcluded.bind(this),\n        });\n        // Perform interpolation for injected scripts\n        const scripts = [];\n        for (const injection of injections) {\n            const script = injection.getScript(this.resources.js);\n            if (script !== undefined) {\n                this.emit('script-injected', script, url);\n                scripts.push(script);\n            }\n        }\n        // Emit events\n        if (stylesheet.length !== 0) {\n            this.emit('style-injected', stylesheet, url);\n        }\n        return {\n            active: true,\n            extended,\n            scripts,\n            styles: stylesheet,\n        };\n    }\n    /**\n     * Given a `request`, return all matching network filters found in the engine.\n     */\n    matchAll(request) {\n        const filters = [];\n        if (request.isSupported) {\n            Array.prototype.push.apply(filters, this.importants.matchAll(request, this.isFilterExcluded.bind(this)));\n            Array.prototype.push.apply(filters, this.filters.matchAll(request, this.isFilterExcluded.bind(this)));\n            Array.prototype.push.apply(filters, this.exceptions.matchAll(request, this.isFilterExcluded.bind(this)));\n            Array.prototype.push.apply(filters, this.csp.matchAll(request, this.isFilterExcluded.bind(this)));\n            Array.prototype.push.apply(filters, this.hideExceptions.matchAll(request, this.isFilterExcluded.bind(this)));\n            Array.prototype.push.apply(filters, this.redirects.matchAll(request, this.isFilterExcluded.bind(this)));\n        }\n        return new Set(filters);\n    }\n    /**\n     * Given a \"main_frame\" request, check if some content security policies\n     * should be injected in the page.\n     */\n    getCSPDirectives(request) {\n        if (!this.config.loadNetworkFilters) {\n            return undefined;\n        }\n        if (request.isSupported !== true || request.isMainFrame() === false) {\n            return undefined;\n        }\n        const matches = this.csp.matchAll(request, this.isFilterExcluded.bind(this));\n        // No $csp filter found\n        if (matches.length === 0) {\n            return undefined;\n        }\n        // Collect all CSP directives and keep track of exceptions\n        const disabledCsp = new Set();\n        const enabledCsp = new Set();\n        for (const filter of matches) {\n            if (filter.isException()) {\n                if (filter.csp === undefined) {\n                    // All CSP directives are disabled for this site\n                    return undefined;\n                }\n                disabledCsp.add(filter.csp);\n            }\n            else {\n                enabledCsp.add(filter.csp);\n            }\n        }\n        // Combine all CSPs (except the black-listed ones)\n        const csps = Array.from(enabledCsp)\n            .filter((csp) => !disabledCsp.has(csp))\n            .join('; ') || undefined;\n        // Emit event\n        if (csps !== undefined) {\n            this.emit('csp-injected', csps, request);\n        }\n        return csps;\n    }\n    /**\n     * Decide if a network request (usually from WebRequest API) should be\n     * blocked, redirected or allowed.\n     */\n    match(request, withMetadata = false) {\n        const result = {\n            exception: undefined,\n            filter: undefined,\n            match: false,\n            redirect: undefined,\n            metadata: undefined,\n        };\n        if (!this.config.loadNetworkFilters) {\n            return result;\n        }\n        if (request.isSupported) {\n            // Check the filters in the following order:\n            // 1. $important (not subject to exceptions)\n            // 2. redirection ($redirect=resource)\n            // 3. normal filters\n            // 4. exceptions\n            result.filter = this.importants.match(request, this.isFilterExcluded.bind(this));\n            let redirectNone;\n            let redirectRule;\n            // If `result.filter` is `undefined`, it means there was no $important\n            // filter found so far. We look for a $redirect filter.  There is some\n            // extra logic to handle special cases like redirect-rule and\n            // redirect=none.\n            //\n            // * If redirect=none is found, then cancel all redirects.\n            // * Else if redirect-rule is found, only redirect if request would be blocked.\n            // * Else if redirect is found, redirect.\n            if (result.filter === undefined) {\n                const redirects = this.redirects.matchAll(request, this.isFilterExcluded.bind(this));\n                if (redirects.length !== 0) {\n                    for (const filter of redirects) {\n                        if (filter.getRedirect() === 'none') {\n                            redirectNone = filter;\n                        }\n                        else if (filter.isRedirectRule()) {\n                            redirectRule = filter;\n                        }\n                        else {\n                            result.filter = filter;\n                        }\n                    }\n                }\n                // If `result.filter` is still `undefined`, it means that there was no\n                // redirection rule triggered for the request. We look for a normal\n                // match.\n                if (result.filter === undefined) {\n                    result.filter = this.filters.match(request, this.isFilterExcluded.bind(this));\n                    // If we found a match, and a `$redirect-rule` as found previously,\n                    // then we transform the match into a redirect, following the\n                    // semantics of redirect-rule.\n                    if (redirectRule !== undefined && result.filter !== undefined) {\n                        result.filter = redirectRule;\n                    }\n                }\n                // If we found either a redirection rule or a normal match, then check\n                // for exceptions which could apply on the request and un-block it.\n                if (result.filter !== undefined) {\n                    result.exception = this.exceptions.match(request, this.isFilterExcluded.bind(this));\n                }\n            }\n            // If there was a redirect match and no exception was found, then we\n            // proceed and process the redirect rule. This means two things:\n            //\n            // 1. Check if a redirect=none rule was found, which acts as exception.\n            // 2. If no exception was found, prepare `result.redirect` response.\n            if (result.filter !== undefined &&\n                result.exception === undefined &&\n                result.filter.isRedirect()) {\n                if (redirectNone !== undefined) {\n                    result.exception = redirectNone;\n                }\n                else {\n                    result.redirect = this.resources.getResource(result.filter.getRedirect());\n                }\n            }\n        }\n        result.match = result.exception === undefined && result.filter !== undefined;\n        // Emit events if we found a match\n        if (result.exception !== undefined) {\n            this.emit('request-whitelisted', request, result);\n        }\n        else if (result.redirect !== undefined) {\n            this.emit('request-redirected', request, result);\n        }\n        else if (result.filter !== undefined) {\n            this.emit('request-blocked', request, result);\n        }\n        else {\n            this.emit('request-allowed', request, result);\n        }\n        if (withMetadata === true && result.filter !== undefined && this.metadata) {\n            result.metadata = this.metadata.fromFilter(result.filter);\n        }\n        return result;\n    }\n    getPatternMetadata(request, { getDomainMetadata = false } = {}) {\n        if (this.metadata === undefined) {\n            return [];\n        }\n        const seenPatterns = new Set();\n        const patterns = [];\n        for (const filter of this.matchAll(request)) {\n            for (const patternInfo of this.metadata.fromFilter(filter)) {\n                if (!seenPatterns.has(patternInfo.pattern.key)) {\n                    seenPatterns.add(patternInfo.pattern.key);\n                    patterns.push(patternInfo);\n                }\n            }\n        }\n        if (getDomainMetadata) {\n            for (const patternInfo of this.metadata.fromDomain(request.hostname)) {\n                if (!seenPatterns.has(patternInfo.pattern.key)) {\n                    seenPatterns.add(patternInfo.pattern.key);\n                    patterns.push(patternInfo);\n                }\n            }\n        }\n        return patterns;\n    }\n    blockScripts() {\n        this.updateFromDiff({\n            added: [block().scripts().redirectTo('javascript').toString()],\n        });\n        return this;\n    }\n    blockImages() {\n        this.updateFromDiff({\n            added: [block().images().redirectTo('png').toString()],\n        });\n        return this;\n    }\n    blockMedias() {\n        this.updateFromDiff({\n            added: [block().medias().redirectTo('mp4').toString()],\n        });\n        return this;\n    }\n    blockFrames() {\n        this.updateFromDiff({\n            added: [block().frames().redirectTo('html').toString()],\n        });\n        return this;\n    }\n    blockFonts() {\n        this.updateFromDiff({\n            added: [block().fonts().toString()],\n        });\n        return this;\n    }\n    blockStyles() {\n        this.updateFromDiff({\n            added: [block().styles().toString()],\n        });\n        return this;\n    }\n}\n//# sourceMappingURL=engine.js.map","/*!\n * Copyright (c) 2017-present Cliqz GmbH. All rights reserved.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at https://mozilla.org/MPL/2.0/.\n */\n/*!\n * Copyright (c) 2008-2009 Bjoern Hoehrmann <bjoern@hoehrmann.de>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n */\n// From http://bjoern.hoehrmann.de/utf-8/decoder/dfa/\nconst utf8d = new Uint8Array([\n    /* eslint-disable prettier/prettier */\n    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 00..1f\n    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 20..3f\n    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 40..5f\n    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 60..7f\n    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, // 80..9f\n    7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, // a0..bf\n    8, 8, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, // c0..df\n    0xa, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x4, 0x3, 0x3, // e0..ef\n    0xb, 0x6, 0x6, 0x6, 0x5, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, 0x8, // f0..ff\n    0x0, 0x1, 0x2, 0x3, 0x5, 0x8, 0x7, 0x1, 0x1, 0x1, 0x4, 0x6, 0x1, 0x1, 0x1, 0x1, // s0..s0\n    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, // s1..s2\n    1, 2, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, // s3..s4\n    1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1, 1, 1, 1, 1, 1, // s5..s6\n    1, 3, 1, 1, 1, 1, 1, 3, 1, 3, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // s7..s8\n    /* eslint-enable prettier/prettier */\n]);\nfunction isAscii(bytes) {\n    if (bytes.length === 0) {\n        return true;\n    }\n    for (let i = 0; i < bytes.length; i += 1) {\n        if (bytes[i] > 127) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function isUTF8(bytes) {\n    if (bytes.length === 0) {\n        return true;\n    }\n    if (isAscii(bytes) === true) {\n        return true;\n    }\n    let state = 0;\n    for (let i = 0; i < bytes.length; i += 1) {\n        const type = utf8d[bytes[i]];\n        state = utf8d[256 + state * 16 + type];\n        if (state === 1 || state === undefined) {\n            return false;\n        }\n    }\n    return true;\n}\n//# sourceMappingURL=encoding.js.map"],"names":["cosmeticSelectorCodebook","networkCSPCodebook","networkFilterCodebook","networkHostnameCodebook","networkRedirectCodebook","networkRawCodebook","cosmeticRawCodebook","Compression","constructor","this","cosmeticSelector","Smaz","networkCSP","networkRedirect","networkHostname","networkFilter","networkRaw","cosmeticRaw","T","c","table","Int32Array","n","maxInt","base","tMin","tMax","skew","damp","initialBias","initialN","delimiter","regexNonASCII","regexSeparators","errors","overflow","baseMinusTMin","error","type","RangeError","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","k","Math","floor","decode","input","output","inputLength","length","i","bias","basic","lastIndexOf","j","charCodeAt","push","index","oldi","w","codePoint","t","baseMinusT","out","splice","String","fromCodePoint","apply","encode","str","counter","value","extra","ucs2decode","currentValue","fromCharCode","basicLength","handledCPCount","m","handledCPCountPlusOne","q","qMinusT","join","toASCII","labels","replace","split","encoded","test","EMPTY_UINT8_ARRAY","Uint8Array","EMPTY_UINT32_ARRAY","Uint32Array","LITTLE_ENDIAN","Int8Array","Int16Array","buffer","promise","getCompressionSingleton","COMPRESSION","sizeOfLength","sizeOfBytes","array","align","sizeOfBytesWithLength","sizeOfASCII","sizeOfUTF8","encodedLength","sizeOfUint32Array","byteLength","StaticDataView","empty","options","fromUint8Array","allocate","capacity","enableCompression","Error","pos","compression","checksum","buf","start","end","C","L","crc32","dataAvailable","setPos","getPos","seekZero","slice","checkSize","subarray","align4","set","pushBool","bool","pushByte","Number","getBool","Boolean","getByte","setByte","byte","octet","pushUint8","getUint8","pushBytes","bytes","pushLength","getBytes","numberOfBytes","getLength","getUint32ArrayView","desiredSize","view","byteOffset","uint8","pushUint16","uint16","getUint16","pushUint32","uint32","getUint32","pushUint32Array","arr","getUint32Array","pushUTF8","raw","getUTF8","pushASCII","getASCII","pushNetworkRedirect","undefined","compress","getNetworkRedirect","decompress","pushNetworkHostname","getNetworkHostname","pushNetworkCSP","getNetworkCSP","pushNetworkFilter","getNetworkFilter","pushCosmeticSelector","getCosmeticSelector","pushRawCosmetic","getRawCosmetic","pushRawNetwork","getRawNetwork","lengthShort","Config","deserialize","debug","enableHtmlFiltering","enableInMemoryCache","enableMutationObserver","enableOptimizations","enablePushInjectionsOnNavigationEvents","guessRequestTypeFromUrl","integrityCheck","loadCSPFilters","loadCosmeticFilters","loadExceptionFilters","loadExtendedSelectors","loadGenericCosmeticsFilters","loadNetworkFilters","loadPreprocessors","getSerializedSize","serialize","queueMicrotask","window","cb","Promise","resolve","then","catch","err","setTimeout","registerCallback","event","callback","listeners","listenersForEvent","get","unregisterCallback","indexOfCallback","indexOf","triggerCallback","args","size","listener","EventEmitter","onceListeners","Map","onListeners","on","once","unsubscribe","emit","delete","fetchWithRetry","fetch","url","retry","fetchWrapper","ex","reject","fetchResource","response","text","PREFIX","adsLists","adsAndTrackingLists","fullLists","fetchLists","urls","all","map","fetchResources","NetworkBuilder","Set","prefix","infix","suffix","redirect","blockRequestsWithType","has","add","images","scripts","frames","fonts","medias","styles","redirectTo","urlContains","urlStartsWith","urlEndsWith","withHostname","hostname","toString","parts","option","block","TOKENS_BUFFER","reset","token","full","remaining","HASH_INTERNAL_MULT","HASH_SEED","bitCount","getBit","mask","setBit","clearBit","fastHashBetween","begin","hash","fastHash","hashStrings","strings","result","fastStartsWith","haystack","needle","ceil","fastStartsWithFrom","isDigit","ch","isAlpha","isAllowedCode","isAlphaExtended","isCyrillic","tokenizeInPlace","pattern","skipFirstToken","skipLastToken","len","min","inside","tokenizeNoSkipInPlace","tokenizeNoSkip","binLookup","elt","low","high","mid","midVal","binSearch","hasUnicodeRe","hasUnicode","TLDTS_OPTIONS","extractHostname","mixedInputs","validateHostname","NORMALIZED_TYPE_TOKEN","beacon","cspReport","csp_report","cspviolationreport","document","eventsource","font","image","imageset","mainFrame","main_frame","manifest","media","object","object_subrequest","other","ping","prefetch","preflight","script","signedexchange","speculative","stylesheet","subFrame","sub_frame","texttrack","webSocket","web_manifest","websocket","xhr","xml_dtd","xmlhttprequest","xslt","hashHostnameBackward","getHashesFromLabelsBackward","startOfDomain","code","getEntityHashesFromLabelsBackward","domain","hostnameWithoutPublicSuffix","indexOfDot","publicSuffix","getHostnameWithoutPublicSuffix","getHostnameHashesFromLabelsBackward","Request","fromRawDetails","requestId","tabId","sourceUrl","sourceHostname","sourceDomain","_originalRequestDetails","toLowerCase","parsed","parse","tokens","hostnameHashes","entityHashes","id","sourceHostnameHashes","sourceEntityHashes","isThirdParty","isFirstParty","isSupported","startsWith","isHttp","isHttps","indexOfComa","getHostnameHashes","getEntityHashes","getTokens","isMainFrame","isSubFrame","guessTypeOfRequest","currentType","guessUrlType","Domains","entities","notEntities","hostnames","notHostnames","negation","entity","sort","optionalParts","updateId","notHostname","notEntity","estimate","match","extractHTMLSelectorFromRule","rule","selectors","currentParsingDepth","startOfSelectorIndex","prev","tagShouldBeRemoved","tag","plainPatterns","regexpPatterns","EMPTY_TOKENS","DEFAULT_HIDDING_STYLE","REGEXP_UNICODE_COMMA","RegExp","REGEXP_UNICODE_BACKSLASH","REGEXP_ESCAPED_COMMA","isSimpleSelector","selector","nextCode","isSimpleHrefSelector","isValidCss","div","createElement","matches","validSelectorRe","CosmeticFilter","line","rawLine","domains","style","sharpIndex","afterSharpIndex","suffixStartIndex","endsWith","indexOfStyle","selectorType","classifySelector","SelectorType","Extended","Invalid","c0","c1","c2","isUnicode","isCosmeticFilter","isNetworkFilter","getCompressedSize","sizeOfCosmeticSelector","sizeOfRawCosmetic","filter","isUnhide","isScriptInject","hasHostnameConstraint","isIdSelector","isClassSelector","endOfSelector","isHrefSelector","getSelector","hrefIndex","hrefEnd","tokenize","parseScript","lastComaIndex","inDoubleQuotes","inSingleQuotes","inRegexp","objectNesting","lastCharIsBackslash","inArgument","char","trim","part","substring","name","getScript","js","arg","getId","computeFilterId","hasCustomStyle","getStyle","getStyleAttributeHash","getSelectorAST","parseCssSelector","getExtendedSelector","isExtended","isRemove","isCSS","isHtmlFiltering","isGenericHide","_a","_b","HTTP_HASH","HTTPS_HASH","FROM_ANY","REQUEST_TYPE_TO_MASK","getListOfRequestTypes","types","fromDocument","fromImage","fromMedia","fromObject","fromOther","fromPing","fromScript","fromStylesheet","fromSubdocument","fromWebsocket","fromXmlHttpRequest","fromFont","csp","denyallow","compileRegex","isLeftAnchor","isRightAnchor","isFullRegex","MATCH_ALL","NetworkFilter","cptMaskPositive","cptMaskNegative","filterIndexStart","filterIndexEnd","optionsIndex","character","lastIndex","findLastIndexOfUnescapedCharacter","rawOption","optionValue","indexOfEqual","optionMask","firstSeparator","separatorCode","setNetworkMask","indexOfSeparator","indexOfWildcard","checkIsRegex","regex","request","isCptAllowed","fromHttps","fromHttp","firstParty","thirdParty","checkOptions","getFilter","isHostnameAnchor","filterHostname","getHostname","isFollowedByWildcard","matchIndex","isAnchoredByHostname","isRegex","getRegex","requestHostname","hasFilter","checkPattern","sizeOfNetworkCSP","sizeOfNetworkFilter","sizeOfNetworkHostname","sizeOfRawNetwork","sizeOfNetworkRedirect","modifierReplacer","isException","hasHostname","source","fromAny","numberOfCptOptions","getCptMask","getListOfRequestTypesNegated","isImportant","isRedirectRule","getRedirect","isRedirect","isCSP","isElemHide","isSpecificHide","isBadFilter","getIdWithoutBadFilter","hasDomains","getMask","precedingCh","tokenizeWithWildcardsInPlace","tokenizeRegexInPlace","cpt","isPlain","Env","detectPreprocessor","tokenizerPattern","identifierPattern","precedence","isOperator","Object","prototype","hasOwnProperty","call","testIdentifier","identifier","env","evaluate","expression","isIdentifier","reduce","partialSum","stack","pop","right","left","Preprocessor","getCondition","filterIDs","condition","l","filterID","estimatedSize","detectFilterType","firstCharCode","secondCharCode","lastCharCode","dollarIndex","afterDollarIndex","afterDollarCharCode","afterSharpCharCode","parseFilter","filterType","parseFilters","list","config","networkFilters","cosmeticFilters","lines","preprocessors","preprocessorStack","nextLine","preprocessorToken","lastPreprocessor","preprocessor","getFilters","filters","concat","Resources","resources","numberOfResources","contentType","body","forEach","data","typeToResource","chunks","chunk","resource","firstNewLine","key","entries","resourcesByName","getResource","getResourceForMime","dataUrl","btoa","Buffer","from","escape","s","setWithDefault","bucket","groupBy","criteria","grouped","Array","values","splitBy","positive","negative","OPTIMIZATIONS","description","fusion","groupByCriteria","select","assign","patterns","f","noopOptimizeNetwork","noopOptimizeCosmetic","optimizeNetwork","fused","toFuse","groups","group","nextPow2","v","UID","EMPTY_BUCKET","MAX_SAFE_INTEGER","ReverseIndex","optimize","tokensLookupIndexSize","bucketsIndexSize","numberOfFilters","tokensLookupIndex","bucketsIndex","filtersIndexStart","updateInternals","cache","deserializeFilter","update","iterMatchingFilters","getNextId","iterBucket","newFilters","removedFilters","clear","totalNumberOfTokens","totalNumberOfIndexedFilters","filtersTokens","estimatedBufferSize","f1","f2","histogram","max","multiTokens","suffixes","filterIndex","bestToken","minCount","tokenCount","indexInBucketsIndex","filtersForMask","offset","startOfBucket","endOfBucket","filtersIndices","lastRequestSeen","EMPTY_FILTERS","FiltersContainer","container","bufferSizeEstimation","selected","currentFilters","storedFiltersRemoved","numberOfExistingFilters","storedFiltersAdded","createStylesheet","rules","maximumNumberOfSelectors","styleStr","createStylesheetFromRulesWithCustomStyles","selectorsPerStyle","stylesheets","selectorsPerStyleArray","createStylesheetFromRules","createLookupTokens","hostnamesHashes","entitiesHashes","CosmeticFilterBucket","genericRules","classesIndex","hostnameIndex","hrefsIndex","htmlIndex","idsIndex","unhideIndex","baseStylesheet","extraGenericRules","classSelectors","genericHideRules","hostnameSpecificRules","hrefSelectors","htmlRules","idSelectors","unHideRules","getHtmlRules","isFilterExcluded","hostnameTokens","disabledRules","getCosmeticsFilters","classes","hrefs","ids","allowGenericHides","allowSpecificHides","getBaseRules","getInjectionRules","getExtendedRules","getRulesFromDOM","getRulesFromHostname","getGenericRules","sorted","compactTokens","arrays","totalSize","concatTypedArrays","href","extended","injections","injectionsDisabled","getBaseStylesheet","extendedProcessed","extendedStyles","ast","attribute","remove","lazyPopulateGenericRulesCache","canBeHiddenSelectors","cannotBeHiddenRules","canBeHiddenRules","NetworkFilterBucket","badFilters","badFiltersIds","matchAll","isFilterDisabled","badFilter","CompactMap","numberOfValues","valuesIndexStart","getKeys","deserializeValue","patternsKeys","keys","valueIndex","valuesForMask","getValues","cachedValues","valuesIndices","isValid","category","color","getKey","createMap","categories","organization","country","website_url","websiteUrl","privacy_policy_url","privacyPolicyUrl","privacy_contact","privacyContact","ghostery_id","ghosteryId","organizations","alias","isArray","every","parsedFilter","sizeOfDomains","sizeOfFilters","numberOfDomains","Metadata","metadata","deserializeCategory","deserializeOrganization","deserializePattern","rawTrackerDB","createOrganizationsMap","createCategoriesMap","createPatternsMap","rawPatterns","rawOrganizations","rawCategories","categoryWithKey","isValidCategory","console","organizationWithKey","isValidOrganization","patternWithKey","isValidPattern","getCategories","getOrganizations","getPatterns","fromFilter","fromId","fromDomain","domainParts","shift","subdomain","parsedDomainFilter","results","getCategoryKey","getOrganizationKey","PreprocessorBucket","excluded","updateEnv","added","removed","local","find","ENGINE_VERSION","shouldApplyHideException","genericHideFilter","currentScore","score","utf8d","fromCached","init","caching","path","read","write","engine","fromLists","listsPromises","resourcesPromise","lists","updateResources","fromPrebuiltAdsOnly","fetchImpl","fromPrebuiltAdsAndTracking","fromPrebuiltFull","fromTrackerDB","rawJsonDump","serialized","serializedEngineVersion","currentPos","expected","numberOfLists","importants","redirects","exceptions","cosmetics","hideExceptions","super","newCosmeticFilters","newNetworkFilters","newPreprocessors","loadedLists","hasList","removedCosmeticFilters","removedNetworkFilters","removedPreprocessors","updated","removedNetworkFiltersSet","updateFromDiff","details","getHtmlFilters","htmlSelectors","bind","active","genericHides","specificHides","injection","getCSPDirectives","disabledCsp","enabledCsp","csps","withMetadata","exception","redirectNone","redirectRule","getPatternMetadata","getDomainMetadata","seenPatterns","patternInfo","blockScripts","blockImages","blockMedias","blockFrames","blockFonts","blockStyles","extractSelectorsFromRules","flush","tags","rest","html","endOfLastTag","endOfTagIndex","indexOfClosingTag","lastClosingTagIndex","indexOfNextTag","extractTagsFromHtml","toRemove","filteredHtml","reverse","removeTagsFromHtml","selectTagsToRemove","prevRevision","newRevision","debugConfig","prevRevisionData","prevRevisionIds","newRevisionData","newRevisionIds","newPreprocessor","removedInScope","scope","addedInScope","isAscii","state","diffs","addedCumul","removedCumul","preprocessorsCumul","fromEntries"],"mappings":"mmBAQe,IAAAA,EAAA,CACX,+IACA,+IACA,4IACA,yFACA,0EACA,sEACA,8DACA,qDACA,kDACA,kDACA,2CACA,0CACA,yCACA,uCACA,qCACA,mCACA,iCACA,iCACA,+BACA,+BACA,6BACA,6BACA,4BACA,2BACA,2BACA,2BACA,2BACA,0BACA,sBACA,qBACA,qBACA,oBACA,oBACA,oBACA,oBACA,mBACA,kBACA,kBACA,kBACA,iBACA,iBACA,gBACA,gBACA,eACA,cACA,cACA,cACA,aACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KC9PWC,EAAA,CACX,qJACA,oFACA,mDACA,+CACA,8CACA,wCACA,qCACA,iCACA,gCACA,+BACA,2BACA,0BACA,wBACA,qBACA,oBACA,oBACA,oBACA,mBACA,mBACA,iBACA,eACA,eACA,cACA,aACA,aACA,aACA,aACA,YACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACA,SACA,SACA,SACA,QACA,QACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KClGWC,EAAA,CACX,0DACA,yDACA,uDACA,sDACA,6CACA,uCACA,4BACA,2BACA,yBACA,wBACA,uBACA,uBACA,uBACA,sBACA,mBACA,kBACA,iBACA,iBACA,iBACA,kBACA,kBACA,iBACA,eACA,cACA,aACA,aACA,YACA,YACA,YACA,YACA,YACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KC9PWC,EAAA,CACX,6BACA,0BACA,oBACA,oBACA,kBACA,gBACA,aACA,aACA,YACA,WACA,UACA,SACA,SACA,SACA,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KC9PWC,EAAA,CACX,oCACA,mCACA,8BACA,2BACA,0BACA,uBACA,mBACA,mBACA,kBACA,iBACA,gBACA,gBACA,gBACA,eACA,eACA,cACA,aACA,aACA,YACA,YACA,YACA,WACA,WACA,UACA,UACA,UACA,SACA,QACA,QACA,OACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KCjFWC,EAAA,CACX,uBACA,sBACA,oBACA,oBACA,oBACA,mBACA,kBACA,kBACA,iBACA,iBACA,gBACA,gBACA,cACA,cACA,aACA,YACA,WACA,WACA,WACA,UACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KC9PWC,EAAA,CACX,uBACA,uBACA,uBACA,uBACA,uBACA,uBACA,uBACA,uBACA,sBACA,qBACA,qBACA,mBACA,iBACA,iBACA,eACA,eACA,cACA,cACA,cACA,cACA,aACA,aACA,aACA,aACA,aACA,aACA,YACA,YACA,YACA,YACA,WACA,WACA,WACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,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"}